{
  "comments": [
    "Build ID: I20070625-1500\n\nSteps To Reproduce:\nRunning WTP 2.0 on a four-way SMP box I sometimes get ConcurrentModificationExceptions like below. Once this happens, WTP becomes pretty much unusable and I have to restart it to recover. I am using Linux and IBM Java 5 SR5.\n\nMore information:\n!STACK 0\njava.util.ConcurrentModificationException: concurrent access to HashMap attempted by Thread[org.eclipse.jdt.internal.ui.text.JavaReconciler,1,main]\n        at java.util.HashMap.onExit(HashMap.java:225)\n        at java.util.HashMap.transfer(HashMap.java:636)\n        at java.util.HashMap.resize(HashMap.java:622)\n        at java.util.HashMap.addEntry(HashMap.java:994)\n        at java.util.HashMap.put(HashMap.java:510)\n        at org.eclipse.core.internal.resources.NatureManager.setEnabledNatures(NatureManager.java:475)\n        at org.eclipse.core.internal.resources.NatureManager.getEnabledNatures(NatureManager.java:336)\n        at org.eclipse.core.internal.resources.NatureManager.isNatureEnabled(NatureManager.java:436)\n        at org.eclipse.core.internal.resources.Project.isNatureEnabled(Project.java:726)\n        at org.eclipse.wst.common.project.facet.core.internal.FacetedProjectFrameworkImpl.create(FacetedProjectFrameworkImpl.java:632)\n        at org.eclipse.wst.common.project.facet.core.ProjectFacetsManager.create(ProjectFacetsManager.java:344)\n        at org.eclipse.jst.j2ee.internal.project.J2EEProjectUtilities.isProjectOfType(J2EEProjectUtilities.java:528)\n        at org.eclipse.jst.j2ee.internal.project.J2EEProjectUtilities.getAllProjectsInWorkspaceOfType(J2EEProjectUtilities.java:667)\n        at org.eclipse.jst.j2ee.componentcore.J2EEModuleVirtualComponent.getManifestReferences(J2EEModuleVirtualComponent.java:251)\n        at org.eclipse.jst.j2ee.componentcore.J2EEModuleVirtualComponent.getReferences(J2EEModuleVirtualComponent.java:86)\n        at org.eclipse.jst.j2ee.componentcore.J2EEModuleVirtualComponent.getReferences(J2EEModuleVirtualComponent.java:79)\n        at org.eclipse.jst.common.jdt.internal.classpath.FlexibleProjectContainer.computeClasspathEntries(FlexibleProjectContainer.java:184)\n        at org.eclipse.jst.common.jdt.internal.classpath.FlexibleProjectContainer.\u003cinit\u003e(FlexibleProjectContainer.java:122)\n        at org.eclipse.jst.j2ee.internal.web.classpath.WebAppLibrariesContainer.\u003cinit\u003e(WebAppLibrariesContainer.java:48)\n        at org.eclipse.jst.j2ee.internal.web.classpath.WebAppLibrariesContainerInitializer.initialize(WebAppLibrariesContainerInitializer.java:34)\n        at org.eclipse.jdt.internal.core.JavaModelManager.initializeContainer(JavaModelManager.java:2203)\n        at org.eclipse.jdt.internal.core.JavaModelManager$9.run(JavaModelManager.java:2133)\n        at org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1797)\n        at org.eclipse.jdt.internal.core.JavaModelManager.initializeAllContainers(JavaModelManager.java:2149)\n        at org.eclipse.jdt.internal.core.JavaModelManager.getClasspathContainer(JavaModelManager.java:1543)\n        at org.eclipse.jdt.core.JavaCore.getClasspathContainer(JavaCore.java:1571)\n        at org.eclipse.jdt.internal.core.JavaProject.resolveClasspath(JavaProject.java:2558)\n        at org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath(JavaProject.java:1848)\n        at org.eclipse.jdt.internal.core.DeltaProcessingState.initializeRoots(DeltaProcessingState.java:202)\n        at org.eclipse.jdt.internal.core.JavaModelOperation.run(JavaModelOperation.java:717)\n        at org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1797)\n        at org.eclipse.jdt.internal.core.JavaModelOperation.runOperation(JavaModelOperation.java:785)\n        at org.eclipse.jdt.core.JavaCore.setClasspathContainer(JavaCore.java:4519)\n        at org.eclipse.jdt.internal.launching.JREContainerInitializer.initialize(JREContainerInitializer.java:69)\n        at org.eclipse.jdt.internal.core.JavaModelManager.initializeContainer(JavaModelManager.java:2203)\n        at org.eclipse.jdt.internal.core.JavaModelManager.getClasspathContainer(JavaModelManager.java:1545)\n        at org.eclipse.jdt.core.JavaCore.getClasspathContainer(JavaCore.java:1571)\n        at org.eclipse.jdt.internal.core.JavaProject.resolveClasspath(JavaProject.java:2558)\n        at org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath(JavaProject.java:1848)\n        at org.eclipse.jdt.internal.core.JavaProject.buildStructure(JavaProject.java:395)\n        at org.eclipse.jdt.internal.core.Openable.generateInfos(Openable.java:229)\n        at org.eclipse.jdt.internal.core.JavaElement.openWhenClosed(JavaElement.java:505)\n        at org.eclipse.jdt.internal.core.JavaElement.getElementInfo(JavaElement.java:249)\n        at org.eclipse.jdt.internal.core.JavaElement.getElementInfo(JavaElement.java:235)\n        at org.eclipse.jdt.internal.core.JavaProject.getJavaProjectElementInfo(JavaProject.java:1529)\n        at org.eclipse.jdt.internal.core.JavaProject.newNameLookup(JavaProject.java:2201)\n        at org.eclipse.jdt.internal.core.SearchableEnvironment.\u003cinit\u003e(SearchableEnvironment.java:53)\n        at org.eclipse.jdt.internal.core.SearchableEnvironment.\u003cinit\u003e(SearchableEnvironment.java:67)\n        at org.eclipse.jdt.internal.core.CancelableNameEnvironment.\u003cinit\u003e(CancelableNameEnvironment.java:26)\n        at org.eclipse.jdt.internal.core.CompilationUnitProblemFinder.process(CompilationUnitProblemFinder.java:160)\n        at org.eclipse.jdt.internal.core.CompilationUnitProblemFinder.process(CompilationUnitProblemFinder.java:249)\n        at org.eclipse.jdt.internal.core.ReconcileWorkingCopyOperation.makeConsistent(ReconcileWorkingCopyOperation.java:190)\n        at org.eclipse.jdt.internal.core.ReconcileWorkingCopyOperation.executeOperation(ReconcileWorkingCopyOperation.java:89)\n        at org.eclipse.jdt.internal.core.JavaModelOperation.run(JavaModelOperation.java:720)\n        at org.eclipse.jdt.internal.core.JavaModelOperation.runOperation(JavaModelOperation.java:780)\n        at org.eclipse.jdt.internal.core.CompilationUnit.reconcile(CompilationUnit.java:1169)\n        at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy$1.run(JavaReconcilingStrategy.java:101)\n        at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n        at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy.reconcile(JavaReconcilingStrategy.java:82)\n        at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy.initialReconcile(JavaReconcilingStrategy.java:176)\n        at org.eclipse.jdt.internal.ui.text.CompositeReconcilingStrategy.initialReconcile(CompositeReconcilingStrategy.java:114)\n        at org.eclipse.jdt.internal.ui.text.JavaCompositeReconcilingStrategy.initialReconcile(JavaCompositeReconcilingStrategy.java:122)\n        at org.eclipse.jface.text.reconciler.MonoReconciler.initialProcess(MonoReconciler.java:103)\n        at org.eclipse.jdt.internal.ui.text.JavaReconciler.initialProcess(JavaReconciler.java:367)\n        at org.eclipse.jface.text.reconciler.AbstractReconciler$BackgroundThread.run(AbstractReconciler.java:170)",
    "Created an attachment (id\u003d78968)\nFix\n\n",
    "Created an attachment (id\u003d79067)\nFix 02\n\nWe don\u0027t need to synchronize getters as it was made in the previous patch.",
    "Actually, first patch was better.  I would be nice to avoid synchronizing readers, but HashMap doesn\u0027t support this.  You can\u0027t have one reader and one writer at the same time.\n\nThere is one alternative to avoid synchronizing readers: create a new map each time it is modified, and then just replace the field with the new map.  That way it\u0027s impossible for a reader to access a map that is being modified.  This solution is good for cases where reading is very common and writing is very rare. I..e, it makes reading a little bit faster, and writing a lot slower.  In this particular case, I don\u0027t think this kind of optimization is needed.\n\nFirst patch released.",
    "Verified by code inspection."
  ],
  "commentCreationDates": [
    "2007-07-31T13:27:36+02:00",
    "2007-09-21T14:50:33+02:00",
    "2007-09-24T13:25:48+02:00",
    "2007-09-24T16:18:19+02:00",
    "2007-10-30T01:47:27+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.util.ConcurrentModificationException",
      "message": "concurrent access to HashMap attempted by Thread[org.eclipse.jdt.internal.ui.text.JavaReconciler,1,main]",
      "elements": [
        {
          "method": "java.util.HashMap.onExit",
          "source": "HashMap.java:225"
        },
        {
          "method": "java.util.HashMap.transfer",
          "source": "HashMap.java:636"
        },
        {
          "method": "java.util.HashMap.resize",
          "source": "HashMap.java:622"
        },
        {
          "method": "java.util.HashMap.addEntry",
          "source": "HashMap.java:994"
        },
        {
          "method": "java.util.HashMap.put",
          "source": "HashMap.java:510"
        },
        {
          "method": "org.eclipse.core.internal.resources.NatureManager.setEnabledNatures",
          "source": "NatureManager.java:475"
        },
        {
          "method": "org.eclipse.core.internal.resources.NatureManager.getEnabledNatures",
          "source": "NatureManager.java:336"
        },
        {
          "method": "org.eclipse.core.internal.resources.NatureManager.isNatureEnabled",
          "source": "NatureManager.java:436"
        },
        {
          "method": "org.eclipse.core.internal.resources.Project.isNatureEnabled",
          "source": "Project.java:726"
        },
        {
          "method": "org.eclipse.wst.common.project.facet.core.internal.FacetedProjectFrameworkImpl.create",
          "source": "FacetedProjectFrameworkImpl.java:632"
        },
        {
          "method": "org.eclipse.wst.common.project.facet.core.ProjectFacetsManager.create",
          "source": "ProjectFacetsManager.java:344"
        },
        {
          "method": "org.eclipse.jst.j2ee.internal.project.J2EEProjectUtilities.isProjectOfType",
          "source": "J2EEProjectUtilities.java:528"
        },
        {
          "method": "org.eclipse.jst.j2ee.internal.project.J2EEProjectUtilities.getAllProjectsInWorkspaceOfType",
          "source": "J2EEProjectUtilities.java:667"
        },
        {
          "method": "org.eclipse.jst.j2ee.componentcore.J2EEModuleVirtualComponent.getManifestReferences",
          "source": "J2EEModuleVirtualComponent.java:251"
        },
        {
          "method": "org.eclipse.jst.j2ee.componentcore.J2EEModuleVirtualComponent.getReferences",
          "source": "J2EEModuleVirtualComponent.java:86"
        },
        {
          "method": "org.eclipse.jst.j2ee.componentcore.J2EEModuleVirtualComponent.getReferences",
          "source": "J2EEModuleVirtualComponent.java:79"
        },
        {
          "method": "org.eclipse.jst.common.jdt.internal.classpath.FlexibleProjectContainer.computeClasspathEntries",
          "source": "FlexibleProjectContainer.java:184"
        },
        {
          "method": "org.eclipse.jst.common.jdt.internal.classpath.FlexibleProjectContainer.\u003cinit\u003e",
          "source": "FlexibleProjectContainer.java:122"
        },
        {
          "method": "org.eclipse.jst.j2ee.internal.web.classpath.WebAppLibrariesContainer.\u003cinit\u003e",
          "source": "WebAppLibrariesContainer.java:48"
        },
        {
          "method": "org.eclipse.jst.j2ee.internal.web.classpath.WebAppLibrariesContainerInitializer.initialize",
          "source": "WebAppLibrariesContainerInitializer.java:34"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelManager.initializeContainer",
          "source": "JavaModelManager.java:2203"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelManager$9.run",
          "source": "JavaModelManager.java:2133"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1797"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelManager.initializeAllContainers",
          "source": "JavaModelManager.java:2149"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelManager.getClasspathContainer",
          "source": "JavaModelManager.java:1543"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore.getClasspathContainer",
          "source": "JavaCore.java:1571"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.resolveClasspath",
          "source": "JavaProject.java:2558"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath",
          "source": "JavaProject.java:1848"
        },
        {
          "method": "org.eclipse.jdt.internal.core.DeltaProcessingState.initializeRoots",
          "source": "DeltaProcessingState.java:202"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelOperation.run",
          "source": "JavaModelOperation.java:717"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1797"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelOperation.runOperation",
          "source": "JavaModelOperation.java:785"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore.setClasspathContainer",
          "source": "JavaCore.java:4519"
        },
        {
          "method": "org.eclipse.jdt.internal.launching.JREContainerInitializer.initialize",
          "source": "JREContainerInitializer.java:69"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelManager.initializeContainer",
          "source": "JavaModelManager.java:2203"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelManager.getClasspathContainer",
          "source": "JavaModelManager.java:1545"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore.getClasspathContainer",
          "source": "JavaCore.java:1571"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.resolveClasspath",
          "source": "JavaProject.java:2558"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath",
          "source": "JavaProject.java:1848"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.buildStructure",
          "source": "JavaProject.java:395"
        },
        {
          "method": "org.eclipse.jdt.internal.core.Openable.generateInfos",
          "source": "Openable.java:229"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaElement.openWhenClosed",
          "source": "JavaElement.java:505"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaElement.getElementInfo",
          "source": "JavaElement.java:249"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaElement.getElementInfo",
          "source": "JavaElement.java:235"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.getJavaProjectElementInfo",
          "source": "JavaProject.java:1529"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.newNameLookup",
          "source": "JavaProject.java:2201"
        },
        {
          "method": "org.eclipse.jdt.internal.core.SearchableEnvironment.\u003cinit\u003e",
          "source": "SearchableEnvironment.java:53"
        },
        {
          "method": "org.eclipse.jdt.internal.core.SearchableEnvironment.\u003cinit\u003e",
          "source": "SearchableEnvironment.java:67"
        },
        {
          "method": "org.eclipse.jdt.internal.core.CancelableNameEnvironment.\u003cinit\u003e",
          "source": "CancelableNameEnvironment.java:26"
        },
        {
          "method": "org.eclipse.jdt.internal.core.CompilationUnitProblemFinder.process",
          "source": "CompilationUnitProblemFinder.java:160"
        },
        {
          "method": "org.eclipse.jdt.internal.core.CompilationUnitProblemFinder.process",
          "source": "CompilationUnitProblemFinder.java:249"
        },
        {
          "method": "org.eclipse.jdt.internal.core.ReconcileWorkingCopyOperation.makeConsistent",
          "source": "ReconcileWorkingCopyOperation.java:190"
        },
        {
          "method": "org.eclipse.jdt.internal.core.ReconcileWorkingCopyOperation.executeOperation",
          "source": "ReconcileWorkingCopyOperation.java:89"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelOperation.run",
          "source": "JavaModelOperation.java:720"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelOperation.runOperation",
          "source": "JavaModelOperation.java:780"
        },
        {
          "method": "org.eclipse.jdt.internal.core.CompilationUnit.reconcile",
          "source": "CompilationUnit.java:1169"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy$1.run",
          "source": "JavaReconcilingStrategy.java:101"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy.reconcile",
          "source": "JavaReconcilingStrategy.java:82"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy.initialReconcile",
          "source": "JavaReconcilingStrategy.java:176"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.text.CompositeReconcilingStrategy.initialReconcile",
          "source": "CompositeReconcilingStrategy.java:114"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.text.JavaCompositeReconcilingStrategy.initialReconcile",
          "source": "JavaCompositeReconcilingStrategy.java:122"
        },
        {
          "method": "org.eclipse.jface.text.reconciler.MonoReconciler.initialProcess",
          "source": "MonoReconciler.java:103"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.text.JavaReconciler.initialProcess",
          "source": "JavaReconciler.java:367"
        },
        {
          "method": "org.eclipse.jface.text.reconciler.AbstractReconciler$BackgroundThread.run",
          "source": "AbstractReconciler.java:170"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "198378",
      "date": "2007-07-31T13:27:36+02:00",
      "product": "Platform",
      "component": "Resources",
      "severity": "major"
    }
  ],
  "groupId": "198378",
  "bugId": "198378",
  "date": "2007-07-31T13:27:36+02:00",
  "product": "Platform",
  "component": "Resources",
  "severity": "major"
}