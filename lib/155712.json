{
  "comments": [
    "I think this error screw the job scheduling real bad.\n\n-- Error Log --\nDate: Wed Aug 30 11:45:31 EDT 2006\nMessage: Failed to execute runnable (java.util.ConcurrentModificationException)\nSeverity: Error\nPlugin ID: org.eclipse.ui\nStack Trace:\norg.eclipse.swt.SWTException: Failed to execute runnable (java.util.ConcurrentModificationException)\nat org.eclipse.swt.SWT.error(SWT.java:3374)\nat org.eclipse.swt.SWT.error(SWT.java:3297)\nat org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:126)\nat org.eclipse.swt.widgets.Display.runAsyncMessages(Display.java:3325)\nat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2971)\nat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1914)\nat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1878)\nat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:419)\nat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)\nat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:95)\nat org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:78)\nat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:92)\nat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:68)\nat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:400)\nat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:177)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\nat java.lang.reflect.Method.invoke(Method.java:597)\nat org.eclipse.core.launcher.Main.invokeFramework(Main.java:336)\nat org.eclipse.core.launcher.Main.basicRun(Main.java:280)\nat org.eclipse.core.launcher.Main.run(Main.java:977)\nat org.eclipse.core.launcher.Main.main(Main.java:952)\nCaused by: java.util.ConcurrentModificationException\nat java.util.HashMap$HashIterator.nextEntry(HashMap.java:793)\nat java.util.HashMap$KeyIterator.next(HashMap.java:827)\nat org.eclipse.mylar.tasks.core.TaskList.findQueryHitHelper(TaskList.java:284)\nat org.eclipse.mylar.tasks.core.TaskList.getQueryHitsForHandle(TaskList.java:502)\nat org.eclipse.mylar.internal.tasks.ui.views.TaskListContentProvider.getFilteredChildrenFor(TaskListContentProvider.java:201)\nat org.eclipse.mylar.internal.tasks.ui.views.TaskListContentProvider.getChildren(TaskListContentProvider.java:73)\nat org.eclipse.jface.viewers.AbstractTreeViewer.getRawChildren(AbstractTreeViewer.java:1157)\nat org.eclipse.jface.viewers.TreeViewer.getRawChildren(TreeViewer.java:768)\nat org.eclipse.jface.viewers.AbstractTreeViewer.getFilteredChildren(AbstractTreeViewer.java:565)\nat org.eclipse.jface.viewers.AbstractTreeViewer.getSortedChildren(AbstractTreeViewer.java:534)\nat org.eclipse.jface.viewers.AbstractTreeViewer.updateChildren(AbstractTreeViewer.java:2326)\nat org.eclipse.jface.viewers.AbstractTreeViewer.internalRefreshStruct(AbstractTreeViewer.java:1640)\nat org.eclipse.jface.viewers.TreeViewer.internalRefreshStruct(TreeViewer.java:955)\nat org.eclipse.jface.viewers.AbstractTreeViewer.internalRefresh(AbstractTreeViewer.java:1616)\nat org.eclipse.jface.viewers.AbstractTreeViewer.internalRefresh(AbstractTreeViewer.java:1571)\nat org.eclipse.jface.viewers.StructuredViewer$8.run(StructuredViewer.java:1415)\nat org.eclipse.jface.viewers.StructuredViewer.preservingSelection(StructuredViewer.java:1323)\nat org.eclipse.jface.viewers.StructuredViewer.refresh(StructuredViewer.java:1413)\nat org.eclipse.mylar.internal.tasks.ui.views.TaskListView$11.run(TaskListView.java:1518)\nat org.eclipse.swt.widgets.RunnableLock.run(RunnableLock.java:35)\nat org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:123)\n... 20 more",
    "It seems like this issue trigger something bad inside eclipse, so many actions just stop working while there is some background processing going on. I guess it could be somehow related to the state of ui thread.\n\nI looked at the code and it seems to me that the way AbstractRepositoryQuery is dealing with \"hits\" field is completely broken. All access to hits field in this class is non synchronized and then method getHits(), \"hits\" is wrapped into the new instance of the synchronized collection on every call. So, all synchronization on that returned value will have no effect because it will be synchronizing on new instance every time:\n\n\tpublic Set\u003cAbstractQueryHit\u003e getHits() {\n\t\treturn Collections.synchronizedSet(hits);\n\t}\n\nBut this is not all! Users of getHits() methods doing stuff like this (e.g. JiraTaskExternalizer):\n\n\t\tSet\u003cAbstractQueryHit\u003e hits \u003d Collections.synchronizedSet(query.getHits());\n\t\tsynchronized (hits) {\n\t\t\tfor (AbstractQueryHit hit : hits) {\n      ....\n      \nI also noticed quite inefficient use of getHits() method in label providers and decorators... I don\u0027t even know where to start refactoring this mess. :-)",
    "Created an attachment (id\u003d49237)\npatch that should fix concurrency issue\n\nI\u0027ve added consistent synchronization on method of the AbstractRepositoryQuery that are working with hits collection and updated other classes that were using this. getHits() now always creates copy wich can be iterated safely. \n\nIt is possible that other Mylar componants may have similar issues...",
    "Created an attachment (id\u003d49238)\nmylar/context/zip\n\n",
    "Great contribution Eugene, it\u0027s about time that this bogus approach to synchronizations that we hacked in way back got fixed...",
    "Patch applied.",
    "*** Bug 154895 has been marked as a duplicate of this bug. ***"
  ],
  "commentCreationDates": [
    "2006-08-30T18:54:24+02:00",
    "2006-09-01T03:37:17+02:00",
    "2006-09-01T04:43:51+02:00",
    "2006-09-01T04:43:52+02:00",
    "2006-09-03T09:42:46+02:00",
    "2006-09-03T09:51:20+02:00",
    "2006-09-08T18:57:32+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.swt.SWTException",
      "message": "Failed to execute runnable (java.util.ConcurrentModificationException)",
      "elements": [
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3374"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3297"
        },
        {
          "method": "org.eclipse.swt.widgets.Synchronizer.runAsyncMessages",
          "source": "Synchronizer.java:126"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runAsyncMessages",
          "source": "Display.java:3325"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2971"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1914"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1878"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:419"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:95"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:78"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:92"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:68"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:400"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:177"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:597"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:336"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:280"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:977"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:952"
        }
      ],
      "causedBy": {
        "exceptionType": "java.util.ConcurrentModificationException",
        "elements": [
          {
            "method": "java.util.HashMap$HashIterator.nextEntry",
            "source": "HashMap.java:793"
          },
          {
            "method": "java.util.HashMap$KeyIterator.next",
            "source": "HashMap.java:827"
          },
          {
            "method": "org.eclipse.mylar.tasks.core.TaskList.findQueryHitHelper",
            "source": "TaskList.java:284"
          },
          {
            "method": "org.eclipse.mylar.tasks.core.TaskList.getQueryHitsForHandle",
            "source": "TaskList.java:502"
          },
          {
            "method": "org.eclipse.mylar.internal.tasks.ui.views.TaskListContentProvider.getFilteredChildrenFor",
            "source": "TaskListContentProvider.java:201"
          },
          {
            "method": "org.eclipse.mylar.internal.tasks.ui.views.TaskListContentProvider.getChildren",
            "source": "TaskListContentProvider.java:73"
          },
          {
            "method": "org.eclipse.jface.viewers.AbstractTreeViewer.getRawChildren",
            "source": "AbstractTreeViewer.java:1157"
          },
          {
            "method": "org.eclipse.jface.viewers.TreeViewer.getRawChildren",
            "source": "TreeViewer.java:768"
          },
          {
            "method": "org.eclipse.jface.viewers.AbstractTreeViewer.getFilteredChildren",
            "source": "AbstractTreeViewer.java:565"
          },
          {
            "method": "org.eclipse.jface.viewers.AbstractTreeViewer.getSortedChildren",
            "source": "AbstractTreeViewer.java:534"
          },
          {
            "method": "org.eclipse.jface.viewers.AbstractTreeViewer.updateChildren",
            "source": "AbstractTreeViewer.java:2326"
          },
          {
            "method": "org.eclipse.jface.viewers.AbstractTreeViewer.internalRefreshStruct",
            "source": "AbstractTreeViewer.java:1640"
          },
          {
            "method": "org.eclipse.jface.viewers.TreeViewer.internalRefreshStruct",
            "source": "TreeViewer.java:955"
          },
          {
            "method": "org.eclipse.jface.viewers.AbstractTreeViewer.internalRefresh",
            "source": "AbstractTreeViewer.java:1616"
          },
          {
            "method": "org.eclipse.jface.viewers.AbstractTreeViewer.internalRefresh",
            "source": "AbstractTreeViewer.java:1571"
          },
          {
            "method": "org.eclipse.jface.viewers.StructuredViewer$8.run",
            "source": "StructuredViewer.java:1415"
          },
          {
            "method": "org.eclipse.jface.viewers.StructuredViewer.preservingSelection",
            "source": "StructuredViewer.java:1323"
          },
          {
            "method": "org.eclipse.jface.viewers.StructuredViewer.refresh",
            "source": "StructuredViewer.java:1413"
          },
          {
            "method": "org.eclipse.mylar.internal.tasks.ui.views.TaskListView$11.run",
            "source": "TaskListView.java:1518"
          },
          {
            "method": "org.eclipse.swt.widgets.RunnableLock.run",
            "source": "RunnableLock.java:35"
          },
          {
            "method": "org.eclipse.swt.widgets.Synchronizer.runAsyncMessages",
            "source": "Synchronizer.java:123"
          }
        ],
        "number": 0,
        "commentIndex": 0
      },
      "number": 0,
      "commentIndex": 0,
      "bugId": "155712",
      "date": "2006-08-30T18:54:24+02:00",
      "product": "Mylyn",
      "component": "Tasks",
      "severity": "blocker"
    }
  ],
  "groupId": "155712",
  "bugId": "155712",
  "date": "2006-08-30T18:54:24+02:00",
  "product": "Mylyn",
  "component": "Tasks",
  "severity": "blocker"
}