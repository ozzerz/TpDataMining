{
  "comments": [
    "NOTE: This may be multiple bugs.\n\nSometimes after I shut down eclipse the call stack below, exhibit a, appears in \nthe log file.\n\nLooks like sometimes DebugPlugin gets shutdown before LaunchingPlugin.  \nThis yields NPE as DebugPlugin.getDefault returns null after it is shutdown.\n\nWhen this happens I see the following\nlaunching plugin startup\nlaunching plugin shutdown\nlaunching plugin startup \nlaunching plugin shutdown \u003c-- NPE\n\nThe second startup ( instantiation ) of launching plugin is caused by the \nshutdown of IndexManager.  ( See callstack exhibit b  below )\n\nI set breakpoints in DebugPlugin and Plugin to see if there was a problem there \nand nothing seemed to be wrong.  At least there weren\u0027t any extra calls to \nDebugPlugin.startup that should have caused getDefault to return non-null \nafterwards.  What I saw was in fact just \ndebug plugin startup \ndebug plugin shutdown ( setDefault( null ) )\nNPE in launching plugin\n\n\n------------------------------------- exhibit a -------------------------------\n\n!MESSAGE FrameworkEvent.ERROR\n!STACK 0\norg.osgi.framework.BundleException: Exception in \norg.eclipse.core.internal.compatibility.PluginActivator.stop()\n\tat org.eclipse.osgi.framework.internal.core.BundleContext.stop\n(BundleContext.java:1170)\n\tat org.eclipse.osgi.framework.internal.core.BundleHost.stopWorker\n(BundleHost.java:481)\n\tat org.eclipse.osgi.framework.internal.core.Bundle.suspend\n(Bundle.java:556)\n\tat org.eclipse.osgi.framework.internal.core.Framework.suspendBundle\n(Framework.java:1252)\n\tat org.eclipse.osgi.framework.internal.core.StartLevelImpl.decFWSL\n(StartLevelImpl.java:626)\n\tat \norg.eclipse.osgi.framework.internal.core.StartLevelImpl.doSetStartLevel\n(StartLevelImpl.java:277)\n\tat org.eclipse.osgi.framework.internal.core.StartLevelImpl.shutdown\n(StartLevelImpl.java:250)\n\tat org.eclipse.osgi.framework.internal.core.SystemBundle.suspend\n(SystemBundle.java:208)\n\tat org.eclipse.osgi.framework.internal.core.Framework.shutdown\n(Framework.java:603)\n\tat org.eclipse.osgi.framework.internal.core.SystemBundle$1.run\n(SystemBundle.java:193)\n\tat java.lang.Thread.run(Thread.java:534)\nNested exception:\njava.lang.NullPointerException\n\tat org.eclipse.jdt.core.JavaCore.shutdown(JavaCore.java:3478)\n\tat org.eclipse.core.internal.compatibility.PluginActivator.stop\n(PluginActivator.java:67)\n\tat org.eclipse.osgi.framework.internal.core.BundleContext$2.run\n(BundleContext.java:1154)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat org.eclipse.osgi.framework.internal.core.BundleContext.stop\n(BundleContext.java:1129)\n\tat org.eclipse.osgi.framework.internal.core.BundleHost.stopWorker\n(BundleHost.java:481)\n\tat org.eclipse.osgi.framework.internal.core.Bundle.suspend\n(Bundle.java:556)\n\tat org.eclipse.osgi.framework.internal.core.Framework.suspendBundle\n(Framework.java:1252)\n\tat org.eclipse.osgi.framework.internal.core.StartLevelImpl.decFWSL\n(StartLevelImpl.java:626)\n\tat \norg.eclipse.osgi.framework.internal.core.StartLevelImpl.doSetStartLevel\n(StartLevelImpl.java:277)\n\tat org.eclipse.osgi.framework.internal.core.StartLevelImpl.shutdown\n(StartLevelImpl.java:250)\n\tat org.eclipse.osgi.framework.internal.core.SystemBundle.suspend\n(SystemBundle.java:208)\n\tat org.eclipse.osgi.framework.internal.core.Framework.shutdown\n(Framework.java:603)\n\tat org.eclipse.osgi.framework.internal.core.SystemBundle$1.run\n(SystemBundle.java:193)\n\tat java.lang.Thread.run(Thread.java:534)\n\n\n--------------------------- exhibit b --------------------------------------\n2nd instance is created from\njava.lang.Exception\n\tat org.eclipse.jdt.internal.launching.LaunchingPlugin.\u003cinit\u003e\n(LaunchingPlugin.java:269)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance\n(NativeConstructorAccessorImpl.java:39)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance\n(DelegatingConstructorAccessorImpl.java:27)\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:274)\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor.internalDoPluginActivation\n(PluginDescriptor.java:488)\n\tat org.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation\n(PluginDescriptor.java:438)\n\tat org.eclipse.core.internal.plugins.PluginDescriptor.getPlugin\n(PluginDescriptor.java:406)\n\tat org.eclipse.core.internal.compatibility.PluginActivator.start\n(PluginActivator.java:48)\n\tat org.eclipse.osgi.framework.internal.core.BundleContext$1.run\n(BundleContext.java:1054)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat org.eclipse.osgi.framework.internal.core.BundleContext.startActivator\n(BundleContext.java:1050)\n\tat org.eclipse.osgi.framework.internal.core.BundleContext.start\n(BundleContext.java:991)\n\tat org.eclipse.osgi.framework.internal.core.BundleHost.startWorker\n(BundleHost.java:403)\n\tat org.eclipse.osgi.framework.internal.core.Bundle.start\n(Bundle.java:312)\n\tat \norg.eclipse.core.internal.registry.ConfigurationElement.createExecutableExtensio\nn(ConfigurationElement.java:133)\n\tat \norg.eclipse.core.internal.registry.ConfigurationElement.createExecutableExtensio\nn(ConfigurationElement.java:125)\n\tat \norg.eclipse.core.internal.registry.ConfigurationElement.createExecutableExtensio\nn(ConfigurationElement.java:114)\n\tat org.eclipse.jdt.core.JavaCore.getClasspathVariableInitializer\n(JavaCore.java:1342)\n\tat org.eclipse.jdt.core.JavaCore.getClasspathVariable\n(JavaCore.java:1280)\n\tat org.eclipse.jdt.core.JavaCore.getResolvedVariablePath\n(JavaCore.java:2262)\n\tat org.eclipse.jdt.core.JavaCore.getResolvedClasspathEntry\n(JavaCore.java:2180)\n\tat org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath\n(JavaProject.java:1856)\n\tat org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath\n(JavaProject.java:1790)\n\tat org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath\n(JavaProject.java:1762)\n\tat org.eclipse.jdt.internal.core.search.JavaSearchScope.add\n(JavaSearchScope.java:75)\n\tat org.eclipse.jdt.internal.core.search.JavaWorkspaceScope.initialize\n(JavaWorkspaceScope.java:78)\n\tat org.eclipse.jdt.internal.core.search.JavaSearchScope.\u003cinit\u003e\n(JavaSearchScope.java:49)\n\tat org.eclipse.jdt.internal.core.search.JavaWorkspaceScope.\u003cinit\u003e\n(JavaWorkspaceScope.java:30)\n\tat org.eclipse.jdt.internal.core.search.indexing.IndexManager.shutdown\n(IndexManager.java:544)\n\tat org.eclipse.jdt.internal.core.JavaModelManager.shutdown\n(JavaModelManager.java:1441)\n\tat org.eclipse.jdt.core.JavaCore.shutdown(JavaCore.java:3481)\n\tat org.eclipse.core.internal.compatibility.PluginActivator.stop\n(PluginActivator.java:67)\n\tat org.eclipse.osgi.framework.internal.core.BundleContext$2.run\n(BundleContext.java:1154)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat org.eclipse.osgi.framework.internal.core.BundleContext.stop\n(BundleContext.java:1129)\n\tat org.eclipse.osgi.framework.internal.core.BundleHost.stopWorker\n(BundleHost.java:481)\n\tat org.eclipse.osgi.framework.internal.core.Bundle.stop(Bundle.java:457)\n\tat org.eclipse.core.internal.plugins.PluginStopper.run\n(PluginStopper.java:101)\n\tat org.eclipse.core.internal.runtime.PlatformActivator.stopLegacyBundles\n(PlatformActivator.java:286)\n\tat org.eclipse.core.internal.runtime.PlatformActivator$1.run\n(PlatformActivator.java:268)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run\n(EclipseStarter.java:104)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:279)\n\tat org.eclipse.core.launcher.Main.run(Main.java:742)\n\tat org.eclipse.core.launcher.Main.main(Main.java:581)",
    "Looks like JCORE is causing plug-in reactivation at shutdown. Moving for \ncomment.",
    "Good find, we were aware of this issue, but haven\u0027t seen it in a long time.\nWe try to eliminate dead indexes during shutdown, and this may force some \ninitializations of classpath variables/containers.\n\nThe problem is that it is quite difficult to be sure an index file is unused \nwhithout resolving the classpaths.\n\nSuggestions: \n1- during shutdown: if we know we have all project classpaths resolved around, \nthen we may do the index cleanup. If not, will let them in place, and rely on a \nsubsequent opportunity to do so. \n2- during workspace save action (like where we save build states), we could \nforce it to perform resolution + cleanup, but on shutdown we can only do \nminimal work.\n\nMy preference is 2. Starting point is:\nJavaModelManager#saving(ISaveContext) \n\nIndex cleanup should only occur in FULL_SAVE mode.",
    "*** Bug 51041 has been marked as a duplicate of this bug. ***",
    "*** Bug 35021 has been marked as a duplicate of this bug. ***",
    "Renamed IndexManager.shutDown() into cleanUpIndexes() and call it from \nJavaModelManager.saving(ISaveContext) in FULL_SAVE mode.",
    "*** Bug 57797 has been marked as a duplicate of this bug. ***",
    "Verified for 3.0 M9 with build I200405180816."
  ],
  "commentCreationDates": [
    "2004-02-18T09:57:49+01:00",
    "2004-02-18T14:04:52+01:00",
    "2004-02-18T14:15:47+01:00",
    "2004-02-25T15:36:33+01:00",
    "2004-03-24T18:11:42+01:00",
    "2004-04-02T15:19:47+02:00",
    "2004-04-07T23:31:54+02:00",
    "2004-05-18T17:05:55+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.osgi.framework.BundleException",
      "message": "Exception in  org.eclipse.core.internal.compatibility.PluginActivator.stop()",
      "elements": [
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContext.stop",
          "source": "BundleContext.java:1170"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleHost.stopWorker",
          "source": "BundleHost.java:481"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Bundle.suspend",
          "source": "Bundle.java:556"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Framework.suspendBundle",
          "source": "Framework.java:1252"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelImpl.decFWSL",
          "source": "StartLevelImpl.java:626"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelImpl.doSetStartLevel",
          "source": "StartLevelImpl.java:277"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelImpl.shutdown",
          "source": "StartLevelImpl.java:250"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.SystemBundle.suspend",
          "source": "SystemBundle.java:208"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Framework.shutdown",
          "source": "Framework.java:603"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.SystemBundle$1.run",
          "source": "SystemBundle.java:193"
        },
        {
          "method": "java.lang.Thread.run",
          "source": "Thread.java:534"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "52347",
      "date": "2004-02-18T09:57:49+01:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.jdt.core.JavaCore.shutdown",
          "source": "JavaCore.java:3478"
        },
        {
          "method": "org.eclipse.core.internal.compatibility.PluginActivator.stop",
          "source": "PluginActivator.java:67"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContext$2.run",
          "source": "BundleContext.java:1154"
        },
        {
          "method": "java.security.AccessController.doPrivileged",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContext.stop",
          "source": "BundleContext.java:1129"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleHost.stopWorker",
          "source": "BundleHost.java:481"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Bundle.suspend",
          "source": "Bundle.java:556"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Framework.suspendBundle",
          "source": "Framework.java:1252"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelImpl.decFWSL",
          "source": "StartLevelImpl.java:626"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelImpl.doSetStartLevel",
          "source": "StartLevelImpl.java:277"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelImpl.shutdown",
          "source": "StartLevelImpl.java:250"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.SystemBundle.suspend",
          "source": "SystemBundle.java:208"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Framework.shutdown",
          "source": "Framework.java:603"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.SystemBundle$1.run",
          "source": "SystemBundle.java:193"
        },
        {
          "method": "java.lang.Thread.run",
          "source": "Thread.java:534"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "52347",
      "date": "2004-02-18T09:57:49+01:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.Exception",
      "elements": [
        {
          "method": "org.eclipse.jdt.internal.launching.LaunchingPlugin.\u003cinit\u003e",
          "source": "LaunchingPlugin.java:269"
        },
        {
          "method": "sun.reflect.NativeConstructorAccessorImpl.newInstance0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeConstructorAccessorImpl.newInstance",
          "source": "NativeConstructorAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingConstructorAccessorImpl.newInstance",
          "source": "DelegatingConstructorAccessorImpl.java:27"
        },
        {
          "method": "java.lang.reflect.Constructor.newInstance",
          "source": "Constructor.java:274"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.internalDoPluginActivation",
          "source": "PluginDescriptor.java:488"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation",
          "source": "PluginDescriptor.java:438"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.getPlugin",
          "source": "PluginDescriptor.java:406"
        },
        {
          "method": "org.eclipse.core.internal.compatibility.PluginActivator.start",
          "source": "PluginActivator.java:48"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContext$1.run",
          "source": "BundleContext.java:1054"
        },
        {
          "method": "java.security.AccessController.doPrivileged",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContext.startActivator",
          "source": "BundleContext.java:1050"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContext.start",
          "source": "BundleContext.java:991"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleHost.startWorker",
          "source": "BundleHost.java:403"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Bundle.start",
          "source": "Bundle.java:312"
        },
        {
          "method": "org.eclipse.core.internal.registry.ConfigurationElement.createExecutableExtension",
          "source": "ConfigurationElement.java:133"
        },
        {
          "method": "org.eclipse.core.internal.registry.ConfigurationElement.createExecutableExtension",
          "source": "ConfigurationElement.java:125"
        },
        {
          "method": "org.eclipse.core.internal.registry.ConfigurationElement.createExecutableExtension",
          "source": "ConfigurationElement.java:114"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore.getClasspathVariableInitializer",
          "source": "JavaCore.java:1342"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore.getClasspathVariable",
          "source": "JavaCore.java:1280"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore.getResolvedVariablePath",
          "source": "JavaCore.java:2262"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore.getResolvedClasspathEntry",
          "source": "JavaCore.java:2180"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath",
          "source": "JavaProject.java:1856"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath",
          "source": "JavaProject.java:1790"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath",
          "source": "JavaProject.java:1762"
        },
        {
          "method": "org.eclipse.jdt.internal.core.search.JavaSearchScope.add",
          "source": "JavaSearchScope.java:75"
        },
        {
          "method": "org.eclipse.jdt.internal.core.search.JavaWorkspaceScope.initialize",
          "source": "JavaWorkspaceScope.java:78"
        },
        {
          "method": "org.eclipse.jdt.internal.core.search.JavaSearchScope.\u003cinit\u003e",
          "source": "JavaSearchScope.java:49"
        },
        {
          "method": "org.eclipse.jdt.internal.core.search.JavaWorkspaceScope.\u003cinit\u003e",
          "source": "JavaWorkspaceScope.java:30"
        },
        {
          "method": "org.eclipse.jdt.internal.core.search.indexing.IndexManager.shutdown",
          "source": "IndexManager.java:544"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelManager.shutdown",
          "source": "JavaModelManager.java:1441"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore.shutdown",
          "source": "JavaCore.java:3481"
        },
        {
          "method": "org.eclipse.core.internal.compatibility.PluginActivator.stop",
          "source": "PluginActivator.java:67"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContext$2.run",
          "source": "BundleContext.java:1154"
        },
        {
          "method": "java.security.AccessController.doPrivileged",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContext.stop",
          "source": "BundleContext.java:1129"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleHost.stopWorker",
          "source": "BundleHost.java:481"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Bundle.stop",
          "source": "Bundle.java:457"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginStopper.run",
          "source": "PluginStopper.java:101"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator.stopLegacyBundles",
          "source": "PlatformActivator.java:286"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:268"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:104"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:324"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:279"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:742"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:581"
        }
      ],
      "number": 2,
      "commentIndex": 0,
      "bugId": "52347",
      "date": "2004-02-18T09:57:49+01:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    }
  ],
  "groupId": "52347",
  "bugId": "52347",
  "date": "2004-02-18T09:57:49+01:00",
  "product": "JDT",
  "component": "Core",
  "severity": "normal"
}