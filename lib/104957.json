{
  "comments": [
    "When running ajc 1.2.1 on the GNU Interpreter for Java 4.0.1, I received this error:\n\njava.lang.NullPointerException\n   at\norg.aspectj.apache.bcel.generic.InstructionComparator$1.equals(org.aspectj.apache.bcel.generic.Instruction,\norg.aspectj.apache.bcel.g\neneric.Instruction) (/tmp/cache/local/aspectj1.2/lib/aspectjweaver.jar.so)\n   at org.aspectj.apache.bcel.generic.Instruction.equals(java.lang.Object)\n(/tmp/cache/local/aspectj1.2/lib/aspectjweaver.jar.so)\n   at java.util.AbstractMap.equals(java.lang.Object, java.lang.Object)\n(/usr/lib/libgcj.so.6.0.0)\n   at java.util.HashMap.put(java.lang.Object, java.lang.Object)\n(/usr/lib/libgcj.so.6.0.0)\n   at java.util.HashSet.add(java.lang.Object) (/usr/lib/libgcj.so.6.0.0)\n   at\norg.aspectj.apache.bcel.generic.InstructionHandle.addTargeter(org.aspectj.apache.bcel.generic.InstructionTargeter)\n(/tmp/cache/local/\naspectj1.2/lib/aspectjweaver.jar.so)\n   at\norg.aspectj.apache.bcel.generic.BranchInstruction.notifyTarget(org.aspectj.apache.bcel.generic.InstructionHandle,\norg.aspectj.apache.\nbcel.generic.InstructionHandle,\norg.aspectj.apache.bcel.generic.InstructionTargeter)\n(/tmp/cache/local/aspectj1.2/lib/aspectjweaver.jar.so)\n   at\norg.aspectj.apache.bcel.generic.BranchInstruction.setTarget(org.aspectj.apache.bcel.generic.InstructionHandle)\n(/tmp/cache/local/aspe\nctj1.2/lib/aspectjweaver.jar.so)\n   at org.aspectj.apache.bcel.generic.BranchInstruction.BranchInstruction(short,\norg.aspectj.apache.bcel.generic.InstructionHandle) (/tmp/c\nache/local/aspectj1.2/lib/aspectjweaver.jar.so)\n   at org.aspectj.apache.bcel.generic.Select.Select(short, int[],\norg.aspectj.apache.bcel.generic.InstructionHandle[], org.aspectj.apache.b\ncel.generic.InstructionHandle)\n(/tmp/cache/local/aspectj1.2/lib/aspectjweaver.jar.so)\n   at org.aspectj.apache.bcel.generic.LOOKUPSWITCH.LOOKUPSWITCH(int[],\norg.aspectj.apache.bcel.generic.InstructionHandle[], org.aspectj.apa\nche.bcel.generic.InstructionHandle)\n(/tmp/cache/local/aspectj1.2/lib/aspectjweaver.jar.so)\n   at org.aspectj.apache.bcel.generic.SWITCH.SWITCH(int[],\norg.aspectj.apache.bcel.generic.InstructionHandle[], org.aspectj.apache.bcel.gen\neric.InstructionHandle, int) (/tmp/cache/local/aspectj1.2/lib/aspectjweaver.jar.so)\n   at org.aspectj.apache.bcel.generic.SWITCH.SWITCH(int[],\norg.aspectj.apache.bcel.generic.InstructionHandle[], org.aspectj.apache.bcel.gen\neric.InstructionHandle) (/tmp/cache/local/aspectj1.2/lib/aspectjweaver.jar.so)\n   at\norg.aspectj.weaver.bcel.Utility.copyInstruction(org.aspectj.apache.bcel.generic.Instruction)\n(/tmp/cache/local/aspectj1.2/lib/aspectj\nweaver.jar.so)\n   at\norg.aspectj.weaver.bcel.LazyMethodGen.packBody(org.aspectj.apache.bcel.generic.MethodGen)\n(/tmp/cache/local/aspectj1.2/lib/aspectjwea\nver.jar.so)\n   at org.aspectj.weaver.bcel.LazyMethodGen.pack()\n(/tmp/cache/local/aspectj1.2/lib/aspectjweaver.jar.so)\n   at org.aspectj.weaver.bcel.LazyMethodGen.getMethod()\n(/tmp/cache/local/aspectj1.2/lib/aspectjweaver.jar.so)\n   at\norg.aspectj.weaver.bcel.LazyClassGen.writeBack(org.aspectj.weaver.bcel.BcelWorld)\n(/tmp/cache/local/aspectj1.2/lib/aspectjweaver.jar.\nso)\n   at\norg.aspectj.weaver.bcel.LazyClassGen.getJavaClass(org.aspectj.weaver.bcel.BcelWorld)\n(/tmp/cache/local/aspectj1.2/lib/aspectjweaver.j\nar.so)\n   at\norg.aspectj.weaver.bcel.BcelWeaver.getClassFilesFor(org.aspectj.weaver.bcel.LazyClassGen)\n(/tmp/cache/local/aspectj1.2/lib/aspectjwea\nver.jar.so)\n   at\norg.aspectj.weaver.bcel.BcelWeaver.weaveAndNotify(org.aspectj.weaver.bcel.UnwovenClassFile,\norg.aspectj.weaver.bcel.BcelObjectType, o\nrg.aspectj.weaver.IWeaveRequestor)\n(/tmp/cache/local/aspectj1.2/lib/aspectjweaver.jar.so)\n   at\norg.aspectj.weaver.bcel.BcelWeaver.weave(org.aspectj.weaver.IClassFileProvider)\n(/tmp/cache/local/aspectj1.2/lib/aspectjweaver.jar.so\n)\n   at org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.weave() (Unknown Source)\n   at org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.afterCompiling()\n(Unknown Source)\n   at\norg.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile(org.aspectj.org.eclipse.jdt.internal.compiler.env.ICompilationUnit[])\n(Unknown Source)\n   at\norg.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilation(java.util.List)\n(Unknown Source)\n   at\norg.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild(org.aspectj.ajdt.internal.core.builder.AjBuildConfig,\norg.aspectj.bridg\ne.IMessageHandler, boolean) (Unknown Source)\n   at\norg.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild(org.aspectj.ajdt.internal.core.builder.AjBuildConfig,\norg.aspectj.br\nidge.IMessageHandler) (Unknown Source)\n   at\norg.aspectj.ajdt.ajc.AjdtCommand.doCommand(org.aspectj.bridge.IMessageHandler,\nboolean) (Unknown Source)\n   at org.aspectj.ajdt.ajc.AjdtCommand.runCommand(java.lang.String[],\norg.aspectj.bridge.IMessageHandler) (Unknown Source)\n   at org.aspectj.tools.ajc.Main.run(java.lang.String[],\norg.aspectj.bridge.IMessageHolder) (Unknown Source)\n   at org.aspectj.tools.ajc.Main.runMain(java.lang.String[], boolean) (Unknown\nSource)\n   at org.aspectj.tools.ajc.Main.main(java.lang.String[]) (Unknown Source)\n   at gnu.java.lang.MainThread.call_main() (/usr/lib/libgcj.so.6.0.0)\n   at gnu.java.lang.MainThread.run() (/usr/lib/libgcj.so.6.0.0)\n\nUnfortunately, the above stack trace contains no line number information;\nhowever, by running the program under the gdb debugger, I was able to get a\nbacktrace with line numbers for the relevant part of the stack trace:\n\n(gdb) bt\n#0  0x011a0246 in\norg.aspectj.apache.bcel.generic.InstructionComparator$1.equals(org.aspectj.apache.bcel.generic.Instruction,\norg.aspectj.apache.bcel.generic.Instruction) (this\u003d@5c71ea8, i1\u003d@610fe70,\ni2\u003d@610fc60) at org/aspectj/apache/bcel/generic/InstructionComparator.java:79\n#1  0x011a004e in\norg.aspectj.apache.bcel.generic.Instruction.equals(java.lang.Object)\n(this\u003d@610fe70, that\u003d@610fc60)\n    at org/aspectj/apache/bcel/generic/Instruction.java:499\n#2  0x031b5f9b in java.util.AbstractMap.equals(java.lang.Object,\njava.lang.Object) (o1\u003d@610fe70, o2\u003d@610fc60)\n    at ../../../libjava/java/util/AbstractMap.java:603\n#3  0x031cc0ae in java.util.HashMap.put(java.lang.Object, java.lang.Object)\n(this\u003d@6483690, key\u003d@610fe70, value\u003d@2dfc0)\n    at ../../../libjava/java/util/HashMap.java:349\n#4  0x031cca00 in java.util.HashSet.add(java.lang.Object) (this\u003dnull,\no\u003d@610fe70) at ../../../libjava/java/util/HashSet.java:151\n#5  0x011b30ad in\norg.aspectj.apache.bcel.generic.InstructionHandle.addTargeter(org.aspectj.apache.bcel.generic.InstructionTargeter)\n(\n    this\u003d@6949d20, t\u003d@610fe70) at\norg/aspectj/apache/bcel/generic/InstructionHandle.java:208\n#6  0x011861e6 in\norg.aspectj.apache.bcel.generic.BranchInstruction.notifyTarget(org.aspectj.apache.bcel.generic.InstructionHandle,\norg.aspectj.apache.bcel.generic.InstructionHandle,\norg.aspectj.apache.bcel.generic.InstructionTargeter) (old_ih\u003dnull, new_ih\u003d@6949d20,\n    t\u003d@610fe70) at org/aspectj/apache/bcel/generic/BranchInstruction.java:217\n#7  0x01186133 in\norg.aspectj.apache.bcel.generic.BranchInstruction.setTarget(org.aspectj.apache.bcel.generic.InstructionHandle)\n(\n    this\u003d@610fe70, target\u003d@6949d20) at\norg/aspectj/apache/bcel/generic/BranchInstruction.java:205\n#8  0x011857ef in\norg.aspectj.apache.bcel.generic.BranchInstruction.BranchInstruction(short,\norg.aspectj.apache.bcel.generic.InstructionHandle) (this\u003d@610fe70, opcode\u003d171,\ntarget\u003d@6949d20) at org/aspectj/apache/bcel/generic/BranchInstruction.java:86\n#9  0x011d3489 in org.aspectj.apache.bcel.generic.Select.Select(short, int[],\norg.aspectj.apache.bcel.generic.InstructionHandle[],\norg.aspectj.apache.bcel.generic.InstructionHandle) (this\u003d@610fe70, opcode\u003d171,\nmatch\u003d@6f63b90, targets\u003d@6eeabe0, target\u003d@6949d20)\n    at org/aspectj/apache/bcel/generic/Select.java:106\n#10 0x011c3152 in\norg.aspectj.apache.bcel.generic.LOOKUPSWITCH.LOOKUPSWITCH(int[],\norg.aspectj.apache.bcel.generic.InstructionHandle[],\norg.aspectj.apache.bcel.generic.InstructionHandle) (this\u003d@610fe70,\nmatch\u003d@6f63b90, targets\u003d@6eeabe0, target\u003d@6949d20)\n    at org/aspectj/apache/bcel/generic/LOOKUPSWITCH.java:80\n#11 0x011d4f94 in org.aspectj.apache.bcel.generic.SWITCH.SWITCH(int[],\norg.aspectj.apache.bcel.generic.InstructionHandle[],\norg.aspectj.apache.bcel.generic.InstructionHandle, int) (this\u003d@6a20978,\nmatch\u003d@5b1ccd0, targets\u003d@6eeac08, target\u003d@6949d20, max_gap\u003d1)\n    at org/aspectj/apache/bcel/generic/SWITCH.java:104\n#12 0x011d5002 in org.aspectj.apache.bcel.generic.SWITCH.SWITCH(int[],\norg.aspectj.apache.bcel.generic.InstructionHandle[],\norg.aspectj.apache.bcel.generic.InstructionHandle) (this\u003d@6a20978,\nmatch\u003d@5b1ccd0, targets\u003d@6eeac08, target\u003d@6949d20)\n    at org/aspectj/apache/bcel/generic/SWITCH.java:109\n#13 0x01332eb6 in\norg.aspectj.weaver.bcel.Utility.copyInstruction(org.aspectj.apache.bcel.generic.Instruction)\n(i\u003d@610fc60)\n    at org/aspectj/weaver/bcel/Utility.java:474\n#14 0x01326f66 in\norg.aspectj.weaver.bcel.LazyMethodGen.packBody(org.aspectj.apache.bcel.generic.MethodGen)\n(this\u003d@6d98000, gen\u003d@6d983c0)\n    at org/aspectj/weaver/bcel/LazyMethodGen.java:813\n#15 0x01326d08 in org.aspectj.weaver.bcel.LazyMethodGen.pack() (this\u003d@6d98000)\nat org/aspectj/weaver/bcel/LazyMethodGen.java:790\n#16 0x01324c81 in org.aspectj.weaver.bcel.LazyMethodGen.getMethod()\n(this\u003d@6d98000) at org/aspectj/weaver/bcel/LazyMethodGen.java:336\n#17 0x0131b502 in\norg.aspectj.weaver.bcel.LazyClassGen.writeBack(org.aspectj.weaver.bcel.BcelWorld)\n(this\u003d@610ff00, world\u003d@5642d20)\n    at org/aspectj/weaver/bcel/LazyClassGen.java:418\n#18 0x0131b95e in\norg.aspectj.weaver.bcel.LazyClassGen.getJavaClass(org.aspectj.weaver.bcel.BcelWorld)\n(this\u003d@610ff00, world\u003d@5642d20)\n    at org/aspectj/weaver/bcel/LazyClassGen.java:446\n#19 0x01311589 in\norg.aspectj.weaver.bcel.BcelWeaver.getClassFilesFor(org.aspectj.weaver.bcel.LazyClassGen)\n(this\u003d@a33c0, clazz\u003d@610ff00)\n\u003csnip\u003e\n\nIt might be difficult for me to provide a reproducable test case (it might\ndepend on the gij version, but I can try if wanted). However, happily, having\nexamined the bytecode of the BCEL classes from the first few lines of the stack\ntrace, I think I can explain why this exception occurs without needing to\nprovide a test case.\n\nIt\u0027s very simple. Whoever wrote the BCEL code in question, obviously never ran\nit with a data set and on a virtual machine where a hash collision in the\nHashSet would occur. Because, with this BCEL snapshot, if a hash collision does\noccur, the object being added to the HashSet is *guaranteed* to cause a\nNullPointerException in the Comparator method. This can be seen merely by\nexamining the code path described by this stack trace. The field \"targets\" in\nthe LOOKUPSWITCH object has not been initialized when notifyTarget is called, so\nif there is a hash collision in the HashSet, the InstructionComparator will be\ncalled - and it is guaranteed to call getTargets () and access its array length,\nwhich will cause a NullPointerException.\n\nI hope this explanation is sufficiently clear. If not, I will be happy to\nprovide further details.",
    "for resolution in M4",
    "Fix checked into AspectJ version of BCEL library, will be available in next\npublished AspectJ build from the download page.\n\nWill close out bug report once build is available.",
    "fix now available."
  ],
  "commentCreationDates": [
    "2005-07-25T02:01:39+02:00",
    "2005-08-26T17:40:26+02:00",
    "2005-09-21T18:29:28+02:00",
    "2005-09-22T16:53:06+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.aspectj.apache.bcel.generic.InstructionComparator$1.equals",
          "source": "org.aspectj.apache.bcel.generic.Instruction, org.aspectj.apache.bcel.g eneric.Instruction"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "104957",
      "date": "2005-07-25T02:01:39+02:00",
      "product": "AspectJ",
      "component": "Compiler",
      "severity": "normal"
    }
  ],
  "groupId": "104957",
  "bugId": "104957",
  "date": "2005-07-25T02:01:39+02:00",
  "product": "AspectJ",
  "component": "Compiler",
  "severity": "normal"
}