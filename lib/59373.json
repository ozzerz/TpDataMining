{
  "comments": [
    "Not sure it is PDE or Update...\n\nA PDE Junit launch config stopped working. Following are the entries generated.\nThe workaround was to rename the launch configuration dir under\norg.eclipse.pde.core metadata area to something else\n(IContentTypeManagerTest_tmp). If I rename it back to IContentTypeManagerTest,\nthe problem starts occurring again.\n\n!ENTRY org.eclipse.update.configurator Apr 20, 2004 21:19:39.275\n!MESSAGE Could not rename configuration temp file\n!ENTRY org.eclipse.pde.core 4 4 Apr 20, 2004 21:19:39.322\n!MESSAGE Unable to save configuration file\n\"d:\\target\\releasing\\plugins\\.metadata\\.plugins\\org.eclipse.pde.core\\IContentTypeManagerTest\\org.eclipse.update\\platform.xml.tmp\"\n!STACK 0\njava.io.IOException: Unable to save configuration file\n\"d:\\target\\releasing\\plugins\\.metadata\\.plugins\\org.eclipse.pde.core\\IContentTypeManagerTest\\org.eclipse.update\\platform.xml.tmp\"\n\tat\norg.eclipse.update.internal.configurator.PlatformConfiguration.save(PlatformConfiguration.java:569)\n\tat\norg.eclipse.core.internal.boot.OldPlatformConfiguration.save(OldPlatformConfiguration.java:141)\n\tat\norg.eclipse.pde.internal.core.TargetPlatform.savePlatformConfiguration(TargetPlatform.java:302)\n\tat\norg.eclipse.pde.internal.core.TargetPlatform.createPlatformConfigurationArea(TargetPlatform.java:169)\n\tat\norg.eclipse.pde.internal.ui.launcher.JUnitLaunchConfiguration.computeProgramArguments(JUnitLaunchConfiguration.java:178)\n\tat\norg.eclipse.pde.internal.ui.launcher.JUnitLaunchConfiguration.createVMRunner(JUnitLaunchConfiguration.java:101)\n\tat\norg.eclipse.pde.internal.ui.launcher.JUnitLaunchConfiguration.launch(JUnitLaunchConfiguration.java:61)\n\tat\norg.eclipse.debug.internal.core.LaunchConfiguration.launch(LaunchConfiguration.java:569)\n\tat\norg.eclipse.debug.internal.core.LaunchConfiguration.launch(LaunchConfiguration.java:150)\n\tat\norg.eclipse.debug.internal.ui.DebugUIPlugin.buildAndLaunch(DebugUIPlugin.java:747)\n\tat org.eclipse.debug.internal.ui.DebugUIPlugin$6.run(DebugUIPlugin.java:928)\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:66)",
    "Created an attachment (id\u003d9741)\nconfiguration location created by PDE\n\nThis is the configuration location created by PDE under\n\u003cworkspace\u003e/.metadata/.plugins/org.eclipse.pde.core.",
    "Dorian, any idea what would cause this?",
    "Moving to update...\nThis is one of the cases that I could not track down, it happens when the \nconfiguration is saved into a tmp file, and then renamed to platform.xml, but \nit fails during rename.\nThe scenario is hard to reproduce, so I changed the \"safe I/O\" :-) code to be \nmore robust.\nDo you still see this problem with newer builds (such as today\u0027s integration \nbuild) ?\n",
    "Yes, I forgot to mention... this was the first time I saw it, and it was with\ni200404201300. It always happens with the configuration area attached. If I\nremoved it and let to be re-created, it would not happen anymore.",
    "*** Bug 45801 has been marked as a duplicate of this bug. ***",
    "Wassim, is PDE Junit holding any file handles on the platform.xml generated by \nthe update manager? Can this happen when you\u0027re removing directories?",
    "The clearing step takes place way after you\u0027re done generating the \nplatform.xml files.\n\nWhen clearing, we skip the platform.xml/platform.cfg files because you had \njust generated them.  In fact, we skip the entire org.eclipse.update directory.",
    "But shouldn\u0027t you clear the configuration for each PDE Junit launch? \nI thought only self hosting has the option to keep the config around. ",
    "BTW, it is not clear why the config cannot be saved, and it may have nothing \nto do with deletion of config.",
    "Actually, we use the same code for both launchers.  It\u0027s called refactoring :-)\nBy default, the clear option is on for both.",
    "To add more detail: when it fails, I am left with a platform.xml file and a\nplatform.xml.tmp file. From that point on, it will not start again. Just\nmanually renaming/deleting platform.xml will do trick. So, it seems that at some\nrandom moment renaming the platform.xml.tmp to platform.tmp will fail for some\nreason (there is already a platform.xml there?). After that, it will not work\nanymore (because there will always be an existing platform.xml).\n\nDorian, it seems the code that fails is swallowing the original exception\n(PlatformConfiguration.save(URL)) and throwing an IOException in its place. This\nis producing a message in the log but does not help explaining the reason for\nthe error.\n\nWassim, (re: comment 7/comment 8) why does the the \"Clear the configuration area\nbefore launching\" option do not clear the whole thing?",
    "Thanks Rafael.\nI\u0027ve released some code to log the original exception as well.\nI\u0027ve also set the StreamResult to null, just in case the XML serializer is not \ngarbage collected and the output stream gets locked for a while.",
    "I think I got it... you are using fle system timestamps to name the backup\ncopies of configuration files in the history directory. The problem is that\ntimestamps on FAT32 have low resolution.\n\nSo, I launch once successfully. The previous platform.xml will be moved to\nhistory/\u003ctimestamp\u003e.xml. The new configuration is written to platform.xml.tmp\nand then renamed to platform.xml. Every thing is alright.\n\nWhen I try to run again: you try to rename the existing platform.xml to\nhistory/\u003ctimestamp\u003e, but there is already a file with that name. This rename\noperation fails. The new configuration, written to platform.xml.tmp, cannot be\nrenamed to platform.xml. PlatformConfiguration.save fails. Removing\nhistory/\u003ctimestamp\u003e or platform.xml will allow me to work.\n\nI guess you cannot rely on file system timestamps to generate unique names.",
    "Just got back from a little \"vacation\" and will look at this more closely. \nRafael, what is the time difference between those timestamps?\nI see two problems:\n- why are the configuration so close to each other? \n- why isn\u0027t PDE removing the old configuration ?",
    "as of today\u0027s I-build, PDE wipes out the org.eclipse.update folder when \nthe \"clear configuration area\" option is selected (it is selected by default).\nSo the history/ folder will be removed, but this will only \"artificially\" fix \nthe scenario, since people can opt to choose to launch *without* clearing the \nconfig area.  In which case, the problem outlined in comment #13 will still \noccur.  So Update needs to do something to make sure the rename/save succeeds.",
    "Thanks Wassim.\nIt is actually good that this fix was not there to start with, because we have \nunconvered an update bug this way (Rafael, thanks for the investigation and \nthe tips!).",
    "I said it before and I will say it again.  Rafael\u0027s investigative reporting \nhas been so good as of late, that he should contribute reports to \"60 \nminutes\" :-)",
    "Trying to answer your questions, I noticed that running a PDE-related launch\nconfiguration will save the configuration twice. It seems one is saved by dev\nEclipse (PDE+Update?), the other is saved by the target Eclipse (Update\nconfigurator). \n\nSo, on FAT32, if the two save operations don\u0027t have at least two seconds between\nthem (the java.io.File timestamp resolution on FAT32?), platform.xml and the\nlatest copy in the history will seem to have exactly the same timestamp. Next\ntime we run, we will fail moving the existing platform.xml to the history (since\nit maps to an existing name).\n\nSo the problems are due to:\n- platform.xml is saved twice in a short period of time\n- configurations in history are named based on their timestamps\n- file timestamp resolution in Java sucks (is the one of the reasons Core\nResources has a native library).",
    "Thanks Rafael.\nYes, Konrad and I were just talking about the re-saving of the config, and \nthat looks odd to me. I see in the history folder that all the time stamps end \nwith 000, so yes, we need 2 seconds apart between saves to ensure uniqueness. \nI still believe the issue has to do with re-saving (which, BTW, does not \nnothing useful to platform.xml).\n\nI will investigate this further.\n\n",
    "I released some code for not un-necessarily re-saving the configuration when \nrunning with PDE generated platform.xml files (i.e. transient configs).\nI will leave the bug open to investigate the timestamps a bit more, to uncover \nother potential issues.\nPlease use the next nightly build and see how it works. Also, given Wassim\u0027s \nfix, you may want to turn off configuration cleanup, so you can test the fix I \nreleased. Thanks!",
    "When backing up the file (i.e. renaming platform.xml to history/timestamp.xml) \nI increase the timestamp by 1 if the target file exists. In fact, this is done \nin a loop (max 100 times), to make sure a new timestamp is used. The \nprobability someone saves the file 100 times within a second should be fairly \nlow (but not zero :-)",
    "*** Bug 60447 has been marked as a duplicate of this bug. ***"
  ],
  "commentCreationDates": [
    "2004-04-21T03:41:37+02:00",
    "2004-04-21T03:48:23+02:00",
    "2004-04-21T04:28:23+02:00",
    "2004-04-21T04:40:34+02:00",
    "2004-04-21T04:57:06+02:00",
    "2004-04-21T20:26:09+02:00",
    "2004-04-21T21:27:31+02:00",
    "2004-04-21T21:30:26+02:00",
    "2004-04-21T21:49:14+02:00",
    "2004-04-21T21:50:39+02:00",
    "2004-04-21T21:52:36+02:00",
    "2004-04-22T20:49:08+02:00",
    "2004-04-22T21:33:04+02:00",
    "2004-04-28T04:41:36+02:00",
    "2004-04-28T19:45:30+02:00",
    "2004-04-28T19:59:29+02:00",
    "2004-04-28T20:02:55+02:00",
    "2004-04-28T20:09:49+02:00",
    "2004-04-28T22:25:01+02:00",
    "2004-04-28T22:39:43+02:00",
    "2004-04-29T05:57:46+02:00",
    "2004-04-29T18:30:50+02:00",
    "2004-04-29T20:33:33+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.io.IOException",
      "message": "Unable to save configuration file \"d:\\target\\releasing\\plugins\\.metadata\\.plugins\\org.eclipse.pde.core\\IContentTypeManagerTest\\org.eclipse.update\\platform.xml.tmp\"",
      "elements": [
        {
          "method": "org.eclipse.update.internal.configurator.PlatformConfiguration.save",
          "source": "PlatformConfiguration.java:569"
        },
        {
          "method": "org.eclipse.core.internal.boot.OldPlatformConfiguration.save",
          "source": "OldPlatformConfiguration.java:141"
        },
        {
          "method": "org.eclipse.pde.internal.core.TargetPlatform.savePlatformConfiguration",
          "source": "TargetPlatform.java:302"
        },
        {
          "method": "org.eclipse.pde.internal.core.TargetPlatform.createPlatformConfigurationArea",
          "source": "TargetPlatform.java:169"
        },
        {
          "method": "org.eclipse.pde.internal.ui.launcher.JUnitLaunchConfiguration.computeProgramArguments",
          "source": "JUnitLaunchConfiguration.java:178"
        },
        {
          "method": "org.eclipse.pde.internal.ui.launcher.JUnitLaunchConfiguration.createVMRunner",
          "source": "JUnitLaunchConfiguration.java:101"
        },
        {
          "method": "org.eclipse.pde.internal.ui.launcher.JUnitLaunchConfiguration.launch",
          "source": "JUnitLaunchConfiguration.java:61"
        },
        {
          "method": "org.eclipse.debug.internal.core.LaunchConfiguration.launch",
          "source": "LaunchConfiguration.java:569"
        },
        {
          "method": "org.eclipse.debug.internal.core.LaunchConfiguration.launch",
          "source": "LaunchConfiguration.java:150"
        },
        {
          "method": "org.eclipse.debug.internal.ui.DebugUIPlugin.buildAndLaunch",
          "source": "DebugUIPlugin.java:747"
        },
        {
          "method": "org.eclipse.debug.internal.ui.DebugUIPlugin$6.run",
          "source": "DebugUIPlugin.java:928"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:66"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "59373",
      "date": "2004-04-21T03:41:37+02:00",
      "product": "Platform",
      "component": "Update",
      "severity": "normal"
    }
  ],
  "groupId": "59373",
  "bugId": "59373",
  "date": "2004-04-21T03:41:37+02:00",
  "product": "Platform",
  "component": "Update",
  "severity": "normal"
}