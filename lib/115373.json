{
  "comments": [
    "Note this was reported on M4. To reproduce, download M4 from eRCP web site,\nunzip, and execute j9foun22-eworkbench.bat.\n\nError only appears to happen on Windows 2000 machines.\n\njava.lang.RuntimeException: Unexpected native exception: Failed to \ninitialize COM\n        at \norg.eclipse.swt.widgets.Display$ESWTErrorHandler.respond(Display.java:265)\n        at com.ibm.ugl.p3ml.OS.Image_NewFromFileData(Native Method)\n        at \norg.eclipse.swt.graphics.ImageDataLoader.load(ImageDataLoader.java:49)\n        at org.eclipse.swt.graphics.ImageData.\u003cinit\u003e(ImageData.java:327)\n        at \norg.eclipse.jface.resource.URLImageDescriptor.getImageData(URLImageDescriptor.java:57)\n        at \norg.eclipse.jface.resource.ImageDescriptor.createImage(ImageDescriptor.java:279)\n        at \norg.eclipse.jface.resource.ImageDescriptor.createImage(ImageDescriptor.java:233)\n        at \norg.eclipse.jface.resource.ImageDescriptor.createImage(ImageDescriptor.java:211)\n        at \norg.eclipse.ercp.eworkbench.DefaultView$ViewLabelProvider.getImage(DefaultView.java:106)\n        at \norg.eclipse.ercp.eworkbench.DefaultView$ViewLabelProvider.getColumnImage(DefaultView.java\n:131)\n        at \norg.eclipse.jface.viewers.TableViewer.doUpdateItem(TableViewer.java:473)\n        at \norg.eclipse.jface.viewers.StructuredViewer$UpdateItemSafeRunnable.run(StructuredViewer.ja\nva:427)\n        at \norg.eclipse.core.internal.runtime.InternalPlatform.run(InternalPlatform.java:1046)\n        at org.eclipse.core.runtime.Platform.run(Platform.java:783)\n        at org.eclipse.ui.internal.JFaceUtil$1.run(JFaceUtil.java:40)\n        at org.eclipse.jface.util.SafeRunnable.run(SafeRunnable.java:158)\n        at \norg.eclipse.jface.viewers.StructuredViewer.updateItem(StructuredViewer.java:1765)\n        at \norg.eclipse.jface.viewers.TableViewer.createItem(TableViewer.java:343)\n        at \norg.eclipse.jface.viewers.TableViewer.internalRefreshAll(TableViewer.java:861)\n        at \norg.eclipse.jface.viewers.TableViewer.internalRefresh(TableViewer.java:758)\n        at \norg.eclipse.jface.viewers.TableViewer.internalRefresh(TableViewer.java:747)\n        at \norg.eclipse.jface.viewers.StructuredViewer$7.run(StructuredViewer.java:1266)\n        at \norg.eclipse.jface.viewers.StructuredViewer.preservingSelection(StructuredViewer.java:1203\n)\n        at \norg.eclipse.jface.viewers.StructuredViewer.refresh(StructuredViewer.java:1264)\n        at \norg.eclipse.jface.viewers.StructuredViewer.refresh(StructuredViewer.java:1223)\n        at \norg.eclipse.jface.viewers.TableViewer.inputChanged(TableViewer.java:708)\n        at \norg.eclipse.jface.viewers.ContentViewer.setInput(ContentViewer.java:248)\n        at \norg.eclipse.jface.viewers.StructuredViewer.setInput(StructuredViewer.java:1419)\n        at \norg.eclipse.ercp.eworkbench.DefaultView.createPartControl(DefaultView.java:150)\n        at \norg.eclipse.ui.internal.ViewFactory.busyRestoreViewHelper(ViewFactory.java:430)\n        at \norg.eclipse.ui.internal.ViewFactory.busyRestoreView(ViewFactory.java:298)\n        at \norg.eclipse.ui.internal.ViewFactory.restoreView(ViewFactory.java:700)\n        at \norg.eclipse.ui.internal.ViewFactory$ViewReference.getPart(ViewFactory.java:118)\n        at org.eclipse.ui.internal.PartPane.setVisible(PartPane.java:250)\n        at org.eclipse.ui.internal.ViewPane.setVisible(ViewPane.java:520)\n        at \norg.eclipse.ui.internal.presentations.PresentablePart.setVisible(PresentablePart.java:126\n)\n        at \norg.eclipse.ui.internal.presentations.NativeStackPresentation.selectPart(NativeStackPrese\nntation.java:147) ...",
    "I am able to successfully load gifs, pngs, jpgs on win2k.  My win2k \ninstallation has gdi+ installed.  It may be that the win2k failure is occurring \non a win2k installation without gdi+, at which point the code tries DirectX.",
    "Tracked down why this could be failing on a win2k machine without gdi.  During \nthe attempt to load the image via gdi, COM is initialized, but it is not being \nproperly uninitialized if the gdi load fails.  And the DirectX code is \ninitializing COM in a different way, and since it wasn\u0027t unitialized an error \noccurs since an attempt to initialize COM in a different mode is occurring.",
    "I have a fix for the COM failure error message; however, event with the fix, \nDirectX image loading for *.gif and *.jpg files is not working properly.  \nLoading these types of files causes the vm to crash.  To reproduce, change the \ncore loading code to bypass loading images via gdi (i.e., have it use \nDirectX).  See the file Image.c, ImageNewFromFile function.  Comment out the \ngdi code and always default to DirectX loading:\n\n//\timageHandle \u003d GDIpImageLoader_LoadFromFile...\n//\tif ((UGL_GetError(uglError) !\u003d 0) ...\n\tif (TRUE) {\n\nOpen the ImageViewer example (from the eswt examples project).  Open a *.gif \nfile, open a *.jpg file.  Doing so causes the vm to eventually crash.  J9 \ncrashes right away, the jdk hangs on for awhile but when you close the \nImageViewer it also crashes.",
    "Matt tried out DirectX on his XP machine and it works fine.",
    "Updated the code/dlls to include correct uninitialization of COM, which was \nleading to the failed COM initialization error.  ",
    "So is the image loading problem now fixed, or is there still an issue using\ndirect X on Win2000?",
    "There is still a problem with DirectX on some machines.  I can reproduce the \nproblem, but Matt can\u0027t.  I looked at the code and the platform calls appear \ncorrect.  I\u0027m leaving the bug open for future investigation, but I am no longer \nactively pursuing this issue.  If the issue arises again, I would suggest \nhaving the win2k users install gdi+.  My win2k machine has gdi+ installed.",
    "resolving as remind since it is no longer worked on"
  ],
  "commentCreationDates": [
    "2005-11-07T19:32:27+01:00",
    "2005-11-07T20:03:02+01:00",
    "2005-11-07T22:21:48+01:00",
    "2005-11-09T14:55:34+01:00",
    "2005-11-10T16:14:54+01:00",
    "2005-11-10T19:25:22+01:00",
    "2005-11-10T20:23:34+01:00",
    "2005-11-10T20:56:56+01:00",
    "2006-08-29T10:19:18+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.RuntimeException",
      "message": "Unexpected native exception: Failed to  initialize COM",
      "elements": [
        {
          "method": "org.eclipse.swt.widgets.Display$ESWTErrorHandler.respond",
          "source": "Display.java:265"
        },
        {
          "method": "com.ibm.ugl.p3ml.OS.Image_NewFromFileData",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.graphics.ImageDataLoader.load",
          "source": "ImageDataLoader.java:49"
        },
        {
          "method": "org.eclipse.swt.graphics.ImageData.\u003cinit\u003e",
          "source": "ImageData.java:327"
        },
        {
          "method": "org.eclipse.jface.resource.URLImageDescriptor.getImageData",
          "source": "URLImageDescriptor.java:57"
        },
        {
          "method": "org.eclipse.jface.resource.ImageDescriptor.createImage",
          "source": "ImageDescriptor.java:279"
        },
        {
          "method": "org.eclipse.jface.resource.ImageDescriptor.createImage",
          "source": "ImageDescriptor.java:233"
        },
        {
          "method": "org.eclipse.jface.resource.ImageDescriptor.createImage",
          "source": "ImageDescriptor.java:211"
        },
        {
          "method": "org.eclipse.ercp.eworkbench.DefaultView$ViewLabelProvider.getImage",
          "source": "DefaultView.java:106"
        },
        {
          "method": "org.eclipse.ercp.eworkbench.DefaultView$ViewLabelProvider.getColumnImage",
          "source": "DefaultView.java :131"
        },
        {
          "method": "org.eclipse.jface.viewers.TableViewer.doUpdateItem",
          "source": "TableViewer.java:473"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer$UpdateItemSafeRunnable.run",
          "source": "StructuredViewer.ja va:427"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:1046"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:783"
        },
        {
          "method": "org.eclipse.ui.internal.JFaceUtil$1.run",
          "source": "JFaceUtil.java:40"
        },
        {
          "method": "org.eclipse.jface.util.SafeRunnable.run",
          "source": "SafeRunnable.java:158"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.updateItem",
          "source": "StructuredViewer.java:1765"
        },
        {
          "method": "org.eclipse.jface.viewers.TableViewer.createItem",
          "source": "TableViewer.java:343"
        },
        {
          "method": "org.eclipse.jface.viewers.TableViewer.internalRefreshAll",
          "source": "TableViewer.java:861"
        },
        {
          "method": "org.eclipse.jface.viewers.TableViewer.internalRefresh",
          "source": "TableViewer.java:758"
        },
        {
          "method": "org.eclipse.jface.viewers.TableViewer.internalRefresh",
          "source": "TableViewer.java:747"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer$7.run",
          "source": "StructuredViewer.java:1266"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.preservingSelection",
          "source": "StructuredViewer.java:1203 "
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.refresh",
          "source": "StructuredViewer.java:1264"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.refresh",
          "source": "StructuredViewer.java:1223"
        },
        {
          "method": "org.eclipse.jface.viewers.TableViewer.inputChanged",
          "source": "TableViewer.java:708"
        },
        {
          "method": "org.eclipse.jface.viewers.ContentViewer.setInput",
          "source": "ContentViewer.java:248"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.setInput",
          "source": "StructuredViewer.java:1419"
        },
        {
          "method": "org.eclipse.ercp.eworkbench.DefaultView.createPartControl",
          "source": "DefaultView.java:150"
        },
        {
          "method": "org.eclipse.ui.internal.ViewFactory.busyRestoreViewHelper",
          "source": "ViewFactory.java:430"
        },
        {
          "method": "org.eclipse.ui.internal.ViewFactory.busyRestoreView",
          "source": "ViewFactory.java:298"
        },
        {
          "method": "org.eclipse.ui.internal.ViewFactory.restoreView",
          "source": "ViewFactory.java:700"
        },
        {
          "method": "org.eclipse.ui.internal.ViewFactory$ViewReference.getPart",
          "source": "ViewFactory.java:118"
        },
        {
          "method": "org.eclipse.ui.internal.PartPane.setVisible",
          "source": "PartPane.java:250"
        },
        {
          "method": "org.eclipse.ui.internal.ViewPane.setVisible",
          "source": "ViewPane.java:520"
        },
        {
          "method": "org.eclipse.ui.internal.presentations.PresentablePart.setVisible",
          "source": "PresentablePart.java:126 "
        },
        {
          "method": "org.eclipse.ui.internal.presentations.NativeStackPresentation.selectPart",
          "source": "NativeStackPrese ntation.java:147"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "115373",
      "date": "2005-11-07T19:32:27+01:00",
      "product": "ERCP",
      "component": "eSWT",
      "severity": "normal"
    }
  ],
  "groupId": "115373",
  "bugId": "115373",
  "date": "2005-11-07T19:32:27+01:00",
  "product": "ERCP",
  "component": "eSWT",
  "severity": "normal"
}