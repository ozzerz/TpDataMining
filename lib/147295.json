{
  "comments": [
    "I run Eclipse in the IBM WED platform and install a new application during runtime which adds new views to the platform.  When we attempt to construct the dynamic perspective we get an error in org.eclipse.ui.PartInitException.\n\nI believe this is with RC3.\n\n2006/06/15 09:25:14.888 SEVERE EclipseLog Exception in org.eclipse.ui.internal.PageLayout.addView: org.eclipse.ui.PartInitException: Could not create view: com.pb.sample.selector.view ::thread\u003dmain ::loggername\u003dEclipseLog\n\n\torg.eclipse.ui.PartInitException: Could not create view: com.pb.sample.selector.view\n\tat org.eclipse.ui.internal.ViewFactory.createView(ViewFactory.java:153)\n\tat org.eclipse.ui.internal.LayoutHelper.createView(LayoutHelper.java:162)\n\tat org.eclipse.ui.internal.PageLayout.createView(PageLayout.java:469)\n\tat org.eclipse.ui.internal.PageLayout.addView(PageLayout.java:371)\n\tat org.eclipse.ui.internal.PageLayout.addStandaloneView(PageLayout.java:804)\n\tat com.ibm.rcp.topologyhandler.ui.internal.layout.LayoutBuilder.addView()",
    "Some additional research.\n\nThe view ID\u0027s are also not in the registry after the new plugins are provisioned.  When I do an SS on the console I can also see the new plugins are not listed.\n\nI added an OSGI console command to list views registered.\n\nfrom the error the view is:  com.pb.sample.selector.view\n\n--Output from the OSGI console--\nViews registered in the platform:\n\tcom.ibm.rcp.samples.orderentry.richapp - com.ibm.rcp.samples.orderentry.richapp.views\n\tcom.ibm.rcp.samples.orderentry.richapp - com.ibm.rcp.samples.orderentry.richapp.views.OrderStatusView\n\tcom.ibm.rcp.samples.orderentry.richapp - com.ibm.rcp.samples.orderentry.richapp.views.NewOrderView\n\tcom.ibm.rcp.ui.browser.portal - com.ibm.rcp.ui.browser.portal.PAABrowserView\n\tcom.ibm.rcp.portal.app.ui - com.ibm.rcp.portal.app.ui.cainavigationview\n\tcom.ibm.rcp.portal.app.ui - com.ibm.rcp.portal.app.ui.CompositeAppNavigatorView\n\tcom.ibm.rcp.portal.catalog.ui - com.ibm.rcp.portal.catalog.ui\n\tcom.ibm.rcp.portal.catalog.ui - com.ibm.rcp.portal.catalog.ui.views.CatalogView\n\tcom.ibm.rcp.portal.catalog.ui - com.ibm.rcp.portal.catalog.ui.views.CatalogNavigatorView\n\tcom.ibm.rcp.portletviewer - com.ibm.rcp.portletviewer.portletview\n\tcom.ibm.rcp.syncui - com.ibm.rcp.syncui.views.SyncView\n\tcom.ibm.rcp.ui - com.ibm.rcp.ui.views.ProgressView\n\tcom.ibm.rcp.ui.browser - com.ibm.rcp.ui.browser.BrowserView\n\torg.eclipse.gef - org.eclipse.gef.ui.palette_view\n\torg.eclipse.help.ui - org.eclipse.help.ui\n\torg.eclipse.help.ui - org.eclipse.help.ui.HelpView\n\torg.eclipse.help.ui - org.eclipse.help.ui.HelpView\n\torg.eclipse.ui - org.eclipse.ui\n\torg.eclipse.ui - org.eclipse.ui.internal.introview\n\torg.eclipse.ui - org.eclipse.ui.internal.introview\n\torg.eclipse.ui.views - org.eclipse.ui.views.PropertySheet\n\torg.eclipse.ui.views - org.eclipse.ui.views.ContentOutline",
    "Just to be clear, is this command inspecting the Equinox Extension Registry or the UI View registry?",
    "I am not sure, here is the code.  I am just calling the Platform api\u0027s.\n\n   IExtensionRegistry reg \u003d Platform.getExtensionRegistry();\n   IExtensionPoint ep \u003d reg.getExtensionPoint(\"org.eclipse.ui\", \"views\");\n",
    "Why is this a P3?  This needs to be a P1.  This is a Hannover must have.",
    "How have you added the new plugins with the new views to eclipse?\n\nPW\n",
    "More specifically - are these views defined in an extension point in a plug-in or only added via the dynamic support.",
    "The views are in plugins that are provisioned by the WED client during runtime.  The plugins are wrapped in a single feature and each plugin contains a single view.\n\nSo in short, WED uses the provisioning API\u0027s to download these new plugins.  Does WED have to do anything else to get these plugins \"installed\"?  Currently, after the plugins are downloaded they are not even listed using the \"ss\" console command.",
    "Jeff, is it OSGi that provides the \"provisioning APIs\"?\n\nBob, if it doesn\u0027t show up in the OSGi console, we\u0027ll never see it.\n\nLater,\nPW\n",
    "Right, which is why we need to know if this is an update/provisioning problem or if WED needs to do something additional after the features and plugins are provisioned.",
    "Hi Bob,\n\nWhat APIs did you use to do this \"provisioning\"?  What platform functionality does it use (i.e., is it just part of equinox)?\n\nPW\n",
    "I will have to defer to Scott Bennett and Joe Rusnak for the specific api\u0027s that are called.",
    "Created an attachment (id\u003d44631)\ndynamically load a plugin in java\n\nThis is part of our dynamic plugin test suite, which can be found in org.eclipse.ui.tests.  It contains the code we use to load and activate a dynamic plugin from somewhere in the file system.\n\nPW\n",
    "Ok, so this implies that we need to call the install method after provisioning and it does not come for free (using the eclipse update apis).  Is this correct?",
    "We need to know what specific API calls were made.\n\nPW\n",
    "From Scott Bennett:\n\nThese are the APIs that provisioning uses to install a feature.\n\nProvisioning uses the following Eclipse Update APIs to install features.\n\nIInstallFeatureOperation op \u003d OperationsManager.getOperationFactory().createInstallOperation(IConfiguredSite, IFeature, IFeatureReference[], IFeature[],\n\tIVerificationListener);\n\nop.execute(IProgressMonitor, IOperationListener);\n",
    "I\u0027m not familiar with the update API, but I get the impression that you either need to do a restart or apply the changes.\n\nCan you try:\n\nOperationsManager.applyChangesNow();\n\nPW\n",
    "That didn\u0027t work.  It looked like it rebooted the platform and when it came back up we had all sorts of launch errors.",
    "You probably have errors in your dynamic plugins that you\u0027ll need to debug.\n\nTo make sure that you are using the APIs correctly you might want to examine the org.eclipse.update.standalone.InstallCommand which is also in org.eclipse.update.core.\n\nI was able to dynamically install and activate a feature, which promptly appeared in my menu bars using the following code:\n\ntry {\n\tfinal InstallCommand cmd \u003d new InstallCommand(\n\t\t\t\"org.eclipse.ui.internal.dynamic.feature\", \"1.0.0\",\n\t\t\t\"file:/home/users/pwebster/dyn-site/\",\n\t\t\t\"file:/opt/local/eclipse/M0609-dun01/eclipse/\", \"false\");\n\twindow.run(true, true, new IRunnableWithProgress() {\n\t\tpublic void run(IProgressMonitor monitor) throws InvocationTargetException, InterruptedException {\n\t\t\tcmd.run(monitor);\n\t\t\tcmd.applyChangesNow();\n\t\t}\n\t});\n} catch (Exception e) {\n\te.printStackTrace();\n}\n",
    "So do the API\u0027s I posted for Scott not work?",
    "BTW, our dynamic plugins are extremely basic.  They only contain a simple view in each.",
    "- Are there any errors in the log after installation? \n- Are all features and plug-ins installed properly i.e. are they in features and plugins directories respectively? \n- Does platform.xml contain your features?\n- After installation if you restart manually does it correct your problem?\n- When you restart eclipse and open Help -\u003e Manage Configuration and expand the tree are there any errors reported?\n",
    "Created an attachment (id\u003d44664)\nExample dynamic view site\n\nThis is an example site with one dynamic view.  It was made using the example Bob sent to me, but it only has dependencies on platform.  i.e. I used the WED feature.xml and WED site.xml, but a sample view plugin created from the  new plugin templates.\n\nOne difference is it no longer includes the WED extension point com.ibm.rcp.propertybroker.PropertyBrokerAction.\n\nIt works for this install command:\nfinal InstallCommand cmd \u003d new InstallCommand(\"z.ex.view.feature\", \"1.0.0\", \"file:/home/users/pwebster/dyn-site/\", \"/opt/local/eclipse/M0609-dyn01/eclipse/\", \"false\");\n\nThere is nothing special to be done to the view to make it dynamic.  Something that might matter is, does the WED extension point support dynamic additions?\n\nPW\n",
    "(In reply to comment #21)\n\u003e - Are there any errors in the log after installation?  \nNo\n\n\u003e - Are all features and plug-ins installed properly i.e. are they in features\n\u003e and plugins directories respectively? \nYes\n\n\u003e - Does platform.xml contain your features? \nI believe so, I need to verify.\n\n\u003e - After installation if you restart manually does it correct your problem? It appears it does, yes.\n\n\u003e - When you restart eclipse and open Help -\u003e Manage Configuration and expand the\n\u003e tree are there any errors reported?\n\nUnfortunately WED does not provide this option.  I do not see any configuration errors in the log and it appears to work fine.\n",
    "We are NOT using that API.  Does the API we ARE using work in your tests?  \n\nCan anyone please answer that basic question about IInstallFeatureOperation?\n\nAlso, yes, the WED extension points have all been updated to have dynamicity. The property broker extensions all listen for new plugins.\n",
    "Yes, API you are using is used from Update UI component so there shouldn?t be any problems. What it does is it lays down files on file system and update platform.xml. And after that you might need to restart (in your case it seems it has to since after restart everything is fine if I understood correctly) or apply changes ( you said that does not help, am I right?). From your answers it seems that we did everything we are suppose to do. What I do not understand is in comment 16 Paul says: \n\nI\u0027m not familiar with the update API, but I get the impression that you either\nneed to do a restart or apply the changes.\n\nCan you try:\n\nOperationsManager.applyChangesNow();\n\nPW\n \nIn your response you say it rebooted eclipse but there were many errors. Were you able to continue after that? ApplyChangesNow() should not reboot are you sure that reboot happened?\n\nCan you call PlatformUI.getWorkbench().restart() after installation?\n",
    "(In reply to comment #24)\n\u003e We are NOT using that API.  Does the API we ARE using work in your tests?  \n\nInstallCommand preps the parameters and then uses that API to do the install ... so yes, it does.\n\nPW\n",
    "Ah ok, we are getting somewhere.\n\nI put that call (OperationsManager.applyChangesNow();) after everything was provisioned however, we are wrapping the Eclipse exe with our own executables and when that command \"applies\" the new features/plugins it looks like it attempts to restart the platform and of course it doesn\u0027t launch correctly.\n\nWhy is that call attempting to restart the platform?  Should it be?",
    "From your comment so far it looks to me like you need to force restart, I am not sure why but that is how it looks. Maybe you can define InstallHander and force the restart. \nAs far as I know applyChangesNow should not attempt the restart, this is the code for it:\nConfigurationActivator configurator \u003d ConfigurationActivator.getConfigurator();\nconfigurator.installBundles();\npendingOperations.clear();\nThis is the call we use when we offer user to start plug-ins that have been just installed without restart.\n\n",
    "(In reply to comment #22)\n\u003e This is an example site with one dynamic view.  It was made using the example\n\u003e Bob sent to me, but it only has dependencies on platform.  i.e. I used the WED\n\u003e feature.xml and WED site.xml, but a sample view plugin created from the  new\n\u003e plugin templates.\n\nSo it looks like the WED site.xml and feature-plugin/feature.xml are fine.  With a substitute view plugin, it was loaded successfully without a restart.\n\n\u003e There is nothing special to be done to the view to make it dynamic.  Something\n\u003e that might matter is, does the WED extension point support dynamic additions?\n\nDoes WED always intall new features/plugins?  Or does WED also update features and plugins with new versions?\n\nPW\n",
    "Ok, I am now convinced this is a WED bug.  I was able to setup with our platform a test where I include the:\n\nOperationsManager.applyChangesNow();\n\nIn a real working environment and the application (views) showed up fine.  We can now close this bug and resolve the issues internally.\n\nThank you!",
    "Reopening because there was no fix involved. Needs to be marked as WORKSFORME.",
    "Done."
  ],
  "commentCreationDates": [
    "2006-06-15T16:18:53+02:00",
    "2006-06-15T16:40:01+02:00",
    "2006-06-15T16:49:40+02:00",
    "2006-06-15T17:00:52+02:00",
    "2006-06-15T17:15:03+02:00",
    "2006-06-15T20:11:11+02:00",
    "2006-06-15T20:13:24+02:00",
    "2006-06-15T20:18:59+02:00",
    "2006-06-15T20:23:22+02:00",
    "2006-06-15T20:25:45+02:00",
    "2006-06-15T21:56:40+02:00",
    "2006-06-16T14:46:15+02:00",
    "2006-06-16T15:01:57+02:00",
    "2006-06-16T15:20:46+02:00",
    "2006-06-16T15:28:53+02:00",
    "2006-06-16T16:12:10+02:00",
    "2006-06-16T16:56:09+02:00",
    "2006-06-16T17:18:44+02:00",
    "2006-06-16T19:28:08+02:00",
    "2006-06-16T19:38:23+02:00",
    "2006-06-16T19:41:59+02:00",
    "2006-06-16T20:57:20+02:00",
    "2006-06-16T21:07:42+02:00",
    "2006-06-16T21:20:36+02:00",
    "2006-06-16T21:23:30+02:00",
    "2006-06-16T22:16:48+02:00",
    "2006-06-16T22:26:27+02:00",
    "2006-06-16T22:43:41+02:00",
    "2006-06-16T22:51:24+02:00",
    "2006-06-17T14:46:32+02:00",
    "2006-06-19T19:52:43+02:00",
    "2006-06-19T20:00:58+02:00",
    "2006-06-19T20:01:48+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.ui.PartInitException",
      "message": "Could not create view: com.pb.sample.selector.view",
      "elements": [
        {
          "method": "org.eclipse.ui.internal.ViewFactory.createView",
          "source": "ViewFactory.java:153"
        },
        {
          "method": "org.eclipse.ui.internal.LayoutHelper.createView",
          "source": "LayoutHelper.java:162"
        },
        {
          "method": "org.eclipse.ui.internal.PageLayout.createView",
          "source": "PageLayout.java:469"
        },
        {
          "method": "org.eclipse.ui.internal.PageLayout.addView",
          "source": "PageLayout.java:371"
        },
        {
          "method": "org.eclipse.ui.internal.PageLayout.addStandaloneView",
          "source": "PageLayout.java:804"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "147295",
      "date": "2006-06-15T16:18:53+02:00",
      "product": "Platform",
      "component": "Update",
      "severity": "major"
    }
  ],
  "groupId": "147295",
  "bugId": "147295",
  "date": "2006-06-15T16:18:53+02:00",
  "product": "Platform",
  "component": "Update",
  "severity": "major"
}