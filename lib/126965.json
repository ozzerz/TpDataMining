{
  "comments": [
    "Driver:  M101 0207\n\nIf the Web services wizard create an EAR targetting Geronimo, the Geronimo facet is not added.  This cause a problem when more than one such EAR is added to Geronimo:\n\n!MESSAGE Configuration with id Application_IDalready exists.  Existing configuration will be overwri\ntten with redeploy.\nDeployer operation failed: Could not parse application.xml\norg.apache.geronimo.common.DeploymentException: Could not parse application.xml\n        at org.apache.geronimo.j2ee.deployment.EARConfigBuilder.getEarPlan(EARConfigBuilder.java:176\n)\n        at org.apache.geronimo.j2ee.deployment.EARConfigBuilder.getDeploymentPlan(EARConfigBuilder.j\nava:122)\n        at org.apache.geronimo.j2ee.deployment.EARConfigBuilder$$FastClassByCGLIB$$38e56ec6.invoke(\u003c\ngenerated\u003e)\n        at net.sf.cglib.reflect.FastMethod.invoke(FastMethod.java:53)\n        at org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke(FastMethodInvoker.java:38)\n        at org.apache.geronimo.gbean.runtime.GBeanOperation.invoke(GBeanOperation.java:118)\n        at org.apache.geronimo.gbean.runtime.GBeanInstance.invoke(GBeanInstance.java:800)\n        at org.apache.geronimo.gbean.runtime.RawInvoker.invoke(RawInvoker.java:57)\n        at org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke(RawOperationInvoker.java:36)\n        at org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept(ProxyMethodInterceptor.\njava:96)\n        at org.apache.geronimo.deployment.ConfigurationBuilder$$EnhancerByCGLIB$$6abab4ad.getDeploym\nentPlan(\u003cgenerated\u003e)\n        at org.apache.geronimo.deployment.Deployer.deploy(Deployer.java:219)\n\nI talked to Sachin and he indicated that we should be adding the default facet specific to the runtime (the Geronimo facet in this case) when we programatically created EAR.\n\nThe only reason its working for web projects is beacuse the configID is falling back on the context root which will be uniquiq for all web projects in the workbench.\n\nI\u0027ve opened a JIRA defect about doing similar defaulting for EAR and other J2EE project creation:\n\nhttp://issues.apache.org/jira/browse/GERONIMODEVTOOLS-64\n\nDepending on how that defect is resolved, we might have to decide whether we need to add the default facet when creating project/EAR targetiing a server runtime.  The code to get default facet is:\n\norg.eclipse.wst.common.project.facet.core.runtime.IRuntime.getDefaultFacets().",
    "Created an attachment (id\u003d41276)\nPatch to jst.ws.consumption\n\n",
    "Impact to user:  The Geronimo facet is not added to the Web or EAR module when they are created by the Web services wizard.  This resulted in error when more than one such created EAR is added to the Geronimo server because when the Geronimo facet is not added to the EAR when targetting Geronimo, geronimo-application.xml is not generated.  When geronimo-application.xml is not present, the application id of the application.xml is used and it\u0027s always hard-coded to \"Application_ID\".  This resulted in the error:  \n\n!MESSAGE Configuration with id Application_IDalready exists. Existing configuration will be overwri \ntten with redeploy. \nDeployer operation failed: Could not parse application.xml \n\nThe fix involves adding the facet runtime\u0027s default facet when calculating the facetsToAdd in CreateFacetedProjectCommand.\n\nI\u0027ve tested the fix with Geronimo 1.0 plugin and Geronimo 1.0 server.\n\nChris, requesting approval for WTP 1.5 RC3.\n",
    "Kathy, approved for RC3.\n\nPS: can the following snippet of new code:\n\n  for (Iterator iter \u003d defaultFacetSet.iterator(); iter.hasNext();) {\n    IProjectFacetVersion defaultProjFacetVersion \u003d (IProjectFacetVersion) iter.next();\n    if( ! facets.contains( defaultProjFacetVersion ) )\n    {\n      facets.add(defaultProjFacetVersion);\n    }\n  }\n\nBe replaced by this?\n\n  facets.addAll(defaultFacetSet)",
    "It turns out that we should only add the defaultProjectFacetVersion if the resulting defaultProjectFacet (not defaultProjectFacetVersion) is not in the project facet of the original facetsToAdd.\n\n  Set defaultFacetsToAdd \u003d new HashSet();\n  for (Iterator iter \u003d defaultProjectFacetVersionSet.iterator(); iter.hasNext();) {\n     IProjectFacetVersion defaultProjFacetVersion \u003d (IProjectFacetVersion) iter.next();\n      \tif( ! projectFacetSet.contains( defaultProjFacetVersion.getProjectFacet() ) )\n      \t{\n      \t  defaultFacetsToAdd.add(defaultProjFacetVersion);\n      \t}\n     }\n\nAlso, since the facets required by the Web services runtime is added after the createFacetedProjectCommand in PreServiceDevelop and preClientDevelop command, we have to move that call to FacetUtils.addRequiredFacetsToProject() to the CreateFacetedProjectCommand before adding the default facets.\n\nI\u0027ve tested with Tomcat, Geronimo and other servers supporting Web services runtimes.\n\nChris, please approve for WTP 1.5 RC3.\n",
    "Created an attachment (id\u003d41690)\nMulti plugin patch\n\nChris and Rupam, for your review.",
    "Reviewed and approved for RC3.",
    "Patch reviewed. Looks good.",
    "Patch committed.  Will release later.",
    "Released to WTP 1.5 RC3 as v200605171621.",
    "Verified on v200605180627 with Geronimo server."
  ],
  "commentCreationDates": [
    "2006-02-08T19:57:04+01:00",
    "2006-05-12T03:41:27+02:00",
    "2006-05-12T03:49:29+02:00",
    "2006-05-12T15:21:06+02:00",
    "2006-05-17T05:56:58+02:00",
    "2006-05-17T05:58:08+02:00",
    "2006-05-17T15:38:33+02:00",
    "2006-05-17T17:47:12+02:00",
    "2006-05-17T17:57:17+02:00",
    "2006-05-17T18:21:46+02:00",
    "2006-05-18T20:45:38+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.apache.geronimo.common.DeploymentException",
      "message": "Could not parse application.xml",
      "elements": [
        {
          "method": "org.apache.geronimo.j2ee.deployment.EARConfigBuilder.getEarPlan",
          "source": "EARConfigBuilder.java:176 "
        },
        {
          "method": "org.apache.geronimo.j2ee.deployment.EARConfigBuilder.getDeploymentPlan",
          "source": "EARConfigBuilder.j ava:122"
        },
        {
          "method": "org.apache.geronimo.j2ee.deployment.EARConfigBuilder$$FastClassByCGLIB$$38e56ec6.invoke",
          "source": "\u003c generated\u003e"
        },
        {
          "method": "net.sf.cglib.reflect.FastMethod.invoke",
          "source": "FastMethod.java:53"
        },
        {
          "method": "org.apache.geronimo.gbean.runtime.FastMethodInvoker.invoke",
          "source": "FastMethodInvoker.java:38"
        },
        {
          "method": "org.apache.geronimo.gbean.runtime.GBeanOperation.invoke",
          "source": "GBeanOperation.java:118"
        },
        {
          "method": "org.apache.geronimo.gbean.runtime.GBeanInstance.invoke",
          "source": "GBeanInstance.java:800"
        },
        {
          "method": "org.apache.geronimo.gbean.runtime.RawInvoker.invoke",
          "source": "RawInvoker.java:57"
        },
        {
          "method": "org.apache.geronimo.kernel.basic.RawOperationInvoker.invoke",
          "source": "RawOperationInvoker.java:36"
        },
        {
          "method": "org.apache.geronimo.kernel.basic.ProxyMethodInterceptor.intercept",
          "source": "ProxyMethodInterceptor. java:96"
        },
        {
          "method": "org.apache.geronimo.deployment.ConfigurationBuilder$$EnhancerByCGLIB$$6abab4ad.getDeploymentPlan",
          "source": "\u003cgenerated\u003e"
        },
        {
          "method": "org.apache.geronimo.deployment.Deployer.deploy",
          "source": "Deployer.java:219"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "126965",
      "date": "2006-02-08T19:57:04+01:00",
      "product": "Web Tools",
      "component": "jst.ws",
      "severity": "major"
    }
  ],
  "groupId": "126965",
  "bugId": "126965",
  "date": "2006-02-08T19:57:04+01:00",
  "product": "Web Tools",
  "component": "jst.ws",
  "severity": "major"
}