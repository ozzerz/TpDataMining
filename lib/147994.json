{
  "comments": [
    "Hello,\n\nI have written two RCP applications with some views. Both have a menu bar and a toolbar. Each view has some actions in the view\u0027s toolbar area and during my tests I noticed the following problem:\n\nWhen I click on a button in the toolbar, the corresponding view opens. If I close it and repeat the same operation three times, the image of the button is replaced by the image of the first action of my view\u0027s toolbar. If I choose to open the view with the menu, I got this error:\n\nGraphic is disposed with the following stacktrace:\norg.eclipse.swt.SWTException: Graphic is disposed\n\tat org.eclipse.swt.SWT.error(SWT.java:2942)\n\tat org.eclipse.swt.SWT.error(SWT.java:2865)\n\tat org.eclipse.swt.SWT.error(SWT.java:2836)\n\tat org.eclipse.swt.graphics.Image.getBounds(Image.java:1087)\n\tat org.eclipse.swt.widgets.MenuItem.wmMeasureChild(MenuItem.java:1071)\n\tat org.eclipse.swt.widgets.Control.WM_MEASUREITEM(Control.java:3389)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3076)\n\tat org.eclipse.swt.widgets.Decorations.windowProc(Decorations.java:1582)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:3751)\n\tat org.eclipse.swt.internal.win32.OS.DefWindowProcW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.DefWindowProc(OS.java:1651)\n\tat org.eclipse.swt.widgets.Shell.callWindowProc(Shell.java:410)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3123)\n\tat org.eclipse.swt.widgets.Decorations.windowProc(Decorations.java:1582)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:3751)\n\tat org.eclipse.swt.internal.win32.OS.DefWindowProcW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.DefWindowProc(OS.java:1651)\n\tat org.eclipse.swt.widgets.Shell.callWindowProc(Shell.java:410)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3123)\n\tat org.eclipse.swt.widgets.Decorations.windowProc(Decorations.java:1582)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:3751)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:1656)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2756)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1699)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1663)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:367)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:143)\n\tat com.kbl.obitm.Application.run(Application.java:14)\n\tat org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:226)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:376)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:163)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.eclipse.core.launcher.Main.invokeFramework(Main.java:334)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:278)\n\tat org.eclipse.core.launcher.Main.run(Main.java:973)\n\tat org.eclipse.core.launcher.Main.main(Main.java:948)",
    "This is most often caused by sharing controls between one object and another.\n\nHow are you creating the actions?  How are you creating the view toolbar?  How many views do you have?\n\nPW\n",
    "I have about ten views. The actions are defined in the plugin.xml file under org.eclipse.ui.actionSets. Each action extends IWorkbenchWindowActionDelegate and has the property \u0027icon\u0027 setted to something like \"icons/xxx.gif\".\n\nIn each view, I extend org.eclipse.jface.action.Action to create my custom actions and I add these ones to the view\u0027s toolbar with \n\nIToolBarManager tbm \u003d getViewSite().getActionBars().getToolBarManager().add()\ntbm.add(action);\n...\n\nHope it helps.\n\nBest regards.\nPascal",
    "Hello,\n\nMy application will be tested very soon by the users and I would like to get rid of this problem.\n\nYou say: \"This is most often caused by sharing controls between one object and another.\"\n\nWhat can I do to try to isolate the problem ? The image is shared by the menubar and the toolbar. The thing I don\u0027t understand it\u0027s why the image is replaced by one of the view\u0027s action bar. There is no link between these objects... I use an ImageRegistry to store the most frequently used images.\n\nBest regards,\nPascal",
    "You create an action?  And in the action you return an image from somewhere for the icon?\n\nThen you use the same action in the menubar and the toolbar?\n\nThen what do you have in actionSets (that\u0027s a different toolbar than the view toolbar).\n\nMake sure none of your actionSet actions have the same IDs as the ones you add using the view IActionBars.\n\nPW\n",
    "You create an action?\n\nYes, in my views, I create several actions and I add them to the view\u0027s toolbar like this:\n\nacnAjouter \u003d new Action(\"Ajouter\", IDTCTLSED) {\n   public void run() {\n      ...\n   }\n};\nacnAjouter.setImageDescriptor(ApplicationImagesRegistry.get(\"add.button\"));\nacnAjouter.setToolTipText(\"Ajouter\");\n\nIToolBarManager tbm \u003d getViewSite().getActionBars().getToolBarManager().add()\n\ntbm.add(acnAjouter);\ntbm.add(xxx);\n....\n\nAnd in the action you return an image from somewhere for the icon?\n\nI use the ImageRegistry of my plugin. I have overloaded the following method to initialize the registry: \n    protected void initializeImageRegistry(ImageRegistry reg)\n\nThe ApplicationImagesRegistry.get(\u003ckey\u003e) method do the following thing:\n\nreturn ObitmPlugin.getDefault().getImageRegistry().getDescriptor(\u003ckey\u003e);\n\nThen you use the same action in the menubar and the toolbar?\n\nYes. I filled the menubarpath and the toolbarpath to render the action in the toolbar and in the menubar\n\nThen what do you have in actionSets (that\u0027s a different toolbar than the view toolbar).\n\nSeveral actions are defined. The implementation class looks like:\n\npublic class ComptesEspecesNostroAction implements WorkbenchWindowActionDelegate {\n\n\tprivate IWorkbenchWindow window;\n\n\tpublic ComptesEspecesNostroAction() {\n\t}\n\n\tpublic void run(IAction action) {\n\t\t\n\t\tIWorkbenchPage page \u003d window.getActivePage();\n\t\tif (page !\u003d null)\n\t\t{\n\t\t\ttry {\n\t\t\t\tpage.showView(ComptesEspecesNostroView.ID_VIEW);\n\t\t\t} catch (PartInitException e) {\n\t\t\t\tErrorManager.showError(e);\n\t\t\t}\n\t\t}\n\t}\n\nThe icon associated to this action is defined under Extension Element Details -\u003e icon.\n\n\nMake sure none of your actionSet actions have the same IDs as the ones you add using the view IActionBars.\n\nI don\u0027t use the method setId() when I create an action for a view\u0027s toolbar...\n\nPascal",
    "Is it the best way to define the menu and the toolbar of an application in the plugin.xml ?\n\nI have seen some examples that define the menu in the ApplicationActionBarAdvisor class.\n\nWhat do you recommand ?\n\nPS: I am using Eclipse 3.1.2",
    "(In reply to comment #6)\n\u003e Is it the best way to define the menu and the toolbar of an application in the\n\u003e plugin.xml ?\n\nI would use the plugin.xml to define my actions unless I had something else I needed to do.  org.eclipse.ui.actionSets can define global actions.  org.eclipse.ui.viewActions can define actions for the view menu and view toolbar.\n\nCheck out http://www.eclipse.org/articles/Article-action-contribution/Contributing%20Actions%20to%20the%20Eclipse%20Workbench.html for an overview.\n\nPW\n",
    "I works almost fine except when you specify an image for the action.\nIn my case, this image is used by the toolbar button and the menu item.\n\nIf I click several times on it I receive an error.\n\nIf I could reproduce this bug in a simple rcp application, could you help me to find what\u0027s wrong ?\n\nPascal",
    "I use two different images. One for the view and one for the actionSet.\n\nI can now open the view a thousand times, everything works fine.\n\nThanks\nPascal",
    "closing"
  ],
  "commentCreationDates": [
    "2006-06-21T09:26:06+02:00",
    "2006-06-21T14:41:05+02:00",
    "2006-06-21T15:10:50+02:00",
    "2006-07-03T11:27:04+02:00",
    "2006-07-03T14:23:24+02:00",
    "2006-07-03T14:50:31+02:00",
    "2006-07-05T16:34:37+02:00",
    "2006-07-05T16:45:06+02:00",
    "2006-07-05T16:50:43+02:00",
    "2006-07-06T11:00:32+02:00",
    "2006-09-19T20:57:50+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.swt.SWTException",
      "message": "Graphic is disposed",
      "elements": [
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:2942"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:2865"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:2836"
        },
        {
          "method": "org.eclipse.swt.graphics.Image.getBounds",
          "source": "Image.java:1087"
        },
        {
          "method": "org.eclipse.swt.widgets.MenuItem.wmMeasureChild",
          "source": "MenuItem.java:1071"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.WM_MEASUREITEM",
          "source": "Control.java:3389"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3076"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.windowProc",
          "source": "Decorations.java:1582"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3751"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DefWindowProcW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DefWindowProc",
          "source": "OS.java:1651"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.callWindowProc",
          "source": "Shell.java:410"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3123"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.windowProc",
          "source": "Decorations.java:1582"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3751"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DefWindowProcW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DefWindowProc",
          "source": "OS.java:1651"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.callWindowProc",
          "source": "Shell.java:410"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3123"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.windowProc",
          "source": "Decorations.java:1582"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3751"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessage",
          "source": "OS.java:1656"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2756"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1699"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1663"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:367"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:143"
        },
        {
          "method": "com.kbl.obitm.Application.run",
          "source": "Application.java:14"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:226"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:376"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:163"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:324"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:334"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:278"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:973"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:948"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "147994",
      "date": "2006-06-21T09:26:06+02:00",
      "product": "Platform",
      "component": "UI",
      "severity": "normal"
    }
  ],
  "groupId": "147994",
  "bugId": "147994",
  "date": "2006-06-21T09:26:06+02:00",
  "product": "Platform",
  "component": "UI",
  "severity": "normal"
}