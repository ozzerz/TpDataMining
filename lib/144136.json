{
  "comments": [
    "CDT 200605270500, Eclipse 3.2RC6:\n\nThe following code causes a ClassCastException:\n\nclass TestClass {\npublic:\n  static TestClass* create() {\n    return new TestClass();\n  }\n};\n\n#define TEST_MACRO(x, y) \\\nstatic void ## y ## _aaa(x, \u0026y::create)\n\nTEST_MACRO(SomeClass::SOME_CONSTANT, TestClass);\n\nava.lang.ClassCastException: org.eclipse.cdt.internal.core.dom.parser.cpp.CPPMethod\n\tat org.eclipse.cdt.internal.core.pdom.dom.cpp.PDOMCPPFunction.\u003cinit\u003e(PDOMCPPFunction.java:57)\n\tat org.eclipse.cdt.internal.core.pdom.dom.cpp.PDOMCPPLinkage.addName(PDOMCPPLinkage.java:143)\n\tat org.eclipse.cdt.internal.core.pdom.indexer.fast.PDOMFastIndexerJob$1.visit(PDOMFastIndexerJob.java:122)\n\tat org.eclipse.cdt.internal.core.dom.parser.cpp.CPPASTName.accept(CPPASTName.java:90)\n\tat org.eclipse.cdt.internal.core.dom.parser.cpp.CPPASTDeclarator.accept(CPPASTDeclarator.java:126)\n\tat org.eclipse.cdt.internal.core.dom.parser.cpp.CPPASTSimpleDeclaration.accept(CPPASTSimpleDeclaration.java:74)\n\tat org.eclipse.cdt.internal.core.dom.parser.cpp.CPPASTTranslationUnit.accept(CPPASTTranslationUnit.java:561)\n\tat org.eclipse.cdt.internal.core.pdom.indexer.fast.PDOMFastIndexerJob.addSymbols(PDOMFastIndexerJob.java:113)\n\tat org.eclipse.cdt.internal.core.pdom.indexer.fast.PDOMFastIndexerJob.addTU(PDOMFastIndexerJob.java:67)\n\tat org.eclipse.cdt.internal.core.pdom.indexer.fast.PDOMFastReindex.addSources(PDOMFastReindex.java:41)\n\tat org.eclipse.cdt.internal.core.pdom.indexer.fast.PDOMFastReindex.run(PDOMFastReindex.java:64)\n\tat org.eclipse.cdt.internal.core.pdom.PDOMIndexerJob.run(PDOMIndexerJob.java:44)\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:58)",
    "This is really ugly code and is full of syntax errors. The macro expands the second parameter to the aaa method to TestClass::create, which resolves to a the method in the TestClass, instead of a parameter name, thus the ClassCastException. I have added protection around the code so that it doesn\u0027t throw the exception and tries to recover.",
    "I don\u0027t see what is wrong with this code. Isn\u0027t the parser supposed to understand method pointers?",
    "Well, thest Test Macro expands to:\n\nstatic voidTestClass_aaa(SomeClass::SOME_CONSTANT, \u0026TestClass::create);\n\nIs this supposed to be a declaration or a function call? Is this code inside another function or in the global scope?",
    "I see what you mean. The first ## in the macro should be removed. It was intended to be a function declaration.",
    "O.K. but even doing that I wasn\u0027t able to get it to compile with gcc. It looks like it\u0027s trying to interpret it as a variable declaration since you are using values (i.e. the constant and the function pointer) as parameter names.",
    "I derived this example from a real compiling code that caused the same exception. I probably removed too much from it.",
    "I confirm that ClassCastException in the indexer does not happen any more."
  ],
  "commentCreationDates": [
    "2006-05-28T23:25:35+02:00",
    "2006-06-06T19:44:37+02:00",
    "2006-06-06T20:24:29+02:00",
    "2006-06-06T21:01:38+02:00",
    "2006-06-06T21:29:08+02:00",
    "2006-06-06T21:33:37+02:00",
    "2006-06-06T21:38:13+02:00",
    "2006-06-07T19:40:29+02:00"
  ],
  "traces": [
    {
      "exceptionType": "ava.lang.ClassCastException",
      "message": "org.eclipse.cdt.internal.core.dom.parser.cpp.CPPMethod",
      "elements": [
        {
          "method": "org.eclipse.cdt.internal.core.pdom.dom.cpp.PDOMCPPFunction.\u003cinit\u003e",
          "source": "PDOMCPPFunction.java:57"
        },
        {
          "method": "org.eclipse.cdt.internal.core.pdom.dom.cpp.PDOMCPPLinkage.addName",
          "source": "PDOMCPPLinkage.java:143"
        },
        {
          "method": "org.eclipse.cdt.internal.core.pdom.indexer.fast.PDOMFastIndexerJob$1.visit",
          "source": "PDOMFastIndexerJob.java:122"
        },
        {
          "method": "org.eclipse.cdt.internal.core.dom.parser.cpp.CPPASTName.accept",
          "source": "CPPASTName.java:90"
        },
        {
          "method": "org.eclipse.cdt.internal.core.dom.parser.cpp.CPPASTDeclarator.accept",
          "source": "CPPASTDeclarator.java:126"
        },
        {
          "method": "org.eclipse.cdt.internal.core.dom.parser.cpp.CPPASTSimpleDeclaration.accept",
          "source": "CPPASTSimpleDeclaration.java:74"
        },
        {
          "method": "org.eclipse.cdt.internal.core.dom.parser.cpp.CPPASTTranslationUnit.accept",
          "source": "CPPASTTranslationUnit.java:561"
        },
        {
          "method": "org.eclipse.cdt.internal.core.pdom.indexer.fast.PDOMFastIndexerJob.addSymbols",
          "source": "PDOMFastIndexerJob.java:113"
        },
        {
          "method": "org.eclipse.cdt.internal.core.pdom.indexer.fast.PDOMFastIndexerJob.addTU",
          "source": "PDOMFastIndexerJob.java:67"
        },
        {
          "method": "org.eclipse.cdt.internal.core.pdom.indexer.fast.PDOMFastReindex.addSources",
          "source": "PDOMFastReindex.java:41"
        },
        {
          "method": "org.eclipse.cdt.internal.core.pdom.indexer.fast.PDOMFastReindex.run",
          "source": "PDOMFastReindex.java:64"
        },
        {
          "method": "org.eclipse.cdt.internal.core.pdom.PDOMIndexerJob.run",
          "source": "PDOMIndexerJob.java:44"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:58"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "144136",
      "date": "2006-05-28T23:25:35+02:00",
      "product": "CDT",
      "component": "cdt-core",
      "severity": "normal"
    }
  ],
  "groupId": "144136",
  "bugId": "144136",
  "date": "2006-05-28T23:25:35+02:00",
  "product": "CDT",
  "component": "cdt-core",
  "severity": "normal"
}