{
  "comments": [
    "I200401130800\n\nFound many of these in the log file.  General stability seems to be affected \nwhile in use.\n\n\n!ENTRY org.eclipse.ui 4 0 Jan 13, 2004 15:11:53.105\n!MESSAGE java.lang.NullPointerException\n!STACK 0\njava.lang.NullPointerException\n\tat org.eclipse.swt.custom.StyledText.getSelectionRange\n(StyledText.java:4275)\n\tat org.eclipse.jface.text.TextViewer.getSelectedRange\n(TextViewer.java:1875)\n\tat org.eclipse.jface.text.TextViewer.getSelection(TextViewer.java:2009)\n\tat org.eclipse.ui.texteditor.AbstractTextEditor.doGetSelection\n(AbstractTextEditor.java:1770)\n\tat \norg.eclipse.ui.texteditor.AbstractTextEditor$SelectionProvider.getSelection\n(AbstractTextEditor.java:1154)\n\tat org.eclipse.ui.internal.AbstractSelectionService.getSelection\n(AbstractSelectionService.java:221)\n\tat org.eclipse.search.internal.ui.OpenSearchDialogAction.getSelection\n(OpenSearchDialogAction.java:68)\n\tat org.eclipse.search.internal.ui.OpenSearchDialogAction.run\n(OpenSearchDialogAction.java:57)\n\tat org.eclipse.search.ui.SearchUI.openSearchDialog(SearchUI.java:110)\n\tat org.eclipse.search.internal.ui.OpenFileSearchPageAction.run\n(OpenFileSearchPageAction.java:46)\n\tat org.eclipse.ui.internal.PluginAction.runWithEvent\n(PluginAction.java:273)\n\tat org.eclipse.ui.internal.WWinPluginAction.runWithEvent\n(WWinPluginAction.java:207)\n\tat \norg.eclipse.jface.action.ActionContributionItem.handleWidgetSelection\n(ActionContributionItem.java:509)\n\tat org.eclipse.jface.action.ActionContributionItem.access$2\n(ActionContributionItem.java:461)\n\tat org.eclipse.jface.action.ActionContributionItem$5.handleEvent\n(ActionContributionItem.java:408)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:953)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:1845)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:1625)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1518)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1494)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench\n(Workbench.java:258)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:139)\n\tat org.eclipse.ui.internal.ide.IDEApplication.run\n(IDEApplication.java:47)\n\tat org.eclipse.core.internal.runtime.PlatformActivator$1.run\n(PlatformActivator.java:226)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run\n(EclipseStarter.java:85)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:279)\n\tat org.eclipse.core.launcher.Main.run(Main.java:742)\n\tat org.eclipse.core.launcher.Main.main(Main.java:581)",
    "Prevents me from opening a search dialog.  Upgrading severity to blocker.  If \nyou have time left, this would be nice for a rebuild.",
    "I\u0027ve used Grant\u0027s debugging \"swt.jar\" file and reproduced the problem.  There \nare still no clear steps to reproduce, but it appears timing related.  When \nEclipse enters this state, it then continues to recur easily.  (Someone has a \nhandle on a partially disposed widget?!?)  Sometimes, I am forced to kill \nEclipse, as a dialog informing of the NPE blocks shutdown (i.e., it keeps re-\nopening if it is closed).\n\nI will attach my log and the console output leading up to the failure.",
    "Created an attachment (id\u003d7427)\nLog file\n",
    "Created an attachment (id\u003d7428)\nConsole output\n",
    "As a note, this combined with Bug 49985 is leading to loss of data.",
    "I still can\u0027t reproduce any of the various StyledText-slots-are-null-too-early \nbugs, but investigating them has helped me to construct other hypothetical \ncases where problems can occur.  So I have a fix for these cases, and as a side \neffect should also fix these other problems that are being reported.  Doug, can \nyou:\n\n1. Just for fun, try running with jit turned off, and/or a different vm.  I ask \nthis because after further investigation, I still don\u0027t see how the cases that \nI can\u0027t reproduce are even possible given code flows.\n\n2. Substitute in the next attached jar, and report here whether this makes your \nworld work better or not.  Thanks!\n",
    "Created an attachment (id\u003d7443)\nswt jar that defers slot nulling\n",
    "I saw the same type of problems with SWT yesterday.  I tried the substituting\nthe attached swt.jar and eclipse won\u0027t start up now.\n\n!SESSION ----------------------------------------------------------------------\n!ENTRY org.eclipse.core.launcher 4 0 Jan 14, 2004 09:45:22.53\n!MESSAGE Exception launching the Eclipse Platform:\n!STACK\njava.lang.NoClassDefFoundError: org/eclipse/swt/widgets/Listener\n\tat org.eclipse.ui.PlatformUI.createDisplay(PlatformUI.java:149)\n\tat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:41)\n\tat\norg.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:226)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:85)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:279)\n\tat org.eclipse.core.launcher.Main.run(Main.java:742)\n\tat org.eclipse.core.launcher.Main.main(Main.java:581)\n",
    "Grant, I\u0027m holding off on using the JAR file because of Travis\u0027 problems with it.   \n\nTravis: What distribution of Linux are you using?  What version of GTK?  And\nwhat version of the JVM?",
    "Gentoo Linux\ngtk+-2.2.4-r1\nsun-jdk-1.4.2.03\nglibc-2.3.2-r3\n\nLet me know if you need anything else.  I\u0027ve reverted to M6 for now, but\nyesterday\u0027s build is just a symlink away.",
    "It\u0027s interesting, because I have the exact same set-up here.  Gentoo Linux, \ngtk+-2.2.4, glibc-2.3.2 and jdk-1.4.2_03.\n\nGrant: what are you running?",
    "Was I just supposed to replace the swt.jar with the attachment?\nI diffed the two .jars and all the same classes are present, so I don\u0027t really\nunderstand how a java.lang.NoClassDefFoundError could occur.",
    "Yes, the jars are almost identical, the new one just has some changed .class \nfiles.  Substituting the new jar into the swt plugin was the intent, I don\u0027t \nknow why it would cause the Listener class (which was not changed) to not be \nfound.  I\u0027ll try to figure something out here.\n\nI\u0027m running on RH8, gtk 2.2.1, sun jre 1.4.1_01.\n",
    "I\u0027ll try attaching a new jar.  I updated this one at the linux command line \ninstead of going through winzip on windows (just a guess that for some reason \nyou\u0027re unable to open the swt.jar that was updated with winzip).  (Which makes \nme think of one other possibility, are the permission bits on your jar that \ndidn\u0027t work liberal enough?)\n\nIf this new jar doesn\u0027t start for you then we can just wait for tonight\u0027s \nnightly build since I\u0027ve released the fix to HEAD; it\u0027s needed regardless of \nthese problems.\n",
    "Created an attachment (id\u003d7445)\nanother attempt at making this jar\n",
    "Same NoClassDefFoundError problem with the new .jar.  I\u0027ll see about having the\nclassloader be a bit verbose about what it is trying to load.  Is there a way to\nhave eclipse spit out it\u0027s classpath?\n",
    "Ok.  My mistake the 2nd .jar seems to be working fine.  No problems so far. \nI\u0027ll let you know if I see any other errors.\n\nThanks for you help",
    "Seems to be better, but still pretty crashy.  I can crash it pretty easily by\nswitching editors using Ctrl-L Ctrl-E a few times.  I\u0027m no longer getting useful\nerror in the .log file.\n\nI am seeing a lot of \"Resource is out of sync...\" ResourceExceptions in the .log.\n\nI\u0027ll try tomorrow\u0027s build.",
    "Are you getting any NullPointerExceptions in the StyledText?  These are \nspecifically what should be addressed by the attached jar.\n",
    "I\u0027ve been able to reproduce the problem in a self-hosted workspace in a \ndebugger.  Unfortunately, the stack traces I got back wouldn\u0027t fill, and Java \nseized up -- becoming completely unresponsive in the workspace that was \ndebugging (rather than the workspace that has being debugged).\n\nGrant, could you upgrade to 1.4.2_03 tomorrow, and run with it for a bit?  I\u0027m \ncurious as to whether this is a VM problem.",
    "I believe I finally have it.  I got a debugger to catch it with a stack trace,\nand a nice variable pool I could walk around.\n\nThe dispose listener that nulls out the values is in the second position of the\nlistener array (i.e., listener[1]), but it is not the last listener responding\nto a dispose event.  The other listeners are positioned (in my particular heap)\nas [0], [1], [11], [28], [29], [41], [42]. [43]. and [57].  The listener at [11]\nis the JFace TextViewer dispose listener, which happens to set document to null.\n This leads to a whole chain reaction of changes leading to the eventual (and\nfatal) StyledText.claimBottomFreeSpace().  A section of this trace is shown below.\n\nThe problem is two-fold.  First of all, SWT is nulling the values very early on,\nwhich means future dispose listeners can\u0027t access the values.  I\u0027m not sure what\nthe SWT contract is on this, but it looks like some people (at least) are\nassuming that this is not going to happen.  Secondly, an exception occurring\nduring dispose aborts the dispose event when it is only partially complete. \nThis leaves partially disposed items referenced in the heap, and things get\nreally messy.  This is what leads to subsequent crashes and general stability\nproblems.\n\nNote, the first problem is probably not SWT\u0027s to solve.  It is likely that there\nare a few dispose listeners that are broken.  They\u0027ve only been set off by the\nmore aggressive policy toward nulling values that SWT has just implemented.\n\nSound like a good explanation?\n\n\n\norg.eclipse.swt.custom.StyledText.claimBottomFreeSpace() line: 2016\norg.eclipse.swt.custom.StyledText.handleResize(org.eclipse.swt.widgets.Event)\nline: 5445\norg.eclipse.swt.custom.StyledText$14.handleEvent(org.eclipse.swt.widgets.Event)\nline: 5100\norg.eclipse.swt.widgets.EventTable.sendEvent(org.eclipse.swt.widgets.Event) line: 82\norg.eclipse.swt.custom.StyledText(org.eclipse.swt.widgets.Widget).sendEvent(org.eclipse.swt.widgets.Event)\nline: 953\norg.eclipse.swt.custom.StyledText(org.eclipse.swt.widgets.Widget).sendEvent(int,\norg.eclipse.swt.widgets.Event, boolean) line: 977\norg.eclipse.swt.custom.StyledText(org.eclipse.swt.widgets.Widget).sendEvent(int)\nline: 958\norg.eclipse.swt.custom.StyledText(org.eclipse.swt.widgets.Control).setBounds(int,\nint, int, int, boolean, boolean) line: 497\norg.eclipse.swt.custom.StyledText(org.eclipse.swt.widgets.Composite).setBounds(int,\nint, int, int, boolean, boolean) line: 664\norg.eclipse.swt.custom.StyledText(org.eclipse.swt.widgets.Canvas).setBounds(int,\nint, int, int, boolean, boolean) line: 239\norg.eclipse.swt.custom.StyledText(org.eclipse.swt.widgets.Control).setBounds(int,\nint, int, int) line: 433\norg.eclipse.jface.text.source.SourceViewer$RulerLayout.layout(org.eclipse.swt.widgets.Composite,\nboolean) line: 106\norg.eclipse.swt.widgets.Canvas(org.eclipse.swt.widgets.Composite).layout(boolean)\nline: 540\norg.eclipse.jface.text.source.LineNumberChangeRulerColumn(org.eclipse.jface.text.source.LineNumberRulerColumn).layout(boolean)\nline: 460\norg.eclipse.jface.text.source.LineNumberChangeRulerColumn.setModel(org.eclipse.jface.text.source.IAnnotationModel)\nline: 314\norg.eclipse.jface.text.source.CompositeRuler.setModel(org.eclipse.jface.text.source.IAnnotationModel)\nline: 642\norg.eclipse.jdt.internal.ui.javaeditor.CompilationUnitEditor$AdaptedSourceViewer(org.eclipse.jface.text.source.SourceViewer).setDocument(org.eclipse.jface.text.IDocument,\norg.eclipse.jface.text.source.IAnnotationModel, int, int) line: 431\norg.eclipse.jdt.internal.ui.javaeditor.CompilationUnitEditor$AdaptedSourceViewer(org.eclipse.jface.text.source.SourceViewer).setDocument(org.eclipse.jface.text.IDocument)\nline: 384\norg.eclipse.jface.text.TextViewer$1.widgetDisposed(org.eclipse.swt.events.DisposeEvent)\nline: 1354\n\n\nFor reference, and debugging purposes, the dispose listeners in the heap at the\ntime of failure were:\n+ org.eclipse.swt.accessibility.Accessible$1\n+ org.eclipse.swt.custom.StyledText$7\n+ org.eclipse.jface.text.TextViewer$1\n+ org.eclipse.jface.text.AbstractInformationControlManager$1 (appears 6 times)\n",
    "The first part (nulling things early) makes sense and is what should be fixed \nas of earlier today (the nulling is now async\u0027d).\n\nThe second part could certainly be true; after an exception occurs who knows \nwhat state you\u0027re left in...\n\n...I don\u0027t think this explains the reports in which the StyledText continues to \nreceive events after being disposed though, since none of these reports \nindicates a previous exception occurring.  However, since the fix from earlier \ntoday should make the StyledText NPE\u0027s all go away, this mystery can probably \nbe ignored for now.\n",
    "And to clarify the first part, the swt policy is that in a dispose listener the \nobject being disposed should still be fully usable.  So this is a bug that has \nalways existed in StyledText and several other emulated widgets (see bug 49996).\n",
    "Using the new .jar I am not seeing any NPE.  Fix seems good.  General stability\nis still iffy, but it doesn\u0027t appear to be SWT anymore.\n\nThanks",
    "Marking as fixed.  If you see any more NPE\u0027s in StyledText then please reopen.\n"
  ],
  "commentCreationDates": [
    "2004-01-13T20:19:19+01:00",
    "2004-01-13T20:20:18+01:00",
    "2004-01-13T22:28:31+01:00",
    "2004-01-13T22:29:36+01:00",
    "2004-01-13T22:31:08+01:00",
    "2004-01-14T17:10:06+01:00",
    "2004-01-14T17:31:35+01:00",
    "2004-01-14T17:33:12+01:00",
    "2004-01-14T17:51:33+01:00",
    "2004-01-14T18:22:30+01:00",
    "2004-01-14T18:28:40+01:00",
    "2004-01-14T18:31:33+01:00",
    "2004-01-14T18:35:30+01:00",
    "2004-01-14T18:56:27+01:00",
    "2004-01-14T19:18:02+01:00",
    "2004-01-14T19:19:00+01:00",
    "2004-01-14T19:39:02+01:00",
    "2004-01-14T21:30:24+01:00",
    "2004-01-14T21:39:56+01:00",
    "2004-01-14T21:44:20+01:00",
    "2004-01-14T22:05:57+01:00",
    "2004-01-14T22:35:13+01:00",
    "2004-01-14T22:51:38+01:00",
    "2004-01-14T22:54:43+01:00",
    "2004-01-14T23:08:11+01:00",
    "2004-01-19T15:25:59+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.swt.custom.StyledText.getSelectionRange",
          "source": "StyledText.java:4275"
        },
        {
          "method": "org.eclipse.jface.text.TextViewer.getSelectedRange",
          "source": "TextViewer.java:1875"
        },
        {
          "method": "org.eclipse.jface.text.TextViewer.getSelection",
          "source": "TextViewer.java:2009"
        },
        {
          "method": "org.eclipse.ui.texteditor.AbstractTextEditor.doGetSelection",
          "source": "AbstractTextEditor.java:1770"
        },
        {
          "method": "org.eclipse.ui.texteditor.AbstractTextEditor$SelectionProvider.getSelection",
          "source": "AbstractTextEditor.java:1154"
        },
        {
          "method": "org.eclipse.ui.internal.AbstractSelectionService.getSelection",
          "source": "AbstractSelectionService.java:221"
        },
        {
          "method": "org.eclipse.search.internal.ui.OpenSearchDialogAction.getSelection",
          "source": "OpenSearchDialogAction.java:68"
        },
        {
          "method": "org.eclipse.search.internal.ui.OpenSearchDialogAction.run",
          "source": "OpenSearchDialogAction.java:57"
        },
        {
          "method": "org.eclipse.search.ui.SearchUI.openSearchDialog",
          "source": "SearchUI.java:110"
        },
        {
          "method": "org.eclipse.search.internal.ui.OpenFileSearchPageAction.run",
          "source": "OpenFileSearchPageAction.java:46"
        },
        {
          "method": "org.eclipse.ui.internal.PluginAction.runWithEvent",
          "source": "PluginAction.java:273"
        },
        {
          "method": "org.eclipse.ui.internal.WWinPluginAction.runWithEvent",
          "source": "WWinPluginAction.java:207"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:509"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$2",
          "source": "ActionContributionItem.java:461"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$5.handleEvent",
          "source": "ActionContributionItem.java:408"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:953"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:1845"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:1625"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1518"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1494"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:258"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:139"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:47"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:226"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:85"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:324"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:279"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:742"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:581"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "49942",
      "date": "2004-01-13T20:19:19+01:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "blocker"
    },
    {
      "exceptionType": "java.lang.NoClassDefFoundError",
      "message": "org/eclipse/swt/widgets/Listener",
      "elements": [
        {
          "method": "org.eclipse.ui.PlatformUI.createDisplay",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:41"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:226"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:85"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:324"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:279"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:742"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:581"
        }
      ],
      "number": 1,
      "commentIndex": 8,
      "bugId": "49942",
      "date": "2004-01-14T17:51:33+01:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "blocker"
    }
  ],
  "groupId": "49942",
  "bugId": "49942",
  "date": "2004-01-13T20:19:19+01:00",
  "product": "Platform",
  "component": "SWT",
  "severity": "blocker"
}