{
  "comments": [
    "I\u0027m getting an ArrayIndexOutOfBoundsException from trying to compile\nSimpleToken.java in CDT 3.0.0:\n\n    [javac] 20. ERROR in\n/home/build/BUILD/common-devrocket-2.1.0/plugins/org.eclipse.cdt.core/parser/org/eclipse/cdt/internal/core/parser/token/SimpleToken.java\n    [javac]  (at line 0)\n    [javac]    \n/*******************************************************************************\n    [javac]     ^\n    [javac] Internal compiler error\n    [javac] java.lang.ArrayIndexOutOfBoundsException: 800\n    [javac]     at\norg.eclipse.jdt.internal.compiler.codegen.CodeStream.ldc(CodeStream.java:4276)\n    [javac]     at\norg.eclipse.jdt.internal.compiler.codegen.CodeStream.generateConstant(CodeStream.java:1393)\n    [javac]     at\norg.eclipse.jdt.internal.compiler.ast.ReturnStatement.generateCode(ReturnStatement.java:136)\n    [javac]     at\norg.eclipse.jdt.internal.compiler.ast.SwitchStatement.generateCode(SwitchStatement.java:202)\n    [javac]     at\norg.eclipse.jdt.internal.compiler.ast.AbstractMethodDeclaration.generateCode(AbstractMethodDeclaration.java:222)\n    [javac]     at\norg.eclipse.jdt.internal.compiler.ast.AbstractMethodDeclaration.generateCode(AbstractMethodDeclaration.java:169)\n    [javac]     at\norg.eclipse.jdt.internal.compiler.ast.TypeDeclaration.generateCode(TypeDeclaration.java:561)\n    [javac]     at\norg.eclipse.jdt.internal.compiler.ast.TypeDeclaration.generateCode(TypeDeclaration.java:615)\n    [javac]     at\norg.eclipse.jdt.internal.compiler.ast.CompilationUnitDeclaration.generateCode(CompilationUnitDeclaration.java:184)\n    [javac]     at\norg.eclipse.jdt.internal.compiler.Compiler.process(Compiler.java:510)\n    [javac]     at\norg.eclipse.jdt.internal.compiler.Compiler.compile(Compiler.java:329)\n    [javac]     at\norg.eclipse.jdt.internal.compiler.batch.Main.performCompilation(Main.java:2691)\n    [javac]     at\norg.eclipse.jdt.internal.compiler.batch.Main.compile(Main.java:1151)\n    [javac]     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    [javac]     at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n    [javac]     at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n    [javac]     at java.lang.reflect.Method.invoke(Method.java:324)\n    [javac]     at\norg.eclipse.jdt.core.JDTCompilerAdapter.execute(JDTCompilerAdapter.java:63)\n    [javac]     at org.apache.tools.ant.taskdefs.Javac.compile(Javac.java:931)\n    [javac]     at org.apache.tools.ant.taskdefs.Javac.execute(Javac.java:757)\n...",
    "Which Eclipse build are you using ?\nOlivier - could be a good candidate for backporting to 3.1.2.",
    "I am investigating.",
    "Raise severity to blocker since this prevents the file from being compiled\nwithout any workaround.",
    "So far I cannot reproduce. Please provide the build id.",
    "I\u0027m using the JDT compiler in Eclipse 3.1.0 (CVS tag: R3_1).  I\u0027ll try to find\nout what the build id is, if you still need it.\n\nI\u0027ll be atatching the CDT file SimpleToken.java shortly.\n\nSorry for not providing this info earlier and thanks for looking into this!",
    "Created an attachment (id\u003d29549)\nCDT source file.\n",
    "I cannot reproduce with HEAD. Could you please send me all the files I need to\ncompile this version of the SimpleToken class.\nI\u0027ll try to reproduce with an older version.",
    "Reducing severity since I cannot reproduce with 3.1 maintenance HEAD stream,\ncurrent 3.2 HEAD and 3.0 maintenance HEAD stream.\nI definitely need all dependant source files.\nI\u0027ll try to get all source files from CDT 3.0.0 out of CVS.",
    "I got all source tagged as CDT_3_0 and I still could not reproduce.",
    "Olivier, did you test this in the workbench?   The failure we\u0027re seeing is when\nbuilding outside the workbench, in the command-line.  We need to be able to do\nthis.  Does the JDT compiler require any special options to be set?\n",
    "I tried in the workbench and on the command line. I could not reproduce.\nCould you please provide the exact same set of source files that you are using?\nAlso give me the command line and all possible details in order to reproduce the\nproblem.\nThanks for your help.",
    "Sure, I\u0027ll attach what I think you\u0027ll need shortly.  BTW, I\u0027m sorry for not\npointing out that I was building in batch mode at the very beginning.  Thanks\nfor your patience! ",
    "Created an attachment (id\u003d29577)\necj.jar and build.xml for cdt.core\n",
    "I could not reproduce the problem.\nCan you reproduce it all the time?\nIf yes, could you please provide the source files you are compiling?",
    "I think the only file is different is the build.xml file for\norg.eclipse.cdt.core.  The one I\u0027m using is attached.  I also provided ecj.jar,\nin it\u0027s different.\n\nI\u0027m using the same version of Ant as in Eclipse 3.1.0, i.e. version 1.6.5.\n\nThe command line used to kick off the CDT build is as follows:\nrc\u003d0 ; \\\nJAVA_HOME\u003d/opt/montavista/common/jdk/jre \\\nANT_HOME\u003d/opt/montavista/common/apache-ant \\\nCLASSPATH\u003d/home/build/SOURCES/ecj.jar \\\n/opt/montavista/common/apache-ant/bin/ant \\\n    -buildfile `/home/build/SOURCES/cygpath -w\n/home/build/BUILD/common-devrocket-2.1.0/build/tools/build.xml` \\\n    -Dos\u003dlinux \\\n    -Dws\u003dgtk \\\n    -Darch\u003dx86 \\\n    -Dbasedir\u003d`/home/build/SOURCES/cygpath -w\n/home/build/BUILD/common-devrocket-2.1.0/` \\\n    -Dbootclasspath\u003d`/home/build/SOURCES/cygpath -wp\n/opt/montavista/common/jdk/jre/lib/rt.jar:/opt/montavista/common/jdk/jre/lib/jsse.jar`\n\\\n    -Dbuild.compiler\u003dorg.eclipse.jdt.core.JDTCompilerAdapter \\\n    -DjavacDebugInfo\u003doff \\\n    -DjavacFailOnError\u003dfalse \\\n    -DjavacSource\u003d1.4 \\\n    -DjavacTarget\u003d1.4 \\\n    -DjavacVerbose\u003dfalse \\\n    init compile ; \\\n[ $rc -eq 0 ] || exit $rc\nBuildfile: /home/build/BUILD/common-devrocket-2.1.0/build/tools/build.xml\n\n\nI\u0027ll also attach /home/build/BUILD/common-devrocket-2.1.0/build/tools/build.xml\nin case its of any help.  It\u0027s a top-level build file to launch the build of the\nvarious CDT plugins.\n\nThe CDT source is the same as CDT 3.0.0.\n\n\n",
    "Created an attachment (id\u003d29578)\ntop-level tools build.xml\n",
    "Yes, the failure occurs consistently for me.   How did you build in the command\nline?  Perhaps I should build the way you did to make this work.",
    "Created an attachment (id\u003d29579)\norg.eclipse.cdt.core source from CDT 3.0.0\n",
    "I\u0027ve attached the source for the org.eclipse.cdt.core plugin.  You may find\nchanges which my team has made (there may not be any) but SimpleToken.java was\ndefinitely not changed.\n\nPlease let me know if you need anything else from me.\n",
    "Thank you. I will continue to investigate this issue. Hopefully I will be able\nto reproduce the failure.",
    "I could not reproduce it. I don\u0027t know what I am doing that could be different\nfrom your settings.\nDid you try with 3.1.1 to see if this problem is fixed?\nI used the jar file of JDT/Core plugin from the 3.1 build. I used your source\nfile and the build.xml located in the project folder. The build is successful.\nCould you please try to run using the following compiler arg:\n\u003ccompilerarg line\u003d\"${temp.folder}/cdtcorelog.xml\"/\u003e\nAnd send me the log file. I\u0027d like to know what files are compiled during your\ncompilation.\nIf this doesn\u0027t work, I can try to send you a patch based on 3.1.1 that could\nfix this issue. I simply wanted to understand how the failure occured.\nThanks for your help tracking down this issue.",
    "I got it.\nDon\u0027t know why suddenly I could reproduce it, but this is the case.\nI am working on a fix.",
    "I could not reproduce because in my testing I was generating the debug\nattributes. To reproduce the failures, the debug attributes must not be generated.\nFixed and released in HEAD.\nRegression test added in\norg.eclipse.jdt.core.tests.compiler.regression.XLargeTest.test008",
    "Backported to 3.1 maintenance and 3.0 maintenance streams.\nSame regression test added in both streams",
    "Thanks very much for getting this fixed so quickly, Olivier!  Would you please\nattach the patch to this bug so that I can apply it to our source repository?",
    "Olivier, do you know why the exception is not thrown when building in the\nworkbench?  Is it because the debug attributes are generated when building in\nthe workbench?",
    "Yes, if you have debug attribute the situation described below won\u0027t happen.\n\nThe fix is very simple.\nReplace the resizeByteArray() method in\norg.eclipse.jdt.internal.compiler.codegen.CodeStream with:\nprivate final void resizeByteArray() {\n\tint length \u003d bCodeStream.length;\n\tint requiredSize \u003d length + length;\n\tif (classFileOffset \u003e\u003d requiredSize) {\n\t\t// must be sure to grow enough\n\t\trequiredSize \u003d classFileOffset + length;\n\t}\n\tSystem.arraycopy(bCodeStream, 0, bCodeStream \u003d new byte[requiredSize], 0, length);\n}\n\nNote the \u003e\u003d instead of \u003e.\nIn your case the byte array size was 400 and the classFileOffset was 800.\nSo the resize checked wrongly (using \u003e) that doubling the size was sufficient.\nSo after the resize, the byte array size is 800 and the classFileOffset is still\n800. So writing at index 800 in an array of 800 elements leads to the exception\nyou got.\nBy checking \u003e\u003d, we will then resize the byte array to 1200 and there is enough\nspace to put what needs to be added.\nLet me know if you could patch it successfully. Next 3.1.2 build or\nintegration/nightly build will contain the fix.",
    "I see.  What a difference \"\u003e\u003d\" makes.  :-)\n\nAre debug attributes not generated when the build is done in batch mode?  What\u0027s\nthe option to turn this on and off?\n",
    "I think this is an ant feature.\nIn the script you send me, I can see:\n\t\u003cproperty name\u003d\"javacDebugInfo\" value\u003d\"on\"/\u003e\nAnd in the javac task, you have:\ndebug\u003d\"${javacDebugInfo}\"\n\nBut it seems that this is overriden when properties are passed on the command\nline. And your command line contains:\n    -DjavacDebugInfo\u003doff \\\n\nSo no debug attributes are generated. By default in the workbench, line number\nattribute and source attribute are generated. This is configurable in the\ncompiler preferences per project or for the whole workbench.",
    "I understand now.  I\u0027ll test the fix and update this bug shortly.   Thanks for\nall your help, Olivier!",
    "Fix verified with CDT 3.0.0 source.",
    "Reopen to close as FIXED.\nWe will verify it again prior to 3.2M4. Thanks for annotating it.",
    "Fixed.",
    "Verified for 3.2 M4 using build I20051212-0010",
    "Reopen for 3.1.2 verification",
    "We also need to verify that\u0027s this bug fix is in R3_1_maintenance stream as well before 3.1.2 delivery...\n",
    "Verified for 3.1.2 using build M20060109-1200.",
    "Verified for 3.1.2 using build M20060109-1200 (maxime)"
  ],
  "commentCreationDates": [
    "2005-11-08T01:40:41+01:00",
    "2005-11-08T10:14:48+01:00",
    "2005-11-08T13:47:19+01:00",
    "2005-11-08T13:47:56+01:00",
    "2005-11-08T14:05:46+01:00",
    "2005-11-08T17:26:46+01:00",
    "2005-11-08T17:27:58+01:00",
    "2005-11-08T20:19:13+01:00",
    "2005-11-08T20:30:39+01:00",
    "2005-11-08T20:35:11+01:00",
    "2005-11-08T20:41:04+01:00",
    "2005-11-08T23:28:11+01:00",
    "2005-11-08T23:39:48+01:00",
    "2005-11-09T00:34:32+01:00",
    "2005-11-09T00:50:44+01:00",
    "2005-11-09T01:01:08+01:00",
    "2005-11-09T01:01:59+01:00",
    "2005-11-09T01:04:02+01:00",
    "2005-11-09T01:31:20+01:00",
    "2005-11-09T01:34:28+01:00",
    "2005-11-09T02:13:33+01:00",
    "2005-11-09T14:44:22+01:00",
    "2005-11-09T15:41:29+01:00",
    "2005-11-09T17:10:13+01:00",
    "2005-11-09T17:28:25+01:00",
    "2005-11-09T17:34:22+01:00",
    "2005-11-09T17:40:45+01:00",
    "2005-11-09T17:42:00+01:00",
    "2005-11-09T17:50:46+01:00",
    "2005-11-09T17:56:55+01:00",
    "2005-11-09T18:10:10+01:00",
    "2005-11-10T04:11:10+01:00",
    "2005-11-10T14:22:23+01:00",
    "2005-11-10T14:22:34+01:00",
    "2005-12-12T16:10:41+01:00",
    "2006-01-09T11:45:27+01:00",
    "2006-01-09T11:46:37+01:00",
    "2006-01-10T10:09:34+01:00",
    "2006-01-10T10:25:20+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ArrayIndexOutOfBoundsException",
      "message": "800     [javac]",
      "elements": [
        {
          "method": "org.eclipse.jdt.internal.compiler.codegen.CodeStream.ldc",
          "source": "CodeStream.java:4276"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "115408",
      "date": "2005-11-08T01:40:41+01:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    }
  ],
  "groupId": "115408",
  "bugId": "115408",
  "date": "2005-11-08T01:40:41+01:00",
  "product": "JDT",
  "component": "Core",
  "severity": "normal"
}