{
  "comments": [
    "I have a cheatsheet that starts a wizard (specifies dialog\u003d\"true\"), the cheatsheet is correctly loaded into the tray when the wizard starts, but when I either cancel or finish the wizard, I get the stack trace below.\n\nThe value of the \"listener\" field in the CheatSheetViewer is null, and this appears to be so because we are not between the hookDialogListener/unhookDialogListener calls when the listener in the code below is invoked (when the control is disposed):\n\n\t\t\thelpPart.getControl().addListener(SWT.Dispose, new Listener() {\n\t\t\t\tpublic void handleEvent(Event event) {\n\t\t\t\t\tcontrol.setVisible(true);\n\t\t\t\t\tDisplay.getCurrent().addFilter(SWT.Show, listener);\n\n---\u003e error happens here\n\n\n\t\t\t\t\tif (preTrayManager !\u003d null) {\n\t\t\t\t\t\tloadState();   // Load from the tray manager\n\t\t\t\t\t\tstateManager \u003d preTrayManager;\n\t\t\t\t\t\tpreTrayManager \u003d null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\nWhat I don\u0027t understand is how this works at all, for any wizard, but it clearly does with the new project wizard in the RCP plugin cheatsheet.  Unfortunately, I can\u0027t run that with the debugger because the cheatsheet (when run in the debugger) shows no steps at all.\n\nI further don\u0027t understand the purpose of adding that filter when the control is being disposed, so I\u0027m reluctant to propose a patch.\n\nLet me know if I can provide further information to help diagnose this.\n\n\n\n------------------\n\njava.lang.IllegalArgumentException: Argument cannot be null\nat org.eclipse.swt.SWT.error(SWT.java:3358)\nat org.eclipse.swt.SWT.error(SWT.java:3297)\nat org.eclipse.swt.SWT.error(SWT.java:3268)\nat org.eclipse.swt.widgets.Display.error(Display.java:1065)\nat org.eclipse.swt.widgets.Display.addFilter(Display.java:493)\nat org.eclipse.ui.internal.cheatsheets.views.CheatSheetViewer$2.handleEvent(CheatSheetViewer.java:666)\nat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\nat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1085)\nat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1109)\nat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1090)\nat org.eclipse.swt.widgets.Widget.release(Widget.java:954)\nat org.eclipse.swt.widgets.Control.release(Control.java:2538)\nat org.eclipse.swt.widgets.Composite.releaseChildren(Composite.java:1033)\nat org.eclipse.swt.widgets.Widget.release(Widget.java:957)\nat org.eclipse.swt.widgets.Control.release(Control.java:2538)\nat org.eclipse.swt.widgets.Widget.dispose(Widget.java:430)\nat org.eclipse.jface.dialogs.TrayDialog.closeTray(TrayDialog.java:118)\nat org.eclipse.jface.dialogs.TrayDialog.close(TrayDialog.java:141)\nat org.eclipse.jface.wizard.WizardDialog.hardClose(WizardDialog.java:735)\nat org.eclipse.jface.wizard.WizardDialog.close(WizardDialog.java:407)\nat org.eclipse.jface.wizard.WizardDialog.cancelPressed(WizardDialog.java:395)\nat org.eclipse.jface.wizard.WizardDialog$1.widgetSelected(WizardDialog.java:277)\nat org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:90)\nat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\nat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1085)\nat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3166)\nat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2842)\nat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1914)\nat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1878)\nat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:419)\nat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)\nat com.oaklandsw.transform.editor.Editor.runEditor(Editor.java:2469)\nat com.oaklandsw.transform.editor.Standalone.run(Standalone.java:105)\nat org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:78)\nat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:92)\nat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:68)\nat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:400)\nat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:177)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\nat java.lang.reflect.Method.invoke(Method.java:324)\nat org.eclipse.core.launcher.Main.invokeFramework(Main.java:336)\nat org.eclipse.core.launcher.Main.basicRun(Main.java:280)\nat org.eclipse.core.launcher.Main.run(Main.java:977)\nat org.eclipse.core.launcher.Main.main(Main.java:952)",
    "This would happen if your command completes immediately after the dialog is opened, as opposed to the eclipse cheat sheet commands which complete after the dialog is closed. It is a bug.. it prematurely cleans up the listener.\n\nThe workaround is to change your command\u0027s lifetime to match the dialog. If you don\u0027t own the command you may have to create your own new one to wrap it. If you\u0027re just opening a regular new/import/export wizard then I suggest using the command provided by the platform.\n\nI will fix in 3.3. This should work.",
    "Fixed.",
    "Damn, you are fast!  That was exactly the problem.  Thanks."
  ],
  "commentCreationDates": [
    "2007-02-15T08:23:19+01:00",
    "2007-02-15T17:30:54+01:00",
    "2007-02-15T17:31:29+01:00",
    "2007-02-15T18:45:44+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.IllegalArgumentException",
      "message": "Argument cannot be null",
      "elements": [
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3358"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3297"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3268"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.error",
          "source": "Display.java:1065"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.addFilter",
          "source": "Display.java:493"
        },
        {
          "method": "org.eclipse.ui.internal.cheatsheets.views.CheatSheetViewer$2.handleEvent",
          "source": "CheatSheetViewer.java:666"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:1085"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:1109"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:1090"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.release",
          "source": "Widget.java:954"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.release",
          "source": "Control.java:2538"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseChildren",
          "source": "Composite.java:1033"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.release",
          "source": "Widget.java:957"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.release",
          "source": "Control.java:2538"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.dispose",
          "source": "Widget.java:430"
        },
        {
          "method": "org.eclipse.jface.dialogs.TrayDialog.closeTray",
          "source": "TrayDialog.java:118"
        },
        {
          "method": "org.eclipse.jface.dialogs.TrayDialog.close",
          "source": "TrayDialog.java:141"
        },
        {
          "method": "org.eclipse.jface.wizard.WizardDialog.hardClose",
          "source": "WizardDialog.java:735"
        },
        {
          "method": "org.eclipse.jface.wizard.WizardDialog.close",
          "source": "WizardDialog.java:407"
        },
        {
          "method": "org.eclipse.jface.wizard.WizardDialog.cancelPressed",
          "source": "WizardDialog.java:395"
        },
        {
          "method": "org.eclipse.jface.wizard.WizardDialog$1.widgetSelected",
          "source": "WizardDialog.java:277"
        },
        {
          "method": "org.eclipse.swt.widgets.TypedListener.handleEvent",
          "source": "TypedListener.java:90"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:1085"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:3166"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2842"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1914"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1878"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:419"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "com.oaklandsw.transform.editor.Editor.runEditor",
          "source": "Editor.java:2469"
        },
        {
          "method": "com.oaklandsw.transform.editor.Standalone.run",
          "source": "Standalone.java:105"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:78"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:92"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:68"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:400"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:177"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:324"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:336"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:280"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:977"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:952"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "174258",
      "date": "2007-02-15T08:23:19+01:00",
      "product": "Platform",
      "component": "User Assistance",
      "severity": "normal"
    }
  ],
  "groupId": "174258",
  "bugId": "174258",
  "date": "2007-02-15T08:23:19+01:00",
  "product": "Platform",
  "component": "User Assistance",
  "severity": "normal"
}