{
  "comments": [
    "The problem is that trac cannot parse the XML sent by Mylar. I think this is a Mylar not a trac bug.\nI monitored the request with tcpmon. This is what mylar sends:\n\u003c?xml version\u003d\"1.0\" encoding\u003d\"UTF-8\"?\u003e\u003cmethodCall\u003e\u003cmethodName\u003eticket.create\u003c/methodName\u003e\u003cparams\u003e\u003cparam\u003e\u003cvalue\u003eTEST \u0026#214;\u0026#196;\u0026#220;\u0026#246;\u0026#228;\u0026#252;\u0026#223; TEST\u003c/value\u003e\u003c/param\u003e\u003cparam\u003e\u003cvalue\u003eTEST \u0026#214;\u0026#196;\u0026#220;\u0026#246;\u0026#228;\u0026#252;\u0026#223; TEST\u003c/value\u003e\u003c/param\u003e\u003cparam\u003e\u003cvalue\u003e\u003cstruct\u003e\u003cmember\u003e\u003cname\u003emilestone\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003ecomponent\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003etype\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003ecc\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003ekeywords\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003epriority\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003eversion\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003c/struct\u003e\u003c/value\u003e\u003c/param\u003e\u003cparam\u003e\u003cvalue\u003e\u003cboolean\u003e1\u003c/boolean\u003e\u003c/value\u003e\u003c/param\u003e\u003c/params\u003e\u003c/methodCall\u003e\n\nI think instead of coding the umlauts into XML entities Mylar should send them as plain UTF-8 (two byte representation, eg. ???? for an ??)\n\nReproducible:\nenter \"TEST ?????????????? TEST\" in summary and/or description\n\nTrac error log:\n2007-05-22 15:44:09,673 Trac[main] ERROR: \u0027utf8\u0027 codec can\u0027t decode bytes in position 1-4: invalid data\nTraceback (most recent call last):\n  File \"/usr/lib/python2.3/site-packages/trac/web/main.py\", line 406, in dispatch_request\n    dispatcher.dispatch(req)\n  File \"/usr/lib/python2.3/site-packages/trac/web/main.py\", line 237, in dispatch\n    resp \u003d chosen_handler.process_request(req)\n  File \"build/bdist.linux-i686/egg/tracrpc/web_ui.py\", line 55, in process_request\n  File \"/usr/lib/python2.3/xmlrpclib.py\", line 1012, in loads\n    p.feed(data)\n  File \"/usr/lib/python2.3/xmllib.py\", line 172, in feed\n    self.goahead(0)\n  File \"/usr/lib/python2.3/xmllib.py\", line 288, in goahead\n    k \u003d self.parse_endtag(i)\n  File \"/usr/lib/python2.3/xmllib.py\", line 701, in parse_endtag\n    self.finish_endtag(tag)\n  File \"/usr/lib/python2.3/xmllib.py\", line 736, in finish_endtag\n    self.unknown_endtag(nstag)\n  File \"/usr/lib/python2.3/xmlrpclib.py\", line 772, in end\n    return f(self, join(self._data, \"\"))\n  File \"/usr/lib/python2.3/xmlrpclib.py\", line 860, in end_value\n    self.end_string(data)\n  File \"/usr/lib/python2.3/xmlrpclib.py\", line 819, in end_string\n    data \u003d _decode(data, self._encoding)\n  File \"/usr/lib/python2.3/xmlrpclib.py\", line 159, in _decode\n    data \u003d unicode(data, encoding)\nUnicodeDecodeError: \u0027utf8\u0027 codec can\u0027t decode bytes in position 1-4: invalid data\n\nEclipse error log:\n-- Error Log --\nDate: Tue May 22 17:31:59 CEST 2007\nMessage: HTTP Error 500\nSeverity: Error\nPlugin ID: org.eclipse.mylar.trac.core\nStack Trace:\norg.eclipse.mylar.internal.trac.core.TracException: HTTP Error 500\nat org.eclipse.mylar.internal.trac.core.TracXmlRpcClient.callInternal(TracXmlRpcClient.java:166)\nat org.eclipse.mylar.internal.trac.core.TracXmlRpcClient.call(TracXmlRpcClient.java:117)\nat org.eclipse.mylar.internal.trac.core.TracXmlRpcClient.createTicket(TracXmlRpcClient.java:559)\nat org.eclipse.mylar.internal.trac.core.TracTaskDataHandler.postTaskData(TracTaskDataHandler.java:326)\nat org.eclipse.mylar.tasks.ui.editors.AbstractRepositoryTaskEditor$32.run(AbstractRepositoryTaskEditor.java:2727)\nat org.eclipse.core.internal.jobs.Worker.run(Worker.java:58)\nCaused by: org.eclipse.mylar.internal.trac.core.util.TracHttpClientTransportFactory$TracHttpException: HTTP Error 500\nat org.eclipse.mylar.internal.trac.core.util.TracHttpClientTransportFactory$TracHttpClientTransport.getInputStream(TracHttpClientTransportFactory.java:106)\nat org.apache.xmlrpc.client.XmlRpcStreamTransport.sendRequest(XmlRpcStreamTransport.java:141)\nat org.apache.xmlrpc.client.XmlRpcHttpTransport.sendRequest(XmlRpcHttpTransport.java:94)\nat org.apache.xmlrpc.client.XmlRpcClientWorker.execute(XmlRpcClientWorker.java:53)\nat org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:166)\nat org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:136)\nat org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:125)\nat org.eclipse.mylar.internal.trac.core.TracXmlRpcClient.callInternal(TracXmlRpcClient.java:159)\n... 5 more",
    "Oh, seems that the bugzilla connector has also its problems with umlaute. \nTo reproduce type \"TEST ??????? TEST\" in the summary or description.\n\nI also forgot to submit detailled versions:\nEclipse: 3.2.1\nMylar: 2.0.0.v20070514-1800",
    "Mylar does configure the XML-RPC library to sue UTF-8 as the character set. I can\u0027t reproduce the error with our test repository and Eclipse 3.3M7 at this point. I\u0027ll have to check if using Eclipse 3.2 makes a difference here.",
    "I\u0027ve just installed Eclipse 3.3 RC2 - the problem occurs with 3.3 as well. \nStefan, could you please check that with RC2? \n\nMaybe this is an platform encoding problem. I have \"file.encoding\u003dCp1252\" in the configuration details of Eclipse.\n\nMaybe it\u0027s an OS issue - I use WinXP.",
    "-Dfile.encoding\u003dUTF-8 does not help - it seems not to be a problem of the file.encoding",
    "Thank you for verifying with Eclipse 3.3. Could you try to create a ticket at http://mylyn.eclipse.org/tractest and check if that works?",
    "http://mylyn.eclipse.org/tractest works fine. This site is running Trac 0.10, our Trac installation runs 0.10.4. Maybe that\u0027s the reason - I have to check that.",
    "Could you check the charset setting in your trac.ini? It is set to \"default_charset \u003d iso-8859-15\" on the Mylyn test repository.",
    "Created an attachment (id\u003d71838)\nmylar/context/zip\n\n",
    "I have updated the test repository to 0.10.4 and it seems to work with special characters. I have also monitored the session using tcpmon and this is what I get when creating a ticket with Umlauts:\n\nPOST /tractest/xmlrpc HTTP/1.1\nContent-Type: text/xml\nUser-Agent: Eclipse Mylyn (HttpClient/3.0.1)\nHost: localhost:8080\nContent-Length: 1038\n\n\u003c?xml version\u003d\"1.0\" encoding\u003d\"UTF-8\"?\u003e\u003cmethodCall\u003e\u003cmethodName\u003eticket.create\u003c/methodName\u003e\u003cparams\u003e\u003cparam\u003e\u003cvalue\u003easdaf \u0026#214;\u0026#196;\u0026#220;\u0026#246;\u0026#228;\u0026#252;\u0026#223;\u003c/value\u003e\u003c/param\u003e\u003cparam\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/param\u003e\u003cparam\u003e\u003cvalue\u003e\u003cstruct\u003e\u003cmember\u003e\u003cname\u003ecomponent\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003ecustom_checkbox_field\u003c/name\u003e\u003cvalue\u003e1\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003etype\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003ecc\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003ecustom_select_field\u003c/name\u003e\u003cvalue\u003etwo\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003ekeywords\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003ecustom_radio_field\u003c/name\u003e\u003cvalue\u003ebaz\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003ecustom_textarea_field\u003c/name\u003e\u003cvalue\u003edefault text\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003eversion\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003emilestone\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003ecustom_text_field\u003c/name\u003e\u003cvalue\u003edefault value\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003epriority\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003c/struct\u003e\u003c/value\u003e\u003c/param\u003e\u003cparam\u003e\u003cvalue\u003e\u003cboolean\u003e1\u003c/boolean\u003e\u003c/value\u003e\u003c/param\u003e\u003c/params\u003e\u003c/methodCall\u003e\n\nIt would be great if you could verify that with the latest Mylar release and your repository.",
    "Never mind, I just realized that Mylar escaped all the entities and this bug report looks very different when looked at in a browser.",
    "This is what I get using tcpmon when send a ticket with umlauts to out repository. Seems to quite the same, except that I\u0027m using basic auth. \n\nPOST /krc/trac/login/xmlrpc HTTP/1.1\nContent-Type: text/xml\nUser-Agent: Eclipse Mylar (HttpClient 3.0.1)\nAuthorization: Basic [omitted]\nHost: localhost:8080\nContent-Length: 741\n\n\u003c?xml version\u003d\"1.0\" encoding\u003d\"UTF-8\"?\u003e\u003cmethodCall\u003e\u003cmethodName\u003eticket.create\u003c/methodName\u003e\u003cparams\u003e\u003cparam\u003e\u003cvalue\u003eTEST \u0026#214;\u0026#196;\u0026#220;\u0026#246;\u0026#228;\u0026#252;\u0026#223; TEST\u003c/value\u003e\u003c/param\u003e\u003cparam\u003e\u003cvalue\u003eTEST \u0026#214;\u0026#196;\u0026#220;\u0026#246;\u0026#228;\u0026#252;\u0026#223; TEST\u003c/value\u003e\u003c/param\u003e\u003cparam\u003e\u003cvalue\u003e\u003cstruct\u003e\u003cmember\u003e\u003cname\u003emilestone\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003ekeywords\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003ecomponent\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003epriority\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003etype\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003ecc\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003cmember\u003e\u003cname\u003eversion\u003c/name\u003e\u003cvalue\u003e\u003c/value\u003e\u003c/member\u003e\u003c/struct\u003e\u003c/value\u003e\u003c/param\u003e\u003cparam\u003e\u003cvalue\u003e\u003cboolean\u003e1\u003c/boolean\u003e\u003c/value\u003e\u003c/param\u003e\u003c/params\u003e\u003c/methodCall\u003e",
    "Thanks. The funny thing is that the text is not send as UTF-8 at all. I am starting to wonder if the character conversion needs to be done manually and if that needs to match the charset on the machine the Trac repository is running on. \n\nCould you provide more information about your Trac setup? Which operating system? Is it running in Apache or standalone? What is the charset on the server (you can run \"locale\" and send me the output)?\n",
    "We have found the problem now: it is the Python version.\n\nWe have Python 2.3.3 running on Linux. Now, we checked it with Python 2.4 and it works fine. Could you please put this in the documentation as a requironment?\n\nThanks for all the help!\n\n",
    "Could you guys update the Trac section of the FAQ with this info in case someone else trips up on it?",
    "Christian, thank you very much for investigating this. I\u0027ll update the FAQ. Out of curiosity, what is the locale on your server?",
    "The Unix locale is (if you wanted to know that):\nLANG\u003den_US.UTF-8",
    "Thanks. Added entry to FAQ."
  ],
  "commentCreationDates": [
    "2007-05-22T18:15:11+02:00",
    "2007-05-22T18:20:08+02:00",
    "2007-05-22T18:48:36+02:00",
    "2007-06-19T13:04:27+02:00",
    "2007-06-19T13:08:16+02:00",
    "2007-06-19T16:39:49+02:00",
    "2007-06-19T18:48:10+02:00",
    "2007-06-20T08:33:05+02:00",
    "2007-06-20T08:48:12+02:00",
    "2007-06-20T16:40:03+02:00",
    "2007-06-20T16:55:15+02:00",
    "2007-06-21T11:54:19+02:00",
    "2007-06-21T17:11:24+02:00",
    "2007-06-22T13:41:10+02:00",
    "2007-06-22T22:12:05+02:00",
    "2007-06-22T23:57:29+02:00",
    "2007-06-23T12:52:25+02:00",
    "2007-06-27T05:30:31+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.mylar.internal.trac.core.TracException",
      "message": "HTTP Error 500",
      "elements": [
        {
          "method": "org.eclipse.mylar.internal.trac.core.TracXmlRpcClient.callInternal",
          "source": "TracXmlRpcClient.java:166"
        },
        {
          "method": "org.eclipse.mylar.internal.trac.core.TracXmlRpcClient.call",
          "source": "TracXmlRpcClient.java:117"
        },
        {
          "method": "org.eclipse.mylar.internal.trac.core.TracXmlRpcClient.createTicket",
          "source": "TracXmlRpcClient.java:559"
        },
        {
          "method": "org.eclipse.mylar.internal.trac.core.TracTaskDataHandler.postTaskData",
          "source": "TracTaskDataHandler.java:326"
        },
        {
          "method": "org.eclipse.mylar.tasks.ui.editors.AbstractRepositoryTaskEditor$32.run",
          "source": "AbstractRepositoryTaskEditor.java:2727"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:58"
        }
      ],
      "causedBy": {
        "exceptionType": "org.eclipse.mylar.internal.trac.core.util.TracHttpClientTransportFactory$TracHttpException",
        "message": "HTTP Error 500",
        "elements": [
          {
            "method": "org.eclipse.mylar.internal.trac.core.util.TracHttpClientTransportFactory$TracHttpClientTransport.getInputStream",
            "source": "TracHttpClientTransportFactory.java:106"
          },
          {
            "method": "org.apache.xmlrpc.client.XmlRpcStreamTransport.sendRequest",
            "source": "XmlRpcStreamTransport.java:141"
          },
          {
            "method": "org.apache.xmlrpc.client.XmlRpcHttpTransport.sendRequest",
            "source": "XmlRpcHttpTransport.java:94"
          },
          {
            "method": "org.apache.xmlrpc.client.XmlRpcClientWorker.execute",
            "source": "XmlRpcClientWorker.java:53"
          },
          {
            "method": "org.apache.xmlrpc.client.XmlRpcClient.execute",
            "source": "XmlRpcClient.java:166"
          },
          {
            "method": "org.apache.xmlrpc.client.XmlRpcClient.execute",
            "source": "XmlRpcClient.java:136"
          },
          {
            "method": "org.apache.xmlrpc.client.XmlRpcClient.execute",
            "source": "XmlRpcClient.java:125"
          },
          {
            "method": "org.eclipse.mylar.internal.trac.core.TracXmlRpcClient.callInternal",
            "source": "TracXmlRpcClient.java:159"
          }
        ],
        "number": 0,
        "commentIndex": 0
      },
      "number": 0,
      "commentIndex": 0,
      "bugId": "188363",
      "date": "2007-05-22T18:15:11+02:00",
      "product": "Mylyn",
      "component": "Trac",
      "severity": "normal"
    }
  ],
  "groupId": "188363",
  "bugId": "188363",
  "date": "2007-05-22T18:15:11+02:00",
  "product": "Mylyn",
  "component": "Trac",
  "severity": "normal"
}