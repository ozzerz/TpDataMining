{
  "comments": [
    "run the code below:\n\u003ccode\u003e\nabstract class TemplateClass {\n   \n    public TemplateClass(){\n        doIt();\n    }\n    \n    public void doIt(){\n        doItPart();\n    }\n    \n    protected abstract void doItPart();\n    \n}\n\npublic class Bug {\n\n    String field \u003d \"I am a field of the containing class.\";\n    \n    public void execute(final String finalArg){\n        new TemplateClass(){\n            protected void doItPart() {\n                System.out.println(\"containing class: \" + Bug.this);\n                System.out.println(\"finalArgment: \" + finalArg + \"\\n\");\n                System.out.println(\"field: \" + field + \"\\n\");\n            }\n            \n        };\n    }\n    \n    public static void main(String[] arg){\n        new Bug().execute(\"I am a final Argument.\");\n    }\n}\n\u003c/code\u003e\nand you get the following output:\n\u003coutput\u003e\ncontaining class: null\nfinalArgment: null\n\nException in thread \"main\" java.lang.NullPointerException\n\tat com.manheim.point.dao.Bug$1.doItPart(Bug.java:27)\n\tat com.manheim.point.dao.TemplateClass.doIt(Bug.java:11)\n\tat com.manheim.point.dao.TemplateClass.\u003cinit\u003e(Bug.java:7)\n\tat com.manheim.point.dao.Bug$1.\u003cinit\u003e(Bug.java:23)\n\tat com.manheim.point.dao.Bug.execute(Bug.java:23)\n\tat com.manheim.point.dao.Bug.main(Bug.java:34)\n\u003c/output\u003e\n\nI have tested this code with eclipse versions 3.1, 3.1.2, 2.1, and javac and the error only happens with eclipse versions 3.1 and 3.1.2. The problems are the following:\n1. The first print statement shows that Bug.this is null. This show never be possible in Java.\n2. The second print statement shows that a final argument reference from the execute() method is null when it should contain the value \"I am a final Argument.\"\n3. The third statement merely reiterates problem 1, in that if you try to reference a field in Bug.this, you get a NPE.",
    "This is fixed in HEAD.\nI get:\ncontaining class: Bug@360be0\nfinalArgment: I am a final Argument.\n\nfield: I am a field of the containing class.",
    "Actually, the problem is still there. The steps were incomplete I believe, it only occurs when -source 1.3 is specified.\n\nToby - can you confirm this ?",
    "When using javac 1.3.1 or 1.4.2 with -source 1.3, I also reproduce the issue.\nJavac 1.5.0 -source 1.3 no longer reproduces.",
    "Exact Javac versions were:\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.3.1_01a)\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.4.2_10-ea-b01)\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_07-b02)\n",
    "Actually, this behavior is intended. Post 1.4 source level, synthetic initializations occur prior to explicit constructor call.\nIn clear, the super constructor call from the anonymous default constructor is calling back into the anonymous before the field this$0 (representing Bug.this) got a chance to be initialized. The offending runtime path is: Bug$1()-\u003eTemplateClass()-\u003eTemplateClass.doIt()-\u003eBug$1.doItPart().\n\nPrior to source 1.4, the code of the anonymous constructor does:\n\u003cinit\u003e(Bug this$0) {\n   super();\n   this.this$0 \u003d this$0;\n   ...\n}\npost 1.4, VMs allow better support of synthetics, and allow:\n\u003cinit\u003e(Bug this$0) {\n   this.this$0 \u003d this$0;\n   super();\n   ...\n}\n\nNeed to double check whether our configuration strategy is valid or not. It feels like from 1.5 on javac is producing code as if source level was \u003e\u003d 1.4 wrt to synthetic initializations.\n\n",
    "I believe the configuration behavior should be based on target level, rather than source level. When using javac with -source 1.3 -target 1.3, it issues the NPE as well.\n\n",
    "Actually, we already toggle behavior based on -target setting.\nSo we are fine there.\n\nNow, we seem to have a mismatch on the batch compiler itself.\nWhen using -1.5 -source 1.3, javac leaves the target at 1.5 !?\n\nToby: the proper solution is for you to specify explicitly using a -1.4 target or above in your compiler settings.",
    "javac 1.3 -source 1.3, sets the default target to 1.1\njavac 1.4 -source 1.3, sets the default target to 1.2\njavac 1.5 -source 1.3, sets the default target to 1.4\njavac 1.6 -source 1.3, sets the default target to 1.4\n\nWe should revisit our defaults to match these.\nFor current time being, Toby, please make these settings explicit.\n",
    "Olivier - pls check all source levels, and provide a patch to the batch compiler.\n          ideally, you should paste here a matrix of defaults.\n\nMartin - there may need to be some alignments in UI.\n\nLikely something for 3.3 at best.",
    "(In reply to comment #2)\n\u003e Actually, the problem is still there. The steps were incomplete I believe, it\n\u003e only occurs when -source 1.3 is specified.\n\u003e \n\u003e Toby - can you confirm this ?\n\u003e \nI have been using source level 1.4.",
    "(In reply to comment #9)\n\u003e Olivier - pls check all source levels, and provide a patch to the batch\n\u003e compiler.\n\u003e           ideally, you should paste here a matrix of defaults.\nList of defaults:\n\njavac 1.3:\n\n-source option doesn\u0027t exist.\n  default target 1.1\n\njavac 1.4:\n-source 1.2, default target 1.2\n-source 1.3, default target 1.2\n-source 1.4, default target 1.4\n\njavac 1.5:\n-source 1.2, default target 1.4\n-source 1.3, default target 1.4\n-source 1.4, default target 1.4\n-source 1.5, default target 1.5\n\njavac 1.6:\n\n-source 1.2, default target 1.4\n-source 1.3, default target 1.4\n-source 1.4, default target 1.4\n-source 1.5, default target 1.6\n-source 1.6, default target 1.6\n\njavac 1.7:\n\n-source 1.2, default target 1.4\n-source 1.3, default target 1.4\n-source 1.4, default target 1.4\n-source 1.5, default target 1.6\n-source 1.6, default target 1.6\n-source 1.7, default target 1.7\n",
    "Created an attachment (id\u003d57618)\nProposed fix\n\n",
    "(In reply to comment #10)\n\u003e I have been using source level 1.4.\nYou must have the target set to 1.1 and this would explain the error.\nI adjusted the compiler\u0027s defaults.\nI\u0027ll released once all the tests are done.",
    "(In reply to comment #9)\n\u003e Martin - there may need to be some alignments in UI.\nMartin,\n\nThe UI doesn\u0027t allow the source to be 1.2. This is allowed by the compiler and javac. Might not be a big deal since source 1.2 doesn\u0027t add any value.",
    "Released for 3.3M5.\nAdded regression tests org.eclipse.jdt.core.tests.compiler.regression.BatchCompilerTest#test107/121",
    "(In reply to comment #14)\n\u003e The UI doesn\u0027t allow the source to be 1.2. This is allowed by the compiler and\n\u003e javac. Might not be a big deal since source 1.2 doesn\u0027t add any value.\nOur batch compiler doesn\u0027t allow 1.2 as well for the source value. So this is not something we should change.\n",
    "Verified for 3.3 M5 using build I20070205-0009",
    "please file a bug against jdt.ui if I need to change something.",
    "As long as you respect the defaults, you are fine. I haven\u0027t check them on the UI side."
  ],
  "commentCreationDates": [
    "2006-05-15T20:00:34+02:00",
    "2006-05-16T05:15:56+02:00",
    "2006-05-16T11:22:48+02:00",
    "2006-05-16T11:25:18+02:00",
    "2006-05-16T11:27:19+02:00",
    "2006-05-16T12:14:37+02:00",
    "2006-05-16T12:16:42+02:00",
    "2006-05-16T12:20:06+02:00",
    "2006-05-16T12:24:31+02:00",
    "2006-05-16T12:32:58+02:00",
    "2006-05-16T16:02:04+02:00",
    "2007-01-26T19:01:40+01:00",
    "2007-01-26T19:37:59+01:00",
    "2007-01-26T19:51:52+01:00",
    "2007-01-26T19:54:08+01:00",
    "2007-01-26T20:43:35+01:00",
    "2007-01-26T20:44:16+01:00",
    "2007-02-06T09:54:26+01:00",
    "2007-02-13T11:06:35+01:00",
    "2007-02-13T13:28:49+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "com.manheim.point.dao.Bug$1.doItPart",
          "source": "Bug.java:27"
        },
        {
          "method": "com.manheim.point.dao.TemplateClass.doIt",
          "source": "Bug.java:11"
        },
        {
          "method": "com.manheim.point.dao.TemplateClass.\u003cinit\u003e",
          "source": "Bug.java:7"
        },
        {
          "method": "com.manheim.point.dao.Bug$1.\u003cinit\u003e",
          "source": "Bug.java:23"
        },
        {
          "method": "com.manheim.point.dao.Bug.execute",
          "source": "Bug.java:23"
        },
        {
          "method": "com.manheim.point.dao.Bug.main",
          "source": "Bug.java:34"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "141830",
      "date": "2006-05-15T20:00:34+02:00",
      "product": "JDT",
      "component": "Core",
      "severity": "major"
    }
  ],
  "groupId": "141830",
  "bugId": "141830",
  "date": "2006-05-15T20:00:34+02:00",
  "product": "JDT",
  "component": "Core",
  "severity": "major"
}