{
  "comments": [
    "Split from 152533.\n\nC.B: Reproduce by create a JSP and opening in VPD.  Then create a new JSP with the first one still open.  This will generate these areas because a pallette workspace listener is not syncing properly with the display thread.  Also, the listener is too broad in the events it responds to and does visual refreshes it doesn\u0027t need too.\n\nEncountered the following stack trace while playing with the VE.  The problem\nseems to occur because the page designer does not ensure that resource changed\nevents are run on the UI thread.  The NPE appears to occur when\nDisplay.getCurrent() returns null (indicating there is no current display,\nusually indicating not on a UI thread):\n\njava.lang.NullPointerException\n\nat\norg.eclipse.draw2d.DeferredUpdateManager.sendUpdateRequest(DeferredUpdateManager.java:225)\nat\norg.eclipse.draw2d.DeferredUpdateManager.queueWork(DeferredUpdateManager.java:215)\nat\norg.eclipse.draw2d.DeferredUpdateManager.addDirtyRegion(DeferredUpdateManager.java:111)\nat org.eclipse.draw2d.Figure.repaint(Figure.java:1319)\nat org.eclipse.draw2d.Figure.erase(Figure.java:311)\nat org.eclipse.draw2d.Figure.remove(Figure.java:1178)\nat\norg.eclipse.gef.editparts.AbstractGraphicalEditPart.removeChildVisual(AbstractGraphicalEditPart.java:684)\nat\norg.eclipse.gef.editparts.AbstractEditPart.removeChild(AbstractEditPart.java:812)\nat\norg.eclipse.gef.editparts.AbstractEditPart.refreshChildren(AbstractEditPart.java:735)\nat\norg.eclipse.gef.internal.ui.palette.editparts.PaletteEditPart.propertyChange(PaletteEditPart.java:259)\nat java.beans.PropertyChangeSupport.firePropertyChange(Unknown Source)\nat java.beans.PropertyChangeSupport.firePropertyChange(Unknown Source)\nat org.eclipse.gef.palette.PaletteContainer.remove(PaletteContainer.java:202)\nat\norg.eclipse.jst.pagedesigner.editors.palette.DesignerPaletteRoot.removeItems(DesignerPaletteRoot.java:224)\nat\norg.eclipse.jst.pagedesigner.editors.palette.DesignerPaletteRoot.loadItems(DesignerPaletteRoot.java:96)\nat\norg.eclipse.jst.pagedesigner.editors.palette.DesignerPaletteRoot.refresh(DesignerPaletteRoot.java:232)\nat\norg.eclipse.jst.pagedesigner.editors.palette.DesignerPaletteViewer$2.modelChanged(DesignerPaletteViewer.java:74)\nat\norg.eclipse.jst.pagedesigner.editors.palette.impl.PaletteItemManager.fireModelChanged(PaletteItemManager.java:978)\nat\norg.eclipse.jst.pagedesigner.editors.palette.impl.PaletteItemManager.reset(PaletteItemManager.java:306)\nat\norg.eclipse.jst.pagedesigner.editors.palette.impl.PaletteItemManager$ResourceTracker.visit(PaletteItemManager.java:140)\nat org.eclipse.core.internal.events.ResourceDelta.accept(ResourceDelta.java:67)\nat org.eclipse.core.internal.events.ResourceDelta.accept(ResourceDelta.java:48)\nat\norg.eclipse.jst.pagedesigner.editors.palette.impl.PaletteItemManager$ResourceTracker.resourceChanged(PaletteItemManager.java:120)\nat\norg.eclipse.core.internal.events.NotificationManager$2.run(NotificationManager.java:280)\nat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\nat\norg.eclipse.core.internal.events.NotificationManager.notify(NotificationManager.java:274)\nat\norg.eclipse.core.internal.events.NotificationManager.broadcastChanges(NotificationManager.java:148)\nat\norg.eclipse.core.internal.resources.Workspace.broadcastPostChange(Workspace.java:256)\nat\norg.eclipse.core.internal.resources.Workspace.endOperation(Workspace.java:958)\nat org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1746)\nat org.eclipse.debug.core.model.Breakpoint.setAttributes(Breakpoint.java:234)\nat org.eclipse.debug.core.model.Breakpoint.setPersisted(Breakpoint.java:145)\nat\norg.eclipse.jdt.internal.debug.ui.JavaDebugOptionsManager$InitJob.run(JavaDebugOptionsManager.java:145)\nat org.eclipse.core.internal.jobs.Worker.run(Worker.java:58)",
    "Triaged for WP 2.0.",
    "Working on a fix.",
    "DesignerPaletteViewer$2.modelChanged now asyncExec\u0027s its refresh on the display thread to avoid running UI operations on a non-UI thread.",
    "Self-verify and close."
  ],
  "commentCreationDates": [
    "2006-11-08T22:15:48+01:00",
    "2007-01-06T01:14:42+01:00",
    "2007-01-25T18:56:21+01:00",
    "2007-01-26T20:08:34+01:00",
    "2007-05-17T01:37:38+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.draw2d.DeferredUpdateManager.sendUpdateRequest",
          "source": "DeferredUpdateManager.java:225"
        },
        {
          "method": "org.eclipse.draw2d.DeferredUpdateManager.queueWork",
          "source": "DeferredUpdateManager.java:215"
        },
        {
          "method": "org.eclipse.draw2d.DeferredUpdateManager.addDirtyRegion",
          "source": "DeferredUpdateManager.java:111"
        },
        {
          "method": "org.eclipse.draw2d.Figure.repaint",
          "source": "Figure.java:1319"
        },
        {
          "method": "org.eclipse.draw2d.Figure.erase",
          "source": "Figure.java:311"
        },
        {
          "method": "org.eclipse.draw2d.Figure.remove",
          "source": "Figure.java:1178"
        },
        {
          "method": "org.eclipse.gef.editparts.AbstractGraphicalEditPart.removeChildVisual",
          "source": "AbstractGraphicalEditPart.java:684"
        },
        {
          "method": "org.eclipse.gef.editparts.AbstractEditPart.removeChild",
          "source": "AbstractEditPart.java:812"
        },
        {
          "method": "org.eclipse.gef.editparts.AbstractEditPart.refreshChildren",
          "source": "AbstractEditPart.java:735"
        },
        {
          "method": "org.eclipse.gef.internal.ui.palette.editparts.PaletteEditPart.propertyChange",
          "source": "PaletteEditPart.java:259"
        },
        {
          "method": "java.beans.PropertyChangeSupport.firePropertyChange",
          "source": "Unknown Source"
        },
        {
          "method": "java.beans.PropertyChangeSupport.firePropertyChange",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.gef.palette.PaletteContainer.remove",
          "source": "PaletteContainer.java:202"
        },
        {
          "method": "org.eclipse.jst.pagedesigner.editors.palette.DesignerPaletteRoot.removeItems",
          "source": "DesignerPaletteRoot.java:224"
        },
        {
          "method": "org.eclipse.jst.pagedesigner.editors.palette.DesignerPaletteRoot.loadItems",
          "source": "DesignerPaletteRoot.java:96"
        },
        {
          "method": "org.eclipse.jst.pagedesigner.editors.palette.DesignerPaletteRoot.refresh",
          "source": "DesignerPaletteRoot.java:232"
        },
        {
          "method": "org.eclipse.jst.pagedesigner.editors.palette.DesignerPaletteViewer$2.modelChanged",
          "source": "DesignerPaletteViewer.java:74"
        },
        {
          "method": "org.eclipse.jst.pagedesigner.editors.palette.impl.PaletteItemManager.fireModelChanged",
          "source": "PaletteItemManager.java:978"
        },
        {
          "method": "org.eclipse.jst.pagedesigner.editors.palette.impl.PaletteItemManager.reset",
          "source": "PaletteItemManager.java:306"
        },
        {
          "method": "org.eclipse.jst.pagedesigner.editors.palette.impl.PaletteItemManager$ResourceTracker.visit",
          "source": "PaletteItemManager.java:140"
        },
        {
          "method": "org.eclipse.core.internal.events.ResourceDelta.accept",
          "source": "ResourceDelta.java:67"
        },
        {
          "method": "org.eclipse.core.internal.events.ResourceDelta.accept",
          "source": "ResourceDelta.java:48"
        },
        {
          "method": "org.eclipse.jst.pagedesigner.editors.palette.impl.PaletteItemManager$ResourceTracker.resourceChanged",
          "source": "PaletteItemManager.java:120"
        },
        {
          "method": "org.eclipse.core.internal.events.NotificationManager$2.run",
          "source": "NotificationManager.java:280"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.core.internal.events.NotificationManager.notify",
          "source": "NotificationManager.java:274"
        },
        {
          "method": "org.eclipse.core.internal.events.NotificationManager.broadcastChanges",
          "source": "NotificationManager.java:148"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.broadcastPostChange",
          "source": "Workspace.java:256"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.endOperation",
          "source": "Workspace.java:958"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1746"
        },
        {
          "method": "org.eclipse.debug.core.model.Breakpoint.setAttributes",
          "source": "Breakpoint.java:234"
        },
        {
          "method": "org.eclipse.debug.core.model.Breakpoint.setPersisted",
          "source": "Breakpoint.java:145"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.ui.JavaDebugOptionsManager$InitJob.run",
          "source": "JavaDebugOptionsManager.java:145"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:58"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "163879",
      "date": "2006-11-08T22:15:48+01:00",
      "product": "Java Server Faces",
      "component": "core",
      "severity": "normal"
    }
  ],
  "groupId": "163879",
  "bugId": "163879",
  "date": "2006-11-08T22:15:48+01:00",
  "product": "Java Server Faces",
  "component": "core",
  "severity": "normal"
}