{
  "comments": [
    "build I20031120 (M5 candidate)\nvm: Sun JDK 1.4.2_01\n\n- self-hosting workspace with UI, Text, Debug, Help in source, rest in binaries\n- created hello world PDE project\n- added an org.eclipse.ui.startup extension to it\n- created a class implementing IStartup for this extension\n- set a breakpoint in its earlyStartup method\n- launched target Eclipse under debug\n- it hit the breakpoint, but the stack frames below Thread.run did not have any \ninfo:\n\nThread [Thread-0] (Suspended (breakpoint at line 13 in HelloStartup))\n\tHelloStartup.earlyStartup() line: 13\n\tWorkbench$10.run() line: 1314\n\tInternalPlatform.run(ISafeRunnable) line: 1127\n\tPlatform.run(ISafeRunnable) line: 464\n\tWorkbench$9.run() line: 1321\n\tThread.run() line: 534\n\t\u003cunknown receiving type\u003e(\u003cunknown declaring type\u003e).\u003cunknown method name\u003e\n(\u003cunknown arguments\u003e) \u003cunknown line number\u003e\n\t\u003cunknown receiving type\u003e(\u003cunknown declaring type\u003e).\u003cunknown method name\u003e\n(\u003cunknown arguments\u003e) \u003cunknown line number\u003e\n\t\u003cunknown receiving type\u003e(\u003cunknown declaring type\u003e).\u003cunknown method name\u003e\n(\u003cunknown arguments\u003e) \u003cunknown line number\u003e\n\t\u003cunknown receiving type\u003e(\u003cunknown declaring type\u003e).\u003cunknown method name\u003e\n(\u003cunknown arguments\u003e) \u003cunknown line number\u003e\n\t\u003cunknown receiving type\u003e(\u003cunknown declaring type\u003e).\u003cunknown method name\u003e\n(\u003cunknown arguments\u003e) \u003cunknown line number\u003e\n\t\u003cunknown receiving type\u003e(\u003cunknown declaring type\u003e).\u003cunknown method name\u003e\n(\u003cunknown arguments\u003e) \u003cunknown line number\u003e\n\t\u003cunknown receiving type\u003e(\u003cunknown declaring type\u003e).\u003cunknown method name\u003e\n(\u003cunknown arguments\u003e) \u003cunknown line number\u003e\n\t\u003cunknown receiving type\u003e(\u003cunknown declaring type\u003e).\u003cunknown method name\u003e\n(\u003cunknown arguments\u003e) \u003cunknown line number\u003e\n\t\u003cunknown receiving type\u003e(\u003cunknown declaring type\u003e).\u003cunknown method name\u003e\n(\u003cunknown arguments\u003e) \u003cunknown line number\u003e\n\t\u003cunknown receiving type\u003e(\u003cunknown declaring type\u003e).\u003cunknown method name\u003e\n(\u003cunknown arguments\u003e) \u003cunknown line number\u003e\n\n\nLog had many entries of the form:\n\n!ENTRY org.eclipse.jdt.launching 4 4 Nov 20, 2003 22:32:07.512\n!MESSAGE Invalid stack frame index referenced\n!STACK 1\norg.eclipse.debug.core.DebugException[5012]: \njava.lang.IndexOutOfBoundsException: Invalid index of stack frames given\n\tat org.eclipse.jdi.internal.ThreadReferenceImpl.frames\n(ThreadReferenceImpl.java:194)\n\tat org.eclipse.jdi.internal.ThreadReferenceImpl.frame\n(ThreadReferenceImpl.java:140)\n\tat \norg.eclipse.jdt.internal.debug.core.model.JDIThread.getUnderlyingFrame\n(JDIThread.java:553)\n\tat \norg.eclipse.jdt.internal.debug.core.model.JDIStackFrame.getUnderlyingStackFrame\n(JDIStackFrame.java:950)\n\tat org.eclipse.jdt.internal.debug.core.model.JDIStackFrame.getSourceName\n(JDIStackFrame.java:837)\n\tat \norg.eclipse.jdt.launching.sourcelookup.JavaSourceLocator.getFullyQualfiedName\n(JavaSourceLocator.java:274)\n\tat \norg.eclipse.jdt.launching.sourcelookup.JavaSourceLocator.getSourceElement\n(JavaSourceLocator.java:242)\n\tat org.eclipse.jdt.debug.ui.JavaUISourceLocator.findSourceElement\n(JavaUISourceLocator.java:199)\n\tat org.eclipse.jdt.debug.ui.JavaUISourceLocator.getSourceElement\n(JavaUISourceLocator.java:145)\n\tat \norg.eclipse.debug.internal.ui.views.launch.LaunchView.lookupEditorInput\n(LaunchView.java:614)\n\tat \norg.eclipse.debug.internal.ui.views.launch.LaunchView.openEditorForStackFrame\n(LaunchView.java:676)\n\tat \norg.eclipse.debug.internal.ui.views.launch.LaunchView.showEditorForCurrentSelect\nion(LaunchView.java:593)\n\tat \norg.eclipse.debug.internal.ui.views.launch.LaunchView.selectionChanged\n(LaunchView.java:469)\n\tat org.eclipse.jface.viewers.Viewer$2.run(Viewer.java:159)\n\tat org.eclipse.core.internal.runtime.InternalPlatform.run\n(InternalPlatform.java:1127)\n\tat org.eclipse.core.runtime.Platform.run(Platform.java:464)\n\tat org.eclipse.jface.viewers.Viewer.fireSelectionChanged\n(Viewer.java:157)\n\tat org.eclipse.jface.viewers.StructuredViewer.updateSelection\n(StructuredViewer.java:1310)\n\tat org.eclipse.jface.viewers.StructuredViewer.handleSelect\n(StructuredViewer.java:666)\n\tat org.eclipse.jface.viewers.StructuredViewer$4.widgetSelected\n(StructuredViewer.java:690)\n\tat org.eclipse.jface.util.OpenStrategy.fireSelectionEvent\n(OpenStrategy.java:178)\n\tat org.eclipse.jface.util.OpenStrategy.access$3(OpenStrategy.java:173)\n\tat org.eclipse.jface.util.OpenStrategy$1.handleEvent\n(OpenStrategy.java:309)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:847)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:2187)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:1877)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1405)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1381)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench\n(Workbench.java:237)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:139)\n\tat org.eclipse.ui.internal.ide.IDEApplication.run\n(IDEApplication.java:47)\n\tat org.eclipse.core.internal.boot.InternalBootLoader.run\n(InternalBootLoader.java:858)\n\tat org.eclipse.core.boot.BootLoader.run(BootLoader.java:461)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:299)\n\tat org.eclipse.core.launcher.Main.run(Main.java:767)\n\tat org.eclipse.core.launcher.Main.main(Main.java:601)",
    "This is reproduceable: it happened again the next time I ran.\nThis thread is started in Workbench.startPlugins().\n",
    "This looks like a dup. Hopefully we can also reproduce it.\n\n*** This bug has been marked as a duplicate of 47169 ***",
    "This one is interesting - the stack traces show \"invalid frame indicies\" which \nis true. The thread should only have the frames which have been rendered (i.e. \nThread.run() is the last/botton frame on the stack. So in this case, it looks \nlike the thread incorrectly thinks it has more frames than it does. (This may \nbe different from bug 47169).\n\nI was unable to reproduce the problem with Nick\u0027s steps, but I did see that my \nthread only had 6 frames as follows, which is what is expected:\n\nThread [Thread-0] (Suspended (breakpoint at line 16 in \norg.one.two.StartupClass))\n\torg.one.two.StartupClass.earlyStartup() line: 16\n\torg.eclipse.ui.internal.Workbench$10.run() line: 1314\n\torg.eclipse.core.internal.runtime.InternalPlatform.run\n(org.eclipse.core.runtime.ISafeRunnable) line: 1127\n\torg.eclipse.core.runtime.Platform.run\n(org.eclipse.core.runtime.ISafeRunnable) line: 464\n\torg.eclipse.ui.internal.Workbench$9.run() line: 1321\n\tjava.lang.Thread.run() line: 534\n",
    "I\u0027m going to re-open this, because I think it\u0027s a different problem. The \nproblem here is that the thread incorrectly thinks it has more frames than it \nshould. The problem in bug 47169 is that all the frames (except the top frame) \nhave rendered in error (due to what looks like a quietly resumed thread that is \nnot shown to the user).",
    "Jared and I are able to reproduce this problem and we came to the same\nconclusion about the number of frames reported by the VM not matching the actual\nnumber of valid frames.\n\nWe\u0027re working on debugging the problem (double selfhosting - woohoo!).",
    "Yeah... This is totally a VM bug. The question now is whether we can somehow\nworkaround this. The trick will be telling the UI that it needs to recompute the\nchild elements (stack frames) for the thread. (Fire Debug CHANGED event?)",
    "Added a workaround in JDIStackFrame#getUnderlyingStackFrame and \nJDIThread#computeStackFrames(boolean) and getUnderlyingFrame(int).\n\nWhen we get an IndexOutOfBoundsException after asking for a stack frame at an \nindex we now recompute the stack frames and fire a change event (so the UI can \nupdate). Also, when we recompute all stack frames we now iterate over the old \nframes and set their indices to -1. When a stack frame is asked to fetch its \nunderlying frame and it has an index of -1, the frame will throw a debug \nexception. The JavaDoc on the method to get the underlying frame already says \nthat it will throw an exception if the frame has no underlying frame.\n\nDoing this handles the case where the UI still has references to a bunch of old \nJDIStackFrames (frames that the thread no longer knows about) and proceeds to \nask these frames questions. In our case, we noticed that the index was bad on \nthe first bad frame and recomputed the frames, but the UI continued to ask about \nthe old frames from the background label job. This was causing an \nIndexOutOfBoundsException to occur for each of those old frames. By setting the \nindex to -1, we shortcircuit the process.",
    "Please verify, DarinW.",
    "I don\u0027t see where a CHANGE event is fired in the code?",
    "Darin, I think the change event you are looking for is in JDIThread.java in the\nmethod: getUnderlyingFrame(int depth). The code looks like this:\n} catch (IndexOutOfBoundsException e) {\n\tcomputeNewStackFrames();\n\tfireChangeEvent(DebugEvent.CONTENT);  \u003c--\n...",
    "OK - I see it now. What if #computeStackFrames() throws a DebugException? In \nthat case, the change event will not be fired. I\u0027m wondering if the catch block \nshould handle the potential DebugException?",
    "Good catch. Surrounded the computeNewStackFrames() in a try/catch.",
    "Verified."
  ],
  "commentCreationDates": [
    "2003-11-21T03:42:02+01:00",
    "2003-11-21T03:58:00+01:00",
    "2003-11-21T04:01:49+01:00",
    "2003-11-21T20:49:56+01:00",
    "2003-11-21T20:53:00+01:00",
    "2003-11-21T23:14:40+01:00",
    "2003-11-21T23:55:04+01:00",
    "2003-11-22T08:21:37+01:00",
    "2003-11-22T08:25:24+01:00",
    "2003-11-24T16:30:11+01:00",
    "2003-11-24T17:36:19+01:00",
    "2003-11-24T17:57:20+01:00",
    "2003-11-24T18:15:46+01:00",
    "2003-11-24T20:22:55+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.IndexOutOfBoundsException",
      "message": "Invalid index of stack frames given",
      "elements": [
        {
          "method": "org.eclipse.jdi.internal.ThreadReferenceImpl.frames",
          "source": "ThreadReferenceImpl.java:194"
        },
        {
          "method": "org.eclipse.jdi.internal.ThreadReferenceImpl.frame",
          "source": "ThreadReferenceImpl.java:140"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.model.JDIThread.getUnderlyingFrame",
          "source": "JDIThread.java:553"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.model.JDIStackFrame.getUnderlyingStackFrame",
          "source": "JDIStackFrame.java:950"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.model.JDIStackFrame.getSourceName",
          "source": "JDIStackFrame.java:837"
        },
        {
          "method": "org.eclipse.jdt.launching.sourcelookup.JavaSourceLocator.getFullyQualfiedName",
          "source": "JavaSourceLocator.java:274"
        },
        {
          "method": "org.eclipse.jdt.launching.sourcelookup.JavaSourceLocator.getSourceElement",
          "source": "JavaSourceLocator.java:242"
        },
        {
          "method": "org.eclipse.jdt.debug.ui.JavaUISourceLocator.findSourceElement",
          "source": "JavaUISourceLocator.java:199"
        },
        {
          "method": "org.eclipse.jdt.debug.ui.JavaUISourceLocator.getSourceElement",
          "source": "JavaUISourceLocator.java:145"
        },
        {
          "method": "org.eclipse.debug.internal.ui.views.launch.LaunchView.lookupEditorInput",
          "source": "LaunchView.java:614"
        },
        {
          "method": "org.eclipse.debug.internal.ui.views.launch.LaunchView.openEditorForStackFrame",
          "source": "LaunchView.java:676"
        },
        {
          "method": "org.eclipse.debug.internal.ui.views.launch.LaunchView.showEditorForCurrentSelection",
          "source": "LaunchView.java:593"
        },
        {
          "method": "org.eclipse.debug.internal.ui.views.launch.LaunchView.selectionChanged",
          "source": "LaunchView.java:469"
        },
        {
          "method": "org.eclipse.jface.viewers.Viewer$2.run",
          "source": "Viewer.java:159"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:1127"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:464"
        },
        {
          "method": "org.eclipse.jface.viewers.Viewer.fireSelectionChanged",
          "source": "Viewer.java:157"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.updateSelection",
          "source": "StructuredViewer.java:1310"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.handleSelect",
          "source": "StructuredViewer.java:666"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer$4.widgetSelected",
          "source": "StructuredViewer.java:690"
        },
        {
          "method": "org.eclipse.jface.util.OpenStrategy.fireSelectionEvent",
          "source": "OpenStrategy.java:178"
        },
        {
          "method": "org.eclipse.jface.util.OpenStrategy.access$3",
          "source": "OpenStrategy.java:173"
        },
        {
          "method": "org.eclipse.jface.util.OpenStrategy$1.handleEvent",
          "source": "OpenStrategy.java:309"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:847"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:2187"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:1877"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1405"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1381"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:237"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:139"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:47"
        },
        {
          "method": "org.eclipse.core.internal.boot.InternalBootLoader.run",
          "source": "InternalBootLoader.java:858"
        },
        {
          "method": "org.eclipse.core.boot.BootLoader.run",
          "source": "BootLoader.java:461"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:324"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:299"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:767"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:601"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "47198",
      "date": "2003-11-21T03:42:02+01:00",
      "product": "JDT",
      "component": "Debug",
      "severity": "major"
    }
  ],
  "groupId": "47198",
  "bugId": "47198",
  "date": "2003-11-21T03:42:02+01:00",
  "product": "JDT",
  "component": "Debug",
  "severity": "major"
}