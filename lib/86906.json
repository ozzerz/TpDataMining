{
  "comments": [
    "(M5)\ncalling IType.createField(body, element, true, null);\nresults in this (in the Error Log):\njava.lang.IllegalArgumentException: EnumDeclaration has no property \nbodyDeclarations\n\tat \norg.eclipse.jdt.internal.core.dom.rewrite.RewriteEventStore.validateHasChildProp\nerty(RewriteEventStore.java:615)\n\tat org.eclipse.jdt.internal.core.dom.rewrite.RewriteEventStore.getEvent\n(RewriteEventStore.java:296)\n\tat \norg.eclipse.jdt.internal.core.dom.rewrite.RewriteEventStore.getListEvent\n(RewriteEventStore.java:325)\n\tat org.eclipse.jdt.core.dom.rewrite.ListRewrite.getEvent\n(ListRewrite.java:56)\n\tat org.eclipse.jdt.core.dom.rewrite.ListRewrite.insertAfter\n(ListRewrite.java:171)\n\tat \norg.eclipse.jdt.internal.core.CreateElementInCUOperation.insertASTNode\n(CreateElementInCUOperation.java:257)\n\tat \norg.eclipse.jdt.internal.core.CreateElementInCUOperation.generateNewCompilationU\nnitAST(CreateElementInCUOperation.java:184)\n\tat \norg.eclipse.jdt.internal.core.CreateElementInCUOperation.executeOperation\n(CreateElementInCUOperation.java:137)\n\tat org.eclipse.jdt.internal.core.JavaModelOperation.run\n(JavaModelOperation.java:710)\n\tat org.eclipse.core.internal.resources.Workspace.run\n(Workspace.java:1702)\n\tat org.eclipse.jdt.internal.core.JavaModelOperation.runOperation\n(JavaModelOperation.java:766)\n\tat org.eclipse.jdt.internal.core.SourceType.createField\n(SourceType.java:117)\n\nThe cause seems to be located in \norg.eclipse.jdt.internal.core.CreateTypeMemberOperation:\nprotected StructuralPropertyDescriptor getChildPropertyDescriptor(ASTNode \nparent) {\n\tswitch (parent.getNodeType()) {\n\t\tcase ASTNode.COMPILATION_UNIT:\n\t\t\treturn CompilationUnit.TYPES_PROPERTY;\n\t\tdefault:\n\t\t\treturn TypeDeclaration.BODY_DECLARATIONS_PROPERTY;\n\t}\n}\nwhich obviously results in failures for EnumDeclarations and \nAnnotationTypeDeclarations. It might be a common issue to regard only \nTypeDeclaration and to not regard other AbstractTypeDeclaration subclasses.",
    "Additionally, when trying to create a method in an enum, the following occurs:\n\njava.lang.IllegalArgumentException: EnumDeclaration has no property \nbodyDeclarations\n\tat \norg.eclipse.jdt.internal.core.dom.rewrite.RewriteEventStore.validateHasChildProp\nerty(RewriteEventStore.java:615)\n\tat org.eclipse.jdt.internal.core.dom.rewrite.RewriteEventStore.getEvent\n(RewriteEventStore.java:296)\n\tat \norg.eclipse.jdt.internal.core.dom.rewrite.RewriteEventStore.getListEvent\n(RewriteEventStore.java:325)\n\tat org.eclipse.jdt.core.dom.rewrite.ListRewrite.getEvent\n(ListRewrite.java:56)\n\tat org.eclipse.jdt.core.dom.rewrite.ListRewrite.internalInsertAt\n(ListRewrite.java:283)\n\tat org.eclipse.jdt.core.dom.rewrite.ListRewrite.insertLast\n(ListRewrite.java:248)\n\tat \norg.eclipse.jdt.internal.core.CreateElementInCUOperation.insertASTNode\n(CreateElementInCUOperation.java:263)\n\tat \norg.eclipse.jdt.internal.core.CreateElementInCUOperation.generateNewCompilationU\nnitAST(CreateElementInCUOperation.java:184)\n\tat \norg.eclipse.jdt.internal.core.CreateElementInCUOperation.executeOperation\n(CreateElementInCUOperation.java:137)\n\tat org.eclipse.jdt.internal.core.JavaModelOperation.run\n(JavaModelOperation.java:710)\n\tat org.eclipse.core.internal.resources.Workspace.run\n(Workspace.java:1702)\n\tat org.eclipse.jdt.internal.core.JavaModelOperation.runOperation\n(JavaModelOperation.java:766)\n\tat org.eclipse.jdt.internal.core.SourceType.createMethod\n(SourceType.java:139)\n",
    "Your diagnosis is exact, the problem is inside\nCreateTypeMemberOperation#getChildPropertyDescriptor().\n\nThis method must be \n\nprotected StructuralPropertyDescriptor getChildPropertyDescriptor(ASTNode parent) {\n  switch (parent.getNodeType()) {\n    case ASTNode.COMPILATION_UNIT:\n      return CompilationUnit.TYPES_PROPERTY;\n    case ASTNode.ENUM_DECLARATION:\n      return EnumDeclaration.BODY_DECLARATIONS_PROPERTY;\n    case ASTNode.ANNOTATION_TYPE_DECLARATION:\n      return AnnotationTypeDeclaration.BODY_DECLARATIONS_PROPERTY;\n    default:\n      return TypeDeclaration.BODY_DECLARATIONS_PROPERTY;\n  }\n}\n\n\nFixed and test added\n  CreateMembersTests#test002()\n  CreateMembersTests#test003()",
    "Another issue has risen in the I200502171619. Consider this enum:\n\npublic enum MyEnum {\n    VALUE1\n}\n\nWe call createField(\"int someField\u003d0;\\n\", null, true, null).\nIt fails because of the following intermediate search call to make the VALUE1 \nenum constant declaration a sibling:\n\tSourceField.findNode(CompilationUnit) line: 40\n\tCreateFieldOperation(CreateElementInCUOperation).insertASTNode\n(ASTRewrite, ASTNode, ASTNode) line: 255\n\tCreateFieldOperation\n(CreateElementInCUOperation).generateNewCompilationUnitAST(ICompilationUnit) \nline: 184\n\tCreateFieldOperation(CreateElementInCUOperation).executeOperation() \nline: 137\n\tCreateFieldOperation(JavaModelOperation).run(IProgressMonitor) line: 710\n\tWorkspace.run(IWorkspaceRunnable, ISchedulingRule, int, \nIProgressMonitor) line: 1702\n\tCreateFieldOperation(JavaModelOperation).runOperation(IProgressMonitor) \nline: 771\n\tSourceType.createField(String, IJavaElement, boolean, IProgressMonitor) \nline: 117\n\nThe reason is this: the SourceType method\npublic ASTNode findNode(org.eclipse.jdt.core.dom.CompilationUnit ast) {\n\t// For field declarations, a variable declaration fragment is returned\n\t// Return the FieldDeclaration instead\n\tASTNode node \u003d super.findNode(ast);\n\tif (node \u003d\u003d null) return null;\n\treturn node.getParent();\n}\n\ndoes find the EnumConstantDeclaration but does not return one, taking its \nparent (i.e. EnumDeclaration) as the final result. A check should be made to \nhandle the enum constant case properly and return the constant declaration \nitself, not its parent node (something like\n\nif (node instanceof VariableDeclarationFragment) {\n    return node.getParent();\n}\nelse {\n    return node;\n}\n\n).",
    "This bug is not the same. I create another bug report (bug 88312) and close the\ncurrent bug.",
    "Verified in I20050330-0500"
  ],
  "commentCreationDates": [
    "2005-03-01T15:07:08+01:00",
    "2005-03-01T15:55:34+01:00",
    "2005-03-02T10:54:15+01:00",
    "2005-03-14T12:51:33+01:00",
    "2005-03-17T11:41:23+01:00",
    "2005-03-31T16:41:40+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.IllegalArgumentException",
      "message": "EnumDeclaration has no property  bodyDeclarations",
      "elements": [
        {
          "method": "org.eclipse.jdt.internal.core.dom.rewrite.RewriteEventStore.validateHasChildProperty",
          "source": "RewriteEventStore.java:615"
        },
        {
          "method": "org.eclipse.jdt.internal.core.dom.rewrite.RewriteEventStore.getEvent",
          "source": "RewriteEventStore.java:296"
        },
        {
          "method": "org.eclipse.jdt.internal.core.dom.rewrite.RewriteEventStore.getListEvent",
          "source": "RewriteEventStore.java:325"
        },
        {
          "method": "org.eclipse.jdt.core.dom.rewrite.ListRewrite.getEvent",
          "source": "ListRewrite.java:56"
        },
        {
          "method": "org.eclipse.jdt.core.dom.rewrite.ListRewrite.insertAfter",
          "source": "ListRewrite.java:171"
        },
        {
          "method": "org.eclipse.jdt.internal.core.CreateElementInCUOperation.insertASTNode",
          "source": "CreateElementInCUOperation.java:257"
        },
        {
          "method": "org.eclipse.jdt.internal.core.CreateElementInCUOperation.generateNewCompilationUnitAST",
          "source": "CreateElementInCUOperation.java:184"
        },
        {
          "method": "org.eclipse.jdt.internal.core.CreateElementInCUOperation.executeOperation",
          "source": "CreateElementInCUOperation.java:137"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelOperation.run",
          "source": "JavaModelOperation.java:710"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1702"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelOperation.runOperation",
          "source": "JavaModelOperation.java:766"
        },
        {
          "method": "org.eclipse.jdt.internal.core.SourceType.createField",
          "source": "SourceType.java:117"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "86906",
      "date": "2005-03-01T15:07:08+01:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.IllegalArgumentException",
      "message": "EnumDeclaration has no property  bodyDeclarations",
      "elements": [
        {
          "method": "org.eclipse.jdt.internal.core.dom.rewrite.RewriteEventStore.validateHasChildProperty",
          "source": "RewriteEventStore.java:615"
        },
        {
          "method": "org.eclipse.jdt.internal.core.dom.rewrite.RewriteEventStore.getEvent",
          "source": "RewriteEventStore.java:296"
        },
        {
          "method": "org.eclipse.jdt.internal.core.dom.rewrite.RewriteEventStore.getListEvent",
          "source": "RewriteEventStore.java:325"
        },
        {
          "method": "org.eclipse.jdt.core.dom.rewrite.ListRewrite.getEvent",
          "source": "ListRewrite.java:56"
        },
        {
          "method": "org.eclipse.jdt.core.dom.rewrite.ListRewrite.internalInsertAt",
          "source": "ListRewrite.java:283"
        },
        {
          "method": "org.eclipse.jdt.core.dom.rewrite.ListRewrite.insertLast",
          "source": "ListRewrite.java:248"
        },
        {
          "method": "org.eclipse.jdt.internal.core.CreateElementInCUOperation.insertASTNode",
          "source": "CreateElementInCUOperation.java:263"
        },
        {
          "method": "org.eclipse.jdt.internal.core.CreateElementInCUOperation.generateNewCompilationUnitAST",
          "source": "CreateElementInCUOperation.java:184"
        },
        {
          "method": "org.eclipse.jdt.internal.core.CreateElementInCUOperation.executeOperation",
          "source": "CreateElementInCUOperation.java:137"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelOperation.run",
          "source": "JavaModelOperation.java:710"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1702"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelOperation.runOperation",
          "source": "JavaModelOperation.java:766"
        },
        {
          "method": "org.eclipse.jdt.internal.core.SourceType.createMethod",
          "source": "SourceType.java:139"
        }
      ],
      "number": 1,
      "commentIndex": 1,
      "bugId": "86906",
      "date": "2005-03-01T15:55:34+01:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    }
  ],
  "groupId": "86906",
  "bugId": "86906",
  "date": "2005-03-01T15:07:08+01:00",
  "product": "JDT",
  "component": "Core",
  "severity": "normal"
}