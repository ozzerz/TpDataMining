{
  "comments": [
    "I encounter a \n\njava.lang.ClassCastException: org.eclipse.equinox.launcher.WebStartMain$BundleInfo:\nat org.eclipse.equinox.launcher.WebStartMain.searchFor(WebStartMain.java:116)\n\nwhen I launch with JavaWebStart (JDK 1.5_0_12) my plugin built with eclipse 3.3.",
    "Created an attachment (id\u003d75120)\npatch\n\nThere are a couple of places where a the code tries to cast elements of an ArrayList containing BundleInfo to a String.  This patch corrects this, but more investigation is needed because there are many cases where BundleInfo.version will be null which will result in NullPointerExceptions I think.\n\nPascal, can you investigate?",
    "This looks like a regression from 3.2.2 that should be fixed for 3.3.1.",
    "Tristan could you please provide a little test case to help us reproduce this?",
    "(In reply to comment #3)\n\u003e Tristan could you please provide a little test case to help us reproduce this?\n\u003e \n\nWe have built a plugin for our business software working on windows XP or 2000 clients. We deploy it by java webstart. So we have a jnlp file. We have these lines on the launcher:\n\n  \u003capplication-desc main-class\u003d\"org.eclipse.equinox.launcher.WebStartMain\"\u003e\n  \t\u003cargument\u003e-showsplash\u003c/argument\u003e\n  \u003c/application-desc\u003e\n \n  \u003cresources\u003e\n    \u003cjar href\u003d\"plugins/org.eclipse.equinox.launcher_1.0.0.v20070606.jar\"/\u003e\n  ...\n\nWhen the user launches the jnlp to download the software the jvm crashes and here is the stack trace written in the log file found in the java webstart folder:\n\njava.lang.ClassCastException: org.eclipse.equinox.launcher.WebStartMain$BundleInfo\n\tat org.eclipse.equinox.launcher.WebStartMain.searchFor(WebStartMain.java:116)\n\tat org.eclipse.equinox.launcher.Main.setupJNI(Main.java:384)\n\tat org.eclipse.equinox.launcher.Main.basicRun(Main.java:430)\n\tat org.eclipse.equinox.launcher.WebStartMain.basicRun(WebStartMain.java:79)\n\tat org.eclipse.equinox.launcher.Main.run(Main.java:1169)\n\tat org.eclipse.equinox.launcher.WebStartMain.main(WebStartMain.java:57)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n\tat java.lang.reflect.Method.invoke(Unknown Source)\n\tat com.sun.javaws.Launcher.executeApplication(Unknown Source)\n\tat com.sun.javaws.Launcher.executeMainClass(Unknown Source)\n\tat com.sun.javaws.Launcher.continueLaunch(Unknown Source)\n\tat com.sun.javaws.Launcher.handleApplicationDesc(Unknown Source)\n\tat com.sun.javaws.Launcher.handleLaunchFile(Unknown Source)\n\tat com.sun.javaws.Launcher.run(Unknown Source)\n\tat java.lang.Thread.run(Unknown Source)\n\n",
    "While looking in my archive, I came across a JNLP startable RCP application dating back from April 27th 2007 that worked fine. It includes the launcher org.eclipse.equinox.launcher_1.0.0.v20070416.jar.\n\nLooking at the history of Main and WebStartMain, the only changes in this code after this date relates to launcher changes. And since Tom suspects a problem around the setupJNI() code, I will assign to Andrew for investigation.\n\nIf bugzilla permits I will attach the working JNLP app to this bug.\n",
    "Created an attachment (id\u003d77066)\nupdated patch\n\nThe setupJNI code is fine and can handle not finding the shared library.\n\nThere are 2 uses of the the BundleInfo objects, bundles from the osgi.bundles property which will have null versions (since that field is not set), however, I do not see any NPEs here since there are no references to those version fields that would cause an NPE.\n\nThe other use is all the other bundles found through the WebStartMain class loader.  There are potential NPEs here only if the bundles do not have the Bundle-Version attribute.\n\nAttached is an updated patch that uses \"0.0.0\" if there was no Bundle-Version attribute in the manifest.",
    "Patch looks good.\n\nLast time I looked at this code I think I got confused the difference between the allBundles Map which contains BundleInfos parsed from the classpath vs the bundleList which contains BundleInfos based on the osgi.bundles property.  In the bundleList the BundleInfos always have a null value, but this is by design because that will cause us to search for the highest version available from the allBundles map.",
    "done in HEAD and 3.3.1"
  ],
  "commentCreationDates": [
    "2007-08-01T01:50:03+02:00",
    "2007-08-01T15:28:38+02:00",
    "2007-08-01T15:30:03+02:00",
    "2007-08-22T19:54:53+02:00",
    "2007-08-23T01:58:05+02:00",
    "2007-08-23T15:46:26+02:00",
    "2007-08-27T21:35:39+02:00",
    "2007-08-27T23:33:54+02:00",
    "2007-08-28T15:47:12+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ClassCastException",
      "message": "org.eclipse.equinox.launcher.WebStartMain$BundleInfo:",
      "elements": [
        {
          "method": "org.eclipse.equinox.launcher.WebStartMain.searchFor",
          "source": "WebStartMain.java:116"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "198462",
      "date": "2007-08-01T01:50:03+02:00",
      "product": "Equinox",
      "component": "Framework",
      "severity": "major"
    },
    {
      "exceptionType": "java.lang.ClassCastException",
      "message": "org.eclipse.equinox.launcher.WebStartMain$BundleInfo",
      "elements": [
        {
          "method": "org.eclipse.equinox.launcher.WebStartMain.searchFor",
          "source": "WebStartMain.java:116"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.setupJNI",
          "source": "Main.java:384"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.basicRun",
          "source": "Main.java:430"
        },
        {
          "method": "org.eclipse.equinox.launcher.WebStartMain.basicRun",
          "source": "WebStartMain.java:79"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.run",
          "source": "Main.java:1169"
        },
        {
          "method": "org.eclipse.equinox.launcher.WebStartMain.main",
          "source": "WebStartMain.java:57"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "com.sun.javaws.Launcher.executeApplication",
          "source": "Unknown Source"
        },
        {
          "method": "com.sun.javaws.Launcher.executeMainClass",
          "source": "Unknown Source"
        },
        {
          "method": "com.sun.javaws.Launcher.continueLaunch",
          "source": "Unknown Source"
        },
        {
          "method": "com.sun.javaws.Launcher.handleApplicationDesc",
          "source": "Unknown Source"
        },
        {
          "method": "com.sun.javaws.Launcher.handleLaunchFile",
          "source": "Unknown Source"
        },
        {
          "method": "com.sun.javaws.Launcher.run",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.Thread.run",
          "source": "Unknown Source"
        }
      ],
      "number": 1,
      "commentIndex": 4,
      "bugId": "198462",
      "date": "2007-08-23T01:58:05+02:00",
      "product": "Equinox",
      "component": "Framework",
      "severity": "major"
    }
  ],
  "groupId": "198462",
  "bugId": "198462",
  "date": "2007-08-01T01:50:03+02:00",
  "product": "Equinox",
  "component": "Framework",
  "severity": "major"
}