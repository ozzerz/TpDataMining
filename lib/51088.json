{
  "comments": [
    "Currently on the Mac, when a Control is disposed, it does not tell the parent to reset the clipping \nregions. This is what causes the area under a ControlEditor to not be redrawn properly after editing \nis complete. The most obvious hack to fix this (which is probably not the correct one) is to call \ninvalidateVisibleRegion in releaseWidget():\n\nIndex: Control.java\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\nretrieving revision 1.128\ndiff -u -r1.128 Control.java\n--- Control.java\t18 Dec 2003 19:34:23 -0000\t1.128\n+++ Control.java\t3 Feb 2004 02:14:50 -0000\n@@ -1619,6 +1619,9 @@\n \t\tmenu.dispose ();\n \t}\n \tif (visibleRgn !\u003d 0) OS.DisposeRgn (visibleRgn);\n+\tif (parent !\u003d null \u0026\u0026 !parent.isDisposed()) {\n+\t\tparent.invalidateVisibleRegion (handle);\n+\t}\n \tvisibleRgn \u003d 0;\n \tmenu \u003d null;\n \tparent \u003d null;\n\nThere was at least one odd piece of fallout from making this change. In the FileExplorer app I have \nbeen working on with Steve, I got the following walkback when closing the shell:\n\nException in thread \"main\" java.lang.NullPointerException\n\tat org.eclipse.swt.widgets.ToolBar.invalidateChildrenVisibleRegion(ToolBar.java:308)\n\tat org.eclipse.swt.widgets.Control.invalidateVisibleRegion(Control.java:1150)\n\tat org.eclipse.swt.widgets.Control.releaseWidget(Control.java:1623)\n\tat org.eclipse.swt.widgets.Scrollable.releaseWidget(Scrollable.java:336)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:493)\n\tat org.eclipse.swt.widgets.Widget.releaseResources(Widget.java:1085)\n\tat org.eclipse.swt.widgets.Composite.releaseChildren(Composite.java:487)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:492)\n\tat org.eclipse.swt.widgets.ToolBar.releaseWidget(ToolBar.java:399)\n\tat org.eclipse.swt.widgets.Widget.releaseResources(Widget.java:1085)\n\tat org.eclipse.swt.widgets.Composite.releaseChildren(Composite.java:487)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:492)\n\tat org.eclipse.swt.widgets.Canvas.releaseWidget(Canvas.java:127)\n\tat org.eclipse.swt.widgets.Decorations.releaseWidget(Decorations.java:328)\n\tat org.eclipse.swt.widgets.Shell.releaseWidget(Shell.java:983)\n\tat org.eclipse.swt.widgets.Widget.dispose(Widget.java:476)\n\tat org.eclipse.swt.widgets.Shell.closeWidget(Shell.java:390)\n\tat org.eclipse.swt.widgets.Shell.kEventWindowClose(Shell.java:789)\n\tat org.eclipse.swt.widgets.Widget.windowProc(Widget.java:1626)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:2825)\n\tat org.eclipse.swt.internal.carbon.OS.SendEventToEventTarget(Native Method)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:1903)\n\tat part3.fileexplorer.FileExplorer.main(FileExplorer.java:68)\n\nThe odd thing is, invalidateChildrenVisibleRegion is failing in this case because the itemCount is \nnon-zero, even though the items array has been nulled out:\nvoid invalidateChildrenVisibleRegion (int control) {\n\tsuper.invalidateChildrenVisibleRegion (control);\n\tfor (int i\u003d0; i\u003citemCount; i++) {\n\t\tToolItem item \u003d items [i];\n\t\titem.resetVisibleRegion (control);\n\t}\n}\n\nIf I patch the releaseWidget method for ToolBar to set itemCount to zero, like this...\n\nIndex: ToolBar.java\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\nretrieving revision 1.20\ndiff -u -r1.20 ToolBar.java\n--- ToolBar.java\t7 May 2003 22:25:37 -0000\t1.20\n+++ ToolBar.java\t3 Feb 2004 02:23:42 -0000\n@@ -394,6 +394,7 @@\n \t\tToolItem item \u003d items [i];\n \t\tif (!item.isDisposed ()) item.releaseResources ();\n \t}\n+\titemCount \u003d 0;\n \titems \u003d null;\n \tsuper.releaseWidget ();\n }\n\n... then the example appears to work perfectly. This last change, seems like a good thing to do \nanyway. I don\u0027t have high confidence in the first one, but it definitely fixes the \"in place rename \ndoes not redraw the tree\" bug in my example, so something like that is needed.",
    "Fixed \u003e 20040210.\n\nThe call to invalidateVisibleRegion() is in releaseChild() to avoid multiple calls. Fixed \nToolItem.releaseChild() too and ToolBar.itemCount too."
  ],
  "commentCreationDates": [
    "2004-02-03T02:50:17+01:00",
    "2004-02-10T17:43:47+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.swt.widgets.ToolBar.invalidateChildrenVisibleRegion",
          "source": "ToolBar.java:308"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.invalidateVisibleRegion",
          "source": "Control.java:1150"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.releaseWidget",
          "source": "Control.java:1623"
        },
        {
          "method": "org.eclipse.swt.widgets.Scrollable.releaseWidget",
          "source": "Scrollable.java:336"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:493"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseResources",
          "source": "Widget.java:1085"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseChildren",
          "source": "Composite.java:487"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:492"
        },
        {
          "method": "org.eclipse.swt.widgets.ToolBar.releaseWidget",
          "source": "ToolBar.java:399"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseResources",
          "source": "Widget.java:1085"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseChildren",
          "source": "Composite.java:487"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:492"
        },
        {
          "method": "org.eclipse.swt.widgets.Canvas.releaseWidget",
          "source": "Canvas.java:127"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.releaseWidget",
          "source": "Decorations.java:328"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.releaseWidget",
          "source": "Shell.java:983"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.dispose",
          "source": "Widget.java:476"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.closeWidget",
          "source": "Shell.java:390"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.kEventWindowClose",
          "source": "Shell.java:789"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.windowProc",
          "source": "Widget.java:1626"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:2825"
        },
        {
          "method": "org.eclipse.swt.internal.carbon.OS.SendEventToEventTarget",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:1903"
        },
        {
          "method": "part3.fileexplorer.FileExplorer.main",
          "source": "FileExplorer.java:68"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "51088",
      "date": "2004-02-03T02:50:17+01:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "normal"
    }
  ],
  "groupId": "51088",
  "bugId": "51088",
  "date": "2004-02-03T02:50:17+01:00",
  "product": "Platform",
  "component": "SWT",
  "severity": "normal"
}