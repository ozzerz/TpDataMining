{
  "comments": [
    "When deleting an AJ project, the following NPE occurs from AJ:\n\njava.lang.NullPointerException\n\tat \norg.eclipse.ajdt.internal.ui.ajde.ProjectProperties.getSourcePathResources\n(ProjectProperties.java:802)\n\tat org.aspectj.ajde.internal.CompilerAdapter.configureProjectOptions\n(CompilerAdapter.java:566)\n\tat org.aspectj.ajde.internal.CompilerAdapter.genBuildConfig\n(CompilerAdapter.java:171)\n\tat org.aspectj.ajde.internal.CompilerAdapter.compile\n(CompilerAdapter.java:97)\n\tat org.aspectj.ajde.internal.AspectJBuildManager$CompilerThread.run\n(AspectJBuildManager.java:165)\n\n\n\nThis is due to the previous problem during the delete:\n\norg.eclipse.core.internal.resources.ResourceException: Problems encountered \nwhile deleting resources.\n\tat \norg.eclipse.core.internal.localstore.FileSystemResourceManager.delete\n(FileSystemResourceManager.java:172)\n\tat \norg.eclipse.core.internal.resources.ResourceTree.standardDeleteProject\n(ResourceTree.java:778)\n\tat org.eclipse.core.internal.resources.Resource.unprotectedDelete\n(Resource.java:1522)\n\tat org.eclipse.core.internal.resources.Resource.delete\n(Resource.java:670)\n\tat org.eclipse.core.internal.resources.Project.delete(Project.java:322)\n\tat org.eclipse.ui.actions.DeleteResourceAction.delete\n(DeleteResourceAction.java:346)\n\tat org.eclipse.ui.actions.DeleteResourceAction.delete\n(DeleteResourceAction.java:314)\n\tat org.eclipse.ui.actions.DeleteResourceAction.access$0\n(DeleteResourceAction.java:305)\n\tat org.eclipse.ui.actions.DeleteResourceAction$2.execute\n(DeleteResourceAction.java:429)\n\tat org.eclipse.ui.actions.WorkspaceModifyOperation$1.run\n(WorkspaceModifyOperation.java:91)\n\tat org.eclipse.core.internal.resources.Workspace.run\n(Workspace.java:1673)\n\tat org.eclipse.ui.actions.WorkspaceModifyOperation.run\n(WorkspaceModifyOperation.java:105)\n\tat org.eclipse.jface.operation.ModalContext$ModalContextThread.run\n(ModalContext.java:101)\n\n\nThere are also messages in the error log saying that the src directory doesn\u0027t \nexist.\n\nTo reproduce:\n\n(1) Ensure that \"build automatically\" is enabled (Project \u003e Build \nautomatically)\n(2) Check out org.eclipse.contribution.visualiser from the adjt cvs\n(3) Wait for the build to finish\n(4) in the Java Perspective, right click on \norg.eclipse.contribution.visualiser in the package explorer and select \"Delete\"\n(5) In the confirmation box, select the option which also deletes the contents \nin org.eclipse.contribution.visualiser.\n(6) Click \"Yes\"\n(7) An error box appears saying that there were problems with the delete, \nfollowed by an AJ error box saying that an NPE occured.\n\n\nWhat is happening is that somewhere along the lines, deleting the project \ncauses an AJ build to occur. Because of this, the delete can\u0027t finish and \nbecause some deletion has occured, the build can\u0027t work (and consequently \nthere is the NPE).\n\nThe fix is to investigate why the AJ build is being triggered on deletion and \nprevent it from doing so (note that there are resourceChangeListeners in the \nbuild configuration work - maybe this is what is triggering the build?). \n\nThis is also somewhat related to when the AJ build is triggered and when it\u0027s \nnot. (see bug 74174 and 73859)",
    "Note, that this is being seen in the following setups:\n\n(1) in a runtime workbench using the ajdt code dated 20041007 (Eclipse 3.0)\n(2) in Eclipse 3.0 with AJDT 1.1.12 installed\n(3) in Eclipse 3.0 with AJDT dev build 1.2.0.20041004170512 installed",
    "This is happening because when a project is deleted, a call is made to \nmakeSureThereIsAtLeastOneActiveConfiguration() in \nProjectBuildConfigurator.java. Because all build configurations have been \ndeleted, calling this method creates one which forces a build and hence the \nproblems. \n\nSo far, I\u0027ve tested this by removing the call to make...Configuration() in the \nremoveBuildConfiguration method. The fix though, is to check whether the last \nthing the user wanted to do was to delete the project. In this case, we don\u0027t \nwant to ensure that there is an active build configuration, however, in \nothercases (like, for example a user accidently deleting all the build \nconfigurations). ",
    "Still deleting this one reference to \nmakeSureThereIsAtLeastOneActiveConfiguration() (as I did yesterday) does not \nseem to fix the problem today. However, removing all references to this does. \n(there are four in total). In this case, checking the project out of CVS means \nthat the AJ compile fails (because no build configurations have been \nactivated)). However, deleting the project now works. In the case when I check \nout the visualiser from CVS, still with these calls removed, then myself \nactivate one of the build configuration files, and finally delete the project. \nAgain, the project deletes with no problems.\n\nThis does seem to imply that there is something in the build configuration \ncode which is causing this problem (by calling \nmakeSureThereIsAtLeastOneActiveConfiguration() when it probably shouldn\u0027t). \nStepping through the debugger has not helped because various jobs are fired \noff at once and it\u0027s a race as to which is executed.\n\nHowever, the strange thing is that the delete always fails when it tries to \ndelete the draw2d.jar and consequently the lib dir (draw2d.jar is in the lib \ndir). The only way to get the visualiser plugin to delete is do the following:\n\n(1) remove draw2d.jar from the libraries tab of the project properties page\n(2) delete draw2d.jar (which now appears under lib in the package explorer)\n(3) delete lib\n(4) delete the visualiser plugin.\n\n(note that this is with all the 4 calls to \nmakeSureThereIsAtLeastOneActiveConfiguration() uncommented).\n\nIs there something strange about an AJ project containing a library and the \nbuild configurations?\n",
    "This does seem to be just a problem with the \norg.eclipse.contribution.visualiser plugin and the library. I checked out the \nfollowing:\n\norg.aspectj.ajde\norg.aspectj.runtime\norg.eclipse.ajdt.core (which is an AJ plugin)\n\nand then deleted org.eclipse.ajdt.core and it worked fine.",
    "Well, today, with all four calls to makeSureAtLeastOneBuildConfiguration() \ncommented out, there are still problems with the delete :-(\n\nWhat I now think is happening is that during compile (or a build) we keep hold \nof a reference to any jars on the build path. When we come to delete this, it \nconsequently fails. My reasoning for this is that if I remove draw2d.jar from \nthe build path, then everything deletes OK.",
    "Matthew has also had problems deleting AJ projects. In his case, there was a \nproblem deleting the .generated.ajsm file. Possibly this happened after a bad \ncompile, which I think is a different problem. Therefore, it seems that \nsomewhere we\u0027re also hanging onto this file if there is a bad compile (an \nexception).",
    "This is not an AJDT bug, instead it\u0027s a problem in AspectJ (the way we saw \nthis was to comment out calling the aj build from the AJDT builder and we \ncould delete as required).\n\nIn ClassPathManager - the zipClassFile isn\u0027t closed. A crude test of this was \nto add a closeAll() method in ClassPathManagerwhich we called from our build() \nmethod after the AspectJ build. Everything deleted as required.\n\nInformation about the lifecycle of ClasspathManagers:\n\nThe places which have an instance of ClassPathManager are:\n\n- BcelWorld constructor: which takes a List, IMessageHandler and \nICrossReferenceHandler\n- ExctensibleURLClassLoader constructor: which takes a URL and Classloader\n\nThe places which use the BcelWorld constructor are: \n\n- AjBuildManager which has an initializeBcelWorld method.\n\nThe places which create an AjBuildManager are:\n\n- CompilerAdapter init() - init is called in the first couple of lines of the \ncompile method.\n- AjdtCommand runCommand()\n\nThe places which use the ExtensibleURLClassLoader are:\n\n- WeavingURLClassloader in one of its constructors, however, nothing uses that \nconstructor.\n\nThe problem is not to create problems for incremental building with this fix, \nplus not to damage performance.",
    "This problem has been fixed in AspectJ and has been included in AJDT:\n\nBUILD COMPLETE -  build.90\nDate of build: 11/23/2004 14:57:00\nTime to build: 28 minutes 10 seconds\nLast changed: 11/23/2004 14:39:45\nLast log entry: (1) Fixes Helens deleting project problem (2) Fixes project \nbuilds with \u003e4000 jars on the classpath (good luck creating a testcase...) (3) \nIncludes BCEL fix to avoid loading types more than once (4) Includes BCEL \nJava5 support.\n\nI\u0027m therefore closing this bug as fixed."
  ],
  "commentCreationDates": [
    "2004-10-07T11:41:40+02:00",
    "2004-10-07T12:04:31+02:00",
    "2004-10-07T18:04:16+02:00",
    "2004-10-08T17:58:27+02:00",
    "2004-10-11T10:57:06+02:00",
    "2004-10-22T16:09:12+02:00",
    "2004-10-28T12:24:19+02:00",
    "2004-11-02T14:59:38+01:00",
    "2004-11-24T08:33:43+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.ajdt.internal.ui.ajde.ProjectProperties.getSourcePathResources",
          "source": "ProjectProperties.java:802"
        },
        {
          "method": "org.aspectj.ajde.internal.CompilerAdapter.configureProjectOptions",
          "source": "CompilerAdapter.java:566"
        },
        {
          "method": "org.aspectj.ajde.internal.CompilerAdapter.genBuildConfig",
          "source": "CompilerAdapter.java:171"
        },
        {
          "method": "org.aspectj.ajde.internal.CompilerAdapter.compile",
          "source": "CompilerAdapter.java:97"
        },
        {
          "method": "org.aspectj.ajde.internal.AspectJBuildManager$CompilerThread.run",
          "source": "AspectJBuildManager.java:165"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "75776",
      "date": "2004-10-07T11:41:40+02:00",
      "product": "AJDT",
      "component": "Core",
      "severity": "normal"
    },
    {
      "exceptionType": "org.eclipse.core.internal.resources.ResourceException",
      "message": "Problems encountered  while deleting resources.",
      "elements": [
        {
          "method": "org.eclipse.core.internal.localstore.FileSystemResourceManager.delete",
          "source": "FileSystemResourceManager.java:172"
        },
        {
          "method": "org.eclipse.core.internal.resources.ResourceTree.standardDeleteProject",
          "source": "ResourceTree.java:778"
        },
        {
          "method": "org.eclipse.core.internal.resources.Resource.unprotectedDelete",
          "source": "Resource.java:1522"
        },
        {
          "method": "org.eclipse.core.internal.resources.Resource.delete",
          "source": "Resource.java:670"
        },
        {
          "method": "org.eclipse.core.internal.resources.Project.delete",
          "source": "Project.java:322"
        },
        {
          "method": "org.eclipse.ui.actions.DeleteResourceAction.delete",
          "source": "DeleteResourceAction.java:346"
        },
        {
          "method": "org.eclipse.ui.actions.DeleteResourceAction.delete",
          "source": "DeleteResourceAction.java:314"
        },
        {
          "method": "org.eclipse.ui.actions.DeleteResourceAction.access$0",
          "source": "DeleteResourceAction.java:305"
        },
        {
          "method": "org.eclipse.ui.actions.DeleteResourceAction$2.execute",
          "source": "DeleteResourceAction.java:429"
        },
        {
          "method": "org.eclipse.ui.actions.WorkspaceModifyOperation$1.run",
          "source": "WorkspaceModifyOperation.java:91"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1673"
        },
        {
          "method": "org.eclipse.ui.actions.WorkspaceModifyOperation.run",
          "source": "WorkspaceModifyOperation.java:105"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext$ModalContextThread.run",
          "source": "ModalContext.java:101"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "75776",
      "date": "2004-10-07T11:41:40+02:00",
      "product": "AJDT",
      "component": "Core",
      "severity": "normal"
    }
  ],
  "groupId": "75776",
  "bugId": "75776",
  "date": "2004-10-07T11:41:40+02:00",
  "product": "AJDT",
  "component": "Core",
  "severity": "normal"
}