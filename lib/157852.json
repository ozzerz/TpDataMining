{
  "comments": [
    "Short:\n\nIn trying to run ATF on Linux 64bit I\u0027ve never managed to get it going.  I found some time today to debug the problem and think I found it.\n\nThe plugin org.eclipse.atf.mozilla.swt.browser ships with all the compiled class in the the package org.eclipse.swt.browser.\n\nHowever the Platform base SWT bundle for Linux ships org.eclipse.swt.gtk.linux.x86_64_3.2.1.v3235.jar which also contains one or more classes in the package org.eclipse.swt.browser.\n\nI think that the ATF plugin org.eclipse.atf.mozilla.swt.browser is volating general namespace rules and think that all the code should be refactored and exported in the package org.eclipse.atf.mozilla.swt.browser.\n\n\nLong:\n\n$ jar -tvf /opt/eclipse/plugins/org.eclipse.swt.gtk.linux.x86_64_3.2.1.v3235.jar  | grep \"browser/[MNO]\"\n   248 Tue Sep 12 17:58:26 BST 2006 org/eclipse/swt/browser/OpenWindowListener.class\n\nThis demonstrate the class org/eclipse/swt/browser/MozillaCloseWindowListener is not shipped with the Eclipse base Platform bundled SWT.\n\n\nHowever the ATF project attempts to provide it here:\n\n$ jar -tvf ~dlm/.eclipseextension/eclipse/plugins/org.eclipse.atf.mozilla.swt.browser_1.0.1/mozilla_swt.jar\n     0 Tue Sep 12 13:33:44 BST 2006 META-INF/\n   106 Tue Sep 12 13:33:42 BST 2006 META-INF/MANIFEST.MF\n     0 Tue Sep 12 13:33:42 BST 2006 org/\n     0 Tue Sep 12 13:33:42 BST 2006 org/eclipse/\n     0 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/\n     0 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/\n  1284 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/AbstractMozillaBrowser$1.class\n   716 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/AbstractMozillaBrowser$2.class\n   716 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/AbstractMozillaBrowser$3.class\n 27603 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/AbstractMozillaBrowser.class\n  3703 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/EmbeddingSiteWindow.class\n  1788 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaBrowser.class\n   272 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaCloseWindowListener.class\n  1223 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaDownload$1.class\n  8318 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaDownload.class\n  1046 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaDownloadFactory.class\n  2264 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaHelperAppLauncherDialog.class\n  1136 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaHelperAppLauncherDialogFactory.class\n   269 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaOpenWindowListener.class\n  1387 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaPromptDialog$1.class\n  1605 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaPromptDialog$2.class\n  1759 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaPromptDialog$3.class\n  6019 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaPromptDialog.class\n  6773 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaPromptService.class\n  1076 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaPromptServiceFactory.class\n   679 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaVisibilityWindowAdapter.class\n   296 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaVisibilityWindowListener.class\n  1420 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaWindowCreator$1.class\n   923 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaWindowCreator$2.class\n  3758 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaWindowCreator.class\n   744 Tue Sep 12 13:33:42 BST 2006 org/eclipse/swt/browser/MozillaWindowEvent.class\n\n\n\nIt seems that BOTH a component of ATF and a component of Eclipse base Platform SWT use the same package name org.eclipse.swt.browser.  The Java class loader *does not* perform an exhaustive search for all memebers of a package, once it find the first JAR file (or classes/ directory) that matches it consider that the only authoritative location for all the classes that make up that package.\n\n\nI am thinking that the package name is a typo in the CVS file:\n\neclipse_cvs/atf/components/plugins/org.eclipse.atf.mozilla.swt.browser/META-INF/MANIFEST.MF\nExport-Package: org.eclipse.swt.browser\n\nI think it should read:\n\nExport-Package: org.eclipse.atf.mozilla.swt.browser\n\n\nThen everything within ATF that uses it need to be refactored.\n\n\nMaybe Win32 version of SWT does not ship with the package org.eclipse.swt.browser and this is why developers have not been aware of this problem before.  But marking this as critical as ATF has never worked for me and I would like is anyone has ATF running on any version 32bit/64bit of linux and if so that other plugins do they have installed ?",
    "\n\nI have found some OSGi options to enable with \"-debug $HOME/.options\" to give a more verbose output of the class finding process (the following information I have extracted in the order they appear that I think it relevant and related to this problem) :\n\nBundleData created: org.eclipse.swt_3.2.1.v3235a\nBundleData created: org.eclipse.swt.gtk.linux.x86_64_3.2.1.v3235\nBundleData created: org.eclipse.atf.mozilla.swt.browser_1.0.1\n\n[ *** AT this point here I switch to Mozilla perspective and attempt to load the URL http://www.eclipse.org/atf/ ]\n\nBundleClassLoader[org.eclipse.atf.mozilla.ide.ui_1.0.1].loadClass(org.eclipse.swt.browser.ProgressListener)\nBundleLoader[org.eclipse.atf.mozilla.ide.ui_1.0.1].loadBundleClass(org.eclipse.swt.browser.ProgressListener)\nBundleLoader[org.eclipse.swt_3.2.1.v3235a].findLocalClass(org.eclipse.swt.browser.ProgressListener)\nBundleClassLoader[org.eclipse.swt_3.2.1.v3235a].findClass(org.eclipse.swt.browser.ProgressListener)\nBundleClassLoader[org.eclipse.swt_3.2.1.v3235a].findClass(org.eclipse.swt.browser.ProgressListener)\n  about to read 269 bytes from org/eclipse/swt/browser/ProgressListener.class\n  read 269 bytes from org/eclipse/swt/browser/ProgressListener.class\n  defining class org.eclipse.swt.browser.ProgressListener\nBundleLoader[org.eclipse.swt_3.2.1.v3235a] found local class org.eclipse.swt.browser.ProgressListener\nBundleClassLoader[org.eclipse.atf.mozilla.ide.ui_1.0.1].loadClass(org.eclipse.swt.browser.StatusTextListener)\nBundleLoader[org.eclipse.atf.mozilla.ide.ui_1.0.1].loadBundleClass(org.eclipse.swt.browser.StatusTextListener)\nBundleLoader[org.eclipse.swt_3.2.1.v3235a].findLocalClass(org.eclipse.swt.browser.StatusTextListener)\nBundleClassLoader[org.eclipse.swt_3.2.1.v3235a].findClass(org.eclipse.swt.browser.StatusTextListener)\nBundleClassLoader[org.eclipse.swt_3.2.1.v3235a].findClass(org.eclipse.swt.browser.StatusTextListener)\n  about to read 255 bytes from org/eclipse/swt/browser/StatusTextListener.class\n  read 255 bytes from org/eclipse/swt/browser/StatusTextListener.class\n  defining class org.eclipse.swt.browser.StatusTextListener\nBundleLoader[org.eclipse.swt_3.2.1.v3235a] found local class org.eclipse.swt.browser.StatusTextListener\nBundleClassLoader[org.eclipse.atf.mozilla.ide.ui_1.0.1].loadClass(org.eclipse.swt.browser.MozillaCloseWindowListener)\nBundleLoader[org.eclipse.atf.mozilla.ide.ui_1.0.1].loadBundleClass(org.eclipse.swt.browser.MozillaCloseWindowListener)\nBundleLoader[org.eclipse.swt_3.2.1.v3235a].findLocalClass(org.eclipse.swt.browser.MozillaCloseWindowListener)\nBundleClassLoader[org.eclipse.swt_3.2.1.v3235a].findClass(org.eclipse.swt.browser.MozillaCloseWindowListener)\nBundleClassLoader[org.eclipse.swt_3.2.1.v3235a].findClass(org.eclipse.swt.browser.MozillaCloseWindowListener)\nBundleLoader[org.eclipse.atf.mozilla.ide.ui_1.0.1].findLocalClass(org.eclipse.swt.browser.MozillaCloseWindowListener)\nBundleClassLoader[org.eclipse.atf.mozilla.ide.ui_1.0.1].findClass(org.eclipse.swt.browser.MozillaCloseWindowListener)\nBundleClassLoader[org.eclipse.atf.mozilla.ide.ui_1.0.1].loadClass(org.eclipse.swt.browser.MozillaCloseWindowListener) failed.\njava.lang.ClassNotFoundException: org.eclipse.swt.browser.MozillaCloseWindowListener\n        at org.eclipse.osgi.framework.internal.core.BundleLoader.findClass(BundleLoader.java:402)\n        at org.eclipse.osgi.framework.internal.core.BundleLoader.findClass(BundleLoader.java:347)\n        at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.loadClass(DefaultClassLoader.java:83)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:251)\n        at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:319)\n        at java.lang.Class.getDeclaredConstructors0(Native Method)\n        at java.lang.Class.privateGetDeclaredConstructors(Class.java:2357)\n        at java.lang.Class.getConstructor0(Class.java:2671)\n        at java.lang.Class.newInstance0(Class.java:321)\n        at java.lang.Class.newInstance(Class.java:303)\n        at org.eclipse.core.internal.registry.osgi.RegistryStrategyOSGI.createExecutableExtension(RegistryStrategyOSGI.java:157)\n\n\n\nFrom what I can see above the bundle org.eclipse.atf.mozilla.swt.browser_1.0.1 is not searched for the class at all.  But the org.eclipse.swt_3.2.1.v3235a bundle is (because it contains one or more files in the package we are locating)\n\n\n\n$HOME/.options file:\n\n# Turn on general debugging for org.eclipse.osgi\norg.eclipse.osgi/debug\u003dtrue\n# Prints out class loading debug information\norg.eclipse.osgi/debug/loader\u003dtrue\n# Prints out event (FrameworkEvent/BundleEvent/ServiceEvent) and listener debug information\norg.eclipse.osgi/debug/events\u003dtrue\n# Prints out OSGi service debug information (registration/getting/ungetting etc.)\norg.eclipse.osgi/debug/services\u003dtrue\n# Prints out bundle manifest parsing debug information\norg.eclipse.osgi/debug/manifest\u003dtrue\n",
    "Just to update this, I have tested with multiple JVMs (for 64bit to 32bit changeover I reinstalled Eclipse from ZIP files starting with a 32bit base and loaded all mu plugins back in).\n\nThere was no change at all between JVMs exactly the same CNFE occurs in the OSGi diagnostic output.\n\nThe JVMs I tried:\n\nSun JVM jdk1.5.0_08_x86_64 (64bit, what I normally use)\nIBM JVM IBMJava2-amd64-142 (64bit)\n\nSun JVM jdk1.5.0_08 (32bit)\nSun JVM j2sdk1.4.2_12 (32bit)\n\nThere is no Sun JVM 1.4 64bit version for Linux (Mu installation, like most 64bit Linux installation supports dual 32/64 bit runtimes natively, however this isn\u0027t prefered usage as system DSO/DLL footprint increases whenever you run any 32bit applications).\n\nI am now going to strip down my Eclipse install so find out which plugin package(s) make a difference to it working or not.  As pedemont@us.ibm.com reported that ATF does indeed work for him based on a minimal base install + ATF.",
    "Try an eclipse without the Visual Editor (org.eclipse.ve). I think the code they added to support a SWT Container is causing the problem. ",
    "As a work around go into \u003ceclipse_install_dir\u003e/plugins/org.eclipse.atf.mozilla.swt.browser_1.0.1/META-INF directory and edit file MANIFEST.MF. Change the line\n\nFragment-Host: org.eclipse.swt;bundle-version\u003d\"3.1.0\"\n\nto \n\nFragment-Host: org.eclipse.swt;bundle-version\u003d\"[3.1.0,4.0.0)\"\n\nPlease notice the [ and ) in the line. The Visual editor code for its SWT Container is not process this line correctly.Please tell me if this fixes your problem?",
    "Robert your suggestions make no difference to the situation.  The \"[3.1.0,4.0.0)\" comes from my other similar/related bug report bug #156517 ?\n\nThis problem does not seem to be affected by:\n * 32bit Linux vs 64bit Linux\n * The JVM implementation (Sun/JVM), (5.0, 1.4)\n * or other parts of callisto that are installed.\n\nI do have a few other plugins being picked up (which are not part of callisto).  Maybe I will just to be sure remove those.\n\nThe problem is more fundimental failure, it would help if you could quote me the exact ZIP files you installed on a Linux box to get a working version first time.\n\nIt would also help to know if you are actually using a released version not a CVS version (or version built from Eclipse project files).\n\nThis way I can try to work out what the difference between our configurations is that is causing the difference.\n",
    "The version of eclipse and WTP I\u0027m using is http://www.eclipse.org/downloads/download.php?file\u003d/webtools/downloads/drops/R1.5/R-1.5.0-200606281455/wtp-all-in-one-sdk-R-1.5.0-200606281455-linux-gtk.tar.gz. \n\nThis has WTP and Eclispe package as one. ",
    "I\u0027m also using the ATF build atf-linux-sdk-0.1-20060912-1300.zip on linux. Using the instructions on the site. ",
    "I think I may be able to duplicate the problem. Let me try to resolve it.",
    "I can definitely duplicated this problem. We are looking at it.",
    "Yes with the all in one WTP install it works for me too, using Sun 32bit 1.5.0_08 JVM, a clean -configuration, a clean -data (workspace) and no extra plugins installed except ATF.\n\nThis is the first time I have seen ATF working :)\n\nI am about to wind versions forward one thing at a time to see what causes the problem for me.",
    "I thought when I tried ATF on a different Linux machine I was able to reproduce the problem, but I forgot to restart eclipse with using the -clean flag ( i.e. eclipse -clean ). When I did that the problem went away. We will also look at adding in the other features in Callisto and see if we run into problems.\n",
    "Just in case you didn\u0027t noticed in the instructions, Eclipse has to be restarted with the -clean option after ATF is installed. Since you stated that you were able to get it to run, I expect that you restarted eclipse with the -clean option. I just thought I mention it just to make sure.\n",
    "Just to confirm I have been using -clean (almost always during this testing).  I think this makes OSGi rebuild its configuration.\n\nWith a brand new install of 64bit Eclipse+WTP, in a empty/clean -configuration space, in a empty/clean -data workspace.  I get the new user help screen on bootup, I can clear that and to go install ATF from Local Archive/Local Site.\n\nAfter that ATF install, eclipse is then restarted and at this point on 32bit I have ATF working.  On 64bit I have some new error which I\u0027ve added to a recent newsgroup posting under \"Linux AMD64/64bit with ATF not working, possible solution included\", the newsgroup is probably better at getting to the bottom of the situation outlined in the posting.\n\nI shall continue today to wind forward my configuration and plugin versions (now I have a starting point that works for me).",
    "I have clean room procedure:\n\n* rm -rf /opt/eclipse\n* rm -rf /home/dlm/.eclipse/org.eclipse.platform_3.2.0/empty/\n* rm -rf /home/dlm/workspace_clean/\n* Setup ~/.gre.d/ based on if I am testing 32bit or 64bit runtime\n* Setup $JAVA_HOME (and other enviromment) for 32bit or 64bit runtime\n* cd /opt\n* UNZIP all the archives (Platform+WTF, not ATF)\n* /opt/eclipse/eclipse -clean -configuration file:///home/dlm/.eclipse/org.eclipse.platform_3.2.0/empty/ -debug /home/dlm/.options -data /home/dlm/workspace_clean \u003e/home/dlm/eclipse_runtime.log 2\u003e\u00261 \u0026\n* This will bootup eclipse to Welcome view, close the welcome view\n* Select Software Updates, configure New Archived Site, for ATF .zip\n* Install ATF\n\n\nI must have tried over 120 combinations of plugins trying to recreate the problem and find a pattern.  25% were 32bit based, 75% were 64bit based.  I tried doing Update Manager driven updates for TPTP, Birt and other items which I have installed to look for any contributing effects and found none.  I have upgraded base platform and WTP to recent development I-build and again ATF work with 32bit.\n\nIn not one case was I able recreate the OSGi error message problem, about org.eclipse.swt.browser Require-Build being invalid.  The 32bit setups worked out of the box.  None of the 64bit setups worked at all (When I say they dont work, this always means In the Mozilla perspective, I press the open URL button, put in a url and get a Mozilla tab drawn, but the contents are transparent, i.e. no redraw is done inside the tab and none of the browser widgets appear).\n\nSo my conclusion is that there is a corruption in the configuration data that was causing org.eclipse.atf.mozilla.swt.browser to be rejected by OSGi and not able to get into \"RESOLVED\" state.\n\n\nSo I went back to trying to find a reason why 64bit doesn\u0027t work.\n\nI have checked into all sorts of other possibilities, like the fact that my Linux 64bit uses GCC4 and this stdc++.so.6 using a different ABI to applications complied with GCC3 (stdc++.so.5).  So I recompiled my xulrunner using (gcc32, g++32, which I have installed) and check everything is using/linked with GCC3 ABI.  This made no difference to the problem.\n\nI have chased down the erronous ClassNotFoundException\u0027s coming of OSGi when it tries to load classes in javaxpcom.jar.  But there is a specialist ClassLoader in url and the classes are really found, as the exception must have been generated inside OSGi resolution.  Maybe OSGi could be taught about this specilist classloader situationt hat ATF presents so the errors are quashed.\n\n\nI then looked at the output during startup of an ATF embeded browser tab.  I have found the point where the startup procedure changes between the working 32bit and the non-working 64bit.  However I do not know the code well enoough to be able to know where in the code to look, as the output comes in the form of OSGi class loading logging.\n\nThe change in behavor is just after org.mozilla.xpcom.nsIBaseWindow is loaded.\n\n\nThe Working 32bit does this:\n\nBundleLoader[org.mozilla.xpcom_1.8.0.4] found local class org.mozilla.xpcom.nsIWebBrowser\nBundleClassLoader[org.mozilla.xpcom_1.8.0.4].loadClass(org.mozilla.xpcom.nsIURIContentListener)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].loadBundleClass(org.mozilla.xpcom.nsIURIContentListener)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].findLocalClass(org.mozilla.xpcom.nsIURIContentListener)\nBundleLoader[org.mozilla.xpcom_1.8.0.4] found local class org.mozilla.xpcom.nsIURIContentListener\nBundleClassLoader[org.mozilla.xpcom_1.8.0.4].loadClass(org.mozilla.xpcom.nsIWebBrowserChrome)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].loadBundleClass(org.mozilla.xpcom.nsIWebBrowserChrome)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].findLocalClass(org.mozilla.xpcom.nsIWebBrowserChrome)\nBundleLoader[org.mozilla.xpcom_1.8.0.4] found local class org.mozilla.xpcom.nsIWebBrowserChrome\nBundleClassLoader[org.eclipse.swt_3.2.1.v3235a].loadClass(org.mozilla.xpcom.nsIWebBrowser)\nBundleLoader[org.eclipse.swt_3.2.1.v3235a].loadBundleClass(org.mozilla.xpcom.nsIWebBrowser)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].findLocalClass(org.mozilla.xpcom.nsIWebBrowser)\nBundleLoader[org.mozilla.xpcom_1.8.0.4] found local class org.mozilla.xpcom.nsIWebBrowser\nBundleClassLoader[org.mozilla.xpcom_1.8.0.4].loadClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].loadBundleClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].findLocalClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleClassLoader[org.mozilla.xpcom_1.8.0.4].findClass(org.mozilla.xpcom.nsIBaseWindow)\n  about to read 980 bytes from org/mozilla/xpcom/nsIBaseWindow.class\n  read 980 bytes from org/mozilla/xpcom/nsIBaseWindow.class\n  defining class org.mozilla.xpcom.nsIBaseWindow\nBundleLoader[org.mozilla.xpcom_1.8.0.4] found local class org.mozilla.xpcom.nsIBaseWindow\nBundleClassLoader[org.eclipse.swt_3.2.1.v3235a].loadClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleLoader[org.eclipse.swt_3.2.1.v3235a].loadBundleClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].findLocalClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleLoader[org.mozilla.xpcom_1.8.0.4] found local class org.mozilla.xpcom.nsIBaseWindow\nBundleClassLoader[org.mozilla.xpcom_1.8.0.4].loadClass(java.util.ArrayList)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].loadBundleClass(java.util.ArrayList)\nBundleClassLoader[org.eclipse.swt_3.2.1.v3235a].loadClass(org.eclipse.swt.browser.AbstractMozillaBrowser$1)\nBundleLoader[org.eclipse.swt_3.2.1.v3235a].loadBundleClass(org.eclipse.swt.browser.AbstractMozillaBrowser$1)\nBundleLoader[org.eclipse.swt_3.2.1.v3235a].findLocalClass(org.eclipse.swt.browser.AbstractMozillaBrowser$1)\nBundleClassLoader[org.eclipse.swt_3.2.1.v3235a].findClass(org.eclipse.swt.browser.AbstractMozillaBrowser$1)\nBundleClassLoader[org.eclipse.swt_3.2.1.v3235a].findClass(org.eclipse.swt.browser.AbstractMozillaBrowser$1)\n  about to read 1284 bytes from org/eclipse/swt/browser/AbstractMozillaBrowser$1.class\n  read 1284 bytes from org/eclipse/swt/browser/AbstractMozillaBrowser$1.class\n  defining class org.eclipse.swt.browser.AbstractMozillaBrowser$1\n\n\n\nThe Non-working 64bit does this:\n\nBundleLoader[org.mozilla.xpcom_1.8.0.4] found local class org.mozilla.xpcom.nsIWebBrowser\nBundleClassLoader[org.mozilla.xpcom_1.8.0.4].loadClass(org.mozilla.xpcom.nsIURIContentListener)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].loadBundleClass(org.mozilla.xpcom.nsIURIContentListener)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].findLocalClass(org.mozilla.xpcom.nsIURIContentListener)\nBundleLoader[org.mozilla.xpcom_1.8.0.4] found local class org.mozilla.xpcom.nsIURIContentListener\nBundleClassLoader[org.mozilla.xpcom_1.8.0.4].loadClass(org.mozilla.xpcom.nsIWebBrowserChrome)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].loadBundleClass(org.mozilla.xpcom.nsIWebBrowserChrome)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].findLocalClass(org.mozilla.xpcom.nsIWebBrowserChrome)\nBundleLoader[org.mozilla.xpcom_1.8.0.4] found local class org.mozilla.xpcom.nsIWebBrowserChrome\nBundleClassLoader[org.eclipse.swt_3.2.0.v3232o].loadClass(org.mozilla.xpcom.nsIWebBrowser)\nBundleLoader[org.eclipse.swt_3.2.0.v3232o].loadBundleClass(org.mozilla.xpcom.nsIWebBrowser)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].findLocalClass(org.mozilla.xpcom.nsIWebBrowser)\nBundleLoader[org.mozilla.xpcom_1.8.0.4] found local class org.mozilla.xpcom.nsIWebBrowser\nBundleClassLoader[org.mozilla.xpcom_1.8.0.4].loadClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].loadBundleClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].findLocalClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleClassLoader[org.mozilla.xpcom_1.8.0.4].findClass(org.mozilla.xpcom.nsIBaseWindow)\n  about to read 980 bytes from org/mozilla/xpcom/nsIBaseWindow.class\n  read 980 bytes from org/mozilla/xpcom/nsIBaseWindow.class\n  defining class org.mozilla.xpcom.nsIBaseWindow\nBundleLoader[org.mozilla.xpcom_1.8.0.4] found local class org.mozilla.xpcom.nsIBaseWindow\nBundleClassLoader[org.eclipse.swt_3.2.0.v3232o].loadClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleLoader[org.eclipse.swt_3.2.0.v3232o].loadBundleClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].findLocalClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleLoader[org.mozilla.xpcom_1.8.0.4] found local class org.mozilla.xpcom.nsIBaseWindow\n***** CHANGES FROM HERE, WE EXPECT TO LOAD org.eclipse.swt.browser.AbstractMozillaBrowser$1 AT THIS POINT, BUT WE DONT *****\nBundleClassLoader[org.eclipse.core.runtime_3.2.0.v20060603].loadClass(org.eclipse.core.internal.runtime.Log)\nBundleLoader[org.eclipse.core.runtime_3.2.0.v20060603].loadBundleClass(org.eclipse.core.internal.runtime.Log)\nBundleLoader[org.eclipse.equinox.common_3.2.0.v20060603].findLocalClass(org.eclipse.core.internal.runtime.Log)\nBundleClassLoader[org.eclipse.equinox.common_3.2.0.v20060603].findClass(org.eclipse.core.internal.runtime.Log)\nBundleLoader[org.eclipse.core.runtime_3.2.0.v20060603].findLocalClass(org.eclipse.core.internal.runtime.Log)\nBundleClassLoader[org.eclipse.core.runtime_3.2.0.v20060603].findClass(org.eclipse.core.internal.runtime.Log)\n  about to read 2161 bytes from org/eclipse/core/internal/runtime/Log.class\n  read 2161 bytes from org/eclipse/core/internal/runtime/Log.class\n  defining class org.eclipse.core.internal.runtime.Log\n",
    "Shortly after posting the last comment I was able to get a new error in ~dlm/workspace_clean64/.metadata/.log:\n\n!ENTRY org.eclipse.ui 4 4 2006-09-22 17:44:17.090\n!MESSAGE Unhandled event loop exception\n\n!ENTRY org.eclipse.ui 4 0 2006-09-22 17:44:17.091\n!MESSAGE handle\n!STACK 0\njava.lang.NoSuchFieldError: handle\n        at org.eclipse.swt.browser.MozillaBrowser.getHandle(MozillaBrowser.java:16)\n        at org.eclipse.swt.browser.AbstractMozillaBrowser.\u003cinit\u003e(AbstractMozillaBrowser.java:232)\n        at org.eclipse.swt.browser.MozillaBrowser.\u003cinit\u003e(MozillaBrowser.java:12)\n        at org.eclipse.atf.mozilla.ide.ui.browser.MozBrowserEditor.createPartControl(MozBrowserEditor.java:245)\n        at org.eclipse.ui.internal.EditorReference.createPartHelper(EditorReference.java:596)\n        at org.eclipse.ui.internal.EditorReference.createPart(EditorReference.java:372)\n        at org.eclipse.ui.internal.WorkbenchPartReference.getPart(WorkbenchPartReference.java:566)\n\n\n\nSo I got to work on this and found in eclipse_cvs/atf/components/plugins/org.eclipse.atf.mozilla.swt.browser/gtk_linux_src/org/eclipse/swt/browser/MozillaBrowser.java at line 32:\n  OS.gtk_container_add(handle, embedHandle);\n\naccesses a field called \"handle\".  I sound that was an inheritied field from class o.e.swt.widget.Widget, MozillaBrowser -\u003e AbstractMozillaBrowser -\u003e Composite -\u003e Scrollable -\u003e Control -\u003e Widget (has \"public int /*long*/ handle\")\n\nSo I decompiled (with javap) the SWT Widget.class for the 32bit and 64bit builds of SWT and found:\n\n32bit SWT: public abstract class org.eclipse.swt.widgets.Widget extends java.lang.Object{ public int handle; ...}\n\n64bit SWT: public abstract class org.eclipse.swt.widgets.Widget extends java.lang.Object{ public long handle; ...}\n\nSo therefore a field lookup for a field called \"handle\" of int type, will throw a NoSuchFieldError on 64bit and this is the cause of the current problem.\n\n\nI think I have an idea to be able to have one common build for linux/win32 on 32 and 64bit, so the ATF download page just has a single thing to download.  I also think that the build server on any platform can be used to build that common distribution, so long as it has a copy of the relevent JARs for each of the platforms available in the compilation classpath.\n\nSo in the comming days I shall try to attach a patch or zip for the org.eclipse.atf.mozilla.swt.browser to rework the build process and demonstrate that it is possible to build it from any host platform for all targets (because there is no Native code in use).\n\n\n\nJust for reference I am now getting past that stage of bootup but getting a JVM crash, so some progress is being made:\n\nBundleClassLoader[org.mozilla.xpcom_1.8.0.4].loadClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].loadBundleClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].findLocalClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleClassLoader[org.mozilla.xpcom_1.8.0.4].findClass(org.mozilla.xpcom.nsIBaseWindow)\n  about to read 980 bytes from org/mozilla/xpcom/nsIBaseWindow.class\n  read 980 bytes from org/mozilla/xpcom/nsIBaseWindow.class\n  defining class org.mozilla.xpcom.nsIBaseWindow\nBundleLoader[org.mozilla.xpcom_1.8.0.4] found local class org.mozilla.xpcom.nsIBaseWindow\nBundleClassLoader[org.eclipse.swt_3.2.1.v3235a].loadClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleLoader[org.eclipse.swt_3.2.1.v3235a].loadBundleClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].findLocalClass(org.mozilla.xpcom.nsIBaseWindow)\nBundleLoader[org.mozilla.xpcom_1.8.0.4] found local class org.mozilla.xpcom.nsIBaseWindow\n[ *** THIS IS THE POINT WE GOT TO BEFORE *** NOW WE GET THE NEXT 2 LINE LIKE THE 32BIT GOOD STARTUP, THEN THE CRASH ]\nBundleClassLoader[org.mozilla.xpcom_1.8.0.4].loadClass(java.util.ArrayList)\nBundleLoader[org.mozilla.xpcom_1.8.0.4].loadBundleClass(java.util.ArrayList)\n#\n# An unexpected error has been detected by HotSpot Virtual Machine:\n#\n#  SIGSEGV (0xb) at pc\u003d0x00002aaac5b9abf0, pid\u003d14726, tid\u003d47829001240512\n#\n# Java VM: Java HotSpot(TM) 64-Bit Server VM (1.5.0_08-b03 mixed mode)\n# Problematic frame:\n# C  [libxul.so+0xbbbbf0]\n#\n# An error report file with more information is saved as hs_err_pid14726.log\n#\n# If you would like to submit a bug report, please visit:\n#   http://java.sun.com/webapps/bugreport/crash.jsp\n#\nType Manifest File: /data/src/xulrunner_1.8.0.4/dist/bin/components/xpti.dat\n************************************************************\n* Call to xpconnect wrapped JSObject produced this error:  *\n[Exception... \"Component returned failure code: 0x80570016 (NS_ERROR_XPC_GS_RETURNED_FAILURE) [nsIJSCID.getService]\"  nsresult: \"0x80570016 (NS_ERROR_XPC_GS_RETURNED_FAILURE)\"  locati\non: \"JS frame :: file:///data/src/xulrunner_1.8.0.4/dist/bin/components/nsExtensionManager.js :: ExtensionManager :: line 2085\"  data: no]\n************************************************************\n************************************************************\n* Call to xpconnect wrapped JSObject produced this error:  *\n[Exception... \"Component returned failure code: 0x80570016 (NS_ERROR_XPC_GS_RETURNED_FAILURE) [nsIJSCID.getService]\"  nsresult: \"0x80570016 (NS_ERROR_XPC_GS_RETURNED_FAILURE)\"  locati\non: \"JS frame :: file:///data/src/xulrunner_1.8.0.4/dist/bin/components/nsUpdateService.js :: UpdateService :: line 812\"  data: no]\n************************************************************\nGFX: dpi\u003d96 t2p\u003d0.0666667 p2t\u003d15 depth\u003d24\n++WEBSHELL \u003d\u003d 1\n++DOMWINDOW \u003d\u003d 1\nStart VM: /opt/jdk1.5.0_08_x86_64/bin/java\n\n\n",
    "As dicussed on IRC, I think the right way could be to have a 64 bits fragment.... yet based on our chats and your logs, I think this is more an issue to have the gethandle return a long, in which case It may call for both a 64 fragment and bringing pieces of AbstractMozillaBrowser down in a platform fragment so we can get a long or an int for 64 or 32 bits.\nthe handle is NOT an SWT api, afaik.\n",
    "I am happy to report I have got ATF working on 64bit Linux today.  I think my remaining issue was related to GCC3/GCC4 ABI differences as my host builds for GCC4 by default.\n\nTo confirm what I have working:\n\n\nI built my own Xulrunner 1.8.1 using CSV tag MOZILLA_1_8_BRANCH.  Using the options \u0027CC\u003d\"gcc32\" CXX\u003d\"g++32\" make -f client.mk MOZ_CO_PROJECT\u003dxulrunner\u0027 this results in an ABI compatible version of xulrunner using GCC3/stdc++.so.5.\n\nI installed this weeks ATF atf-linux-sdk-0.1-20061004-2300.zip\n\nI build my own version of plugins/org.eclipse.atf.mozilla.swt.browser_1.0.1 which uses long return type for 64bit in AbstractMozillaBrowser and MozillaBrowser classes.\n\nThen I fired up Eclipse and I am able to browse :)  So from this standpoint I\u0027m happy to close this bug as the original goal has been achieved, that is to see ATF working on 64bit Linux.\n\nThere are followup items already being worked on to unify the download.\n\n\nNow I noticed in the CSS view the error \"Required Xulrunner classes not found. Full CSS tooling only supported with XULRunner version 1.8.1 or later\" so I track this down to lack of org.mozilla.xpcom.inIDOMUtils class in org.mozilla.xpcom_1.8.0.4 but it is in the MozillaInterfaces.jar of 1.8.1.\n\nSo I tried to build my own version of plugins/org.mozilla.xpcom_1.8.1 out of the 1.8.0.4 version with the MANIFEST updated and the JAR replace from my 1.8.1 xulrunner build.\n\n\nHowever now I get this error:\n\njava.lang.NoSuchMethodError: org.mozilla.xpcom.nsIAppShell.create([J[Ljava/lang/String;)V\n\n\nAnd looking at the java stub _javagen/default/org/mozilla/xpcom/nsIAppShell.java:\n\n  void create(int[] argc, String[] argv);\n\n\ndist/idl/nsIAppShell.idl:\n\n  void Create(inout int argc, inout string argv);\n\n\nNow in 1.8.0.4 the \"argc\" argument is of type \"long\" (if I decompile the .class file) which is what the \"J\" in \"([J[Ljava/lang/String;)V\".  The nsIAppShell.idl file on both version uses type \"int\".\n\nIt looks like the \"idl\" to java compiler fixed to use an int type when appropiate.\n\nWhen I fixed my customer build of org.eclipse.atf.mozilla.swt.browser to call with \"int []\" I can confirm ATF is working on 1.8.1 for 64bit Linux as well.",
    "(In reply to comment #17)\n\u003e I am happy to report I have got ATF working on 64bit Linux today.\n\nGreat.  Thanks for working on this.\n\n\u003e I build my own version of plugins/org.eclipse.atf.mozilla.swt.browser_1.0.1\n\u003e which uses long return type for 64bit in AbstractMozillaBrowser and\n\u003e MozillaBrowser classes.\n\nI assume you only had to change the methods dealing with the SWT \u0027handle\u0027, correct?  Could you attach a patch of the changes you made?\n\n\u003e Now I noticed in the CSS view the error \"Required Xulrunner classes not found.\n\u003e Full CSS tooling only supported with XULRunner version 1.8.1 or later\" so I\n\u003e track this down to lack of org.mozilla.xpcom.inIDOMUtils class in\n\u003e org.mozilla.xpcom_1.8.0.4 but it is in the MozillaInterfaces.jar of 1.8.1.\n\nThe 20061004 weekly build of ATF now points to org.mozilla.xpcom_1.8.0.90, which  is basically the 1.8.1 release (just didn\u0027t want to name it ..._1.8.1 since it is not final).  You can get it directly from ftp://ftp.mozilla.org/pub/mozilla.org/xulrunner/eclipse/plugins/org.mozilla.xpcom_1.8.0.90.jar.",
    "Created an attachment (id\u003d51693)\nAbstractMozillaBrowser.java.diff\n\n",
    "Created an attachment (id\u003d51694)\nMozillaBrowser.java.diff\n\n",
    "*** Bug 156517 has been marked as a duplicate of this bug. ***",
    "The latest weekly build (0.2.1-v200702271030) has Linux 64 bit platform specific fragment that has the SWT handle as a long instead of int."
  ],
  "commentCreationDates": [
    "2006-09-19T17:48:16+02:00",
    "2006-09-19T18:58:41+02:00",
    "2006-09-19T19:47:21+02:00",
    "2006-09-19T20:24:36+02:00",
    "2006-09-19T20:56:22+02:00",
    "2006-09-19T22:36:57+02:00",
    "2006-09-19T22:46:49+02:00",
    "2006-09-19T23:08:13+02:00",
    "2006-09-19T23:34:52+02:00",
    "2006-09-19T23:54:49+02:00",
    "2006-09-20T00:19:51+02:00",
    "2006-09-20T05:17:27+02:00",
    "2006-09-20T05:27:00+02:00",
    "2006-09-20T15:24:50+02:00",
    "2006-09-22T18:31:54+02:00",
    "2006-09-22T21:54:44+02:00",
    "2006-09-26T02:14:38+02:00",
    "2006-10-07T17:58:21+02:00",
    "2006-10-07T19:35:00+02:00",
    "2006-10-10T16:44:48+02:00",
    "2006-10-10T16:45:39+02:00",
    "2007-02-28T22:54:29+01:00",
    "2007-02-28T23:00:15+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ClassNotFoundException",
      "message": "org.eclipse.swt.browser.MozillaCloseWindowListener",
      "elements": [
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleLoader.findClass",
          "source": "BundleLoader.java:402"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleLoader.findClass",
          "source": "BundleLoader.java:347"
        },
        {
          "method": "org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.loadClass",
          "source": "DefaultClassLoader.java:83"
        },
        {
          "method": "java.lang.ClassLoader.loadClass",
          "source": "ClassLoader.java:251"
        },
        {
          "method": "java.lang.ClassLoader.loadClassInternal",
          "source": "ClassLoader.java:319"
        },
        {
          "method": "java.lang.Class.getDeclaredConstructors0",
          "source": "Native Method"
        },
        {
          "method": "java.lang.Class.privateGetDeclaredConstructors",
          "source": "Class.java:2357"
        },
        {
          "method": "java.lang.Class.getConstructor0",
          "source": "Class.java:2671"
        },
        {
          "method": "java.lang.Class.newInstance0",
          "source": "Class.java:321"
        },
        {
          "method": "java.lang.Class.newInstance",
          "source": "Class.java:303"
        },
        {
          "method": "org.eclipse.core.internal.registry.osgi.RegistryStrategyOSGI.createExecutableExtension",
          "source": "RegistryStrategyOSGI.java:157"
        }
      ],
      "number": 0,
      "commentIndex": 1,
      "bugId": "157852",
      "date": "2006-09-19T18:58:41+02:00",
      "product": "ATF",
      "component": "core",
      "severity": "critical"
    },
    {
      "exceptionType": "java.lang.NoSuchFieldError",
      "message": "handle",
      "elements": [
        {
          "method": "org.eclipse.swt.browser.MozillaBrowser.getHandle",
          "source": "MozillaBrowser.java:16"
        },
        {
          "method": "org.eclipse.swt.browser.AbstractMozillaBrowser.\u003cinit\u003e",
          "source": "AbstractMozillaBrowser.java:232"
        },
        {
          "method": "org.eclipse.swt.browser.MozillaBrowser.\u003cinit\u003e",
          "source": "MozillaBrowser.java:12"
        },
        {
          "method": "org.eclipse.atf.mozilla.ide.ui.browser.MozBrowserEditor.createPartControl",
          "source": "MozBrowserEditor.java:245"
        },
        {
          "method": "org.eclipse.ui.internal.EditorReference.createPartHelper",
          "source": "EditorReference.java:596"
        },
        {
          "method": "org.eclipse.ui.internal.EditorReference.createPart",
          "source": "EditorReference.java:372"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchPartReference.getPart",
          "source": "WorkbenchPartReference.java:566"
        }
      ],
      "number": 1,
      "commentIndex": 15,
      "bugId": "157852",
      "date": "2006-09-22T21:54:44+02:00",
      "product": "ATF",
      "component": "core",
      "severity": "critical"
    }
  ],
  "groupId": "157852",
  "bugId": "157852",
  "date": "2006-09-19T17:48:16+02:00",
  "product": "ATF",
  "component": "core",
  "severity": "critical"
}