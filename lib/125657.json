{
  "comments": [
    "From within Eclipse 3.0 (RAD 6.0.1) I get an error with the (partial) details listed below.  My aspect looks like this:\n\npublic aspect AAwtEventDispatcherThreadProtection\n{\n  pointcut awtComponentMethod(java.awt.Component component):\n    target(component) \u0026\u0026 call(* *.*(..));\n\n  before(java.awt.Component component): awtComponentMethod(component) {\n    if (!SwingUtilities.isEventDispatchThread() \u0026\u0026 component.isDisplayable())\n    {\n      System.err.println(\"AWT Component method called from another Thread than the AWT-EventDispatchThread! source: \" + \n                         thisJoinPoint.getSourceLocation() + \", target: \" + thisJoinPoint.toLongString());\n    }\n  }\n}\n\n----------------\nDETAILS (shortened because the size exceeded the 65k limit):\n\n\njava.lang.NullPointerException\nat \tat org.aspectj.weaver.bcel.BcelShadow.ensureTargetTypeIsCorrect(BcelShadow.java:1313)\nat \tat org.aspectj.weaver.bcel.BcelShadow.initializeTargetVar(BcelShadow.java:1274)\nat \tat org.aspectj.weaver.bcel.BcelShadow.getTargetVar(BcelShadow.java:968)\nat \tat org.aspectj.weaver.patterns.ThisOrTargetPointcut.findResidueInternal(ThisOrTargetPointcut.java:185)\nat \tat org.aspectj.weaver.patterns.Pointcut.findResidue(Pointcut.java:268)\nat \tat org.aspectj.weaver.patterns.AndPointcut.findResidueInternal(AndPointcut.java:97)\nat \tat org.aspectj.weaver.patterns.Pointcut.findResidue(Pointcut.java:268)\nat \tat org.aspectj.weaver.patterns.AndPointcut.findResidueInternal(AndPointcut.java:97)\nat \tat org.aspectj.weaver.patterns.Pointcut.findResidue(Pointcut.java:268)\nat \tat org.aspectj.weaver.bcel.BcelAdvice.specializeOn(BcelAdvice.java:132)\nat \tat org.aspectj.weaver.bcel.BcelShadow.prepareForMungers(BcelShadow.java:313)\nat \tat org.aspectj.weaver.Shadow.implement(Shadow.java:404)\nat \tat org.aspectj.weaver.bcel.BcelClassWeaver.implement(BcelClassWeaver.java:2146)\nat \tat org.aspectj.weaver.bcel.BcelClassWeaver.weave(BcelClassWeaver.java:467)\nat \tat org.aspectj.weaver.bcel.BcelClassWeaver.weave(BcelClassWeaver.java:102)\nat \tat org.aspectj.weaver.bcel.BcelWeaver.weave(BcelWeaver.java:1543)\nat \tat org.aspectj.weaver.bcel.BcelWeaver.weaveWithoutDump(BcelWeaver.java:1494)\nat \tat org.aspectj.weaver.bcel.BcelWeaver.weaveAndNotify(BcelWeaver.java:1275)\nat \tat org.aspectj.weaver.bcel.BcelWeaver.weave(BcelWeaver.java:1097)\nat \tat org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.weave(AjCompilerAdapter.java:300)\nat \tat org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.afterCompiling(AjCompilerAdapter.java:178)\nat \tat org.aspectj.ajdt.internal.compiler.CompilerAdapter.ajc$afterReturning$org_aspectj_ajdt_internal_compiler_CompilerAdapter$2$f9cc9ca0(CompilerAdapter.aj:70)\nat \tat org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile(Compiler.java:367)\nat \tat org.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilation(AjBuildManager.java:811)\nat \tat org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild(AjBuildManager.java:230)\nat \tat org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild(AjBuildManager.java:156)\nat \tat org.aspectj.ajde.internal.CompilerAdapter.compile(CompilerAdapter.java:122)\nat \tat org.aspectj.ajde.internal.AspectJBuildManager$CompilerThread.run(AspectJBuildManager.java:191)\n\ntrouble in: \npublic class com.sun.imageio.plugins.gif.GIFImageMetadata extends javax.imageio.metadata.IIOMetadata:",
    "Created an attachment (id\u003d33769)\nComplete details from AJDT dialog\n\n",
    "Relevant section from the attached log concerns clone():\n\u003d\u003d\u003d\nwhen implementing on shadow method-call(java.lang.Object java.lang.Object.clone())\nwhen weaving type com.sun.imageio.plugins.gif.GIFImageMetadata\n\u003d\u003d\u003d\n\nThe code in BcelShadow has changed since 1.5.0 shipped and now the relevant line is probably 1360 to do with determining the type for a clone call that is probably on an array.  A possible workaround is to extend your point to ignore clone:\n\n  pointcut awtComponentMethod(java.awt.Component component):\n    target(component) \u0026\u0026 call(* *.*(..)) \u0026\u0026 !call(* clone(..));\n\nI can put a guard in to prevent us NPEing - but it may just cause us to fail later.  It appears to NPE when the local variable table info for a method is missing so we can\u0027t determine the type for an array clone call.  So, this class: GIFImageMetadata, is probably missing local variable info (debug info) - I guess you are just using this class from some jar?\n\nI\u0027ll commit the change to avoid the NPE.\n",
    "Thanks for the quick response.\nThe class is from the graphics.jar in a version of JRE 1.4.2 from IBM.\nHowever, after applying your suggestion to my pointcut I got a new bug: Bug 125670.",
    "Helen - is this resolved now?",
    "I\u0027ve just retested this with the aspectj 1.5.1a, and although the originally reported NPE is no longer happening, I am now seeing the following BCException (note this is only when using the originally posted aspect that doesn\u0027t exclude clone() as suggested in comment #2):\n\n\norg.aspectj.weaver.BCException\nat org.aspectj.weaver.bcel.BcelShadow.ensureTargetTypeIsCorrect(BcelShadow.java:1397)\nat org.aspectj.weaver.bcel.BcelShadow.initializeTargetVar(BcelShadow.java:1334)\nat org.aspectj.weaver.bcel.BcelShadow.getTargetVar(BcelShadow.java:1026)\nat org.aspectj.weaver.patterns.ThisOrTargetPointcut.findResidueInternal(ThisOrTargetPointcut.java:192)\nat org.aspectj.weaver.patterns.Pointcut.findResidue(Pointcut.java:267)\nat org.aspectj.weaver.patterns.AndPointcut.findResidueInternal(AndPointcut.java:93)\nat org.aspectj.weaver.patterns.Pointcut.findResidue(Pointcut.java:267)\nat org.aspectj.weaver.patterns.AndPointcut.findResidueInternal(AndPointcut.java:93)\nat org.aspectj.weaver.patterns.Pointcut.findResidue(Pointcut.java:267)\nat org.aspectj.weaver.bcel.BcelAdvice.specializeOn(BcelAdvice.java:132)\nat org.aspectj.weaver.bcel.BcelShadow.prepareForMungers(BcelShadow.java:325)\nat org.aspectj.weaver.Shadow.implement(Shadow.java:455)\nat org.aspectj.weaver.bcel.BcelClassWeaver.implement(BcelClassWeaver.java:2236)\nat org.aspectj.weaver.bcel.BcelClassWeaver.weave(BcelClassWeaver.java:491)\nat org.aspectj.weaver.bcel.BcelClassWeaver.weave(BcelClassWeaver.java:109)\nat org.aspectj.weaver.bcel.BcelWeaver.weave(BcelWeaver.java:1560)\nat org.aspectj.weaver.bcel.BcelWeaver.weaveWithoutDump(BcelWeaver.java:1511)\nat org.aspectj.weaver.bcel.BcelWeaver.weaveAndNotify(BcelWeaver.java:1291)\nat org.aspectj.weaver.bcel.BcelWeaver.weave(BcelWeaver.java:1113)\nat org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.weave(AjCompilerAdapter.java:311)\nat org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.afterCompiling(AjCompilerAdapter.java:183)\nat org.aspectj.ajdt.internal.compiler.CompilerAdapter.ajc$afterReturning$org_aspectj_ajdt_internal_compiler_CompilerAdapter$2$f9cc9ca0(CompilerAdapter.aj:70)\nat org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile(Compiler.java:367)\nat org.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilation(AjBuildManager.java:862)\nat org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild(AjBuildManager.java:242)\nat org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild(AjBuildManager.java:161)\nat org.aspectj.ajde.internal.CompilerAdapter.compile(CompilerAdapter.java:122)\nat org.aspectj.ajde.internal.AspectJBuildManager$CompilerThread.run(AspectJBuildManager.java:191)\n\n",
    "Created an attachment (id\u003d38398)\nFile containing full exception dump\n\n",
    "Closing this bug as WONTFIX since the BCException is a limitation to do with the clone method and not being able to work out who clone was called on. A valid workaround is to exclude clone within the pointcut as suggested in comment #2."
  ],
  "commentCreationDates": [
    "2006-01-29T23:45:17+01:00",
    "2006-01-29T23:47:51+01:00",
    "2006-01-30T07:46:53+01:00",
    "2006-01-30T08:15:05+01:00",
    "2006-04-04T20:25:06+02:00",
    "2006-04-12T15:17:23+02:00",
    "2006-04-12T15:18:32+02:00",
    "2006-04-12T15:26:51+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.aspectj.weaver.BCException",
      "elements": [
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.ensureTargetTypeIsCorrect",
          "source": "BcelShadow.java:1397"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.initializeTargetVar",
          "source": "BcelShadow.java:1334"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.getTargetVar",
          "source": "BcelShadow.java:1026"
        },
        {
          "method": "org.aspectj.weaver.patterns.ThisOrTargetPointcut.findResidueInternal",
          "source": "ThisOrTargetPointcut.java:192"
        },
        {
          "method": "org.aspectj.weaver.patterns.Pointcut.findResidue",
          "source": "Pointcut.java:267"
        },
        {
          "method": "org.aspectj.weaver.patterns.AndPointcut.findResidueInternal",
          "source": "AndPointcut.java:93"
        },
        {
          "method": "org.aspectj.weaver.patterns.Pointcut.findResidue",
          "source": "Pointcut.java:267"
        },
        {
          "method": "org.aspectj.weaver.patterns.AndPointcut.findResidueInternal",
          "source": "AndPointcut.java:93"
        },
        {
          "method": "org.aspectj.weaver.patterns.Pointcut.findResidue",
          "source": "Pointcut.java:267"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelAdvice.specializeOn",
          "source": "BcelAdvice.java:132"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.prepareForMungers",
          "source": "BcelShadow.java:325"
        },
        {
          "method": "org.aspectj.weaver.Shadow.implement",
          "source": "Shadow.java:455"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelClassWeaver.implement",
          "source": "BcelClassWeaver.java:2236"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelClassWeaver.weave",
          "source": "BcelClassWeaver.java:491"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelClassWeaver.weave",
          "source": "BcelClassWeaver.java:109"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.weave",
          "source": "BcelWeaver.java:1560"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.weaveWithoutDump",
          "source": "BcelWeaver.java:1511"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.weaveAndNotify",
          "source": "BcelWeaver.java:1291"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.weave",
          "source": "BcelWeaver.java:1113"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.weave",
          "source": "AjCompilerAdapter.java:311"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.afterCompiling",
          "source": "AjCompilerAdapter.java:183"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.CompilerAdapter.ajc$afterReturning$org_aspectj_ajdt_internal_compiler_CompilerAdapter$2$f9cc9ca0",
          "source": "CompilerAdapter.aj:70"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile",
          "source": "Compiler.java:367"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilation",
          "source": "AjBuildManager.java:862"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild",
          "source": "AjBuildManager.java:242"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild",
          "source": "AjBuildManager.java:161"
        },
        {
          "method": "org.aspectj.ajde.internal.CompilerAdapter.compile",
          "source": "CompilerAdapter.java:122"
        },
        {
          "method": "org.aspectj.ajde.internal.AspectJBuildManager$CompilerThread.run",
          "source": "AspectJBuildManager.java:191"
        }
      ],
      "number": 0,
      "commentIndex": 5,
      "bugId": "125657",
      "date": "2006-04-12T15:17:23+02:00",
      "product": "AspectJ",
      "component": "LTWeaving",
      "severity": "normal"
    }
  ],
  "groupId": "125657",
  "bugId": "125657",
  "date": "2006-01-29T23:45:17+01:00",
  "product": "AspectJ",
  "component": "LTWeaving",
  "severity": "normal"
}