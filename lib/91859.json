{
  "comments": [
    "Using the attached example project, I added some comments to Aspect.aj and \nsaved and got the following NPE:\n\njava.lang.NullPointerException\n\tat \norg.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.doDeclareAnnotati\nons(AjLookupEnvironment.java:555)\n\tat \norg.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.weaveInterTypeDec\nlarations(AjLookupEnvironment.java:410)\n\tat \norg.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.weaveInterTypeDec\nlarations(AjLookupEnvironment.java:334)\n\tat \norg.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.doPendingWeaves\n(AjLookupEnvironment.java:227)\n\tat \norg.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.completeTypeBindi\nngs(AjLookupEnvironment.java:132)\n\tat \norg.aspectj.org.eclipse.jdt.internal.compiler.Compiler.beginToCompile\n(Compiler.java:331)\n\tat org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile\n(Compiler.java:348)\n\tat \norg.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilation\n(AjBuildManager.java:683)\n\tat org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild\n(AjBuildManager.java:191)\n\tat \norg.aspectj.ajdt.internal.core.builder.AjBuildManager.incrementalBuild\n(AjBuildManager.java:109)\n\tat org.aspectj.ajde.internal.CompilerAdapter.compile\n(CompilerAdapter.java:117)\n\tat org.aspectj.ajde.internal.AspectJBuildManager$CompilerThread.run\n(AspectJBuildManager.java:165)\n\nI also got another NPE when I added some whitespace to MainClass.aj and saved \nit:\n\njava.lang.NullPointerException\n\tat \norg.aspectj.org.eclipse.jdt.internal.compiler.lookup.MethodBinding.getAnnotatio\nnTagBits(MethodBinding.java:410)\n\tat \norg.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.doDeclareAnnotati\nons(AjLookupEnvironment.java:549)\n\tat \norg.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.weaveInterTypeDec\nlarations(AjLookupEnvironment.java:410)\n\tat \norg.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.weaveInterTypeDec\nlarations(AjLookupEnvironment.java:494)\n\tat \norg.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.weaveIntertypes\n(AjLookupEnvironment.java:220)\n\tat \norg.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.completeTypeBindi\nngs(AjLookupEnvironment.java:162)\n\tat \norg.aspectj.org.eclipse.jdt.internal.compiler.Compiler.beginToCompile\n(Compiler.java:331)\n\tat org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile\n(Compiler.java:348)\n\tat \norg.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilation\n(AjBuildManager.java:683)\n\tat org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild\n(AjBuildManager.java:191)\n\tat \norg.aspectj.ajdt.internal.core.builder.AjBuildManager.incrementalBuild\n(AjBuildManager.java:109)\n\tat org.aspectj.ajde.internal.CompilerAdapter.compile\n(CompilerAdapter.java:117)\n\tat org.aspectj.ajde.internal.AspectJBuildManager$CompilerThread.run\n(AspectJBuildManager.java:165)",
    "Created an attachment (id\u003d20041)\nTest project\n",
    "The failing line is: \n\nAnnotation currentAnnotations[] \u003d sourceType.scope.referenceContext.annotations;\n\nan awful lot of options for things that could be null.\n\nThe file has changed recently and now the line number it would fail at is 587.\n\nI\u0027m having trouble putting the test case into the multiIncremental harness - not\nsure why but when built from the harness i get a problem where the annotation on\nthe ajc$declare member representing the first declare @type cannot be found. \nWhen built from command line the annotation is found no problem...\n\nnot generics related so scheduling post M3",
    "I *think* the fix for bug 85132 will also fix this one.  In that bug the problem\nwas that a change in the type hierarchy was never undone before the next\nincremental build.  The only other change that could occur to a type that wasnt\nbeing undone correctly was an annotation change - so at the same time as undoing\nthe type hierarchy change I undo the annotation change.  I don\u0027t suppose there\nis any way you still have this project around Sian - so we can test the fix?\n(the attached project doesnt seem to fail for me...)",
    "After a chat with Sian, the first problem reported here has gone.  But there is\na new problem to do with modifying an aspect containing a declare @type - on the\nincremental compile that occurs when you save the modification you fail to see a\ngutter annotation going out from the declare @type.  I\u0027m going to try adding a\ntestcase for this to our incremental suite in AJ and see if I can recreate it\nthere...",
    "this is a horrible bug - i know exactly why it happens but its just a pain in\nthe backside to fix.  The problem is that declare @type is done up front (has to\nbe) in the compile stage - this means the classfile produced by the compiler has\nthe annotations against the type.  Therefore when the weaver tries to apply\ndeclare @type again, the annotation is already there and so it does nothing.\n\nthe fix is to make sure the class file coming out of the compiler does *not*\nhave the annotation on it if it was declared upon it.  that way the weaver can\nalways do its job.\n\nits exactly the same problem we had for declare parents...",
    "I\u0027ve fixed this.  I enabled TypeDeclarations in the compiler to remember what\nannotations they were originally declared with - this means declare @type\nstatements may change the set when completing type bindings, but when the class\nis \u0027output\u0027 from the compile stage it is only tagged with the annotations it was\ndeclared with.  This allows the weaver to do its job and correctly report weave\ninfo and relationships for declare @types.\n\nIf we ever do declare @method/field/ctor during compilation then we\u0027ll need a\nsimilar fix for those.\n\nfix checked in, waiting on build.",
    "build available."
  ],
  "commentCreationDates": [
    "2005-04-19T11:49:10+02:00",
    "2005-04-19T11:51:34+02:00",
    "2005-06-13T14:50:27+02:00",
    "2005-10-06T16:50:35+02:00",
    "2005-10-07T09:46:50+02:00",
    "2005-11-09T09:07:16+01:00",
    "2005-11-09T17:09:12+01:00",
    "2005-11-10T08:04:23+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.doDeclareAnnotations",
          "source": "AjLookupEnvironment.java:555"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.weaveInterTypeDeclarations",
          "source": "AjLookupEnvironment.java:410"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.weaveInterTypeDeclarations",
          "source": "AjLookupEnvironment.java:334"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.doPendingWeaves",
          "source": "AjLookupEnvironment.java:227"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.completeTypeBindings",
          "source": "AjLookupEnvironment.java:132"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.beginToCompile",
          "source": "Compiler.java:331"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile",
          "source": "Compiler.java:348"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilation",
          "source": "AjBuildManager.java:683"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild",
          "source": "AjBuildManager.java:191"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.incrementalBuild",
          "source": "AjBuildManager.java:109"
        },
        {
          "method": "org.aspectj.ajde.internal.CompilerAdapter.compile",
          "source": "CompilerAdapter.java:117"
        },
        {
          "method": "org.aspectj.ajde.internal.AspectJBuildManager$CompilerThread.run",
          "source": "AspectJBuildManager.java:165"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "91859",
      "date": "2005-04-19T11:49:10+02:00",
      "product": "AspectJ",
      "component": "Compiler",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.lookup.MethodBinding.getAnnotationTagBits",
          "source": "MethodBinding.java:410"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.doDeclareAnnotations",
          "source": "AjLookupEnvironment.java:549"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.weaveInterTypeDeclarations",
          "source": "AjLookupEnvironment.java:410"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.weaveInterTypeDeclarations",
          "source": "AjLookupEnvironment.java:494"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.weaveIntertypes",
          "source": "AjLookupEnvironment.java:220"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.completeTypeBindings",
          "source": "AjLookupEnvironment.java:162"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.beginToCompile",
          "source": "Compiler.java:331"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile",
          "source": "Compiler.java:348"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilation",
          "source": "AjBuildManager.java:683"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild",
          "source": "AjBuildManager.java:191"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.incrementalBuild",
          "source": "AjBuildManager.java:109"
        },
        {
          "method": "org.aspectj.ajde.internal.CompilerAdapter.compile",
          "source": "CompilerAdapter.java:117"
        },
        {
          "method": "org.aspectj.ajde.internal.AspectJBuildManager$CompilerThread.run",
          "source": "AspectJBuildManager.java:165"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "91859",
      "date": "2005-04-19T11:49:10+02:00",
      "product": "AspectJ",
      "component": "Compiler",
      "severity": "normal"
    }
  ],
  "groupId": "91859",
  "bugId": "91859",
  "date": "2005-04-19T11:49:10+02:00",
  "product": "AspectJ",
  "component": "Compiler",
  "severity": "normal"
}