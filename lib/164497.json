{
  "comments": [
    "I20061108-1600\n\nI got an unexpected NPE while accessing a field of an enclosing instance from an inner type. This is either a compiler- or a VM-bug, since an NPE on a this.field access is not to be expected.\n\nSteps:\n- new workspace with target platform I20061108-1600\n- check out org.eclipse.jdt.junit, tag v20061107-0800\n- apply the patch I\u0027ll attach\n- debug as Eclipse Application.\n\nIn the runtime workbench:\n- paste this text into Package Explorer:\n\nimport junit.framework.TestCase;\npublic class Compar extends TestCase {\n\tpublic void test1() throws Exception {\n\t\tassertEquals(\"123\", \"153\");\n\t}\n}\n\n- use quick fix to add JUnit3 container\n- run as JUnit Test\n- in the JUnitView, click the \"Compare ...\" button in the middle toolbar\n\n\u003d\u003e The NPE below is thrown. I don\u0027t know how to fix this, and I think it is a bug that this.this$1.this$0 can be observed with a null value at this place.\n\n\njava.lang.NullPointerException\n\tat org.eclipse.jdt.internal.junit.ui.CompareResultDialog.access$0(CompareResultDialog.java:142)\n\tat org.eclipse.jdt.internal.junit.ui.CompareResultDialog$CompareResultViewerConfiguration$SimpleDamagerRepairer.createPresentation(CompareResultDialog.java:93)\n\tat org.eclipse.jface.text.presentation.PresentationReconciler.createPresentation(PresentationReconciler.java:453)\n\tat org.eclipse.jface.text.presentation.PresentationReconciler.processDamage(PresentationReconciler.java:565)\n\tat org.eclipse.jface.text.presentation.PresentationReconciler.access$3(PresentationReconciler.java:563)\n\tat org.eclipse.jface.text.presentation.PresentationReconciler$InternalListener.inputDocumentChanged(PresentationReconciler.java:119)\n\tat org.eclipse.jface.text.TextViewer.fireInputDocumentChanged(TextViewer.java:2649)\n\tat org.eclipse.jface.text.TextViewer.setDocument(TextViewer.java:2698)\n\tat org.eclipse.jface.text.source.SourceViewer.setDocument(SourceViewer.java:517)\n\tat org.eclipse.jface.text.source.SourceViewer.setDocument(SourceViewer.java:458)\n\tat org.eclipse.compare.contentmergeviewer.TextMergeViewer$ContributorInfo.updateViewerDocument(TextMergeViewer.java:525)\n\tat org.eclipse.compare.contentmergeviewer.TextMergeViewer$ContributorInfo.internalSetDocument(TextMergeViewer.java:477)\n\tat org.eclipse.compare.contentmergeviewer.TextMergeViewer$ContributorInfo.setDocument(TextMergeViewer.java:406)\n\tat org.eclipse.compare.contentmergeviewer.TextMergeViewer.updateContent(TextMergeViewer.java:2299)\n\tat org.eclipse.compare.contentmergeviewer.ContentMergeViewer.internalRefresh(ContentMergeViewer.java:701)\n\tat org.eclipse.compare.contentmergeviewer.ContentMergeViewer.inputChanged(ContentMergeViewer.java:603)\n\tat org.eclipse.jface.viewers.ContentViewer.setInput(ContentViewer.java:250)\n\tat org.eclipse.jdt.internal.junit.ui.CompareResultDialog.createPreviewer(CompareResultDialog.java:219)\n\tat org.eclipse.jdt.internal.junit.ui.CompareResultDialog.createDialogArea(CompareResultDialog.java:202)\n\tat org.eclipse.jface.dialogs.Dialog.createContents(Dialog.java:780)\n\tat org.eclipse.jface.window.Window.create(Window.java:426)\n\tat org.eclipse.jface.dialogs.Dialog.create(Dialog.java:1111)\n\tat org.eclipse.jdt.internal.junit.ui.CompareResultsAction.run(CompareResultsAction.java:40)\n\tat org.eclipse.jface.action.Action.runWithEvent(Action.java:499)\n\tat org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:539)\n\tat org.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:488)\n\tat org.eclipse.jface.action.ActionContributionItem$6.handleEvent(ActionContributionItem.java:441)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:927)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3463)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3077)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1924)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1888)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:419)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)\n\tat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:95)\n\tat org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:78)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:104)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:74)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:348)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:165)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:585)\n\tat org.eclipse.core.launcher.Main.invokeFramework(Main.java:341)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:285)\n\tat org.eclipse.core.launcher.Main.run(Main.java:987)\n\tat org.eclipse.core.launcher.Main.main(Main.java:962)",
    "Created an attachment (id\u003d53830)\npatch to reproduce\n\n",
    "I\u0027ll try to extract a compiler test.",
    "When the constructor:\nprivate CompareResultMergeViewer(Composite parent, int style, CompareConfiguration configuration) {\n     super(parent, style, configuration);\n}\nis called the this$0 is null.\nInside the super call, the method protected void configureTextViewer(TextViewer textViewer) is called. So when the CompareResultViewerConfiguration object is created this$0 is still null.\n\nWhen the code returns from the constructor, this$0 is initialized.\nWe might need to initialize this$0, before we call super. I\u0027ll continue to investigate.",
    "It seems that this is done only by javac \u003e\u003d 1.5. javac 1.4.2 behaves like we do (i.e. NPE).",
    "We have the right behavior. If target is \u003e\u003d 1.4, then this$0 is initialized before the super call. If target is \u003c 1.4 (and I guess you have target 1.2), then this$0 is initialized after the super call and you end up with the NPE.\nSo if you don\u0027t want to use your workaround, you should change your source/target levels.",
    "Added regression test org.eclipse.jdt.core.tests.compiler.regression.InnerEmulationTest#test130.\n\nClosing as INVALID.",
    "Thanks for the explanation. I guess I better don\u0027t use inner classes then, since I could not find this behavior spec\u0027d in the JLS.\n\nHere\u0027s a stripped-down example that shows the difference:\n\npublic class Try {\n\tpublic static void main(String[] args) {\n\t\tnew Try().new Inner();\n\t}\n\n\tint fField\u003d -1;\n\tclass Inner extends Super {\n\t\tpublic void access() {\n\t\t\tSystem.out.println(fField);\n\t\t}\n\t}\n}\n\nclass Super {\n\tpublic Super() {\n\t\taccess();\n\t}\n\tpublic void access() {\n\t\tSystem.out.println(\"Super#access()\");;\n\t}\n}",
    "I\u0027ll try to find the reference for this particular problem.\nThe solution is to use source 1.4 and target 1.4. JDT/UI has 1.4 as the execution environment. So you are fine to change the defaults.\n\nPhilippe, do you remember from where this is coming from?",
    "We do the right thing. Basically, the new codegen guarantees initialization of enclosing instance slot prior to invoking super constructor, which is intended in your case. However, this codegen is only allowed on 1.4VMs, since before that it would break bytecode verification. \n\nThis is a known language limitation for pre-1.4 targets.\n",
    "\u003e This is a known language limitation for pre-1.4 targets.\n\nHere\u0027s the Javac bug: http://bugs.sun.com/bugdatabase/view_bug.do?bug_id\u003d4030374\n"
  ],
  "commentCreationDates": [
    "2006-11-14T17:10:16+01:00",
    "2006-11-14T17:11:02+01:00",
    "2006-11-14T17:13:23+01:00",
    "2006-11-14T19:04:31+01:00",
    "2006-11-14T19:09:10+01:00",
    "2006-11-14T19:26:31+01:00",
    "2006-11-14T19:49:22+01:00",
    "2006-11-15T11:13:17+01:00",
    "2006-11-15T14:42:25+01:00",
    "2006-11-15T14:52:30+01:00",
    "2007-07-05T14:33:24+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.jdt.internal.junit.ui.CompareResultDialog.access$0",
          "source": "CompareResultDialog.java:142"
        },
        {
          "method": "org.eclipse.jdt.internal.junit.ui.CompareResultDialog$CompareResultViewerConfiguration$SimpleDamagerRepairer.createPresentation",
          "source": "CompareResultDialog.java:93"
        },
        {
          "method": "org.eclipse.jface.text.presentation.PresentationReconciler.createPresentation",
          "source": "PresentationReconciler.java:453"
        },
        {
          "method": "org.eclipse.jface.text.presentation.PresentationReconciler.processDamage",
          "source": "PresentationReconciler.java:565"
        },
        {
          "method": "org.eclipse.jface.text.presentation.PresentationReconciler.access$3",
          "source": "PresentationReconciler.java:563"
        },
        {
          "method": "org.eclipse.jface.text.presentation.PresentationReconciler$InternalListener.inputDocumentChanged",
          "source": "PresentationReconciler.java:119"
        },
        {
          "method": "org.eclipse.jface.text.TextViewer.fireInputDocumentChanged",
          "source": "TextViewer.java:2649"
        },
        {
          "method": "org.eclipse.jface.text.TextViewer.setDocument",
          "source": "TextViewer.java:2698"
        },
        {
          "method": "org.eclipse.jface.text.source.SourceViewer.setDocument",
          "source": "SourceViewer.java:517"
        },
        {
          "method": "org.eclipse.jface.text.source.SourceViewer.setDocument",
          "source": "SourceViewer.java:458"
        },
        {
          "method": "org.eclipse.compare.contentmergeviewer.TextMergeViewer$ContributorInfo.updateViewerDocument",
          "source": "TextMergeViewer.java:525"
        },
        {
          "method": "org.eclipse.compare.contentmergeviewer.TextMergeViewer$ContributorInfo.internalSetDocument",
          "source": "TextMergeViewer.java:477"
        },
        {
          "method": "org.eclipse.compare.contentmergeviewer.TextMergeViewer$ContributorInfo.setDocument",
          "source": "TextMergeViewer.java:406"
        },
        {
          "method": "org.eclipse.compare.contentmergeviewer.TextMergeViewer.updateContent",
          "source": "TextMergeViewer.java:2299"
        },
        {
          "method": "org.eclipse.compare.contentmergeviewer.ContentMergeViewer.internalRefresh",
          "source": "ContentMergeViewer.java:701"
        },
        {
          "method": "org.eclipse.compare.contentmergeviewer.ContentMergeViewer.inputChanged",
          "source": "ContentMergeViewer.java:603"
        },
        {
          "method": "org.eclipse.jface.viewers.ContentViewer.setInput",
          "source": "ContentViewer.java:250"
        },
        {
          "method": "org.eclipse.jdt.internal.junit.ui.CompareResultDialog.createPreviewer",
          "source": "CompareResultDialog.java:219"
        },
        {
          "method": "org.eclipse.jdt.internal.junit.ui.CompareResultDialog.createDialogArea",
          "source": "CompareResultDialog.java:202"
        },
        {
          "method": "org.eclipse.jface.dialogs.Dialog.createContents",
          "source": "Dialog.java:780"
        },
        {
          "method": "org.eclipse.jface.window.Window.create",
          "source": "Window.java:426"
        },
        {
          "method": "org.eclipse.jface.dialogs.Dialog.create",
          "source": "Dialog.java:1111"
        },
        {
          "method": "org.eclipse.jdt.internal.junit.ui.CompareResultsAction.run",
          "source": "CompareResultsAction.java:40"
        },
        {
          "method": "org.eclipse.jface.action.Action.runWithEvent",
          "source": "Action.java:499"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:539"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$2",
          "source": "ActionContributionItem.java:488"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$6.handleEvent",
          "source": "ActionContributionItem.java:441"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:927"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:3463"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:3077"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1924"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1888"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:419"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:95"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:78"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:104"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:74"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:348"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:165"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:585"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:341"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:285"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:987"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:962"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "164497",
      "date": "2006-11-14T17:10:16+01:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    }
  ],
  "groupId": "164497",
  "bugId": "164497",
  "date": "2006-11-14T17:10:16+01:00",
  "product": "JDT",
  "component": "Core",
  "severity": "normal"
}