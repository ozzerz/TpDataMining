{
  "comments": [
    "In AbstractWorkingSetManager#bundleChanged there is a call to \ngetDescriptorsForNamespace that passes the symbolic name of the changed \nbundle.  OSGi bundles are not required to have symbolic names, in which cash \nBundle#getSymbolicName() will return null.  This is causing an NPE in the call \nto getDescriptorsForNameSpace().  Here is the code:\n\npublic synchronized void bundleChanged(BundleEvent event) {\n\tif (event.getType() !\u003d BundleEvent.STARTED)\n\t\treturn;\n\tWorkingSetDescriptor[] descriptors\u003d WorkbenchPlugin.getDefault()\n       \t.getWorkingSetRegistry().getDescriptorsForNamespace(event.getBundle\n().getSymbolicName());\n\tfor (int i\u003d 0; i \u003c descriptors.length; i++) {\n\t\tWorkingSetDescriptor descriptor\u003d descriptors[i];\n\t\tList workingSets\u003d getWorkingSetsForId(descriptor.getId());\n\t\tif (workingSets.size() \u003d\u003d 0)\n\t\t\tcontinue;\n\t\tIWorkingSetUpdater updater\u003d getUpdater(descriptor);\n\t\tfor (Iterator iter\u003d workingSets.iterator(); iter.hasNext();) {\n\t\t\tIWorkingSet workingSet\u003d (IWorkingSet)iter.next();\n\t\t\tif (!updater.contains(workingSet))\n\t\t\t\tupdater.add(workingSet);\n\t\t}\n\t}\n}\n\nOne possible fix is the following (not tested):\n\npublic synchronized void bundleChanged(BundleEvent event) {\n\tif (event.getType() !\u003d BundleEvent.STARTED)\n\t\treturn;\n\u003e\u003e\tif (event.getBundle().getSymbolicName() \u003d\u003d null)\n\u003e\u003e\t\treturn;\n\tWorkingSetDescriptor[] descriptors\u003d WorkbenchPlugin.getDefault()\n       \t.getWorkingSetRegistry().getDescriptorsForNamespace(event.getBundle\n().getSymbolicName());\n\tfor (int i\u003d 0; i \u003c descriptors.length; i++) {\n\t\tWorkingSetDescriptor descriptor\u003d descriptors[i];\n\t\tList workingSets\u003d getWorkingSetsForId(descriptor.getId());\n\t\tif (workingSets.size() \u003d\u003d 0)\n\t\t\tcontinue;\n\t\tIWorkingSetUpdater updater\u003d getUpdater(descriptor);\n\t\tfor (Iterator iter\u003d workingSets.iterator(); iter.hasNext();) {\n\t\t\tIWorkingSet workingSet\u003d (IWorkingSet)iter.next();\n\t\t\tif (!updater.contains(workingSet))\n\t\t\t\tupdater.add(workingSet);\n\t\t}\n\t}\n}\n\nHere is the log entry with the NPE:\n!ENTRY org.eclipse.osgi 2004-12-03 09:46:13.245\n!MESSAGE An unexpected runtime error has occurred.\n!STACK 0\njava.lang.NullPointerException\n\tat \norg.eclipse.ui.internal.registry.WorkingSetRegistry.getDescriptorsForNamespace\n(WorkingSetRegistry.java:124)\n\tat org.eclipse.ui.internal.AbstractWorkingSetManager.bundleChanged\n(AbstractWorkingSetManager.java:462)\n\tat \norg.eclipse.osgi.framework.internal.core.BundleContextImpl.dispatchEvent\n(BundleContextImpl.java:1151)\n\tat org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent\n(EventManager.java:186)\n\tat org.eclipse.osgi.framework.eventmgr.EventThread.run\n(EventThread.java:104)",
    "Fix in HEAD.",
    "Verified in I20061031-0656"
  ],
  "commentCreationDates": [
    "2004-12-03T16:03:39+01:00",
    "2006-09-25T15:44:50+02:00",
    "2006-10-31T14:56:18+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.ui.internal.registry.WorkingSetRegistry.getDescriptorsForNamespace",
          "source": "WorkingSetRegistry.java:124"
        },
        {
          "method": "org.eclipse.ui.internal.AbstractWorkingSetManager.bundleChanged",
          "source": "AbstractWorkingSetManager.java:462"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl.dispatchEvent",
          "source": "BundleContextImpl.java:1151"
        },
        {
          "method": "org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent",
          "source": "EventManager.java:186"
        },
        {
          "method": "org.eclipse.osgi.framework.eventmgr.EventThread.run",
          "source": "EventThread.java:104"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "80116",
      "date": "2004-12-03T16:03:39+01:00",
      "product": "Platform",
      "component": "UI",
      "severity": "normal"
    }
  ],
  "groupId": "80116",
  "bugId": "80116",
  "date": "2004-12-03T16:03:39+01:00",
  "product": "Platform",
  "component": "UI",
  "severity": "normal"
}