{
  "comments": [
    "Build ID: I20070503-1400\n\nSteps To Reproduce:\n1. Profile StartStop by launching as an external java application\nand profiling for execution statistics (jdk 1.5+)\n2. detach from agent\n3. attach to agent\n\nresult is an error in the workbench:\n\n\"An unexpected error occurred while attempting to establish\na connection with the JVMTI agent.\"\n\ndetails:\njava.lang.NullPointerException\nnull\n\njava.lang.NullPointerException\n  at org.eclipse.tptp.platform.jvmti.client.internal.launcher.TIDelegateHelper.attachToAgent(TIDelegateHelper.java:574)\n  at org.eclipse.tptp.platform.jvmti.client.internal.launcher.TIDelegateHelper.attachToAgent(TIDelegateHelper.java:538)\n  at org.eclipse.tptp.platform.jvmti.client.internal.controlproviders.TIAgentControlProvider$TIAgentStateModifier.doAction(TIAgentControlProvider.java:321)\n  at org.eclipse.tptp.platform.jvmti.client.internal.controlproviders.TIAgentControlProvider$TIAgentStateModifier.performCollectiveAction(TIAgentControlProvider.java:271)\n  at org.eclipse.tptp.platform.jvmti.client.internal.controlproviders.TIAgentControlProvider$TIAgentStateModifier.attach(TIAgentControlProvider.java:221)\n  at org.eclipse.tptp.trace.ui.provisional.control.provider.AbstractAgentControlProvider$1$AttachControlItem.run(AbstractAgentControlProvider.java:108)\n  at org.eclipse.jface.action.Action.runWithEvent(Action.java:498)\n  at org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:545)\n  at org.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:490)\n  at org.eclipse.jface.action.ActionContributionItem$5.handleEvent(ActionContributionItem.java:402)\n  at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n  at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:938)\n  at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3673)\n  at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3284)\n  at org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:2365)\n  at org.eclipse.ui.internal.Workbench.runUI(Workbench.java:2329)\n  at org.eclipse.ui.internal.Workbench.access$4(Workbench.java:2204)\n  at org.eclipse.ui.internal.Workbench$4.run(Workbench.java:466)\n  at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:289)\n  at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:461)\n  at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)\n  at org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:106)\n  at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:153)\n  at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:106)\n  at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:76)\n  at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:363)\n  at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:176)\n  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)\n  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  at java.lang.reflect.Method.invoke(Method.java:615)\n  at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:497)\n  at org.eclipse.equinox.launcher.Main.basicRun(Main.java:436)\n  at org.eclipse.equinox.launcher.Main.run(Main.java:1162)\n  at org.eclipse.equinox.launcher.Main.main(Main.java:1137)\n\n\n\nMore information:\n\nStartStop is a test class from the automation framework:\n/org.eclipse.tptp.ac.testautomation/automation-files/external_classes/StartStop.class\nLikely any class that will not run to completion right away can be used.\n\nThis is reproduced using the 4.4.0-200705080100A build.",
    "This causes failures in DetachAttachTest* profiler test cases.\n",
    "This is a known issue gated by 183001",
    "This is failing profile to file testcase as well.",
    "Raise this as blocker as it\u0027s a regression.",
    "Ali,\n  The failure is when you attach to an agent when there is no launchConfig info passed. Do you persist that info on a per run basis? How did you do it for PI?\nI am assigning it to you. This issue is not gated by 183001 now",
    "I agree that it doesn\u0027t depend on 183001.  TIDelegateHelper.attachToAgent can have launchConfiguration \u003d\u003d null in the case when the user selects a detached agent and re-attaches.  I have added some code to avoid the NPE exception but the data after a re-attach is sent to the old agent instead of the new one.\n\nI can\u0027t figure out why this is happening.  It seems that the data processor registered during the second round with the TI agent is never invoked.  Guru, I will shortly attach a patch that will avoid the NPE exception.  Can you investigate why the execution framework is not invoking the second data processor that is registered in TIDelegateHelper.configureDataProcessor(...)?\n\nLiz, you have added some code that assumes launchConfiguration is not null in attachToAgent.  I have added an if-block around your code.",
    "Created an attachment (id\u003d69579)\nHere\u0027s the patch that avoid the NPE\n\n",
    "Thanks Ali. I will investigate the data processor issue\n",
    "Thanks Ali, the if block looks fine.",
    "*** Bug 190494 has been marked as a duplicate of this bug. ***",
    "Unable to reproduce the NPE. \nThe dataprocessor issue is being addressed by 187090"
  ],
  "commentCreationDates": [
    "2007-05-14T17:15:26+02:00",
    "2007-05-14T17:17:33+02:00",
    "2007-05-15T17:27:19+02:00",
    "2007-05-18T01:36:02+02:00",
    "2007-05-18T01:36:36+02:00",
    "2007-05-31T01:37:31+02:00",
    "2007-05-31T21:01:03+02:00",
    "2007-05-31T21:01:38+02:00",
    "2007-05-31T22:50:38+02:00",
    "2007-05-31T23:57:02+02:00",
    "2007-06-01T18:04:05+02:00",
    "2007-06-12T00:59:39+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.tptp.platform.jvmti.client.internal.launcher.TIDelegateHelper.attachToAgent",
          "source": "TIDelegateHelper.java:574"
        },
        {
          "method": "org.eclipse.tptp.platform.jvmti.client.internal.launcher.TIDelegateHelper.attachToAgent",
          "source": "TIDelegateHelper.java:538"
        },
        {
          "method": "org.eclipse.tptp.platform.jvmti.client.internal.controlproviders.TIAgentControlProvider$TIAgentStateModifier.doAction",
          "source": "TIAgentControlProvider.java:321"
        },
        {
          "method": "org.eclipse.tptp.platform.jvmti.client.internal.controlproviders.TIAgentControlProvider$TIAgentStateModifier.performCollectiveAction",
          "source": "TIAgentControlProvider.java:271"
        },
        {
          "method": "org.eclipse.tptp.platform.jvmti.client.internal.controlproviders.TIAgentControlProvider$TIAgentStateModifier.attach",
          "source": "TIAgentControlProvider.java:221"
        },
        {
          "method": "org.eclipse.tptp.trace.ui.provisional.control.provider.AbstractAgentControlProvider$1$AttachControlItem.run",
          "source": "AbstractAgentControlProvider.java:108"
        },
        {
          "method": "org.eclipse.jface.action.Action.runWithEvent",
          "source": "Action.java:498"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:545"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$2",
          "source": "ActionContributionItem.java:490"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$5.handleEvent",
          "source": "ActionContributionItem.java:402"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:938"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:3673"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:3284"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:2365"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:2329"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.access$4",
          "source": "Workbench.java:2204"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$4.run",
          "source": "Workbench.java:466"
        },
        {
          "method": "org.eclipse.core.databinding.observable.Realm.runWithDefault",
          "source": "Realm.java:289"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:461"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "org.eclipse.ui.internal.ide.application.IDEApplication.start",
          "source": "IDEApplication.java:106"
        },
        {
          "method": "org.eclipse.equinox.internal.app.EclipseAppHandle.run",
          "source": "EclipseAppHandle.java:153"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:106"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:76"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:363"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:176"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:64"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:43"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:615"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.invokeFramework",
          "source": "Main.java:497"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.basicRun",
          "source": "Main.java:436"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.run",
          "source": "Main.java:1162"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.main",
          "source": "Main.java:1137"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "186807",
      "date": "2007-05-14T17:15:26+02:00",
      "product": "TPTP Profiling",
      "component": "Platform.Agents.JVMTI",
      "severity": "blocker"
    }
  ],
  "groupId": "186807",
  "bugId": "186807",
  "date": "2007-05-14T17:15:26+02:00",
  "product": "TPTP Profiling",
  "component": "Platform.Agents.JVMTI",
  "severity": "blocker"
}