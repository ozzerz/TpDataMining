{
  "comments": [
    "I20050426-1700\n\nPrompted for server password after being prompted for keyring password. This\ndoes not happen all the time but from time to time (see also comments in bug\n66885 and bug 90766).\n\n1. open an editor on a file that is shared\n2. ensure that the CVS Quick Diff reference provider is used\n3. ensure to used ssh2 with a password protected keyring\n4. ensure another window is open with Team perspective\n5. exit\n6. start\n7. switch to another application for several minutes\n8. switch back to eclipse\n   \u003d\u003d\u003e password for keyring gets asked\n9. enter keyring password\n\u003d\u003d\u003e\n\nBug 1: server password gets asked\nBug 2: select the \"Save Password\" checkbox and repeat 5. - 9. \u003d\u003d\u003e server\npassword is queried even though I checked to save it.\n\n\n!ENTRY org.eclipse.team.cvs.core 4 2 2005-04-27 09:50:02.140\n!MESSAGE Authentication error: An undetermined authentication failure has occurred\n!STACK 0\ncom.jcraft.jsch.JSchException: Auth fail\n\tat com.jcraft.jsch.Session.connect(Unknown Source)\n\tat com.jcraft.jsch.Session.connect(Unknown Source)\n\tat\norg.eclipse.team.internal.ccvs.ssh2.JSchSession.createSession(JSchSession.java:484)\n\tat org.eclipse.team.internal.ccvs.ssh2.JSchSession.getSession(JSchSession.java:433)\n\tat\norg.eclipse.team.internal.ccvs.ssh2.CVSSSH2ServerConnection.internalOpen(CVSSSH2ServerConnection.java:108)\n\tat\norg.eclipse.team.internal.ccvs.ssh2.CVSSSH2ServerConnection.open(CVSSSH2ServerConnection.java:93)\n\tat\norg.eclipse.team.internal.ccvs.core.connection.Connection.open(Connection.java:128)\n\tat\norg.eclipse.team.internal.ccvs.core.connection.CVSRepositoryLocation.createConnection(CVSRepositoryLocation.java:493)\n\tat\norg.eclipse.team.internal.ccvs.core.connection.CVSRepositoryLocation.openConnection(CVSRepositoryLocation.java:733)\n\tat org.eclipse.team.internal.ccvs.core.client.Session.open(Session.java:149)\n\tat\norg.eclipse.team.internal.ccvs.core.resources.RemoteFile.internalFetchContents(RemoteFile.java:199)\n\tat\norg.eclipse.team.internal.ccvs.core.resources.RemoteFile.fetchContents(RemoteFile.java:177)\n\tat\norg.eclipse.team.core.variants.CachedResourceVariant.ensureContentsCached(CachedResourceVariant.java:111)\n\tat\norg.eclipse.team.core.variants.CachedResourceVariant.getStorage(CachedResourceVariant.java:101)\n\tat\norg.eclipse.team.internal.ccvs.core.resources.RemoteFile.getContents(RemoteFile.java:168)\n\tat\norg.eclipse.team.internal.ccvs.ui.RemoteRevisionQuickDiffProvider.readDocument(RemoteRevisionQuickDiffProvider.java:254)\n\tat\norg.eclipse.team.internal.ccvs.ui.RemoteRevisionQuickDiffProvider.getReference(RemoteRevisionQuickDiffProvider.java:131)\n\tat\norg.eclipse.ui.internal.texteditor.quickdiff.DocumentLineDiffer$1.run(DocumentLineDiffer.java:447)\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:67)",
    "I\u0027ve tried your steps a couple of times and cannot reproduce the failure. \nThere\u0027s not much I can do without being able to reproduce it. I\u0027ll leave this \nopen. Please add any additonal information if you see this again.",
    "Here\u0027s an updated .log from this morning using latest N20050519-0010. I\u0027ll retry\nthe attached stpes from comment 0 to see what I forgot to provide since I really\nlike this bug being fixed.\n\n!SESSION 2005-05-19 08:36:26.135 -----------------------------------------------\neclipse.buildId\u003dN20050519-0010\njava.version\u003d1.5.0_03\njava.vendor\u003dSun Microsystems Inc.\nBootLoader constants: OS\u003dwin32, ARCH\u003dx86, WS\u003dwin32, NL\u003dde_CH\nFramework arguments:  -update -keyring c:\\eclipse\\.keyring -application\norg.eclipse.ui.ide.workbench -showlocation\nCommand-line arguments:  -update -keyring c:\\eclipse\\.keyring -application\norg.eclipse.ui.ide.workbench -showlocation -data\nc:\\eclipse\\workspaces\\Development_2_2\\plugins\n\n!ENTRY org.eclipse.team.cvs.core 4 2 2005-05-19 08:41:25.615\n!MESSAGE Authentication error: An undetermined authentication failure has occurred\n!STACK 0\ncom.jcraft.jsch.JSchException: Auth fail\n\tat com.jcraft.jsch.Session.connect(Unknown Source)\n\tat com.jcraft.jsch.Session.connect(Unknown Source)\n\tat\norg.eclipse.team.internal.ccvs.ssh2.JSchSession.createSession(JSchSession.java:486)\n\tat org.eclipse.team.internal.ccvs.ssh2.JSchSession.getSession(JSchSession.java:435)\n\tat\norg.eclipse.team.internal.ccvs.ssh2.CVSSSH2ServerConnection.internalOpen(CVSSSH2ServerConnection.java:122)\n\tat\norg.eclipse.team.internal.ccvs.ssh2.CVSSSH2ServerConnection.open(CVSSSH2ServerConnection.java:107)\n\tat\norg.eclipse.team.internal.ccvs.core.connection.Connection.open(Connection.java:128)\n\tat\norg.eclipse.team.internal.ccvs.core.connection.CVSRepositoryLocation.createConnection(CVSRepositoryLocation.java:494)\n\tat\norg.eclipse.team.internal.ccvs.core.connection.CVSRepositoryLocation.openConnection(CVSRepositoryLocation.java:734)\n\tat org.eclipse.team.internal.ccvs.core.client.Session.open(Session.java:149)\n\tat\norg.eclipse.team.internal.ccvs.core.resources.RemoteFile.internalFetchContents(RemoteFile.java:199)\n\tat\norg.eclipse.team.internal.ccvs.core.resources.RemoteFile.fetchContents(RemoteFile.java:177)\n\tat\norg.eclipse.team.core.variants.CachedResourceVariant.ensureContentsCached(CachedResourceVariant.java:111)\n\tat\norg.eclipse.team.core.variants.CachedResourceVariant.getStorage(CachedResourceVariant.java:101)\n\tat\norg.eclipse.team.internal.ccvs.core.resources.RemoteFile.getContents(RemoteFile.java:168)\n\tat\norg.eclipse.team.internal.ccvs.ui.RemoteRevisionQuickDiffProvider.readDocument(RemoteRevisionQuickDiffProvider.java:254)\n\tat\norg.eclipse.team.internal.ccvs.ui.RemoteRevisionQuickDiffProvider.getReference(RemoteRevisionQuickDiffProvider.java:131)\n\tat\norg.eclipse.ui.internal.texteditor.quickdiff.DocumentLineDiffer$1.run(DocumentLineDiffer.java:448)\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:67)\n",
    "I can also not reproduce this with a fresh workspace and a single connection but\nit happens from time to time (at least once a week) in my large development\nworkspace where I have many different repository connection. Same machine.\n\nIs there some debug/trace that I could enable to better track this down?",
    "There is no tracing but we should add some in 3.2.",
    "This drives me nuts at least twice a weak. I\u0027ll try to hunt it down now.",
    "Setting a high connection timeout (60000 in my case) is the cause for this problem.",
    "Found the bug:\n\nICVSRepositoryLocation.getTimeout() is defined as:\n \t/**\n\t * Return the conection timeout value in milliseconds.\n\t * A value of 0 means there is no timeout value.\n\t */\n\tpublic int getTimeout();\n\nHowever, CVSRepositoryLocation.getTimeout() is implemented like this:\n\n\tpublic int getTimeout() {\n\t\treturn CVSProviderPlugin.getPlugin().getTimeout();\n\t}\n\nwhere CVSProviderPlugin.getPlugin().getTimeout() is in seconds!\n\nThe fix is to change CVSRepositoryLocation.getTimeout() to:\n\tpublic int getTimeout() {\n\t\treturn CVSProviderPlugin.getPlugin().getTimeout() * 1000;\n\t}\n\nI\u0027ve checked occurrences and it looks good i.e. callers of ICVSRepositoryLocation.getTimeout() are indeed expecting ms.\n\nMichael, the attached patch also contains a fix for the preference page: it clarifies the dimension of the connection timeout. I\u0027d appreciate if you could release this soon.",
    "Created an attachment (id\u003d31836)\nFix\n\n",
    "I don\u0027t think this will fix your problem. I checked and all the users of the method are expected seconds. I\u0027ve updated the javadoc of ICVSRepositoryLocation to indicate that the timeout is in seconds.\n\nAre you saying that you enter 60000 as the timeout and that caused your problem? I can release the text change if that is the case.",
    "OK, I see that ms is not correct, it\u0027s used as retries with connections that use 1000ms as timeout. Point taken. Forgot to take a coffee last night ;-)\n\nI can now constantly reproduce and debug the problem when setting connection timeout to 60000:\nIf the connection timeout is high (like in my case 60000s) a JSchException is thrown even if the correct passphrase is entered. It looks as if JSch has some internal timeout which is not connected to the socket timeout (I tried to set the session\u0027s timeout using Session.setTimeout(...) but that did not help). So, JSch throws the exception even it the passphrase has been entered correctly. \n\nThe exception is handled in JSchSession.getSession(...) line 439:\n    if (isAuthenticationFailure(e) \u0026\u0026 wrapperUI.hasPromptExceededTimeout()) {\n\nisAuthenticationFailure(e) is true in our case. Now if wrapperUI.hasPromptExceededTimeout() is true, another attempt is made, assuming the correct information might have been recorded. I think the test should be:\n  isAuthenticationFailure(e) \u0026\u0026 !wrapperUI.hasPromptExceededTimeout()\ni.e. if the timeout is not yet reached the information might have been successfully entered but aborted by internal JSch timeout.\n\nIn fact using the timeout here is questionable since it\u0027s not really relevant whether the connection timed out or not but whether the user has entered the correct credentials. We could even want to remove that test and simply try a second time. The current code then throws the exception should it fails again.\n\n\u003eAre you saying that you enter 60000 as the timeout and that caused your\n\u003eproblem? I can release the text change if that is the case.\nYes, exactly that I\u0027m saying but I do this *on purpose* because\n- we often have a very slow network that often resulted in a timeout, hence I\u0027ve\n  set a very high time out\n- due to the lack of information on the preference page I went into the code\n  to check whether seconds or milliseconds are used and I explicitly set 60000\n\u003d\u003d\u003e even though I now know the dimension I think it\u0027s worth improving the preference page ;-)",
    "This logic was put in to fix bug 66885. The logic is correct but the problem is that we use the CVS timeout as the test instead of the timeout used by Jsch. The other part of the problem is that Jsch doesn\u0027t provide a distinction between a real authentication failure and a timeout during authentication.\n\nWe\u0027ll need to find a proper solution but for the time being, I\u0027ve hardcoded the timeout used for the re-prompt case to 60 seconds. Let me know if this helps in your case.",
    "Thanks, the workaround works for me.\n\nIn bug you wrote:\n\u003eI have modified the SSH2 client to retry if a connection failure occurs after \n\u003ea prompt has been open for longer than the CVS timeout (option 2 above)\nSo, why not simply always try a second time?\n\n\u003einstead of the timeout used by Jsch.\nI\u0027m not sure you can access this. There\u0027s a getter on Session but it does not seem to be the same timeout that causes this (I tried setting via setter without luck).\n\n",
    "In general, reprompting is handled by Jsch (though a callback). We only want to reprompt in the case were there was a timeout while our prompt was up. It would probably be better if this was also handled by Jsch but currently it is not. \n\nWith regard to the timeout used by Jsch, I wasn\u0027t implying it would be possible given the current API. We may need to work with the provider of Jsch to resolve the issue properly.",
    "The proper solution ot this problem would require that Jsch throw an exception with a different message when authentication fails. In general, it wuld be nice if Jsch used exception return codes to indicate the type of failure. We won\u0027t have time to address this in 3.2 but perhaps it is something we can look at in 3.3.",
    "We didn\u0027t have time to address this in 3.3.",
    "I think that the essential problem is that the password is not correctly\ncached.  \n\nEven if the reconnections happens, the prompt will not be appeared \nif the correct password is passed from cvs.core.\n\nI have read the similar problem on the other bug entry,\nwhere the keyring will be broken or a given password is not correctly \nsaved into the keyring in some timing on Eclipse 3.2.  \nMichael, do you remember about that?  That reporter had used cvs plug-in \nand Mylar simultaneously.\n",
    "(In reply to comment #16)\n\u003e I have read the similar problem on the other bug entry,\n\u003e where the keyring will be broken or a given password is not correctly \n\u003e saved into the keyring in some timing on Eclipse 3.2.  \n\u003e Michael, do you remember about that?  That reporter had used cvs plug-in \n\u003e and Mylar simultaneously.\n\nI found it.  Please refer to Bug 130582 Comment 27.\nIt seems that keyring broken problem has been fixed at Bug 170722.\nSo, Dainiel, may I ask you to try Eclipse SDK 3.3M6?  I hope you will not\nencounter such irritate prompts any more.\n\n",
    "I cannot verify this because as far as I know the workaround that Michael put in for me (see comment 11) is still in place and hence I no longer run into the problem.",
    "Yes, the cause of bug 170722 may be the problem here as well. Given that the fix mentioned in comment 11 is also in, I\u0027m closing this.\n\n*** This bug has been marked as a duplicate of bug 170722 ***"
  ],
  "commentCreationDates": [
    "2005-04-27T11:01:07+02:00",
    "2005-05-02T16:01:31+02:00",
    "2005-05-19T09:00:33+02:00",
    "2005-06-24T13:10:41+02:00",
    "2005-06-24T15:48:20+02:00",
    "2005-12-15T17:24:49+01:00",
    "2005-12-15T18:24:06+01:00",
    "2005-12-15T21:57:13+01:00",
    "2005-12-15T21:57:40+01:00",
    "2005-12-15T22:22:04+01:00",
    "2005-12-16T07:19:24+01:00",
    "2005-12-16T14:53:38+01:00",
    "2005-12-16T15:05:30+01:00",
    "2005-12-16T15:17:34+01:00",
    "2006-04-12T14:45:42+02:00",
    "2007-04-19T03:32:32+02:00",
    "2007-04-19T03:59:39+02:00",
    "2007-04-19T04:26:53+02:00",
    "2007-04-19T09:09:53+02:00",
    "2007-04-19T14:17:49+02:00"
  ],
  "traces": [
    {
      "exceptionType": "com.jcraft.jsch.JSchException",
      "message": "Auth fail",
      "elements": [
        {
          "method": "com.jcraft.jsch.Session.connect",
          "source": "Unknown Source"
        },
        {
          "method": "com.jcraft.jsch.Session.connect",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ssh2.JSchSession.createSession",
          "source": "JSchSession.java:484"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ssh2.JSchSession.getSession",
          "source": "JSchSession.java:433"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ssh2.CVSSSH2ServerConnection.internalOpen",
          "source": "CVSSSH2ServerConnection.java:108"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ssh2.CVSSSH2ServerConnection.open",
          "source": "CVSSSH2ServerConnection.java:93"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.connection.Connection.open",
          "source": "Connection.java:128"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.connection.CVSRepositoryLocation.createConnection",
          "source": "CVSRepositoryLocation.java:493"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.connection.CVSRepositoryLocation.openConnection",
          "source": "CVSRepositoryLocation.java:733"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.client.Session.open",
          "source": "Session.java:149"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.resources.RemoteFile.internalFetchContents",
          "source": "RemoteFile.java:199"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.resources.RemoteFile.fetchContents",
          "source": "RemoteFile.java:177"
        },
        {
          "method": "org.eclipse.team.core.variants.CachedResourceVariant.ensureContentsCached",
          "source": "CachedResourceVariant.java:111"
        },
        {
          "method": "org.eclipse.team.core.variants.CachedResourceVariant.getStorage",
          "source": "CachedResourceVariant.java:101"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.resources.RemoteFile.getContents",
          "source": "RemoteFile.java:168"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ui.RemoteRevisionQuickDiffProvider.readDocument",
          "source": "RemoteRevisionQuickDiffProvider.java:254"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ui.RemoteRevisionQuickDiffProvider.getReference",
          "source": "RemoteRevisionQuickDiffProvider.java:131"
        },
        {
          "method": "org.eclipse.ui.internal.texteditor.quickdiff.DocumentLineDiffer$1.run",
          "source": "DocumentLineDiffer.java:447"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:67"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "92887",
      "duplicateId": "170722",
      "date": "2005-04-27T11:01:07+02:00",
      "product": "Platform",
      "component": "CVS",
      "severity": "normal"
    },
    {
      "exceptionType": "com.jcraft.jsch.JSchException",
      "message": "Auth fail",
      "elements": [
        {
          "method": "com.jcraft.jsch.Session.connect",
          "source": "Unknown Source"
        },
        {
          "method": "com.jcraft.jsch.Session.connect",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ssh2.JSchSession.createSession",
          "source": "JSchSession.java:486"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ssh2.JSchSession.getSession",
          "source": "JSchSession.java:435"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ssh2.CVSSSH2ServerConnection.internalOpen",
          "source": "CVSSSH2ServerConnection.java:122"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ssh2.CVSSSH2ServerConnection.open",
          "source": "CVSSSH2ServerConnection.java:107"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.connection.Connection.open",
          "source": "Connection.java:128"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.connection.CVSRepositoryLocation.createConnection",
          "source": "CVSRepositoryLocation.java:494"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.connection.CVSRepositoryLocation.openConnection",
          "source": "CVSRepositoryLocation.java:734"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.client.Session.open",
          "source": "Session.java:149"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.resources.RemoteFile.internalFetchContents",
          "source": "RemoteFile.java:199"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.resources.RemoteFile.fetchContents",
          "source": "RemoteFile.java:177"
        },
        {
          "method": "org.eclipse.team.core.variants.CachedResourceVariant.ensureContentsCached",
          "source": "CachedResourceVariant.java:111"
        },
        {
          "method": "org.eclipse.team.core.variants.CachedResourceVariant.getStorage",
          "source": "CachedResourceVariant.java:101"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.resources.RemoteFile.getContents",
          "source": "RemoteFile.java:168"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ui.RemoteRevisionQuickDiffProvider.readDocument",
          "source": "RemoteRevisionQuickDiffProvider.java:254"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ui.RemoteRevisionQuickDiffProvider.getReference",
          "source": "RemoteRevisionQuickDiffProvider.java:131"
        },
        {
          "method": "org.eclipse.ui.internal.texteditor.quickdiff.DocumentLineDiffer$1.run",
          "source": "DocumentLineDiffer.java:448"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:67"
        }
      ],
      "number": 1,
      "commentIndex": 2,
      "bugId": "92887",
      "duplicateId": "170722",
      "date": "2005-05-19T09:00:33+02:00",
      "product": "Platform",
      "component": "CVS",
      "severity": "normal"
    }
  ],
  "groupId": "170722",
  "bugId": "92887",
  "duplicateId": "170722",
  "date": "2005-04-27T11:01:07+02:00",
  "product": "Platform",
  "component": "CVS",
  "severity": "normal"
}