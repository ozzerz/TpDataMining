{
  "comments": [
    "I haven\u0027t yet narrowed it down, but the following advice fails with an \nerror \"RuntimeException thrown: Ranges must be updated with an enclosing \ninstructionList\"\n\nIf I make it just advise call(* *(..)), it gives\n\"IllegalStateException thrown: no this\"\n\nAny ideas what\u0027s wrong? I will try to narrow this down tomorrow (as always, \nsimplified standalone versions don\u0027t do this)...\n\n---\n\n        Object around() : call(* *(..)) || execution(* *(..)) || \nadviceexecution() || call(new(..)) || execution(new(..)) {\n            VirtualDynamicMock vdMock \u003d getFirstMatch(thisJoinPoint);\n            // not handled yet: \u003e1 matches per join point... eventually might \nneed precedence\n            if (vdMock !\u003d null) {\n                Invocation jpInvocation \u003d new JpInvocation(thisJoinPoint) {\n                    public Object doProceed() {\n                        return proceed();\n                    }\n                };\n                try {\n                    return vdMock.mockInvocation(jpInvocation);\n                } catch (Throwable t) {\n                    throw new RuntimeException(t); // bad\n                }\n            } else {\n                return proceed();\n            }\n        }",
    "Here is a simple test program that reproduces the problem:\npublic aspect MockProcessing {\n    public pointcut scope(): !within(MockProcessing);\n    \n    Object around() : scope() \u0026\u0026 (call(* *(..)) || execution(* *(..)) || \nadviceexecution() || call(new(..)) || execution(new(..))) {\n            return proceed();\n    }\n    \n}    \n\nclass ContractChecking {\n    public static final boolean enabled \u003d Boolean.getBoolean\n(ContractChecking.class.getName());\n}\n\nCompiler output:\nRanges must be updated with an enclosing instructionList\nRanges must be updated with an enclosing instructionList\njava.lang.RuntimeException: Ranges must be updated with an enclosing \ninstruction\nList\n        at org.aspectj.weaver.bcel.Range.updateTarget(Range.java:170)\n        at org.aspectj.weaver.bcel.BcelShadow.retargetFrom(BcelShadow.java:230)\n        at org.aspectj.weaver.bcel.BcelShadow.deleteNewAndDup\n(BcelShadow.java:20\n7)\n        at org.aspectj.weaver.bcel.BcelShadow.prepareForMungers\n(BcelShadow.java:\n247)\n        at org.aspectj.weaver.Shadow.implement(Shadow.java:349)\n        at org.aspectj.weaver.bcel.BcelClassWeaver.implement\n(BcelClassWeaver.jav\na:1618)\n        at org.aspectj.weaver.bcel.BcelClassWeaver.weave\n(BcelClassWeaver.java:38\n6)\n        at org.aspectj.weaver.bcel.BcelClassWeaver.weave\n(BcelClassWeaver.java:92\n)\n        at org.aspectj.weaver.bcel.BcelWeaver.weave(BcelWeaver.java:1267)\n        at org.aspectj.weaver.bcel.BcelWeaver.weaveWithoutDump\n(BcelWeaver.java:1\n232)\n        at org.aspectj.weaver.bcel.BcelWeaver.weaveAndNotify\n(BcelWeaver.java:102\n6)\n        at org.aspectj.weaver.bcel.BcelWeaver.weave(BcelWeaver.java:915)\n        at org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.weave\n(AjCompiler\nAdapter.java:244)\n        at org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.afterCompiling\n(A\njCompilerAdapter.java:119)\n        at org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile\n(Compil\ner.java:385)\n        at \norg.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilat\nion(AjBuildManager.java:683)\n        at org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild\n(AjBuild\nManager.java:168)\n        at org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild\n(AjBu\nildManager.java:102)\n        at org.aspectj.ajdt.ajc.AjdtCommand.doCommand(AjdtCommand.java:109)\n        at org.aspectj.ajdt.ajc.AjdtCommand.runCommand(AjdtCommand.java:60)\n        at org.aspectj.tools.ajc.Main.run(Main.java:291)\n        at org.aspectj.tools.ajc.Main.runMain(Main.java:227)\n        at org.aspectj.tools.ajc.Main.main(Main.java:80)\n\n\n1 fail|abort\n\n",
    "thanks to Rons great testcase I\u0027ve fixed the problem with updating targeters reported - I fixed it under the more recent 109614.  The problem was in advising an implicit call to the NoClassDefFoundError ctor that is put into the static initializer.  I\u0027ve fixed it not to crash - but you may need to test it to verify the woven result does what you expect.",
    "presumed fixed - as mentioned in the previous comment."
  ],
  "commentCreationDates": [
    "2005-05-03T10:13:04+02:00",
    "2005-05-03T16:33:20+02:00",
    "2005-12-08T11:45:34+01:00",
    "2006-05-30T15:58:14+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.RuntimeException",
      "message": "Ranges must be updated with an enclosing  instruction List",
      "elements": [
        {
          "method": "org.aspectj.weaver.bcel.Range.updateTarget",
          "source": "Range.java:170"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.retargetFrom",
          "source": "BcelShadow.java:230"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.deleteNewAndDup",
          "source": "BcelShadow.java:20 7"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.prepareForMungers",
          "source": "BcelShadow.java: 247"
        },
        {
          "method": "org.aspectj.weaver.Shadow.implement",
          "source": "Shadow.java:349"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelClassWeaver.implement",
          "source": "BcelClassWeaver.jav a:1618"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelClassWeaver.weave",
          "source": "BcelClassWeaver.java:38 6"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelClassWeaver.weave",
          "source": "BcelClassWeaver.java:92 "
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.weave",
          "source": "BcelWeaver.java:1267"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.weaveWithoutDump",
          "source": "BcelWeaver.java:1 232"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.weaveAndNotify",
          "source": "BcelWeaver.java:102 6"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.weave",
          "source": "BcelWeaver.java:915"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.weave",
          "source": "AjCompiler Adapter.java:244"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.afterCompiling",
          "source": "A jCompilerAdapter.java:119"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile",
          "source": "Compil er.java:385"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilation",
          "source": "AjBuildManager.java:683"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild",
          "source": "AjBuild Manager.java:168"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild",
          "source": "AjBu ildManager.java:102"
        },
        {
          "method": "org.aspectj.ajdt.ajc.AjdtCommand.doCommand",
          "source": "AjdtCommand.java:109"
        },
        {
          "method": "org.aspectj.ajdt.ajc.AjdtCommand.runCommand",
          "source": "AjdtCommand.java:60"
        },
        {
          "method": "org.aspectj.tools.ajc.Main.run",
          "source": "Main.java:291"
        },
        {
          "method": "org.aspectj.tools.ajc.Main.runMain",
          "source": "Main.java:227"
        },
        {
          "method": "org.aspectj.tools.ajc.Main.main",
          "source": "Main.java:80"
        }
      ],
      "number": 0,
      "commentIndex": 1,
      "bugId": "93489",
      "date": "2005-05-03T16:33:20+02:00",
      "product": "AspectJ",
      "component": "Compiler",
      "severity": "normal"
    }
  ],
  "groupId": "93489",
  "bugId": "93489",
  "date": "2005-05-03T10:13:04+02:00",
  "product": "AspectJ",
  "component": "Compiler",
  "severity": "normal"
}