{
  "comments": [
    "3.0\n\nThe AnnotationModel manipulates the document\u0027s positions, its annotation map and\nits annotation model event unsynchronized. For example in\nAnnotationModel#addAnnotation(..), the following calls are not synchronized:\n\nif (!fAnnotations.containsKey(annotation)) {\n\taddPosition(fDocument, position);\n\tfAnnotations.put(annotation, position);\n\tsynchronized (getLockObject()) {\n\t\tgetAnnotationModelEvent().annotationAdded(annotation);\n\t}\n...",
    "Each call itself is using a lock object but some of the calls should be locked\nall together to guarantee atomic behavior.\n\nNote: AnnotationModel.cleanup(boolean, boolean) has been changed in one of the\n3.0 RCs: it can fire the model changed in a new thread.",
    "Attachments are not accessed in a thread-safe manner either. Found the following\nwhile running the test case from bug 77204 comment 5:\n\njava.util.ConcurrentModificationException\n\tat java.util.HashMap$HashIterator.nextEntry(HashMap.java:782)\n\tat java.util.HashMap$KeyIterator.next(HashMap.java:818)\n\tat\norg.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator(AnnotationModel.java:504)\n\tat\norg.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator(AnnotationModel.java:482)\n\tat\norg.eclipse.jface.text.source.projection.ProjectionSummary.removeSummaries(ProjectionSummary.java:193)\n\tat\norg.eclipse.jface.text.source.projection.ProjectionSummary.internalUpdateSummaries(ProjectionSummary.java:166)\n\tat\norg.eclipse.jface.text.source.projection.ProjectionSummary.access$3(ProjectionSummary.java:148)\n\tat\norg.eclipse.jface.text.source.projection.ProjectionSummary$Summarizer.run(ProjectionSummary.java:70)\n",
    "*** Bug 87568 has been marked as a duplicate of this bug. ***",
    "I don\u0027t know if this helps, but I found a similar CME in my log (build\nI20050811-1530):\n\njava.util.ConcurrentModificationException\nat java.util.HashMap$HashIterator.nextEntry(Unknown Source)\nat java.util.HashMap$KeyIterator.next(Unknown Source)\nat java.util.AbstractCollection.toArray(Unknown Source)\nat java.util.ArrayList.\u003cinit\u003e(Unknown Source)\nat org.eclipse.jface.text.source.AnnotationMap.keySetIterator(AnnotationMap.java:76)\nat\norg.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator(AnnotationModel.java:570)\nat\norg.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator(AnnotationModel.java:550)\nat\norg.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator(AnnotationModel.java:530)\nat\norg.eclipse.jface.text.source.OverviewRuler$FilterIterator.\u003cinit\u003e(OverviewRuler.java:116)\nat\norg.eclipse.jface.text.source.OverviewRuler.updateHeaderToolTipText(OverviewRuler.java:1237)\nat org.eclipse.jface.text.source.OverviewRuler.updateHeader(OverviewRuler.java:1207)\nat org.eclipse.jface.text.source.OverviewRuler.access$11(OverviewRuler.java:1170)\nat org.eclipse.jface.text.source.OverviewRuler$5.run(OverviewRuler.java:685)\nat org.eclipse.swt.widgets.RunnableLock.run(RunnableLock.java:35)\nat org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:123)\n... 18 more\n",
    "FWIW, we saw the following during a run of bea internal tests:\n\njava.util.ConcurrentModificationException\n     [java]     at\njava.util.HashMap$KeyIterator.next()Ljava.lang.Object;(Unknown Source)\n     [java]     at java.util.AbstractCollection.toArray(AbstractCollection.java:176)\n     [java]     at java.util.ArrayList.\u003cinit\u003e(ArrayList.java:137)\n     [java]     at\norg.eclipse.jface.text.source.AnnotationMap.keySetIterator(AnnotationMap.java:76)\n     [java]     at\norg.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator(AnnotationModel.java:570)\n     [java]     at\norg.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator(AnnotationModel.java:550)\n     [java]     at\norg.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator(AnnotationModel.java:530)\n     [java]     at\norg.eclipse.jface.text.source.OverviewRuler$FilterIterator.\u003cinit\u003e(OverviewRuler.java:116)\n     [java]     at\norg.eclipse.jface.text.source.OverviewRuler.updateHeaderToolTipText(OverviewRuler.java:1237)\n     [java]     at\norg.eclipse.jface.text.source.OverviewRuler.updateHeader(OverviewRuler.java:1207)\n     [java]     at\norg.eclipse.jface.text.source.OverviewRuler.access$11(OverviewRuler.java:1170)\n     [java]     at\norg.eclipse.jface.text.source.OverviewRuler$5.run(OverviewRuler.java:685)\n     [java]     at org.eclipse.swt.widgets.RunnableLock.run(RunnableLock.java:35)\n     [java]     at\norg.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:123)\n     [java]     at\norg.eclipse.swt.widgets.Display.runAsyncMessages(Display.java:3057)\n     [java]     at\norg.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2716)",
    "*** Bug 128147 has been marked as a duplicate of this bug. ***",
    "What\u0027s the status of this bug, will it be fixed in a release?\nI\u0027m getting this Exception in 3.2:\n\nException in thread \"Thread-9\" java.util.ConcurrentModificationException\n\tat java.util.HashMap$HashIterator.nextEntry(HashMap.java:841)\n\tat java.util.HashMap$KeyIterator.next(HashMap.java:877)\n\tat org.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator(AnnotationModel.java:552)\n\tat org.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator(AnnotationModel.java:530)\n\tat org.eclipse.jface.text.source.projection.ProjectionSummary.removeSummaries(ProjectionSummary.java:193)\n\tat org.eclipse.jface.text.source.projection.ProjectionSummary.internalUpdateSummaries(ProjectionSummary.java:166)\n\tat org.eclipse.jface.text.source.projection.ProjectionSummary.access$3(ProjectionSummary.java:148)\n\tat org.eclipse.jface.text.source.projection.ProjectionSummary$Summarizer.run(ProjectionSummary.java:70)",
    "\u003eWhat\u0027s the status of this bug, will it be fixed in a release?\nNo.",
    "*** Bug 182995 has been marked as a duplicate of this bug. ***",
    "*** Bug 184027 has been marked as a duplicate of this bug. ***"
  ],
  "commentCreationDates": [
    "2004-07-05T16:46:50+02:00",
    "2004-07-06T12:08:13+02:00",
    "2004-11-05T14:45:34+01:00",
    "2005-03-10T07:25:41+01:00",
    "2005-08-16T21:20:05+02:00",
    "2005-09-23T23:26:48+02:00",
    "2006-02-16T08:28:10+01:00",
    "2007-03-10T16:47:56+01:00",
    "2007-03-11T16:28:59+01:00",
    "2007-04-19T09:54:41+02:00",
    "2007-04-25T17:31:36+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.util.ConcurrentModificationException",
      "elements": [
        {
          "method": "java.util.HashMap$HashIterator.nextEntry",
          "source": "HashMap.java:782"
        },
        {
          "method": "java.util.HashMap$KeyIterator.next",
          "source": "HashMap.java:818"
        },
        {
          "method": "org.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator",
          "source": "AnnotationModel.java:504"
        },
        {
          "method": "org.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator",
          "source": "AnnotationModel.java:482"
        },
        {
          "method": "org.eclipse.jface.text.source.projection.ProjectionSummary.removeSummaries",
          "source": "ProjectionSummary.java:193"
        },
        {
          "method": "org.eclipse.jface.text.source.projection.ProjectionSummary.internalUpdateSummaries",
          "source": "ProjectionSummary.java:166"
        },
        {
          "method": "org.eclipse.jface.text.source.projection.ProjectionSummary.access$3",
          "source": "ProjectionSummary.java:148"
        },
        {
          "method": "org.eclipse.jface.text.source.projection.ProjectionSummary$Summarizer.run",
          "source": "ProjectionSummary.java:70"
        }
      ],
      "number": 0,
      "commentIndex": 2,
      "bugId": "69289",
      "date": "2004-11-05T14:45:34+01:00",
      "product": "Platform",
      "component": "Text",
      "severity": "normal"
    },
    {
      "exceptionType": "java.util.ConcurrentModificationException",
      "elements": [
        {
          "method": "java.util.HashMap$HashIterator.nextEntry",
          "source": "Unknown Source"
        },
        {
          "method": "java.util.HashMap$KeyIterator.next",
          "source": "Unknown Source"
        },
        {
          "method": "java.util.AbstractCollection.toArray",
          "source": "Unknown Source"
        },
        {
          "method": "java.util.ArrayList.\u003cinit\u003e",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.jface.text.source.AnnotationMap.keySetIterator",
          "source": "AnnotationMap.java:76"
        },
        {
          "method": "org.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator",
          "source": "AnnotationModel.java:570"
        },
        {
          "method": "org.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator",
          "source": "AnnotationModel.java:550"
        },
        {
          "method": "org.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator",
          "source": "AnnotationModel.java:530"
        },
        {
          "method": "org.eclipse.jface.text.source.OverviewRuler$FilterIterator.\u003cinit\u003e",
          "source": "OverviewRuler.java:116"
        },
        {
          "method": "org.eclipse.jface.text.source.OverviewRuler.updateHeaderToolTipText",
          "source": "OverviewRuler.java:1237"
        },
        {
          "method": "org.eclipse.jface.text.source.OverviewRuler.updateHeader",
          "source": "OverviewRuler.java:1207"
        },
        {
          "method": "org.eclipse.jface.text.source.OverviewRuler.access$11",
          "source": "OverviewRuler.java:1170"
        },
        {
          "method": "org.eclipse.jface.text.source.OverviewRuler$5.run",
          "source": "OverviewRuler.java:685"
        },
        {
          "method": "org.eclipse.swt.widgets.RunnableLock.run",
          "source": "RunnableLock.java:35"
        },
        {
          "method": "org.eclipse.swt.widgets.Synchronizer.runAsyncMessages",
          "source": "Synchronizer.java:123"
        }
      ],
      "number": 1,
      "commentIndex": 4,
      "bugId": "69289",
      "date": "2005-08-16T21:20:05+02:00",
      "product": "Platform",
      "component": "Text",
      "severity": "normal"
    },
    {
      "exceptionType": "java.util.ConcurrentModificationException",
      "elements": [
        {
          "method": "java.util.HashMap$HashIterator.nextEntry",
          "source": "HashMap.java:841"
        },
        {
          "method": "java.util.HashMap$KeyIterator.next",
          "source": "HashMap.java:877"
        },
        {
          "method": "org.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator",
          "source": "AnnotationModel.java:552"
        },
        {
          "method": "org.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator",
          "source": "AnnotationModel.java:530"
        },
        {
          "method": "org.eclipse.jface.text.source.projection.ProjectionSummary.removeSummaries",
          "source": "ProjectionSummary.java:193"
        },
        {
          "method": "org.eclipse.jface.text.source.projection.ProjectionSummary.internalUpdateSummaries",
          "source": "ProjectionSummary.java:166"
        },
        {
          "method": "org.eclipse.jface.text.source.projection.ProjectionSummary.access$3",
          "source": "ProjectionSummary.java:148"
        },
        {
          "method": "org.eclipse.jface.text.source.projection.ProjectionSummary$Summarizer.run",
          "source": "ProjectionSummary.java:70"
        }
      ],
      "number": 2,
      "commentIndex": 7,
      "bugId": "69289",
      "date": "2007-03-10T16:47:56+01:00",
      "product": "Platform",
      "component": "Text",
      "severity": "normal"
    }
  ],
  "groupId": "69289",
  "bugId": "69289",
  "date": "2004-07-05T16:46:50+02:00",
  "product": "Platform",
  "component": "Text",
  "severity": "normal"
}