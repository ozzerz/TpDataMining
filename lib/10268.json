{
  "comments": [
    "After a SUSPEND event with BREAKPOINT as the detail we ask the JDIThread for its \nstack frames and get the following exception:\n\norg.eclipse.debug.core.DebugException[5010]: \ncom.sun.jdi.IncompatibleThreadStateException: Thread was not suspended.\n\tat \norg.eclipse.jdi.internal.ThreadReferenceImpl.frames(ThreadReferenceImpl.java:179\n)\n\tat \norg.eclipse.jdi.internal.ThreadReferenceImpl.frames(ThreadReferenceImpl.java:158\n)\n\tat \norg.eclipse.jdt.internal.debug.core.model.JDIThread.getUnderlyingFrames(JDIThrea\nd.java:528)\n\tat \norg.eclipse.jdt.internal.debug.core.model.JDIThread.computeStackFrames(JDIThread\n.java:378)\n\tat \norg.eclipse.jdt.internal.debug.core.model.JDIThread.computeStackFrames(JDIThread\n.java:465)\n\tat \norg.eclipse.jdt.internal.debug.core.model.JDIThread.getStackFrames(JDIThread.jav\na:355)\n\tat \ncom.ibm.debug.egl.internal.core.EGLThread.computeStackFrames(EGLThread.java:743)\n\tat \ncom.ibm.debug.egl.internal.core.EGLThread.getEGLStackFrame(EGLThread.java:700)\n\tat \ncom.ibm.debug.egl.internal.core.EGLThread.getTopEGLStackFrame(EGLThread.java:716\n)\n\tat \ncom.ibm.debug.egl.internal.core.EGLThread.getCurrentEGLStatement(EGLThread.java:\n539)\n\tat \ncom.ibm.debug.egl.internal.core.EGLThread.handleBreakpointHit(EGLThread.java:281\n)\n\tat \ncom.ibm.debug.egl.internal.core.EGLThread.handleDebugEvent(EGLThread.java:232)\n\tat \ncom.ibm.debug.egl.internal.core.EGLDebugTarget.filterDebugEvent(EGLDebugTarget.j\nava:154)\n\tat org.eclipse.debug.core.DebugPlugin.isFiltered(DebugPlugin.java:414)\n\tat \norg.eclipse.debug.core.DebugPlugin.fireDebugEvent(DebugPlugin.java:179)\n\tat \norg.eclipse.jdt.internal.debug.core.model.JDIDebugElement.fireEvent(JDIDebugElem\nent.java:125)\n\tat \norg.eclipse.jdt.internal.debug.core.model.JDIDebugElement.fireSuspendEvent(JDIDe\nbugElement.java:147)\n\tat \norg.eclipse.jdt.internal.debug.core.model.JDIThread.fireSuspendEvent(JDIThread.j\nava:1474)\n\tat \norg.eclipse.jdt.internal.debug.core.model.JDIThread.handleSuspendForBreakpoint(J\nDIThread.java:1007)\n\tat \norg.eclipse.jdt.internal.debug.core.breakpoints.JavaBreakpoint.suspend(JavaBreak\npoint.java:279)\n\tat \norg.eclipse.jdt.internal.debug.core.breakpoints.JavaBreakpoint.handleBreakpointE\nvent(JavaBreakpoint.java:265)\n\tat \norg.eclipse.jdt.internal.debug.core.breakpoints.JavaBreakpoint.handleEvent(JavaB\nreakpoint.java:229)\n\tat \norg.eclipse.jdt.internal.debug.core.EventDispatcher.dispatch(EventDispatcher.jav\na:108)\n\tat \norg.eclipse.jdt.internal.debug.core.EventDispatcher$1.run(EventDispatcher.java:1\n43)\n\tat \norg.eclipse.core.internal.resources.Workspace.run(Workspace.java:1232)\n\tat \norg.eclipse.jdt.internal.debug.core.EventDispatcher.run(EventDispatcher.java:160\n)\n\tat java.lang.Thread.run(Thread.java:498)\n\norg.eclipse.debug.core.DebugException[5010]: \ncom.sun.jdi.VMDisconnectedException: Got IOException from Virtual Machine\n\tat \norg.eclipse.jdi.internal.ThreadReferenceImpl.frames(ThreadReferenceImpl.java:198\n)\n\tat \norg.eclipse.jdi.internal.ThreadReferenceImpl.frames(ThreadReferenceImpl.java:158\n)\n\tat \norg.eclipse.jdt.internal.debug.core.model.JDIThread.getUnderlyingFrames(JDIThrea\nd.java:528)\n\tat \norg.eclipse.jdt.internal.debug.core.model.JDIThread.computeStackFrames(JDIThread\n.java:378)\n\tat \norg.eclipse.jdt.internal.debug.core.model.JDIThread.computeStackFrames(JDIThread\n.java:465)\n\tat \norg.eclipse.jdt.internal.debug.core.model.JDIThread.getStackFrames(JDIThread.jav\na:355)\n\tat \ncom.ibm.debug.egl.internal.core.EGLThread.computeStackFrames(EGLThread.java:743)\n\tat \ncom.ibm.debug.egl.internal.core.EGLThread.getEGLStackFrame(EGLThread.java:700)\n\tat \ncom.ibm.debug.egl.internal.core.EGLThread.getTopEGLStackFrame(EGLThread.java:716\n)\n\tat \ncom.ibm.debug.egl.internal.core.EGLThread.getCurrentEGLStatement(EGLThread.java:\n539)\n\tat \ncom.ibm.debug.egl.internal.core.EGLThread.getLabel(EGLThread.java:179)\n\tat \ncom.ibm.debug.egl.internal.core.EGLModelPresentation.getText(EGLModelPresentatio\nn.java:80)\n\tat \norg.eclipse.debug.internal.ui.LazyModelPresentation.getText(LazyModelPresentatio\nn.java:63)\n\tat \norg.eclipse.debug.internal.ui.DelegatingModelPresentation.getText(DelegatingMode\nlPresentation.java:212)\n\tat org.eclipse.jface.viewers.TreeViewer.doUpdateItem(TreeViewer.java:88)\n\tat \norg.eclipse.jface.viewers.AbstractTreeViewer.doUpdateItem(AbstractTreeViewer.jav\na:352)\n\tat \norg.eclipse.jface.viewers.StructuredViewer.updateItem(StructuredViewer.java:979)\n\tat \norg.eclipse.jface.viewers.AbstractTreeViewer.internalRefresh(AbstractTreeViewer.\njava:840)\n\tat \norg.eclipse.jface.viewers.AbstractTreeViewer.internalRefresh(AbstractTreeViewer.\njava:854)\n\tat \norg.eclipse.jface.viewers.AbstractTreeViewer.internalRefresh(AbstractTreeViewer.\njava:854)\n\tat \norg.eclipse.jface.viewers.AbstractTreeViewer.internalRefresh(AbstractTreeViewer.\njava:823)\n\tat \norg.eclipse.jface.viewers.StructuredViewer$1.run(StructuredViewer.java:626)\n\tat \norg.eclipse.jface.viewers.StructuredViewer.preservingSelection(StructuredViewer.\njava:572)\n\tat \norg.eclipse.jface.viewers.StructuredViewer.refresh(StructuredViewer.java:624)\n\tat \norg.eclipse.debug.internal.ui.views.LaunchViewer.refresh(LaunchViewer.java:61)\n\tat \norg.eclipse.debug.internal.ui.views.AbstractDebugEventHandler.refresh(AbstractDe\nbugEventHandler.java:109)\n\tat \norg.eclipse.debug.internal.ui.views.LaunchViewEventHandler.doHandleDebugEvent(La\nunchViewEventHandler.java:71)\n\tat \norg.eclipse.debug.internal.ui.views.AbstractDebugEventHandler$1.run(AbstractDebu\ngEventHandler.java:53)\n\tat org.eclipse.swt.widgets.RunnableLock.run(RunnableLock.java:29)\n\tat \norg.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:93)\n\tat org.eclipse.swt.widgets.Display.runAsyncMessages(Display.java:1390)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:1208)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:788)\n\tat org.eclipse.ui.internal.Workbench.run(Workbench.java:771)\n\tat \norg.eclipse.core.internal.boot.InternalBootLoader.run(InternalBootLoader.java:77\n7)\n\tat org.eclipse.core.boot.BootLoader.run(BootLoader.java:319)\n\tat SlimLauncher.main(SlimLauncher.java:14)\n\nThe problem seems to be that both a step event and a breakpoint event occur at \nthe same spot.  The EGL super adapter which is registered as a debug event \nfilter first gets the step end event which it decides to filter and tells the \nJDIThread to resume.  It then gets the breakpoint event and then tries to get \nthe stack frames from the JDIThread so that it can see where it is and if it \nwants to filter or not.  This is when the exception occurs.  I suspect that when \nthe EGL super adapter tells the thread to resume it does so without checking \nwhether there are still more JDI events in the same event set.  Thus when it \ndoes later continue looping through the events it fires a breakpoint suspend \nevent while the thread is not really suspended.\n\nOne solution might be as follows (and this is how PICL behaves):\n\nIf there are both step and breakpoint events in the JDI event set and at least \none of the breakpoints is valid (e.g. enabled), ignore the step event and just \nfire a breakpoint suspend event.  On the JDIThread have a method which will \nreturn all of the breakpoints that were hit.  Thus only one event is fired for \nthe suspend.\n\nAnother solution might be to fire a set of events when there is more than one \nevent in the JDI event set.",
    "\n\n*** This bug has been marked as a duplicate of 12157 ***",
    "Verified with 20020404."
  ],
  "commentCreationDates": [
    "2002-02-26T16:43:02+01:00",
    "2002-03-25T18:00:17+01:00",
    "2002-04-08T14:51:36+02:00"
  ],
  "traces": [
    {
      "exceptionType": "com.sun.jdi.IncompatibleThreadStateException",
      "message": "Thread was not suspended.",
      "elements": [
        {
          "method": "org.eclipse.jdi.internal.ThreadReferenceImpl.frames",
          "source": "ThreadReferenceImpl.java:179 "
        },
        {
          "method": "org.eclipse.jdi.internal.ThreadReferenceImpl.frames",
          "source": "ThreadReferenceImpl.java:158 "
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.model.JDIThread.getUnderlyingFrames",
          "source": "JDIThrea d.java:528"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.model.JDIThread.computeStackFrames",
          "source": "JDIThread .java:378"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.model.JDIThread.computeStackFrames",
          "source": "JDIThread .java:465"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.model.JDIThread.getStackFrames",
          "source": "JDIThread.jav a:355"
        },
        {
          "method": "com.ibm.debug.egl.internal.core.EGLThread.computeStackFrames",
          "source": "EGLThread.java:743"
        },
        {
          "method": "com.ibm.debug.egl.internal.core.EGLThread.getEGLStackFrame",
          "source": "EGLThread.java:700"
        },
        {
          "method": "com.ibm.debug.egl.internal.core.EGLThread.getTopEGLStackFrame",
          "source": "EGLThread.java:716 "
        },
        {
          "method": "com.ibm.debug.egl.internal.core.EGLThread.getCurrentEGLStatement",
          "source": "EGLThread.java: 539"
        },
        {
          "method": "com.ibm.debug.egl.internal.core.EGLThread.handleBreakpointHit",
          "source": "EGLThread.java:281 "
        },
        {
          "method": "com.ibm.debug.egl.internal.core.EGLThread.handleDebugEvent",
          "source": "EGLThread.java:232"
        },
        {
          "method": "com.ibm.debug.egl.internal.core.EGLDebugTarget.filterDebugEvent",
          "source": "EGLDebugTarget.j ava:154"
        },
        {
          "method": "org.eclipse.debug.core.DebugPlugin.isFiltered",
          "source": "DebugPlugin.java:414"
        },
        {
          "method": "org.eclipse.debug.core.DebugPlugin.fireDebugEvent",
          "source": "DebugPlugin.java:179"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.model.JDIDebugElement.fireEvent",
          "source": "JDIDebugElem ent.java:125"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.model.JDIDebugElement.fireSuspendEvent",
          "source": "JDIDe bugElement.java:147"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.model.JDIThread.fireSuspendEvent",
          "source": "JDIThread.j ava:1474"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.model.JDIThread.handleSuspendForBreakpoint",
          "source": "J DIThread.java:1007"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.breakpoints.JavaBreakpoint.suspend",
          "source": "JavaBreak point.java:279"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.breakpoints.JavaBreakpoint.handleBreakpointEvent",
          "source": "JavaBreakpoint.java:265"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.breakpoints.JavaBreakpoint.handleEvent",
          "source": "JavaB reakpoint.java:229"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.EventDispatcher.dispatch",
          "source": "EventDispatcher.jav a:108"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.EventDispatcher$1.run",
          "source": "EventDispatcher.java:1 43"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1232"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.EventDispatcher.run",
          "source": "EventDispatcher.java:160 "
        },
        {
          "method": "java.lang.Thread.run",
          "source": "Thread.java:498"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "10268",
      "duplicateId": "12157",
      "date": "2002-02-26T16:43:02+01:00",
      "product": "Platform",
      "component": "Debug",
      "severity": "major"
    },
    {
      "exceptionType": "com.sun.jdi.VMDisconnectedException",
      "message": "Got IOException from Virtual Machine",
      "elements": [
        {
          "method": "org.eclipse.jdi.internal.ThreadReferenceImpl.frames",
          "source": "ThreadReferenceImpl.java:198 "
        },
        {
          "method": "org.eclipse.jdi.internal.ThreadReferenceImpl.frames",
          "source": "ThreadReferenceImpl.java:158 "
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.model.JDIThread.getUnderlyingFrames",
          "source": "JDIThrea d.java:528"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.model.JDIThread.computeStackFrames",
          "source": "JDIThread .java:378"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.model.JDIThread.computeStackFrames",
          "source": "JDIThread .java:465"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.core.model.JDIThread.getStackFrames",
          "source": "JDIThread.jav a:355"
        },
        {
          "method": "com.ibm.debug.egl.internal.core.EGLThread.computeStackFrames",
          "source": "EGLThread.java:743"
        },
        {
          "method": "com.ibm.debug.egl.internal.core.EGLThread.getEGLStackFrame",
          "source": "EGLThread.java:700"
        },
        {
          "method": "com.ibm.debug.egl.internal.core.EGLThread.getTopEGLStackFrame",
          "source": "EGLThread.java:716 "
        },
        {
          "method": "com.ibm.debug.egl.internal.core.EGLThread.getCurrentEGLStatement",
          "source": "EGLThread.java: 539"
        },
        {
          "method": "com.ibm.debug.egl.internal.core.EGLThread.getLabel",
          "source": "EGLThread.java:179"
        },
        {
          "method": "com.ibm.debug.egl.internal.core.EGLModelPresentation.getText",
          "source": "EGLModelPresentatio n.java:80"
        },
        {
          "method": "org.eclipse.debug.internal.ui.LazyModelPresentation.getText",
          "source": "LazyModelPresentatio n.java:63"
        },
        {
          "method": "org.eclipse.debug.internal.ui.DelegatingModelPresentation.getText",
          "source": "DelegatingMode lPresentation.java:212"
        },
        {
          "method": "org.eclipse.jface.viewers.TreeViewer.doUpdateItem",
          "source": "TreeViewer.java:88"
        },
        {
          "method": "org.eclipse.jface.viewers.AbstractTreeViewer.doUpdateItem",
          "source": "AbstractTreeViewer.jav a:352"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.updateItem",
          "source": "StructuredViewer.java:979"
        },
        {
          "method": "org.eclipse.jface.viewers.AbstractTreeViewer.internalRefresh",
          "source": "AbstractTreeViewer. java:840"
        },
        {
          "method": "org.eclipse.jface.viewers.AbstractTreeViewer.internalRefresh",
          "source": "AbstractTreeViewer. java:854"
        },
        {
          "method": "org.eclipse.jface.viewers.AbstractTreeViewer.internalRefresh",
          "source": "AbstractTreeViewer. java:854"
        },
        {
          "method": "org.eclipse.jface.viewers.AbstractTreeViewer.internalRefresh",
          "source": "AbstractTreeViewer. java:823"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer$1.run",
          "source": "StructuredViewer.java:626"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.preservingSelection",
          "source": "StructuredViewer. java:572"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.refresh",
          "source": "StructuredViewer.java:624"
        },
        {
          "method": "org.eclipse.debug.internal.ui.views.LaunchViewer.refresh",
          "source": "LaunchViewer.java:61"
        },
        {
          "method": "org.eclipse.debug.internal.ui.views.AbstractDebugEventHandler.refresh",
          "source": "AbstractDe bugEventHandler.java:109"
        },
        {
          "method": "org.eclipse.debug.internal.ui.views.LaunchViewEventHandler.doHandleDebugEvent",
          "source": "La unchViewEventHandler.java:71"
        },
        {
          "method": "org.eclipse.debug.internal.ui.views.AbstractDebugEventHandler$1.run",
          "source": "AbstractDebu gEventHandler.java:53"
        },
        {
          "method": "org.eclipse.swt.widgets.RunnableLock.run",
          "source": "RunnableLock.java:29"
        },
        {
          "method": "org.eclipse.swt.widgets.Synchronizer.runAsyncMessages",
          "source": "Synchronizer.java:93"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runAsyncMessages",
          "source": "Display.java:1390"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:1208"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:788"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.run",
          "source": "Workbench.java:771"
        },
        {
          "method": "org.eclipse.core.internal.boot.InternalBootLoader.run",
          "source": "InternalBootLoader.java:77 7"
        },
        {
          "method": "org.eclipse.core.boot.BootLoader.run",
          "source": "BootLoader.java:319"
        },
        {
          "method": "SlimLauncher.main",
          "source": "SlimLauncher.java:14"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "10268",
      "duplicateId": "12157",
      "date": "2002-02-26T16:43:02+01:00",
      "product": "Platform",
      "component": "Debug",
      "severity": "major"
    }
  ],
  "groupId": "12157",
  "bugId": "10268",
  "duplicateId": "12157",
  "date": "2002-02-26T16:43:02+01:00",
  "product": "Platform",
  "component": "Debug",
  "severity": "major"
}