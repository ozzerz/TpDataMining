{
  "comments": [
    "This does not look good.  Should try to fix it before the I build.\n\njava.util.ConcurrentModificationException: concurrent access to HashMap attempted by Thread[main,6,main]\n\tat java.util.HashMap.onExit(HashMap.java:217)\n\tat java.util.HashMap.transfer(HashMap.java:514)\n\tat java.util.HashMap.resize(HashMap.java:500)\n\tat java.util.HashMap.addEntry(HashMap.java:800)\n\tat java.util.HashMap.put(HashMap.java:441)\n\tat org.eclipse.core.internal.runtime.AdapterManager.getFactories(AdapterManager.java:179)\n\tat org.eclipse.core.internal.runtime.AdapterManager.getAdapter(AdapterManager.java:253)\n\tat org.eclipse.core.runtime.PlatformObject.getAdapter(PlatformObject.java:66)\n\tat org.eclipse.ui.internal.LegacyResourceSupport.getAdaptedContributorResource(LegacyResourceSupport.java:354)\n\tat org.eclipse.ui.internal.decorators.DecoratorManager.getResourceAdapter(DecoratorManager.java:430)\n\tat org.eclipse.ui.internal.decorators.DecoratorManager.prepareDecoration(DecoratorManager.java:875)\n\tat org.eclipse.ui.internal.decorators.DecoratorManager.prepareDecoration(DecoratorManager.java:889)\n\tat org.eclipse.jface.viewers.DecoratingLabelProvider.updateLabel(DecoratingLabelProvider.java:220)\n\tat org.eclipse.jface.viewers.DecoratingLabelProvider.update(DecoratingLabelProvider.java:415)\n\tat org.eclipse.jface.viewers.ViewerColumn.refresh(ViewerColumn.java:91)\n\tat org.eclipse.jface.viewers.TreeViewer.doUpdateItem(TreeViewer.java:157)\n\tat org.eclipse.jface.viewers.AbstractTreeViewer$UpdateItemSafeRunnable.run(AbstractTreeViewer.java:97)\n\tat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n\tat org.eclipse.core.runtime.Platform.run(Platform.java:850)\n\tat org.eclipse.ui.internal.JFaceUtil$1.run(JFaceUtil.java:44)\n\tat org.eclipse.jface.util.SafeRunnable.run(SafeRunnable.java:149)\n\tat org.eclipse.jface.viewers.AbstractTreeViewer.doUpdateItem(AbstractTreeViewer.java:893)\n\tat org.eclipse.jface.viewers.StructuredViewer$UpdateItemSafeRunnable.run(StructuredViewer.java:465)\n\tat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n\tat org.eclipse.core.runtime.Platform.run(Platform.java:850)\n\tat org.eclipse.ui.internal.JFaceUtil$1.run(JFaceUtil.java:44)\n\tat org.eclipse.jface.util.SafeRunnable.run(SafeRunnable.java:149)\n\tat org.eclipse.jface.viewers.StructuredViewer.updateItem(StructuredViewer.java:1977)\n\tat org.eclipse.jface.viewers.AbstractTreeViewer.createTreeItem(AbstractTreeViewer.java:797)\n\tat org.eclipse.jface.viewers.AbstractTreeViewer$1.run(AbstractTreeViewer.java:775)\n\tat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:67)\n\tat org.eclipse.jface.viewers.AbstractTreeViewer.createChildren(AbstractTreeViewer.java:749)\n\tat org.eclipse.jface.viewers.TreeViewer.createChildren(TreeViewer.java:783)\n\tat org.eclipse.jface.viewers.AbstractTreeViewer.handleTreeExpand(AbstractTreeViewer.java:1302)\n\tat org.eclipse.jface.viewers.AbstractTreeViewer$4.treeExpanded(AbstractTreeViewer.java:1314)\n\tat org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:181)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)",
    "Changing bug summary and assigning to equinox-common.  I don\u0027t think this is a bug in UI - AdapterManager does not synchronize accesses to the adapterLookup HashMap.",
    "Agree - all three \"lookup\" fields should be made thread safe. Easiest solution is to use Collections.synchronizedMap wrapper class.",
    "There are some subtle cases here... let me try putting together a patch.",
    "Created an attachment (id\u003d52076)\nFix\n\nThis fix adds thread safety to the three lookup structures: adapterLookup, classLookup, and classSearchOrderLookup. The synchronization technique used for each field is described in the field javadoc.\n\nThis patch also changes the classSearchOrderLookup to store a Class[] directly rather than ArrayList.  It was previously caching ArrayList and invoking toArray on each lookup, so storing the array directly in the cache reduces garbage creation.",
    "The patch also makes all fields private to protect against concurrency problems due to access from outside the class, and makes fields final where possible.",
    "Moving back to inbox.  Can someone with commit rights review and release the attached patch? I have run all core tests with the patch applied.",
    "Oleg, can you take a look at this patch? It took awhile to figure this out and I don\u0027t want the patch to get too stale.",
    "Patch applied to CVS Head. Thanks John!\n"
  ],
  "commentCreationDates": [
    "2006-10-16T16:51:33+02:00",
    "2006-10-16T18:44:28+02:00",
    "2006-10-16T18:55:48+02:00",
    "2006-10-16T19:00:55+02:00",
    "2006-10-16T23:15:51+02:00",
    "2006-10-16T23:16:44+02:00",
    "2006-10-16T23:18:12+02:00",
    "2006-10-20T22:52:57+02:00",
    "2006-10-23T20:25:33+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.util.ConcurrentModificationException",
      "message": "concurrent access to HashMap attempted by Thread[main,6,main]",
      "elements": [
        {
          "method": "java.util.HashMap.onExit",
          "source": "HashMap.java:217"
        },
        {
          "method": "java.util.HashMap.transfer",
          "source": "HashMap.java:514"
        },
        {
          "method": "java.util.HashMap.resize",
          "source": "HashMap.java:500"
        },
        {
          "method": "java.util.HashMap.addEntry",
          "source": "HashMap.java:800"
        },
        {
          "method": "java.util.HashMap.put",
          "source": "HashMap.java:441"
        },
        {
          "method": "org.eclipse.core.internal.runtime.AdapterManager.getFactories",
          "source": "AdapterManager.java:179"
        },
        {
          "method": "org.eclipse.core.internal.runtime.AdapterManager.getAdapter",
          "source": "AdapterManager.java:253"
        },
        {
          "method": "org.eclipse.core.runtime.PlatformObject.getAdapter",
          "source": "PlatformObject.java:66"
        },
        {
          "method": "org.eclipse.ui.internal.LegacyResourceSupport.getAdaptedContributorResource",
          "source": "LegacyResourceSupport.java:354"
        },
        {
          "method": "org.eclipse.ui.internal.decorators.DecoratorManager.getResourceAdapter",
          "source": "DecoratorManager.java:430"
        },
        {
          "method": "org.eclipse.ui.internal.decorators.DecoratorManager.prepareDecoration",
          "source": "DecoratorManager.java:875"
        },
        {
          "method": "org.eclipse.ui.internal.decorators.DecoratorManager.prepareDecoration",
          "source": "DecoratorManager.java:889"
        },
        {
          "method": "org.eclipse.jface.viewers.DecoratingLabelProvider.updateLabel",
          "source": "DecoratingLabelProvider.java:220"
        },
        {
          "method": "org.eclipse.jface.viewers.DecoratingLabelProvider.update",
          "source": "DecoratingLabelProvider.java:415"
        },
        {
          "method": "org.eclipse.jface.viewers.ViewerColumn.refresh",
          "source": "ViewerColumn.java:91"
        },
        {
          "method": "org.eclipse.jface.viewers.TreeViewer.doUpdateItem",
          "source": "TreeViewer.java:157"
        },
        {
          "method": "org.eclipse.jface.viewers.AbstractTreeViewer$UpdateItemSafeRunnable.run",
          "source": "AbstractTreeViewer.java:97"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:850"
        },
        {
          "method": "org.eclipse.ui.internal.JFaceUtil$1.run",
          "source": "JFaceUtil.java:44"
        },
        {
          "method": "org.eclipse.jface.util.SafeRunnable.run",
          "source": "SafeRunnable.java:149"
        },
        {
          "method": "org.eclipse.jface.viewers.AbstractTreeViewer.doUpdateItem",
          "source": "AbstractTreeViewer.java:893"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer$UpdateItemSafeRunnable.run",
          "source": "StructuredViewer.java:465"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:850"
        },
        {
          "method": "org.eclipse.ui.internal.JFaceUtil$1.run",
          "source": "JFaceUtil.java:44"
        },
        {
          "method": "org.eclipse.jface.util.SafeRunnable.run",
          "source": "SafeRunnable.java:149"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.updateItem",
          "source": "StructuredViewer.java:1977"
        },
        {
          "method": "org.eclipse.jface.viewers.AbstractTreeViewer.createTreeItem",
          "source": "AbstractTreeViewer.java:797"
        },
        {
          "method": "org.eclipse.jface.viewers.AbstractTreeViewer$1.run",
          "source": "AbstractTreeViewer.java:775"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:67"
        },
        {
          "method": "org.eclipse.jface.viewers.AbstractTreeViewer.createChildren",
          "source": "AbstractTreeViewer.java:749"
        },
        {
          "method": "org.eclipse.jface.viewers.TreeViewer.createChildren",
          "source": "TreeViewer.java:783"
        },
        {
          "method": "org.eclipse.jface.viewers.AbstractTreeViewer.handleTreeExpand",
          "source": "AbstractTreeViewer.java:1302"
        },
        {
          "method": "org.eclipse.jface.viewers.AbstractTreeViewer$4.treeExpanded",
          "source": "AbstractTreeViewer.java:1314"
        },
        {
          "method": "org.eclipse.swt.widgets.TypedListener.handleEvent",
          "source": "TypedListener.java:181"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "161062",
      "date": "2006-10-16T16:51:33+02:00",
      "product": "Equinox",
      "component": "Bundles",
      "severity": "normal"
    }
  ],
  "groupId": "161062",
  "bugId": "161062",
  "date": "2006-10-16T16:51:33+02:00",
  "product": "Equinox",
  "component": "Bundles",
  "severity": "normal"
}