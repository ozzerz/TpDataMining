{
  "comments": [
    "Ah, I think I found the problem:\n\n  IFile file \u003d ResourcesPlugin.getWorkspace().getRoot().getFile(\n      new Path(uri.path()));\n  file.setDerived(true);\n\nEMF can work outside the workspace with URIs, but now ATL tries to set all generated files as derived. ATL should only do that when the Eclipse workspace is available.\n\nPlease copy \u0026 paste this entire conversation into bugzilla ;-) .\n\nRegards,\nDennis\n\nP.S. If I\u0027m correct about this problem, your model should still be saved. Please check if this is true.\n\nWilliam Piers schreef:\n\u003e Hello,\n\u003e\n\u003e Thanks for the answer.\n\u003e\n\u003e Dennis Wagelaar a ?crit :\n\u003e\u003e I have different line numbers than you specify in your stacktrace. Can you verify that you have the latest Main.java (from SVN)\n\u003e\n\u003e I think I use the latest version, but when I copy the stack trace I may have added some System.out.println somewhere in order to debug...\n\u003e The exact trace is :\n\u003e\n\u003e java.lang.IllegalStateException: Workspace is closed.java.lang.IllegalStateException: Workspace is closed.\n\u003e     at org.eclipse.core.resources.ResourcesPlugin.getWorkspace(ResourcesPlugin.java:326)\n\u003e     at org.eclipse.m2m.atl.engine.AtlEMFModelHandler.saveModel(AtlEMFModelHandler.java:144)\n\u003e     at org.eclipse.m2m.atl.engine.AtlEMFModelHandler.saveModel(AtlEMFModelHandler.java:61)\n\u003e     at org.atl.commandline.Main.run(Main.java:324)\n\u003e     at org.atl.commandline.Main.main(Main.java:91)\n\u003e\n\u003e\n\u003e Are line numbers correct ?\n\u003e And the Main I use is this one :\n\u003e http://ssel.vub.ac.be/viewcvs/viewcvs.py/UML1CaseStudies/uml1cs-atlcommandline/src/org/atl/commandline/Main.java?view\u003dmarkup\n\u003e\n\u003e\u003e as well as the latest ATL? \n\u003e\n\u003e In order to use the latest ATL and Eclipse version I had to update some libraries which where not available at the location indicated in the copydep.xml file. So I need to build vm.jar and emf4atl.jar myself using ATL latest source code.\n\u003e So I think libraries are OK.\n\u003e\n\u003e\u003e Please also send the parameters you give to Main.java.\n\u003e\n\u003e Here is the command I use for launching :\n\u003e --trans file:/D:/test/Families2Persons.asm --in IN\u003dfile:/D:/test/sample-Families.ecore Families\u003dfile:/D:/test/Families.ecore EMF --out OUT\u003dfile:/D:/test/sample-Persons.ecore Persons\u003dfile:/D:/test/Persons.ecore EMF\n\u003e\n\u003e\n\u003e NOTE :\n\u003e I did a little modification to the original Main.java file, at line 112 : I replaced\n\u003e URI absURI \u003d URI.createURI(uri).resolve(cwd);\n\u003e by\n\u003e URI absURI \u003d URI.createURI(uri);//.resolve(cwd);\n\u003e\n\u003e Because when launching, I had this error :\n\u003e java.lang.IllegalArgumentException: resolve against non-hierarchical or relative base\n\u003e     at org.eclipse.emf.common.util.URI.resolve(URI.java:1940)\n\u003e     at org.eclipse.emf.common.util.URI.resolve(URI.java:1913)\n\u003e     at org.atl.commandline.Main.loadModel(Main.java:112)\n\u003e     at org.atl.commandline.Main.addInputModel(Main.java:219)\n\u003e     at org.atl.commandline.Main.parseArgs(Main.java:160)\n\u003e     at org.atl.commandline.Main.main(Main.java:89)\n\u003e\n\u003e But this modification has no effect on the \"saveModel\" part, which seems to be problematic in my bug.\n\u003e\n\u003e Thanks in advance,\n\u003e William\n\u003e\n\u003e\u003e Dennis\n\u003e\u003e\n\u003e\u003e William Piers schreef:\n\u003e\u003e\u003e Hello,\n\u003e\u003e\u003e\n\u003e\u003e\u003e I attempt to run the Families2Persons Example outside Eclipse. I\u0027m using the ATL Command-Line tool done by Dennis Wagelaar.\n\u003e\u003e\u003e\n\u003e\u003e\u003e When launching the program outside of Eclipse, transformation works and the output model is generated, but an error is displayed :\n\u003e\u003e\u003e\n\u003e\u003e\u003e java.lang.IllegalStateException: Workspace is closed.java.lang.IllegalStateException: Workspace is closed.\n\u003e\u003e\u003e     at org.eclipse.core.resources.ResourcesPlugin.getWorkspace(ResourcesPlugin.java:326)Usage: \u003cthis program\u003e --trans \u003ctransformation url\u003e [--in \u003cid\u003e\u003d\u003cmodel\u003e \u003cid\u003e\u003d\u003cmetamodel\u003e \u003cMDR|EMF\u003e] [--out \u003cid\u003e\u003d\u003cmodel\u003e \u003cid\u003e\u003d\u003cmetamodel\u003e \u003cMDR|EMF\u003e] [--lib \u003cid\u003e\u003d\u003clibrary url\u003e] [--superimpose \u003ctransformation url\u003e] --next --trans ...\n\u003e\u003e\u003e\n\u003e\u003e\u003e     at org.eclipse.m2m.atl.engine.AtlEMFModelHandler.saveModel(AtlEMFModelHandler.java:144)\n\u003e\u003e\u003e     at org.eclipse.m2m.atl.engine.AtlEMFModelHandler.saveModel(AtlEMFModelHandler.java:61)\n\u003e\u003e\u003e     at org.atl.commandline.Main.run(Main.java:325)\n\u003e\u003e\u003e     at org.atl.commandline.Main.main(Main.java:92)\n\u003e\u003e\u003e\n\u003e\u003e\u003e Did someone ever has this problem ?\n\u003e\u003e\u003e Thanks in advance,\n\u003e\u003e\u003e\n\u003e\u003e\u003e William",
    "(In reply to comment #0)\n\u003e Ah, I think I found the problem:\n\u003e \n\u003e   IFile file \u003d ResourcesPlugin.getWorkspace().getRoot().getFile(\n\u003e       new Path(uri.path()));\n\u003e   file.setDerived(true);\n\u003e \n\u003e EMF can work outside the workspace with URIs, but now ATL tries to set all\n\u003e generated files as derived. ATL should only do that when the Eclipse workspace\n\u003e is available.\n\u003e \n\u003e Please copy \u0026 paste this entire conversation into bugzilla ;-) .\n\u003e \n\u003e Regards,\n\u003e Dennis\n\u003e \n\u003e P.S. If I\u0027m correct about this problem, your model should still be saved.\n\u003e Please check if this is true.\n\u003e \n\u003e William Piers schreef:\n\u003e \u003e Hello,\n\u003e \u003e\n\u003e \u003e Thanks for the answer.\n\u003e \u003e\n\u003e \u003e Dennis Wagelaar a ?crit :\n\u003e \u003e\u003e I have different line numbers than you specify in your stacktrace. Can you verify that you have the latest Main.java (from SVN)\n\u003e \u003e\n\u003e \u003e I think I use the latest version, but when I copy the stack trace I may have added some System.out.println somewhere in order to debug...\n\u003e \u003e The exact trace is :\n\u003e \u003e\n\u003e \u003e java.lang.IllegalStateException: Workspace is closed.java.lang.IllegalStateException: Workspace is closed.\n\u003e \u003e     at org.eclipse.core.resources.ResourcesPlugin.getWorkspace(ResourcesPlugin.java:326)\n\u003e \u003e     at org.eclipse.m2m.atl.engine.AtlEMFModelHandler.saveModel(AtlEMFModelHandler.java:144)\n\u003e \u003e     at org.eclipse.m2m.atl.engine.AtlEMFModelHandler.saveModel(AtlEMFModelHandler.java:61)\n\u003e \u003e     at org.atl.commandline.Main.run(Main.java:324)\n\u003e \u003e     at org.atl.commandline.Main.main(Main.java:91)\n\u003e \u003e\n\u003e \u003e\n\u003e \u003e Are line numbers correct ?\n\u003e \u003e And the Main I use is this one :\n\u003e \u003e http://ssel.vub.ac.be/viewcvs/viewcvs.py/UML1CaseStudies/uml1cs-atlcommandline/src/org/atl/commandline/Main.java?view\u003dmarkup\n\u003e \u003e\n\u003e \u003e\u003e as well as the latest ATL? \n\u003e \u003e\n\u003e \u003e In order to use the latest ATL and Eclipse version I had to update some libraries which where not available at the location indicated in the copydep.xml file. So I need to build vm.jar and emf4atl.jar myself using ATL latest source code.\n\u003e \u003e So I think libraries are OK.\n\u003e \u003e\n\u003e \u003e\u003e Please also send the parameters you give to Main.java.\n\u003e \u003e\n\u003e \u003e Here is the command I use for launching :\n\u003e \u003e --trans file:/D:/test/Families2Persons.asm --in IN\u003dfile:/D:/test/sample-Families.ecore Families\u003dfile:/D:/test/Families.ecore EMF --out OUT\u003dfile:/D:/test/sample-Persons.ecore Persons\u003dfile:/D:/test/Persons.ecore EMF\n\u003e \u003e\n\u003e \u003e\n\u003e \u003e NOTE :\n\u003e \u003e I did a little modification to the original Main.java file, at line 112 : I replaced\n\u003e \u003e URI absURI \u003d URI.createURI(uri).resolve(cwd);\n\u003e \u003e by\n\u003e \u003e URI absURI \u003d URI.createURI(uri);//.resolve(cwd);\n\u003e \u003e\n\u003e \u003e Because when launching, I had this error :\n\u003e \u003e java.lang.IllegalArgumentException: resolve against non-hierarchical or relative base\n\u003e \u003e     at org.eclipse.emf.common.util.URI.resolve(URI.java:1940)\n\u003e \u003e     at org.eclipse.emf.common.util.URI.resolve(URI.java:1913)\n\u003e \u003e     at org.atl.commandline.Main.loadModel(Main.java:112)\n\u003e \u003e     at org.atl.commandline.Main.addInputModel(Main.java:219)\n\u003e \u003e     at org.atl.commandline.Main.parseArgs(Main.java:160)\n\u003e \u003e     at org.atl.commandline.Main.main(Main.java:89)\n\u003e \u003e\n\u003e \u003e But this modification has no effect on the \"saveModel\" part, which seems to be problematic in my bug.\n\u003e \u003e\n\u003e \u003e Thanks in advance,\n\u003e \u003e William\n\u003e \u003e\n\u003e \u003e\u003e Dennis\n\u003e \u003e\u003e\n\u003e \u003e\u003e William Piers schreef:\n\u003e \u003e\u003e\u003e Hello,\n\u003e \u003e\u003e\u003e\n\u003e \u003e\u003e\u003e I attempt to run the Families2Persons Example outside Eclipse. I\u0027m using the ATL Command-Line tool done by Dennis Wagelaar.\n\u003e \u003e\u003e\u003e\n\u003e \u003e\u003e\u003e When launching the program outside of Eclipse, transformation works and the output model is generated, but an error is displayed :\n\u003e \u003e\u003e\u003e\n\u003e \u003e\u003e\u003e java.lang.IllegalStateException: Workspace is closed.java.lang.IllegalStateException: Workspace is closed.\n\u003e \u003e\u003e\u003e     at org.eclipse.core.resources.ResourcesPlugin.getWorkspace(ResourcesPlugin.java:326)Usage: \u003cthis program\u003e --trans \u003ctransformation url\u003e [--in \u003cid\u003e\u003d\u003cmodel\u003e \u003cid\u003e\u003d\u003cmetamodel\u003e \u003cMDR|EMF\u003e] [--out \u003cid\u003e\u003d\u003cmodel\u003e \u003cid\u003e\u003d\u003cmetamodel\u003e \u003cMDR|EMF\u003e] [--lib \u003cid\u003e\u003d\u003clibrary url\u003e] [--superimpose \u003ctransformation url\u003e] --next --trans ...\n\u003e \u003e\u003e\u003e\n\u003e \u003e\u003e\u003e     at org.eclipse.m2m.atl.engine.AtlEMFModelHandler.saveModel(AtlEMFModelHandler.java:144)\n\u003e \u003e\u003e\u003e     at org.eclipse.m2m.atl.engine.AtlEMFModelHandler.saveModel(AtlEMFModelHandler.java:61)\n\u003e \u003e\u003e\u003e     at org.atl.commandline.Main.run(Main.java:325)\n\u003e \u003e\u003e\u003e     at org.atl.commandline.Main.main(Main.java:92)\n\u003e \u003e\u003e\u003e\n\u003e \u003e\u003e\u003e Did someone ever has this problem ?\n\u003e \u003e\u003e\u003e Thanks in advance,\n\u003e \u003e\u003e\u003e\n\u003e \u003e\u003e\u003e William\n\u003e \n\nHi William,\n\nI already had this kind of problem in the past and I implemented a new \"save\" method which allows specifying if the model you want to save is inside or outside the workspace. This method has been integrated into the AtlEMFModelHandler class.\n\nSee https://bugs.eclipse.org/bugs/show_bug.cgi?id\u003d197797\n\nBest regards,\n\nHugo",
    "(In reply to comment #1)\n\u003e Hi William,\n\u003e \n\u003e I already had this kind of problem in the past and I implemented a new \"save\"\n\u003e method which allows specifying if the model you want to save is inside or\n\u003e outside the workspace. This method has been integrated into the\n\u003e AtlEMFModelHandler class.\n\u003e \n\u003e See https://bugs.eclipse.org/bugs/show_bug.cgi?id\u003d197797\n\u003e \n\u003e Best regards,\n\u003e \n\u003e Hugo\n\u003e \n\nHmm, this changes the API. I wonder if the following solution would also work:\n\n    try {\n        IFile file \u003d ResourcesPlugin.getWorkspace().getRoot().getFile(new Path(uri.path()));\n        if (file.exists()) {\n            file.setDerived(true);\n        }\n    } catch (IllegalStateException e) {\n        // workspace is closed\n        logger.log(Level.FINE, e.getLocalizedMessage(), e);\n    }\n\nIt puts a safety check around the block of code that causes our problems. If the workspace is closed, we can stop trying. If the file cannot be found, we don\u0027t touch it.\n\nThis should catch the following scenarios:\n1. file is not in workspace\n2. transformation is run outside Eclipse (includes scenario 1)\n\nFurthermore, this solution can be combined with your existing solution. What do you think?",
    "(In reply to comment #2)\n\u003e Hmm, this changes the API. I wonder if the following solution would also work:\n\u003e \n\nYes you\u0027re right but we added a new \"save\" method without modifying other \"save\" ones. This way we avoid compatibility problems with previously developed solutions using this class.\n\n\u003e     try {\n\u003e         IFile file \u003d ResourcesPlugin.getWorkspace().getRoot().getFile(new\n\u003e Path(uri.path()));\n\u003e         if (file.exists()) {\n\u003e             file.setDerived(true);\n\u003e         }\n\u003e     } catch (IllegalStateException e) {\n\u003e         // workspace is closed\n\u003e         logger.log(Level.FINE, e.getLocalizedMessage(), e);\n\u003e     }\n\u003e \n\u003e It puts a safety check around the block of code that causes our problems. If\n\u003e the workspace is closed, we can stop trying. If the file cannot be found, we\n\u003e don\u0027t touch it.\n\u003e \n\u003e This should catch the following scenarios:\n\u003e 1. file is not in workspace\n\u003e 2. transformation is run outside Eclipse (includes scenario 1)\n\u003e \n\u003e Furthermore, this solution can be combined with your existing solution. What do\n\u003e you think?\n\u003e \n\nYes this seems to be a good idea!\n\nHugo\n\n",
    "Solution committed to CVS:\nhttp://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.m2m/org.eclipse.m2m.atl/plugins/org.eclipse.m2m.atl.engine/src/org/eclipse/m2m/atl/engine/AtlEMFModelHandler.java?root\u003dModeling_Project\u0026r1\u003d1.10\u0026r2\u003d1.11"
  ],
  "commentCreationDates": [
    "2007-09-03T14:28:36+02:00",
    "2007-09-04T14:40:42+02:00",
    "2007-09-05T11:32:47+02:00",
    "2007-09-05T14:02:37+02:00",
    "2007-09-11T13:55:37+02:00"
  ],
  "traces": [
    {
      "exceptionType": "closed.java.lang.IllegalStateException",
      "message": "Workspace is closed. \u003e",
      "elements": [
        {
          "method": "org.eclipse.core.resources.ResourcesPlugin.getWorkspace",
          "source": "ResourcesPlugin.java:326"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "202069",
      "date": "2007-09-03T14:28:36+02:00",
      "product": "M2M",
      "component": "ATL-Engine",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.IllegalArgumentException",
      "message": "resolve against non-hierarchical or relative base \u003e",
      "elements": [
        {
          "method": "org.eclipse.emf.common.util.URI.resolve",
          "source": "URI.java:1940"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "202069",
      "date": "2007-09-03T14:28:36+02:00",
      "product": "M2M",
      "component": "ATL-Engine",
      "severity": "normal"
    },
    {
      "exceptionType": "closed.java.lang.IllegalStateException",
      "message": "Workspace is closed. \u003e\u003e\u003e",
      "elements": [
        {
          "method": "org.eclipse.core.resources.ResourcesPlugin.getWorkspace",
          "source": "ResourcesPlugin.java:326"
        }
      ],
      "number": 2,
      "commentIndex": 0,
      "bugId": "202069",
      "date": "2007-09-03T14:28:36+02:00",
      "product": "M2M",
      "component": "ATL-Engine",
      "severity": "normal"
    },
    {
      "exceptionType": "closed.java.lang.IllegalStateException",
      "message": "Workspace is closed. \u003e \u003e",
      "elements": [
        {
          "method": "org.eclipse.core.resources.ResourcesPlugin.getWorkspace",
          "source": "ResourcesPlugin.java:326"
        }
      ],
      "number": 3,
      "commentIndex": 1,
      "bugId": "202069",
      "date": "2007-09-04T14:40:42+02:00",
      "product": "M2M",
      "component": "ATL-Engine",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.IllegalArgumentException",
      "message": "resolve against non-hierarchical or relative base \u003e \u003e",
      "elements": [
        {
          "method": "org.eclipse.emf.common.util.URI.resolve",
          "source": "URI.java:1940"
        }
      ],
      "number": 4,
      "commentIndex": 1,
      "bugId": "202069",
      "date": "2007-09-04T14:40:42+02:00",
      "product": "M2M",
      "component": "ATL-Engine",
      "severity": "normal"
    },
    {
      "exceptionType": "closed.java.lang.IllegalStateException",
      "message": "Workspace is closed. \u003e \u003e\u003e\u003e",
      "elements": [
        {
          "method": "org.eclipse.core.resources.ResourcesPlugin.getWorkspace",
          "source": "ResourcesPlugin.java:326"
        }
      ],
      "number": 5,
      "commentIndex": 1,
      "bugId": "202069",
      "date": "2007-09-04T14:40:42+02:00",
      "product": "M2M",
      "component": "ATL-Engine",
      "severity": "normal"
    }
  ],
  "groupId": "202069",
  "bugId": "202069",
  "date": "2007-09-03T14:28:36+02:00",
  "product": "M2M",
  "component": "ATL-Engine",
  "severity": "normal"
}