{
  "comments": [
    "I20060807-2000\n\n* Created a new scrapbook page in a 1.5 project\n* Tried content assist after \"new java.util.ArrayList\u003c\"\n\nBOOM:\n\njava.lang.IllegalArgumentException: Index out of bounds\n\tat org.eclipse.swt.SWT.error(SWT.java:3358)\n\tat org.eclipse.swt.SWT.error(SWT.java:3297)\n\tat org.eclipse.swt.SWT.error(SWT.java:3268)\n\tat org.eclipse.swt.custom.StyledText.getLocationAtOffset(StyledText.java:3685)\n\tat org.eclipse.jface.text.contentassist.ContentAssistSubjectControlAdapter.getLocationAtOffset(ContentAssistSubjectControlAdapter.java:94)\n\tat org.eclipse.jface.text.contentassist.ContentAssistant$LayoutManager.getCaretRectangle(ContentAssistant.java:682)\n\tat org.eclipse.jface.text.contentassist.ContentAssistant$LayoutManager.computeBoundsAboveBelow(ContentAssistant.java:612)\n\tat org.eclipse.jface.text.contentassist.ContextInformationPopup.resize(ContextInformationPopup.java:440)\n\tat org.eclipse.jface.text.contentassist.ContextInformationPopup.internalShowContextFrame(ContextInformationPopup.java:360)\n\tat org.eclipse.jface.text.contentassist.ContextInformationPopup.internalShowContextInfo(ContextInformationPopup.java:280)\n\tat org.eclipse.jface.text.contentassist.ContextInformationPopup.access$5(ContextInformationPopup.java:275)\n\tat org.eclipse.jface.text.contentassist.ContextInformationPopup$2.run(ContextInformationPopup.java:262)\n\tat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:67)\n\tat org.eclipse.jface.text.contentassist.ContextInformationPopup.showContextInformation(ContextInformationPopup.java:253)\n\tat org.eclipse.jface.text.contentassist.ContentAssistant.showContextInformation(ContentAssistant.java:1653)\n\tat org.eclipse.jface.text.contentassist.CompletionProposalPopup.insertProposal(CompletionProposalPopup.java:833)\n\tat org.eclipse.jface.text.contentassist.CompletionProposalPopup.access$22(CompletionProposalPopup.java:770)\n\tat org.eclipse.jface.text.contentassist.CompletionProposalPopup$2.run(CompletionProposalPopup.java:417)\n\tat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:67)\n\tat org.eclipse.jface.text.contentassist.CompletionProposalPopup.showProposals(CompletionProposalPopup.java:404)\n\tat org.eclipse.jface.text.contentassist.ContentAssistant.showPossibleCompletions(ContentAssistant.java:1582)\n\tat org.eclipse.jface.text.source.SourceViewer.doOperation(SourceViewer.java:777)\n\tat org.eclipse.ui.texteditor.TextOperationAction$1.run(TextOperationAction.java:131)\n\tat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:67)\n\tat org.eclipse.ui.texteditor.TextOperationAction.run(TextOperationAction.java:129)\n\tat org.eclipse.jface.action.Action.runWithEvent(Action.java:499)\n\tat org.eclipse.ui.commands.ActionHandler.execute(ActionHandler.java:185)\n\tat org.eclipse.ui.internal.handlers.LegacyHandlerWrapper.execute(LegacyHandlerWrapper.java:109)\n\tat org.eclipse.core.commands.Command.executeWithChecks(Command.java:461)\n\tat org.eclipse.core.commands.ParameterizedCommand.executeWithChecks(ParameterizedCommand.java:424)\n\tat org.eclipse.ui.internal.handlers.HandlerService.executeCommand(HandlerService.java:160)\n\tat org.eclipse.ui.internal.keys.WorkbenchKeyboard.executeCommand(WorkbenchKeyboard.java:466)\n\tat org.eclipse.ui.internal.keys.WorkbenchKeyboard.press(WorkbenchKeyboard.java:799)\n\tat org.eclipse.ui.internal.keys.WorkbenchKeyboard.processKeyEvent(WorkbenchKeyboard.java:846)\n\tat org.eclipse.ui.internal.keys.WorkbenchKeyboard.filterKeySequenceBindings(WorkbenchKeyboard.java:564)\n\tat org.eclipse.ui.internal.keys.WorkbenchKeyboard.access$3(WorkbenchKeyboard.java:506)\n\tat org.eclipse.ui.internal.keys.WorkbenchKeyboard$KeyDownFilter.handleEvent(WorkbenchKeyboard.java:122)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n\tat org.eclipse.swt.widgets.Display.filterEvent(Display.java:982)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:927)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:952)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:937)\n\tat org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:965)\n\tat org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:961)\n\tat org.eclipse.swt.widgets.Widget.wmChar(Widget.java:1275)\n\tat org.eclipse.swt.widgets.Control.WM_CHAR(Control.java:3352)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3252)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:4054)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:1928)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2995)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1914)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1878)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:419)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)\n\tat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:95)\n\tat org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:78)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:104)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:74)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:401)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:177)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:85)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:58)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:60)\n\tat java.lang.reflect.Method.invoke(Method.java:391)\n\tat org.eclipse.core.launcher.Main.invokeFramework(Main.java:336)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:280)\n\tat org.eclipse.core.launcher.Main.run(Main.java:977)\n\tat org.eclipse.core.launcher.Main.main(Main.java:952)",
    "Problem does not occur in 3.2.1, may be a text issue.",
    "Looks like the fix to bug 67328 may have caused this problem? As well, there may be an issue in ContextInformationPopup.createContextFrame(...). In the case of the snippet editor, (offset - beginOffset) is negative, which results in the following line setting visibleOffset to a large number (since subtracting a negative number actually adds it).\n\nint visibleOffset\u003d fContentAssistSubjectControlAdapter.getWidgetSelectionRange().x - (offset - beginOffset);",
    "Moving to text for comment/investigation.",
    "Hm, the problems seems to be that the completion proposal created by core has wrong offsets: in the given example, the proposal states a completion offset of 155, but a replaceStart and replaceEnd of 24. Apparently, the completion offset was not stripped of any additional context added by the evalutation context. \n\n(In reply to comment #1)\n\u003e Problem does not occur in 3.2.1, may be a text issue.\n\nContext information for parameterized types has newly been introduced for 3.3 M1. Therefore, this was not previously an issue. However, invoking content assist in the following snippet (| \u003d\u003d caret) will fail in 3.2 and 20060807:\n\nnew java.util.ArrayList().contains(|)\n\nMoving to jdt-core for comments.\n",
    "As David is in vacation, I\u0027m afraid it will be too late for 3.3 M1. I\u0027ll try to investigate a little bit and let you know...",
    "Unfortunately the changes is not really easy \u003d\u003e reset bug\u0027s target\n\nSimple test case to highlight this issue (completion is done at |):\npublic class Test {\n\tvoid foo() {\n\t    new java.util.ArrayList|\n\t}\n}\nproposal is ArrayList\u003cE\u003e - java.util\nselect it and hit enter complete to new java.util.ArrayList\u003cE\u003e: OK\n\npublic class Test {\n\tvoid foo() {\n\t    new java.util.ArrayList\u003c|\n\t}\n}\nproposal is ArrayList\u003cE\u003e - java.util\nselect it and hit enter: nothing is inserted\n\nIn the latter case, proposal completionName has no chars and selectionRange is empty...",
    "Behavior described in comment 6 are the expected behavior.\nWhen \u0027ArrayList\u003c\u0027 is completed the ArrayList type is a proposal and nothing is inserted.\n\nThe exception occurs only in scrapbook page. The offset of the code snippet isn\u0027t correct in EvaluationContext#complete.",
    "Created an attachment (id\u003d49329)\nProposed fix\n\n",
    "Released for 3.3 M2.\n\nTest added\n   CompletionTests_1_5#testEC001()",
    "Verified for 3.3 M2 using build I20060918-0010.\n\nNote that you need to have preference \"Insert single proposition automatically\" set to get this exception. Otherwise, proposal is made correctly and exception occurs in log while inserting it..."
  ],
  "commentCreationDates": [
    "2006-08-08T19:38:04+02:00",
    "2006-08-08T20:31:20+02:00",
    "2006-08-08T22:12:58+02:00",
    "2006-08-08T22:14:02+02:00",
    "2006-08-09T12:36:48+02:00",
    "2006-08-09T13:31:28+02:00",
    "2006-08-09T16:23:20+02:00",
    "2006-09-04T10:51:39+02:00",
    "2006-09-04T10:52:12+02:00",
    "2006-09-04T10:56:03+02:00",
    "2006-09-18T17:15:24+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.IllegalArgumentException",
      "message": "Index out of bounds",
      "elements": [
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3358"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3297"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3268"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.getLocationAtOffset",
          "source": "StyledText.java:3685"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.ContentAssistSubjectControlAdapter.getLocationAtOffset",
          "source": "ContentAssistSubjectControlAdapter.java:94"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.ContentAssistant$LayoutManager.getCaretRectangle",
          "source": "ContentAssistant.java:682"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.ContentAssistant$LayoutManager.computeBoundsAboveBelow",
          "source": "ContentAssistant.java:612"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.ContextInformationPopup.resize",
          "source": "ContextInformationPopup.java:440"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.ContextInformationPopup.internalShowContextFrame",
          "source": "ContextInformationPopup.java:360"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.ContextInformationPopup.internalShowContextInfo",
          "source": "ContextInformationPopup.java:280"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.ContextInformationPopup.access$5",
          "source": "ContextInformationPopup.java:275"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.ContextInformationPopup$2.run",
          "source": "ContextInformationPopup.java:262"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:67"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.ContextInformationPopup.showContextInformation",
          "source": "ContextInformationPopup.java:253"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.ContentAssistant.showContextInformation",
          "source": "ContentAssistant.java:1653"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.CompletionProposalPopup.insertProposal",
          "source": "CompletionProposalPopup.java:833"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.CompletionProposalPopup.access$22",
          "source": "CompletionProposalPopup.java:770"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.CompletionProposalPopup$2.run",
          "source": "CompletionProposalPopup.java:417"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:67"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.CompletionProposalPopup.showProposals",
          "source": "CompletionProposalPopup.java:404"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.ContentAssistant.showPossibleCompletions",
          "source": "ContentAssistant.java:1582"
        },
        {
          "method": "org.eclipse.jface.text.source.SourceViewer.doOperation",
          "source": "SourceViewer.java:777"
        },
        {
          "method": "org.eclipse.ui.texteditor.TextOperationAction$1.run",
          "source": "TextOperationAction.java:131"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:67"
        },
        {
          "method": "org.eclipse.ui.texteditor.TextOperationAction.run",
          "source": "TextOperationAction.java:129"
        },
        {
          "method": "org.eclipse.jface.action.Action.runWithEvent",
          "source": "Action.java:499"
        },
        {
          "method": "org.eclipse.ui.commands.ActionHandler.execute",
          "source": "ActionHandler.java:185"
        },
        {
          "method": "org.eclipse.ui.internal.handlers.LegacyHandlerWrapper.execute",
          "source": "LegacyHandlerWrapper.java:109"
        },
        {
          "method": "org.eclipse.core.commands.Command.executeWithChecks",
          "source": "Command.java:461"
        },
        {
          "method": "org.eclipse.core.commands.ParameterizedCommand.executeWithChecks",
          "source": "ParameterizedCommand.java:424"
        },
        {
          "method": "org.eclipse.ui.internal.handlers.HandlerService.executeCommand",
          "source": "HandlerService.java:160"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.executeCommand",
          "source": "WorkbenchKeyboard.java:466"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.press",
          "source": "WorkbenchKeyboard.java:799"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.processKeyEvent",
          "source": "WorkbenchKeyboard.java:846"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.filterKeySequenceBindings",
          "source": "WorkbenchKeyboard.java:564"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.access$3",
          "source": "WorkbenchKeyboard.java:506"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard$KeyDownFilter.handleEvent",
          "source": "WorkbenchKeyboard.java:122"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.filterEvent",
          "source": "Display.java:982"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:927"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:952"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:937"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendKeyEvent",
          "source": "Widget.java:965"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendKeyEvent",
          "source": "Widget.java:961"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.wmChar",
          "source": "Widget.java:1275"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.WM_CHAR",
          "source": "Control.java:3352"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3252"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:4054"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessage",
          "source": "OS.java:1928"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2995"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1914"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1878"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:419"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:95"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:78"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:104"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:74"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:401"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:177"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:85"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:58"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:60"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:391"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:336"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:280"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:977"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:952"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "153130",
      "date": "2006-08-08T19:38:04+02:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    }
  ],
  "groupId": "153130",
  "bugId": "153130",
  "date": "2006-08-08T19:38:04+02:00",
  "product": "JDT",
  "component": "Core",
  "severity": "normal"
}