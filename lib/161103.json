{
  "comments": [
    "In case of projects that are checked into sourcecontrol, the entire workspace needs to be locked before a save happens to a resource. In org.eclipse.wst.common.internal.emfworkbench.integration.EditModel, we are passing the project as the scheduling rule, which needs to be changed to specify the workspace.",
    "Created an attachment (id\u003d52056)\nPatch that passes in the workspace as the scheduling rule to the save operation\n\n",
    "approve",
    "I approve - this was the behavior in V6  (we defaulted to workspace root).\n\nAlthough I agree it doesn\u0027t make sense for the CC(or pessimistic adapter) to lock the entire workspace.. regardless we need to prevent this rule scope collision.",
    "To provide some more background and information on this defect:  \n\nThis problem is seen when using the Clearcase Pessimistic Adapter as well as the CC Remote Client (CCRC). When a save on a resource is attempted (in this case, the EAR project\u0027s application.xml), the following check is performed in ThreadJob.push(), which is eventually called from File.setContents(InputStream, int, IProgressMonitor) : \n\n\nbaseRule.contains(rule) (This method is called )\n\nwhere \u0027baseRule\u0027 is the rule specified by us in EditModel.runSaveOperation, and \u0027rule\u0027is specified by the source control adapter. \n\nIn the case of the Clearcase Pessimistic Adapter, the rule returned by the PessimisticResourceRuleFactory is always the workspace root. This causes the above check to fail, causing the exception below to be thrown, and failing the save operation.\n\nIn V6, we were not passing any rule to the save operation, which made it default to workspace root, and the comparison described above used to succeed. However, in wtp, we are now explicitly passing the Project for the baseRule, which causes the above check to fail.\n\nIn order to fix this, we are now passing the workspace root as the scheduling rule to the save operation.\n\n*** ERROR ***: Mon Oct 16 17:26:35 EDT 2006    java.lang.IllegalArgumentException: Attempted to beginRule: R/, does not match outer scope rule: P/E1EAR\n    \tat org.eclipse.core.runtime.Assert.isLegal(Assert.java:62)\n    \tat org.eclipse.core.internal.jobs.ThreadJob.illegalPush(ThreadJob.java:116)\n    \tat org.eclipse.core.internal.jobs.ThreadJob.push(ThreadJob.java:225)\n    \tat org.eclipse.core.internal.jobs.ImplicitJobs.begin(ImplicitJobs.java:58)\n    \tat org.eclipse.core.internal.jobs.JobManager.beginRule(JobManager.java:219)\n    \tat org.eclipse.core.internal.resources.WorkManager.checkIn(WorkManager.java:96)\n    \tat org.eclipse.core.internal.resources.Workspace.prepareOperation(Workspace.java:1684)\n    \tat org.eclipse.core.internal.resources.File.setContents(File.java:358)\n    \tat org.eclipse.core.internal.resources.File.setContents(File.java:462)\n    \tat org.eclipse.core.internal.filebuffers.ResourceTextFileBuffer.commitFileBufferContent(ResourceTextFileBuffer.java:361)\n    \tat org.eclipse.core.internal.filebuffers.ResourceFileBuffer.commit(ResourceFileBuffer.java)\n    \tat org.eclipse.wst.sse.core.internal.model.ModelManagerImpl.saveModel(ModelManagerImpl.java:1532)\n    \tat org.eclipse.wst.sse.core.internal.model.AbstractStructuredModel.save(AbstractStructuredModel.java:1244)\n    \tat org.eclipse.wst.xml.core.internal.emf2xml.EMF2DOMSSERenderer.doSave(EMF2DOMSSERenderer.java:244)\n    \tat org.eclipse.wst.common.internal.emf.resource.TranslatorResourceImpl.doSave(TranslatorResourceImpl.java:178)\n    \tat org.eclipse.wst.common.internal.emf.resource.TranslatorResourceImpl.save(TranslatorResourceImpl.java:158)\n    \tat org.eclipse.wst.common.internal.emfworkbench.integration.EditModel.primSaveResource(EditModel.java:1295)\n    \tat org.eclipse.wst.common.internal.emfworkbench.integration.EditModel.saveResource(EditModel.java:1326)\n    \tat org.eclipse.wst.common.internal.emfworkbench.integration.EditModel.primSave(EditModel.java:1261)\n    \tat org.eclipse.wst.common.internal.emfworkbench.integration.EditModel$1.run(EditModel.java:371)\n    \tat org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1737)\n    \tat org.eclipse.wst.common.internal.emfworkbench.integration.EditModel.runSaveOperation(EditModel.java)\n    \tat org.eclipse.wst.common.internal.emfworkbench.integration.EditModel.save(EditModel.java:374)\n    \tat org.eclipse.wst.common.internal.emfworkbench.integration.EditModel.saveIfNecessary(EditModel.java:396)\n    \tat org.eclipse.wst.common.componentcore.ArtifactEdit.saveIfNecessary(ArtifactEdit.java:385)\n    \tat org.eclipse.wst.common.componentcore.ArtifactEdit.saveIfNecessaryWithPrompt(ArtifactEdit.java:407)\n    \tat com.ibm.etools.application.presentation.ApplicationEditor.doSave(ApplicationEditor.java:321)\n    \tat org.eclipse.ui.internal.SaveableHelper$1.run(SaveableHelper.java:131)\n    \tat org.eclipse.ui.internal.SaveableHelper$4.run(SaveableHelper.java:252)\n    \tat org.eclipse.jface.operation.ModalContext.runInCurrentThread(ModalContext.java:369)\n    \tat org.eclipse.jface.operation.ModalContext.run(ModalContext.java:313)\n    \tat org.eclipse.jface.window.ApplicationWindow$1.run(ApplicationWindow.java:763)\n    \tat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:67)\n    \tat org.eclipse.jface.window.ApplicationWindow.run(ApplicationWindow.java:760)\n    \tat org.eclipse.ui.internal.WorkbenchWindow.run(WorkbenchWindow.java:2283)\n    \tat org.eclipse.ui.internal.SaveableHelper.runProgressMonitorOperation(SaveableHelper.java:258)\n    \tat org.eclipse.ui.internal.SaveableHelper.savePart(SaveableHelper.java:136)\n    \tat org.eclipse.ui.internal.EditorManager.savePart(EditorManager.java:1386)\n    \tat org.eclipse.ui.internal.WorkbenchPage.savePart(WorkbenchPage.java:2995)\n    \tat org.eclipse.ui.internal.WorkbenchPage.saveEditor(WorkbenchPage.java:3008)\n    \tat org.eclipse.ui.internal.SaveAction.run(SaveAction.java:67)\n    \tat org.eclipse.jface.action.Action.runWithEvent(Action.java:499)\n    \tat org.eclipse.jface.commands.ActionHandler.execute(ActionHandler.java:119)\n    \tat org.eclipse.core.commands.Command.executeWithChecks(Command.java:461)\n    \tat org.eclipse.core.commands.ParameterizedCommand.executeWithChecks(ParameterizedCommand.java:424)\n    \tat org.eclipse.ui.internal.handlers.HandlerService.executeCommand(HandlerService.java:160)\n    \tat org.eclipse.ui.internal.keys.WorkbenchKeyboard.executeCommand(WorkbenchKeyboard.java:466)\n    \tat org.eclipse.ui.internal.keys.WorkbenchKeyboard.press(WorkbenchKeyboard.java:799)\n    \tat org.eclipse.ui.internal.keys.WorkbenchKeyboard.processKeyEvent(WorkbenchKeyboard.java:846)\n    \tat org.eclipse.ui.internal.keys.WorkbenchKeyboard.filterKeySequenceBindings(WorkbenchKeyboard.java:564)\n    \tat org.eclipse.ui.internal.keys.WorkbenchKeyboard.access$3(WorkbenchKeyboard.java:506)\n    \tat org.eclipse.ui.internal.keys.WorkbenchKeyboard$KeyDownFilter.handleEvent(WorkbenchKeyboard.java:122)\n    \tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n    \tat org.eclipse.swt.widgets.Display.filterEvent(Display.java:982)\n    \tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:927)\n    \tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:952)\n    \tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:937)\n    \tat org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:965)\n    \tat org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:961)\n    \tat org.eclipse.swt.widgets.Widget.wmChar(Widget.java:1275)\n    \tat org.eclipse.swt.widgets.Control.WM_CHAR(Control.java:3346)\n    \tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3246)\n    \tat org.eclipse.swt.widgets.Display.windowProc(Display.java:4025)\n    \tat org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)\n    \tat org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:1925)\n    \tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2966)\n    \tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1914)\n    \tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1878)\n    \tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:419)\n    \tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)\n    \tat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:95)\n    \tat org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:78)\n    \tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:92)\n    \tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:68)\n    \tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:400)\n    \tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:177)\n    \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)\n    \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    \tat java.lang.reflect.Method.invoke(Method.java:615)\n    \tat org.eclipse.core.launcher.Main.invokeFramework(Main.java:336)\n    \tat org.eclipse.core.launcher.Main.basicRun(Main.java:280)\n    \tat org.eclipse.core.launcher.Main.run(Main.java:977)\n    \tat org.eclipse.core.launcher.Main.main(Main.java:952)\n\n",
    "+1 \nI see the need to fix this for now in our code, but can you please ensure proper bugs open on ClearCase so \" .... it doesn\u0027t make sense for the CC(or pessimistic adapter) to lock the entire workspace\" is eventually addressed? \n\nAlso, what does java do for save? They lock whole workspace too? \n\nThanks, \n",
    "+1 (and adding myself to the CC list, since David asks a good question about how the JDT handles this)",
    "+1",
    "This is released for the 101806 WTP 1.5.2 and 2.0 builds.",
    "Verified 101906."
  ],
  "commentCreationDates": [
    "2006-10-16T20:11:47+02:00",
    "2006-10-16T20:18:30+02:00",
    "2006-10-16T22:03:29+02:00",
    "2006-10-16T22:18:51+02:00",
    "2006-10-16T23:37:07+02:00",
    "2006-10-17T13:46:11+02:00",
    "2006-10-17T15:54:20+02:00",
    "2006-10-17T16:35:01+02:00",
    "2006-10-17T18:18:28+02:00",
    "2006-10-20T16:10:03+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.IllegalArgumentException",
      "message": "Attempted to beginRule: R/, does not match outer scope rule: P/E1EAR",
      "elements": [
        {
          "method": "org.eclipse.core.runtime.Assert.isLegal",
          "source": "Assert.java:62"
        },
        {
          "method": "org.eclipse.core.internal.jobs.ThreadJob.illegalPush",
          "source": "ThreadJob.java:116"
        },
        {
          "method": "org.eclipse.core.internal.jobs.ThreadJob.push",
          "source": "ThreadJob.java:225"
        },
        {
          "method": "org.eclipse.core.internal.jobs.ImplicitJobs.begin",
          "source": "ImplicitJobs.java:58"
        },
        {
          "method": "org.eclipse.core.internal.jobs.JobManager.beginRule",
          "source": "JobManager.java:219"
        },
        {
          "method": "org.eclipse.core.internal.resources.WorkManager.checkIn",
          "source": "WorkManager.java:96"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.prepareOperation",
          "source": "Workspace.java:1684"
        },
        {
          "method": "org.eclipse.core.internal.resources.File.setContents",
          "source": "File.java:358"
        },
        {
          "method": "org.eclipse.core.internal.resources.File.setContents",
          "source": "File.java:462"
        },
        {
          "method": "org.eclipse.core.internal.filebuffers.ResourceTextFileBuffer.commitFileBufferContent",
          "source": "ResourceTextFileBuffer.java:361"
        },
        {
          "method": "org.eclipse.core.internal.filebuffers.ResourceFileBuffer.commit",
          "source": "ResourceFileBuffer.java"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.model.ModelManagerImpl.saveModel",
          "source": "ModelManagerImpl.java:1532"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.model.AbstractStructuredModel.save",
          "source": "AbstractStructuredModel.java:1244"
        },
        {
          "method": "org.eclipse.wst.xml.core.internal.emf2xml.EMF2DOMSSERenderer.doSave",
          "source": "EMF2DOMSSERenderer.java:244"
        },
        {
          "method": "org.eclipse.wst.common.internal.emf.resource.TranslatorResourceImpl.doSave",
          "source": "TranslatorResourceImpl.java:178"
        },
        {
          "method": "org.eclipse.wst.common.internal.emf.resource.TranslatorResourceImpl.save",
          "source": "TranslatorResourceImpl.java:158"
        },
        {
          "method": "org.eclipse.wst.common.internal.emfworkbench.integration.EditModel.primSaveResource",
          "source": "EditModel.java:1295"
        },
        {
          "method": "org.eclipse.wst.common.internal.emfworkbench.integration.EditModel.saveResource",
          "source": "EditModel.java:1326"
        },
        {
          "method": "org.eclipse.wst.common.internal.emfworkbench.integration.EditModel.primSave",
          "source": "EditModel.java:1261"
        },
        {
          "method": "org.eclipse.wst.common.internal.emfworkbench.integration.EditModel$1.run",
          "source": "EditModel.java:371"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1737"
        },
        {
          "method": "org.eclipse.wst.common.internal.emfworkbench.integration.EditModel.runSaveOperation",
          "source": "EditModel.java"
        },
        {
          "method": "org.eclipse.wst.common.internal.emfworkbench.integration.EditModel.save",
          "source": "EditModel.java:374"
        },
        {
          "method": "org.eclipse.wst.common.internal.emfworkbench.integration.EditModel.saveIfNecessary",
          "source": "EditModel.java:396"
        },
        {
          "method": "org.eclipse.wst.common.componentcore.ArtifactEdit.saveIfNecessary",
          "source": "ArtifactEdit.java:385"
        },
        {
          "method": "org.eclipse.wst.common.componentcore.ArtifactEdit.saveIfNecessaryWithPrompt",
          "source": "ArtifactEdit.java:407"
        },
        {
          "method": "com.ibm.etools.application.presentation.ApplicationEditor.doSave",
          "source": "ApplicationEditor.java:321"
        },
        {
          "method": "org.eclipse.ui.internal.SaveableHelper$1.run",
          "source": "SaveableHelper.java:131"
        },
        {
          "method": "org.eclipse.ui.internal.SaveableHelper$4.run",
          "source": "SaveableHelper.java:252"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext.runInCurrentThread",
          "source": "ModalContext.java:369"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext.run",
          "source": "ModalContext.java:313"
        },
        {
          "method": "org.eclipse.jface.window.ApplicationWindow$1.run",
          "source": "ApplicationWindow.java:763"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:67"
        },
        {
          "method": "org.eclipse.jface.window.ApplicationWindow.run",
          "source": "ApplicationWindow.java:760"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchWindow.run",
          "source": "WorkbenchWindow.java:2283"
        },
        {
          "method": "org.eclipse.ui.internal.SaveableHelper.runProgressMonitorOperation",
          "source": "SaveableHelper.java:258"
        },
        {
          "method": "org.eclipse.ui.internal.SaveableHelper.savePart",
          "source": "SaveableHelper.java:136"
        },
        {
          "method": "org.eclipse.ui.internal.EditorManager.savePart",
          "source": "EditorManager.java:1386"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchPage.savePart",
          "source": "WorkbenchPage.java:2995"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchPage.saveEditor",
          "source": "WorkbenchPage.java:3008"
        },
        {
          "method": "org.eclipse.ui.internal.SaveAction.run",
          "source": "SaveAction.java:67"
        },
        {
          "method": "org.eclipse.jface.action.Action.runWithEvent",
          "source": "Action.java:499"
        },
        {
          "method": "org.eclipse.jface.commands.ActionHandler.execute",
          "source": "ActionHandler.java:119"
        },
        {
          "method": "org.eclipse.core.commands.Command.executeWithChecks",
          "source": "Command.java:461"
        },
        {
          "method": "org.eclipse.core.commands.ParameterizedCommand.executeWithChecks",
          "source": "ParameterizedCommand.java:424"
        },
        {
          "method": "org.eclipse.ui.internal.handlers.HandlerService.executeCommand",
          "source": "HandlerService.java:160"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.executeCommand",
          "source": "WorkbenchKeyboard.java:466"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.press",
          "source": "WorkbenchKeyboard.java:799"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.processKeyEvent",
          "source": "WorkbenchKeyboard.java:846"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.filterKeySequenceBindings",
          "source": "WorkbenchKeyboard.java:564"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.access$3",
          "source": "WorkbenchKeyboard.java:506"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard$KeyDownFilter.handleEvent",
          "source": "WorkbenchKeyboard.java:122"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.filterEvent",
          "source": "Display.java:982"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:927"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:952"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:937"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendKeyEvent",
          "source": "Widget.java:965"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendKeyEvent",
          "source": "Widget.java:961"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.wmChar",
          "source": "Widget.java:1275"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.WM_CHAR",
          "source": "Control.java:3346"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3246"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:4025"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessage",
          "source": "OS.java:1925"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2966"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1914"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1878"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:419"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:95"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:78"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:92"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:68"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:400"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:177"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:64"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:43"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:615"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:336"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:280"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:977"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:952"
        }
      ],
      "number": 0,
      "commentIndex": 4,
      "bugId": "161103",
      "date": "2006-10-16T23:37:07+02:00",
      "product": "Web Tools",
      "component": "jst.j2ee",
      "severity": "major"
    }
  ],
  "groupId": "161103",
  "bugId": "161103",
  "date": "2006-10-16T20:11:47+02:00",
  "product": "Web Tools",
  "component": "jst.j2ee",
  "severity": "major"
}