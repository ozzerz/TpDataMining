{
  "comments": [
    "Build ID: I20070323-1616\n\nSteps To Reproduce:\nI write a plug-in that prints strings to a console view. This works fine until I print strings ending in one or more \\r characters.\n\n\nSee log:\n!ENTRY org.eclipse.ui 4 0 2007-08-02 16:03:00.531\n!MESSAGE Unhandled event loop exception\n!STACK 0\njava.lang.ArrayIndexOutOfBoundsException\n\tat java.lang.System.arraycopy(Native Method)\n\tat org.eclipse.swt.custom.StyledTextRenderer.textChanging(StyledTextRenderer.java:1277)\n\tat org.eclipse.swt.custom.StyledText.handleTextChanging(StyledText.java:5329)\n\tat org.eclipse.swt.custom.StyledText$6.textChanging(StyledText.java:4767)\n\tat org.eclipse.ui.internal.console.ConsoleDocumentAdapter.documentAboutToBeChanged(ConsoleDocumentAdapter.java:298)\n\tat org.eclipse.jface.text.AbstractDocument.fireDocumentAboutToBeChanged(AbstractDocument.java:606)\n\tat org.eclipse.jface.text.AbstractDocument.replace(AbstractDocument.java:1072)\n\tat org.eclipse.jface.text.AbstractDocument.replace(AbstractDocument.java:1091)\n\tat org.eclipse.ui.internal.console.ConsoleDocument.replace(ConsoleDocument.java:83)\n\tat org.eclipse.ui.internal.console.ConsoleDocumentAdapter.replaceTextRange(ConsoleDocumentAdapter.java:254)\n\tat org.eclipse.swt.custom.StyledText.modifyContent(StyledText.java:5738)\n\tat org.eclipse.swt.custom.StyledText.sendKeyEvent(StyledText.java:6468)\n\tat org.eclipse.swt.custom.StyledText.doContent(StyledText.java:2148)\n\tat org.eclipse.swt.custom.StyledText.handleKey(StyledText.java:5021)\n\tat org.eclipse.swt.custom.StyledText.handleKeyDown(StyledText.java:5046)\n\tat org.eclipse.swt.custom.StyledText$7.handleEvent(StyledText.java:4790)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:938)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:962)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:947)\n\tat org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:975)\n\tat org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:971)\n\tat org.eclipse.swt.widgets.Widget.wmChar(Widget.java:1285)\n\tat org.eclipse.swt.widgets.Control.WM_CHAR(Control.java:3770)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3670)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:4342)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:2226)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3282)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:2337)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:2301)\n\tat org.eclipse.ui.internal.Workbench.access$4(Workbench.java:2176)\n\tat org.eclipse.ui.internal.Workbench$4.run(Workbench.java:463)\n\tat org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:289)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:458)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)\n\tat org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:101)\n\tat org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:146)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:106)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:76)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:356)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:171)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n\tat java.lang.reflect.Method.invoke(Unknown Source)\n\tat org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:476)\n\tat org.eclipse.equinox.launcher.Main.basicRun(Main.java:416)\n\tat org.eclipse.equinox.launcher.Main.run(Main.java:1141)\n\tat org.eclipse.equinox.launcher.Main.main(Main.java:1116)\n\n\n\n2.\n3.\n\n\nMore information:\nI figured out that the error is related to the graphic update of the view. The view counts the number of lines that have to be updated.\n\nI found the following method that performs this job: \n\nclass org.eclipse.ui.internal.console.ConsoleDocumentAdapter {\n  ....\n   private int countNewLines(String string) {\n\t\tint count \u003d 0;\n\t\t\n\t\tif (string.length() \u003d\u003d 0) return 0;\n\n\t\t// work around to\n\t\t// http://bugs.sun.com/bugdatabase/view_bug.do?bug_id\u003d4994840\n\t\t// see bug 84641\n\t\tif (string.endsWith(\"\\r\")) { //$NON-NLS-1$\n\t\t\tint len \u003d string.length();\n\t\t\tint index \u003d len \u003e\u003d 2 ? len - 2 : 0;\n\t\t\tstring \u003d string.substring(0, index);\n\t\t\tcount++;\n\t\t}\n\t\t\n\t\tint lastIndex \u003d 0;\n\t\tint index \u003d 0;\n\t\t\n\t\tMatcher matcher \u003d pattern.matcher(string);\n\t\t\n\t\twhile (matcher.find()) {\n\t\t\tindex \u003d matcher.start();\n\t\t\t\n\t\t\tif (index \u003d\u003d 0)\n\t\t\t\tcount++;\n\t\t\telse if (index!\u003dstring.length())\n\t\t\t\tcount++;\n\t\t\t\n\t\t\tif (consoleWidth \u003e 0) {\n\t\t\t\tint lineLen \u003d index - lastIndex + 1;\n\t\t\t\tif (index \u003d\u003d 0) lineLen +\u003d lengths[regionCount-1];\n\t\t\t\tcount +\u003d lineLen/consoleWidth;\n\t\t\t}\n\t\t\t\n\t\t\tlastIndex \u003d index;\n\t\t}\n\t\treturn count;\n\t}\n  ....\n\nThe comment that refers to the Pattern matcher bug is already suspicious, is not it? ;-)\n\nFrom my point of view the problem is in the line:\nint index \u003d len \u003e\u003d 2 ? len - 2 : 0;\n\nsince this reduces the length of a string by _two_ characters. It should only truncate the last character! In my case e.g. a string ended in \"hello\\r\\r\\r\". This meant that it was reduced to \"hello\\r\" and the while loop just count one line.... And the problem with trailing \\r is not even solved by this, but which on the other hand did not cause problems.\n\nI suggest to replace\n\nif (string.endsWith(\"\\r\")) { //$NON-NLS-1$\n  int len \u003d string.length();\n  int index \u003d len \u003e\u003d 2 ? len - 2 : 0;\n  string \u003d string.substring(0, index);\n  count++;\n}\n\nby\n\nwhile(string.endsWith(\"\\r\"))\n{\n  string \u003d string.substring(0, string.length - 1);\n  count++;\n}\n\nIf the bug that the comment refers to is fixed as noted on the corresponding webpage, the whole code snippet can be erased anyway, since no more special treatment would be necessary.\n\nNils Hagge",
    "Debug team owns ConsoleDocumentAdapter.",
    "\n\n*** This bug has been marked as a duplicate of bug 176508 ***"
  ],
  "commentCreationDates": [
    "2007-08-03T09:59:11+02:00",
    "2007-08-08T15:12:20+02:00",
    "2007-08-24T16:38:13+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ArrayIndexOutOfBoundsException",
      "elements": [
        {
          "method": "java.lang.System.arraycopy",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.custom.StyledTextRenderer.textChanging",
          "source": "StyledTextRenderer.java:1277"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.handleTextChanging",
          "source": "StyledText.java:5329"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText$6.textChanging",
          "source": "StyledText.java:4767"
        },
        {
          "method": "org.eclipse.ui.internal.console.ConsoleDocumentAdapter.documentAboutToBeChanged",
          "source": "ConsoleDocumentAdapter.java:298"
        },
        {
          "method": "org.eclipse.jface.text.AbstractDocument.fireDocumentAboutToBeChanged",
          "source": "AbstractDocument.java:606"
        },
        {
          "method": "org.eclipse.jface.text.AbstractDocument.replace",
          "source": "AbstractDocument.java:1072"
        },
        {
          "method": "org.eclipse.jface.text.AbstractDocument.replace",
          "source": "AbstractDocument.java:1091"
        },
        {
          "method": "org.eclipse.ui.internal.console.ConsoleDocument.replace",
          "source": "ConsoleDocument.java:83"
        },
        {
          "method": "org.eclipse.ui.internal.console.ConsoleDocumentAdapter.replaceTextRange",
          "source": "ConsoleDocumentAdapter.java:254"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.modifyContent",
          "source": "StyledText.java:5738"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.sendKeyEvent",
          "source": "StyledText.java:6468"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.doContent",
          "source": "StyledText.java:2148"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.handleKey",
          "source": "StyledText.java:5021"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.handleKeyDown",
          "source": "StyledText.java:5046"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText$7.handleEvent",
          "source": "StyledText.java:4790"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:938"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:962"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:947"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendKeyEvent",
          "source": "Widget.java:975"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendKeyEvent",
          "source": "Widget.java:971"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.wmChar",
          "source": "Widget.java:1285"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.WM_CHAR",
          "source": "Control.java:3770"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3670"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:4342"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessage",
          "source": "OS.java:2226"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:3282"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:2337"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:2301"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.access$4",
          "source": "Workbench.java:2176"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$4.run",
          "source": "Workbench.java:463"
        },
        {
          "method": "org.eclipse.core.databinding.observable.Realm.runWithDefault",
          "source": "Realm.java:289"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:458"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "org.eclipse.ui.internal.ide.application.IDEApplication.start",
          "source": "IDEApplication.java:101"
        },
        {
          "method": "org.eclipse.equinox.internal.app.EclipseAppHandle.run",
          "source": "EclipseAppHandle.java:146"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:106"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:76"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:356"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:171"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.invokeFramework",
          "source": "Main.java:476"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.basicRun",
          "source": "Main.java:416"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.run",
          "source": "Main.java:1141"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.main",
          "source": "Main.java:1116"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "198776",
      "duplicateId": "176508",
      "date": "2007-08-03T09:59:11+02:00",
      "product": "Platform",
      "component": "Debug",
      "severity": "critical"
    }
  ],
  "groupId": "176508",
  "bugId": "198776",
  "duplicateId": "176508",
  "date": "2007-08-03T09:59:11+02:00",
  "product": "Platform",
  "component": "Debug",
  "severity": "critical"
}