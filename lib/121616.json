{
  "comments": [
    "Encountered during a JavaPolis demo. I was using a pre-release \ndevelopment version. However, reproducable with latest post-release \ndevelopment version as well.\n\nCreate the following source file:\n\npackage banking;\n\nimport org.aspectj.lang.annotation.Aspect;\nimport org.aspectj.lang.annotation.Pointcut;\n\npublic class Main {\n\tpublic static void main(String[] args) {\n\t\tSystem.out.println(\"Main\");\n\t}\n}\n\n@Aspect\nclass MainLogger {\n\t@Pointcut(\"execution(* main(..))\")\n\tpublic void log(JoinPoint thisJoinPoint) {\n\t\tSystem.out.println(\"Before \" thisJoinPoint\");\n\t}\n}\n\nNote that the import statement for JoinPoint is lacking. Compiling this \nsource file crahses the compiler. Adding import statement for JoinPoint \nmakes it work fine.\n\nC:\\work\\aop\\src\\workspace\\CallDebugBug\u003eajc -version\nAspectJ Compiler DEVELOPMENT built on Tuesday Dec 20, 2005 at 13:58:29 GMT\n\nC:\\work\\aop\\src\\workspace\\CallDebugBug\u003eajc -1.5 banking\\Main.java\nC:\\work\\aop\\src\\workspace\\CallDebugBug\\banking\\Main.java [error] Internal compil\ner error\njava.lang.NullPointerException\n        at org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVi\nsitor.buildFormalAdviceBindingsFrom(ValidateAtAspectJAnnotationsVisitor.java:417\n)\n        at org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVi\nsitor.convertToPointcutDeclaration(ValidateAtAspectJAnnotationsVisitor.java:513)\n\n        at org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVi\nsitor.visit(ValidateAtAspectJAnnotationsVisitor.java:188)\n        at org.aspectj.org.eclipse.jdt.internal.compiler.ast.MethodDeclaration.t\nraverse(MethodDeclaration.java:185)\n        at org.aspectj.org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.tra\nverse(TypeDeclaration.java:1195)\n        at org.aspectj.org.eclipse.jdt.internal.compiler.ast.CompilationUnitDecl\naration.traverse(CompilationUnitDeclaration.java:339)\n        at org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.beforeAnalysing(\nAjCompilerAdapter.java:154)\n        at org.aspectj.ajdt.internal.compiler.CompilerAdapter.ajc$before$org_asp\nectj_ajdt_internal_compiler_CompilerAdapter$7$db78446d(CompilerAdapter.aj:101)\n        at org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.process(Compil\ner.java:517)\n        at org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile(Compil\ner.java:329)\n        at org.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilat\nion(AjBuildManager.java:811)\n        at org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild(AjBuild\nManager.java:230)\n        at org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild(AjBu\nildManager.java:156)\n        at org.aspectj.ajdt.ajc.AjdtCommand.doCommand(AjdtCommand.java:112)\n        at org.aspectj.ajdt.ajc.AjdtCommand.runCommand(AjdtCommand.java:60)\n        at org.aspectj.tools.ajc.Main.run(Main.java:326)\n        at org.aspectj.tools.ajc.Main.runMain(Main.java:240)\n        at org.aspectj.tools.ajc.Main.main(Main.java:83)\n\n(no source information available)\nC:\\work\\aop\\src\\workspace\\CallDebugBug\\banking\\Main.java:16 [error] JoinPoint ca\nnnot be resolved to a type\npublic void log(JoinPoint thisJoinPoint) {\n                ^^^^^^^\nC:\\work\\aop\\src\\workspace\\CallDebugBug\\banking\\Main.java:17 [error] Syntax error\n, insert \")\" to complete MethodInvocation\nSystem.out.println(\"Before \" thisJoinPoint\");\n\nC:\\work\\aop\\src\\workspace\\CallDebugBug\\banking\\Main.java:17 [error] Syntax error\n, insert \";\" to complete BlockStatements\nSystem.out.println(\"Before \" thisJoinPoint\");\n\nABORT\n\nException thrown from AspectJ DEVELOPMENT\n\nThis might be logged as a bug already -- find current bugs at\n  http://bugs.eclipse.org/bugs/buglist.cgi?product\u003dAspectJ\u0026component\u003dCompiler\n\nBugs for exceptions thrown have titles File:line from the top stack,\ne.g., \"SomeFile.java:243\"\n\nIf you don\u0027t find the exception below in a bug, please add a new bug\nat http://bugs.eclipse.org/bugs/enter_bug.cgi?product\u003dAspectJ\nTo make the bug a priority, please include a test program\nthat can reproduce this exception.\n\nwhen validating @AspectJ annotations log\nwhen analysing types defined in compilation unit C:\\work\\aop\\src\\workspace\\CallD\nebugBug\\banking\\Main.java\nwhen processing compilation unit C:\\work\\aop\\src\\workspace\\CallDebugBug\\banking\\\nMain.java\nwhen batch building with classpath: c:\\java\\jdk1.5.0_04\\jre\\lib\\ext\\dnsns.jar;c:\n\\java\\jdk1.5.0_04\\jre\\lib\\ext\\localedata.jar;c:\\java\\jdk1.5.0_04\\jre\\lib\\ext\\sun\njce_provider.jar;c:\\java\\jdk1.5.0_04\\jre\\lib\\ext\\sunpkcs11.jar;c:\\java\\jdk1.5.0_\n04\\lib\\tools.jar;c:\\java\\jdk1.5.0_04\\jre\\lib\\rt.jar;C:\\java\\aspectj\\aspectj5\\lib\n\\aspectjrt.jar;C:\\java\\log4j\\jakarta-log4j-1.2.8\\dist\\lib\\log4j-1.2.8.jar;C:\\jav\na\\jess\\Jess61p5\\jess.jar;c:\\java\\j2sdkee1.3.1\\lib\\system\\cloudscape.jar;c:\\java\\\nj2sdkee1.3.1\\lib\\system\\tools.jar;c:\\java\\j2sdkee1.3.1\\lib\\cloudscape\\RmiJdbc.ja\nr;c:\\java\\j2sdkee1.3.1\\lib\\cloudscape\\cloudclient.jar;c:\\java\\j2sdkee1.3.1\\lib\\c\nlasses;c:\\java\\j2sdkee1.3.1\\classes;c:\\java\\j2sdkee1.3.1\\lib\\j2ee.jar;c:\\java\\j2\nsdkee1.3.1\\lib\\toolclasses;c:\\java\\j2sdkee1.3.1\\lib\\j2eetools.jar;c:\\java\\j2sdke\ne1.3.1\\lib\\locale;c:\\java\\j2sdkee1.3.1\\lib\\j2ee.jar;c:\\java\\j2sdkee1.3.1\\lib\\jha\nll.jar;c:\\java\\j2sdkee1.3.1\\lib\\locale;c:\\java\\jdk1.5.0_04\\lib\\tools.jar;c:\\java\n\\j2sdkee1.3.1\\lib\\jhall.jar;C:\\java\\ws\\axis\\axis-1_1\\lib\\axis.jar;C:\\java\\ws\\axi\ns\\axis-1_1\\lib\\axis-ant.jar;C:\\java\\ws\\axis\\axis-1_1\\lib\\commons-discovery.jar;C\n:\\java\\ws\\axis\\axis-1_1\\lib\\commons-logging.jar;C:\\java\\ws\\axis\\axis-1_1\\lib\\jax\nrpc.jar;C:\\java\\ws\\axis\\axis-1_1\\lib\\saaj.jar;C:\\java\\ws\\axis\\axis-1_1\\lib\\log4j\n-1.2.8.jar;C:\\java\\ws\\axis\\axis-1_1\\lib\\wsdl4j.jar;C:\\java\\concurrency\\concurren\ncy.jar;C:\\java\\junit\\junit3.8.1\\junit.jar;.;\nnull\njava.lang.NullPointerException\n        at org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVi\nsitor.buildFormalAdviceBindingsFrom(ValidateAtAspectJAnnotationsVisitor.java:417\n)\n        at org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVi\nsitor.convertToPointcutDeclaration(ValidateAtAspectJAnnotationsVisitor.java:513)\n\n        at org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVi\nsitor.visit(ValidateAtAspectJAnnotationsVisitor.java:188)\n        at org.aspectj.org.eclipse.jdt.internal.compiler.ast.MethodDeclaration.t\nraverse(MethodDeclaration.java:185)\n        at org.aspectj.org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.tra\nverse(TypeDeclaration.java:1195)\n        at org.aspectj.org.eclipse.jdt.internal.compiler.ast.CompilationUnitDecl\naration.traverse(CompilationUnitDeclaration.java:339)\n        at org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.beforeAnalysing(\nAjCompilerAdapter.java:154)\n        at org.aspectj.ajdt.internal.compiler.CompilerAdapter.ajc$before$org_asp\nectj_ajdt_internal_compiler_CompilerAdapter$7$db78446d(CompilerAdapter.aj:101)\n        at org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.process(Compil\ner.java:517)\n        at org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile(Compil\ner.java:329)\n        at org.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilat\nion(AjBuildManager.java:811)\n        at org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild(AjBuild\nManager.java:230)\n        at org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild(AjBu\nildManager.java:156)\n        at org.aspectj.ajdt.ajc.AjdtCommand.doCommand(AjdtCommand.java:112)\n        at org.aspectj.ajdt.ajc.AjdtCommand.runCommand(AjdtCommand.java:60)\n        at org.aspectj.tools.ajc.Main.run(Main.java:326)\n        at org.aspectj.tools.ajc.Main.runMain(Main.java:240)\n        at org.aspectj.tools.ajc.Main.main(Main.java:83)\n\n\n1 fail|abort, 4 errors",
    "That\u0027s one for me...",
    "Created an attachment (id\u003d34833)\nzip containing test and fix patches\n\nThe attached zip file contains two patches:\n\n* pr121616-org-aspectj-ajdt-core-patch.txt - apply to the org.aspectj.ajdt.core project - contains the proposed fix\n* pr121616-tests-patch.txt - apply to the tests project - contains the testcase\n\n\nThe problem is occuring when the only error is the lack of import for JoinPoint. In this case there are no errors marked against any other types and we visit the MethodDeclaration\u0027s using a ValidateAtAspectJAnnotationsVisitor. When we come to the MethodDeclaration corresponding to \n\npublic @Before(\"execution(* main(..))\") void log(JoinPoint thisJoinPoint) {\n}\n\nwe go ahead without checking first whether there are any errors marked against it and then blow up with the NPE. In the case of there not being an import for @Aspect as well as JoinPoint, we don\u0027t get this far because the traverse() method in TypeDeclaration has a check first to see if there\u0027s an error reported against the typedeclaration (which there is because the import of @Aspect is missing) and if there is it just returns (and hence no NPE). In the case of there just being no import for @Before then everything is ok because no adviceAnnotations or pointcutAnnotations have been added and so we don\u0027t enter the code which is causing the NPE. \n\nTherefore the proposed fix is to add a check for errors at the start of the ValidateAtAspectJAnnotationsVisitor.visit(MethodDeclaration, ClassScope). If there are errors, then just return false. ",
    "fix checked in.",
    "Closing this bug as fixed as the patch has been integrated into AspectJ. Moreover,  AJDT 1.3.1.20060309111525 for Eclipse 3.1 includes an AspectJ which contains this fix and the next build of AJDT for Eclipse 3.2M5 will also contain the fix."
  ],
  "commentCreationDates": [
    "2005-12-20T19:58:14+01:00",
    "2005-12-21T07:13:55+01:00",
    "2006-02-16T08:54:13+01:00",
    "2006-02-16T09:32:24+01:00",
    "2006-03-10T16:16:25+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVisitor.buildFormalAdviceBindingsFrom",
          "source": "ValidateAtAspectJAnnotationsVisitor.java:417 "
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVisitor.convertToPointcutDeclaration",
          "source": "ValidateAtAspectJAnnotationsVisitor.java:513"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVisitor.visit",
          "source": "ValidateAtAspectJAnnotationsVisitor.java:188"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.ast.MethodDeclaration.traverse",
          "source": "MethodDeclaration.java:185"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.traverse",
          "source": "TypeDeclaration.java:1195"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.ast.CompilationUnitDeclaration.traverse",
          "source": "CompilationUnitDeclaration.java:339"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.beforeAnalysing",
          "source": " AjCompilerAdapter.java:154"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.CompilerAdapter.ajc$before$org_aspectj_ajdt_internal_compiler_CompilerAdapter$7$db78446d",
          "source": "CompilerAdapter.aj:101"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.process",
          "source": "Compil er.java:517"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile",
          "source": "Compil er.java:329"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilation",
          "source": "AjBuildManager.java:811"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild",
          "source": "AjBuild Manager.java:230"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild",
          "source": "AjBu ildManager.java:156"
        },
        {
          "method": "org.aspectj.ajdt.ajc.AjdtCommand.doCommand",
          "source": "AjdtCommand.java:112"
        },
        {
          "method": "org.aspectj.ajdt.ajc.AjdtCommand.runCommand",
          "source": "AjdtCommand.java:60"
        },
        {
          "method": "org.aspectj.tools.ajc.Main.run",
          "source": "Main.java:326"
        },
        {
          "method": "org.aspectj.tools.ajc.Main.runMain",
          "source": "Main.java:240"
        },
        {
          "method": "org.aspectj.tools.ajc.Main.main",
          "source": "Main.java:83"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "121616",
      "date": "2005-12-20T19:58:14+01:00",
      "product": "AspectJ",
      "component": "Compiler",
      "severity": "major"
    },
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVisitor.buildFormalAdviceBindingsFrom",
          "source": "ValidateAtAspectJAnnotationsVisitor.java:417 "
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVisitor.convertToPointcutDeclaration",
          "source": "ValidateAtAspectJAnnotationsVisitor.java:513"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVisitor.visit",
          "source": "ValidateAtAspectJAnnotationsVisitor.java:188"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.ast.MethodDeclaration.traverse",
          "source": "MethodDeclaration.java:185"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.traverse",
          "source": "TypeDeclaration.java:1195"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.ast.CompilationUnitDeclaration.traverse",
          "source": "CompilationUnitDeclaration.java:339"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.beforeAnalysing",
          "source": " AjCompilerAdapter.java:154"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.CompilerAdapter.ajc$before$org_aspectj_ajdt_internal_compiler_CompilerAdapter$7$db78446d",
          "source": "CompilerAdapter.aj:101"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.process",
          "source": "Compil er.java:517"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile",
          "source": "Compil er.java:329"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilation",
          "source": "AjBuildManager.java:811"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild",
          "source": "AjBuild Manager.java:230"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild",
          "source": "AjBu ildManager.java:156"
        },
        {
          "method": "org.aspectj.ajdt.ajc.AjdtCommand.doCommand",
          "source": "AjdtCommand.java:112"
        },
        {
          "method": "org.aspectj.ajdt.ajc.AjdtCommand.runCommand",
          "source": "AjdtCommand.java:60"
        },
        {
          "method": "org.aspectj.tools.ajc.Main.run",
          "source": "Main.java:326"
        },
        {
          "method": "org.aspectj.tools.ajc.Main.runMain",
          "source": "Main.java:240"
        },
        {
          "method": "org.aspectj.tools.ajc.Main.main",
          "source": "Main.java:83"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "121616",
      "date": "2005-12-20T19:58:14+01:00",
      "product": "AspectJ",
      "component": "Compiler",
      "severity": "major"
    }
  ],
  "groupId": "121616",
  "bugId": "121616",
  "date": "2005-12-20T19:58:14+01:00",
  "product": "AspectJ",
  "component": "Compiler",
  "severity": "major"
}