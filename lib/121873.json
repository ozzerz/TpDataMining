{
  "comments": [
    "In report item script functions, i.e. onCreate(), onRender(), try writing some javascript code to use birt classes which are in plugins that are not explicitly depended on by the Viewer(for example, org.eclipse.birt.chart.util.CDateTime in birt.chart.engine plugin), Exception will be thrown out. \n\nThis is because Viewer now uses the EclipseClassLoader to load all plugin classes while EclipseClassLoader will restrict the accessing privilege due to the plugin dependency rules. So only classes in birt.core, birt.report.engine, birt.report.model, birt.data can be accessed currently in script. \n\nSo this prevents the user from using those birt classes in script. Reargding to chart, this lowers the usability a lot, since in chart scripting, user usually need to use/access many chart attributes classes to change the chart model, but now they can\u0027t do this in BIRT. This works fine for chart standalone mode.",
    "Sample script:\n----------------------------------\n\nimportPackage(Packages.org.eclipse.birt.chart.util);\njava.lang.System.out.println(new CDateTime() + \"-------------\");\n\n----------------------------------\n\nput this in chart.onGeneration() function on table.onRender() function and preview, it will result in the same error:\n\nCaused by: org.mozilla.javascript.EcmaError: ReferenceError: \"CDateTime\" is not defined. (#5)\n\tat org.mozilla.javascript.ScriptRuntime.constructError(ScriptRuntime.java:3240)\n\tat org.mozilla.javascript.ScriptRuntime.constructError(ScriptRuntime.java:3230)\n\tat org.mozilla.javascript.ScriptRuntime.notFoundError(ScriptRuntime.java:3303)\n\tat org.mozilla.javascript.ScriptRuntime.nameOrFunction(ScriptRuntime.java:1632)\n\tat org.mozilla.javascript.ScriptRuntime.name(ScriptRuntime.java:1571)\n\tat org.mozilla.javascript.gen.c104._c0(:5)\n\tat org.mozilla.javascript.gen.c104.call()\n\tat org.mozilla.javascript.ContextFactory.doTopCall(ContextFactory.java:304)\n\tat org.mozilla.javascript.ScriptRuntime.doTopCall(ScriptRuntime.java:2769)\n\tat org.mozilla.javascript.gen.c104.call()\n\tat org.mozilla.javascript.gen.c104.exec()\n\tat org.eclipse.birt.core.script.ScriptContext.eval(ScriptContext.java:231)\n\tat org.eclipse.birt.report.engine.executor.ExecutionContext.evaluate(ExecutionContext.java:414)\n\t... 65 more\n",
    "Here are two possible resolutions:\n\n1. Put all birt jars in the tomcat class search path, so rhino can find them then.\n\n2. Write a ViewerClassloader and pass it to rhino through engine api(engine must provide api to support this). The ViewerClassLoader must be able to load those birt plugins(including birt extension plugins) by ignoring the eclipse plugin dependency rules. So rhino will delegate the classloading to ViewerClassLoader then.",
    "Blocks chart script bugs.",
    "We can\u0027t take the first solution because that requires us to copy all BIRT extensions to viewer/birt/plugin folders, which is a bug we have fixed in BIRT 2.0.\n\nWe need to pass a custom plugin class loder to tomcat, see the following code in viewer. \n\n\t\t\t// we get the server before constructing the class loader, so\n\t\t\t// class loader exposed by the server is available to the webapps.\n\t\t\tIWebappServer server \u003d AppServerWrapper.getInstance( )\n\t\t\t\t\t.getAppServer( );\n\t\t\tserver.start( webappName, webappPath, new PluginClassLoaderWrapper(\n\t\t\t\t\tpluginId ) );\n\n\t\t\tapplicationsStarted \u003d true;\n\n\nThe custom plugin class loader should be ale to load classes that we place under $BIRTScriptlib folder.",
    "A better solution will be:\n \n- assume people will create a java project in the current workspace, and add all jar files into the java project,\n\n- viewerClassLoaderWrapper will include all java project\u0027s classpath in the current workspace into its class loader URLs.\n \nIn this way, as long as the classes are added into a java project in the current workspace, they will be available in javaScript. This is also consistent with scripting in java.\n",
    "It should load the BIRT and BIRT extension plugins from the registered plugins in the Eclipse platform, not from the workspace (although we could also include the workspace ones). \n",
    "The fix is for people to access their own classes or jars from BIRT script. \nAll java classes or jars in the current workspace will be avaliable for scripting.\n\nTo make all BIRT componment for scripting, we can simply add them as viewer\u0027s dependants.",
    "Use the all bundle to load the class. \n",
    "Verified",
    "closed."
  ],
  "commentCreationDates": [
    "2005-12-22T10:50:28+01:00",
    "2005-12-22T10:52:23+01:00",
    "2005-12-22T11:09:24+01:00",
    "2005-12-22T18:35:08+01:00",
    "2005-12-22T18:57:22+01:00",
    "2005-12-23T08:07:14+01:00",
    "2005-12-23T11:12:52+01:00",
    "2005-12-23T16:45:01+01:00",
    "2005-12-26T03:34:24+01:00",
    "2005-12-27T06:37:41+01:00",
    "2005-12-30T04:18:07+01:00"
  ],
  "traces": [
    {
      "exceptionType": "ReferenceError",
      "message": "\"CDateTime\" is not defined. (#5)",
      "elements": [
        {
          "method": "org.mozilla.javascript.ScriptRuntime.constructError",
          "source": "ScriptRuntime.java:3240"
        },
        {
          "method": "org.mozilla.javascript.ScriptRuntime.constructError",
          "source": "ScriptRuntime.java:3230"
        },
        {
          "method": "org.mozilla.javascript.ScriptRuntime.notFoundError",
          "source": "ScriptRuntime.java:3303"
        },
        {
          "method": "org.mozilla.javascript.ScriptRuntime.nameOrFunction",
          "source": "ScriptRuntime.java:1632"
        },
        {
          "method": "org.mozilla.javascript.ScriptRuntime.name",
          "source": "ScriptRuntime.java:1571"
        },
        {
          "method": "org.mozilla.javascript.gen.c104._c0",
          "source": ":5"
        }
      ],
      "number": 0,
      "commentIndex": 1,
      "bugId": "121873",
      "date": "2005-12-22T10:52:23+01:00",
      "product": "BIRT",
      "component": "Report Viewer",
      "severity": "critical"
    }
  ],
  "groupId": "121873",
  "bugId": "121873",
  "date": "2005-12-22T10:50:28+01:00",
  "product": "BIRT",
  "component": "Report Viewer",
  "severity": "critical"
}