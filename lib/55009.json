{
  "comments": [
    "Build 200403161300\n\nWhen running a failing JUnit testcase interactively in Eclipse (Run -\u003e JUnit \nPlug-in Test, default arguments), I get a NPE (see stack trace below).\n\nThe testcase I am running contains the following:\n\nimport junit.framework.TestCase;\npublic class TestFoo extends TestCase{\n\t\n\tpublic void testThis(){\n\t\tassertTrue(false);\n\t}\n}\n\n\n\n!SESSION Mar 16, 2004 15:06:57.265 --------------------------------------------\n-\njava.version\u003d1.4.2\njava.vendor\u003dSun Microsystems Inc.\nBootLoader constants: OS\u003dwin32, ARCH\u003dx86, WS\u003dwin32, NL\u003den_US\nCommand-line arguments: -version 3 -application \norg.eclipse.pde.junit.runtime.coretestapplication -data D:\\runtime-test-\nworkspace -dev bin -port 1242 -testpluginname chkpii -classnames chkpii.TestFoo\n!ENTRY reference:file:D:/eclipse/plugins/org.eclipse.core.runtime_3.0.0/ 0 0 \nMar 16, 2004 15:06:57.281\n!MESSAGE FrameworkEvent.ERROR\n!STACK 0\norg.osgi.framework.BundleException: Exception in \norg.eclipse.core.internal.runtime.PlatformActivator.stop()\n\tat org.eclipse.osgi.framework.internal.core.BundleContext.stop\n(BundleContext.java:1044)\n\tat org.eclipse.osgi.framework.internal.core.BundleHost.stopWorker\n(BundleHost.java:482)\n\tat org.eclipse.osgi.framework.internal.core.Bundle.suspend\n(Bundle.java:583)\n\tat org.eclipse.osgi.framework.internal.core.Framework.suspendBundle\n(Framework.java:993)\n\tat org.eclipse.osgi.framework.internal.core.StartLevelImpl.decFWSL\n(StartLevelImpl.java:626)\n\tat \norg.eclipse.osgi.framework.internal.core.StartLevelImpl.doSetStartLevel\n(StartLevelImpl.java:277)\n\tat org.eclipse.osgi.framework.internal.core.StartLevelImpl.shutdown\n(StartLevelImpl.java:250)\n\tat org.eclipse.osgi.framework.internal.core.SystemBundle.suspend\n(SystemBundle.java:196)\n\tat org.eclipse.osgi.framework.internal.core.Framework.shutdown\n(Framework.java:434)\n\tat org.eclipse.osgi.framework.internal.core.SystemBundle$1.run\n(SystemBundle.java:181)\n\tat java.lang.Thread.run(Thread.java:534)\nNested exception:\njava.lang.NullPointerException\n\tat org.eclipse.core.internal.runtime.DataArea.createLocation\n(DataArea.java:141)\n\tat org.eclipse.core.internal.runtime.DataArea.initializeLocation\n(DataArea.java:122)\n\tat org.eclipse.core.internal.runtime.DataArea.assertLocationInitialized\n(DataArea.java:59)\n\tat org.eclipse.core.internal.runtime.DataArea.getVersionPath\n(DataArea.java:108)\n\tat org.eclipse.core.internal.runtime.InternalPlatform.writeVersion\n(InternalPlatform.java:1287)\n\tat org.eclipse.core.internal.runtime.InternalPlatform.stop\n(InternalPlatform.java:456)\n\tat org.eclipse.core.internal.runtime.PlatformActivator.stop\n(PlatformActivator.java:129)\n\tat org.eclipse.osgi.framework.internal.core.BundleContext$2.run\n(BundleContext.java:1028)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat org.eclipse.osgi.framework.internal.core.BundleContext.stop\n(BundleContext.java:1024)\n\tat org.eclipse.osgi.framework.internal.core.BundleHost.stopWorker\n(BundleHost.java:482)\n\tat org.eclipse.osgi.framework.internal.core.Bundle.suspend\n(Bundle.java:583)\n\tat org.eclipse.osgi.framework.internal.core.Framework.suspendBundle\n(Framework.java:993)\n\tat org.eclipse.osgi.framework.internal.core.StartLevelImpl.decFWSL\n(StartLevelImpl.java:626)\n\tat \norg.eclipse.osgi.framework.internal.core.StartLevelImpl.doSetStartLevel\n(StartLevelImpl.java:277)\n\tat org.eclipse.osgi.framework.internal.core.StartLevelImpl.shutdown\n(StartLevelImpl.java:250)\n\tat org.eclipse.osgi.framework.internal.core.SystemBundle.suspend\n(SystemBundle.java:196)\n\tat org.eclipse.osgi.framework.internal.core.Framework.shutdown\n(Framework.java:434)\n\tat org.eclipse.osgi.framework.internal.core.SystemBundle$1.run\n(SystemBundle.java:181)\n\tat java.lang.Thread.run(Thread.java:534)",
    "Rafael, can you check this out?\n",
    "It actually does not matter if the test fails or not. The trigger is that the\ntests don\u0027t cause the DataArea to be created during normal execution. Thus we\nend up trying to create the metadata location during InternalPlatform#stop, when\ntrying to write the workspace version. At that time, we had already released any\nreferences to the log service, and the NPE happens because we are trying to set\nthe log file location from DataArea#createLocation.\n\nAn easy fix would be to postpone the cleanup of the service references to after\nwe call InternalPlatform#stop.\n\nBut what I think is the right fix is that we should not be trying to create the\ndata area only for the sake of writing the version there.\n\nAccording to Jeff, we should not be trying to write the workspace version from\nthe InternalPlatform#stop method (UI is in charge of doing that now). Moving to\nJeff as requested.",
    "Fixed and released to HEAD.",
    "Jeff to release more changes...\n",
    "all related change released."
  ],
  "commentCreationDates": [
    "2004-03-16T20:17:01+01:00",
    "2004-03-16T22:51:08+01:00",
    "2004-03-17T16:28:15+01:00",
    "2004-03-17T23:51:21+01:00",
    "2004-03-17T23:51:47+01:00",
    "2004-03-21T01:19:38+01:00"
  ],
  "traces": [
    {
      "exceptionType": "org.osgi.framework.BundleException",
      "message": "Exception in  org.eclipse.core.internal.runtime.PlatformActivator.stop()",
      "elements": [
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContext.stop",
          "source": "BundleContext.java:1044"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleHost.stopWorker",
          "source": "BundleHost.java:482"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Bundle.suspend",
          "source": "Bundle.java:583"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Framework.suspendBundle",
          "source": "Framework.java:993"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelImpl.decFWSL",
          "source": "StartLevelImpl.java:626"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelImpl.doSetStartLevel",
          "source": "StartLevelImpl.java:277"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelImpl.shutdown",
          "source": "StartLevelImpl.java:250"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.SystemBundle.suspend",
          "source": "SystemBundle.java:196"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Framework.shutdown",
          "source": "Framework.java:434"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.SystemBundle$1.run",
          "source": "SystemBundle.java:181"
        },
        {
          "method": "java.lang.Thread.run",
          "source": "Thread.java:534"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "55009",
      "date": "2004-03-16T20:17:01+01:00",
      "product": "Equinox",
      "component": "Incubator",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.core.internal.runtime.DataArea.createLocation",
          "source": "DataArea.java:141"
        },
        {
          "method": "org.eclipse.core.internal.runtime.DataArea.initializeLocation",
          "source": "DataArea.java:122"
        },
        {
          "method": "org.eclipse.core.internal.runtime.DataArea.assertLocationInitialized",
          "source": "DataArea.java:59"
        },
        {
          "method": "org.eclipse.core.internal.runtime.DataArea.getVersionPath",
          "source": "DataArea.java:108"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.writeVersion",
          "source": "InternalPlatform.java:1287"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.stop",
          "source": "InternalPlatform.java:456"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator.stop",
          "source": "PlatformActivator.java:129"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContext$2.run",
          "source": "BundleContext.java:1028"
        },
        {
          "method": "java.security.AccessController.doPrivileged",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContext.stop",
          "source": "BundleContext.java:1024"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleHost.stopWorker",
          "source": "BundleHost.java:482"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Bundle.suspend",
          "source": "Bundle.java:583"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Framework.suspendBundle",
          "source": "Framework.java:993"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelImpl.decFWSL",
          "source": "StartLevelImpl.java:626"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelImpl.doSetStartLevel",
          "source": "StartLevelImpl.java:277"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelImpl.shutdown",
          "source": "StartLevelImpl.java:250"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.SystemBundle.suspend",
          "source": "SystemBundle.java:196"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Framework.shutdown",
          "source": "Framework.java:434"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.SystemBundle$1.run",
          "source": "SystemBundle.java:181"
        },
        {
          "method": "java.lang.Thread.run",
          "source": "Thread.java:534"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "55009",
      "date": "2004-03-16T20:17:01+01:00",
      "product": "Equinox",
      "component": "Incubator",
      "severity": "normal"
    }
  ],
  "groupId": "55009",
  "bugId": "55009",
  "date": "2004-03-16T20:17:01+01:00",
  "product": "Equinox",
  "component": "Incubator",
  "severity": "normal"
}