{
  "comments": [
    "I\u0027m using GFM using DiagramRenderUtil.renderToSWTImage(Diagram d) to get an Image file back and I\u0027m seeing a case where the API fails with a null pointer exception (below). \n\nIn a nut shell using \n\nimport org.eclipse.gmf.runtime.notation.Diagram;\nimport org.eclipse.gmf.runtime.diagram.ui.render.util.DiagramRenderUtil;\n\nI make the following API call\n\nDisplay.getDefault().syncExec(new Runnable() {\n  public void run() {\n    for (Iterator it \u003d set.iterator(); it.hasNext();) {\n      final Object o \u003d it.next();\n      // DiagramImpl\n      if (o instanceof Diagram) {\n\ttry {\n\t  Diagram diag \u003d (Diagram) o;\n\t  // Exception occurs here!!!\n\t  Image result \u003d DiagramRenderUtil.renderToSWTImage(diag);\n\t  nodeSetImpl.add(result);\n\t} catch (Exception e) {\n\t  e.printStackTrace();\n\t}\n    }\n  }\n}\n\n\njava.lang.NullPointerException\n\tat org.eclipse.gmf.runtime.diagram.core.listener.DiagramEventBroker.initializeDiagramEventBroker(DiagramEventBroker.java:224)\n\tat org.eclipse.gmf.runtime.diagram.core.listener.DiagramEventBroker.startListening(DiagramEventBroker.java:213)\n\tat org.eclipse.gmf.runtime.diagram.ui.OffscreenEditPartFactory.createDiagramEditPart(OffscreenEditPartFactory.java:107)\n\tat org.eclipse.gmf.runtime.diagram.ui.OffscreenEditPartFactory.createDiagramEditPart(OffscreenEditPartFactory.java:58)\n\tat org.eclipse.gmf.runtime.diagram.ui.render.util.DiagramRenderUtil.renderToSWTImage(DiagramRenderUtil.java:71)\n\tat com.ibm.ccl.oda.emf.internal.functions.GetDiagram$1.run(GetDiagram.java:63)\n\ntracing into this I get to the line\n\n  DiagramEventBroker.startListening(TransactionUtil.getEditingDomain(diagram));\n\nin the file OffscreenEditPartFactory.java and this is where this fails. \n\n\nany ideas why this would fail the way it does, and note it seems to be random as well... sometimes it works fine, other times, I see the Null pointer exception.",
    "more info, so I debugged this futher and I get to the routine\n\npublic TransactionalEditingDomain getEditingDomain(ResourceSet rset)\n\nin the file org.eclipse.emf.transaction.impl\n\nin this routine the code\n\nResourceSetDomainLink link \u003d (ResourceSetDomainLink) EcoreUtil.getAdapter(rset.eAdapters(),ResourceSetDomainLink.class);\n\nis called, this is returning null if that helps any. \n\nNote that the model that I get the diagram element from is part of a org.eclipse.emf.ecore.resource.impl.ResourceSetImpl;\n\nand the call _resourceSet.getResource(_uri, true); gets the resource.\n\n\n\n",
    "ok debugging this further it seems that I need to provide an EMF editing domain during resourceset creation. \n\nAs a side note, it looks like the NPE  returned from \nTransactionUtil.getEditingDomain(diagram)\n\nin the call to \n\nDiagramEventBroker.startListening(TransactionUtil.getEditingDomain(diagram));\n\nin the method\n\npublic DiagramEditPart createDiagramEditPart(\n        Diagram diagram, Shell shell, PreferencesHint preferencesHint)\n\nin org.eclipse.gmf.runtime.diagram.ui.OffscreenEditPartFactory\n\nshould be handled better? not sure maybe its best it throws... \n\n"
  ],
  "commentCreationDates": [
    "2007-06-21T01:18:26+02:00",
    "2007-06-21T01:30:32+02:00",
    "2007-06-22T20:05:46+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.gmf.runtime.diagram.core.listener.DiagramEventBroker.initializeDiagramEventBroker",
          "source": "DiagramEventBroker.java:224"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.core.listener.DiagramEventBroker.startListening",
          "source": "DiagramEventBroker.java:213"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.OffscreenEditPartFactory.createDiagramEditPart",
          "source": "OffscreenEditPartFactory.java:107"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.OffscreenEditPartFactory.createDiagramEditPart",
          "source": "OffscreenEditPartFactory.java:58"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.render.util.DiagramRenderUtil.renderToSWTImage",
          "source": "DiagramRenderUtil.java:71"
        },
        {
          "method": "com.ibm.ccl.oda.emf.internal.functions.GetDiagram$1.run",
          "source": "GetDiagram.java:63"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "193633",
      "date": "2007-06-21T01:18:26+02:00",
      "product": "GMF",
      "component": "Runtime Diagram",
      "severity": "normal"
    }
  ],
  "groupId": "193633",
  "bugId": "193633",
  "date": "2007-06-21T01:18:26+02:00",
  "product": "GMF",
  "component": "Runtime Diagram",
  "severity": "normal"
}