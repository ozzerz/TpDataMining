{
  "comments": [
    "Build ID: M20060629-1905\n\nSteps To Reproduce:\n1. Run this code using prior WMP versions (works fine)\n    OleFrame frame \u003d new OleFrame(shell, SWT.NONE);\n    OleControlSite controlSite \u003d new OleControlSite(frame, SWT.NONE, \"WMPlayer.OCX\");\n\n2. Run the same code using Windows Media Player 11, it crashes during OleControlSite construction:\n\n    Exception in thread \"main\" org.eclipse.swt.SWTException: Failed to create Ole Client. result \u003d -2147467259\n        at org.eclipse.swt.ole.win32.OLE.error(OLE.java:302)\n        at org.eclipse.swt.ole.win32.OleControlSite.\u003cinit\u003e(OleControlSite.java:101)\n\n\nMore information:\nWe have an Eclipse Platform application that embeds WMP (Windows Media Player).\nIt works fine if running with version 9 of the WMP, but it doesn\u0027t work at all if running with version 11 of the WMP.\n\nEnvironment: Windows XP Professional / Windows Media Player 11 / JDK 5.0 update 10 / Eclipse 3.2.0 build M20060629-1905",
    "Can you provide a simple snippet of code that opens the WMP on a file?",
    "(In reply to comment #1)\n\u003e Can you provide a simple snippet of code that opens the WMP on a file?\n\u003e \nHere?s a sample method for viewing a movie:\n\tprivate void createContents(Shell shell) {\n\t\tString filename \u003d \"C:\\\\myMovie.wmv\";\n\t\tOleFrame frame \u003d new OleFrame(shell, SWT.NONE);\n\t\tOleControlSite controlSite \u003d new OleControlSite(frame, SWT.NONE, \"WMPlayer.OCX\");\n\t\tOleAutomation player \u003d new OleAutomation(controlSite);\n\t\tcontrolSite.doVerb(OLE.OLEIVERB_SHOW);\n\t\tshell.setLayout(new GridLayout());\n\t\tshell.setSize(800, 600);\n\t\tframe.setSize(800, 600);\n\t\tcontrolSite.setSize(800, 600);\n\t\tint ids[] \u003d player.getIDsOfNames(new String[] {\"uiMode\"});\n\t\tif (ids !\u003d null) {\n\t\t\tplayer.setProperty(ids[0], new Variant(\"full\"));\n\t\t}\n\t\tids \u003d player.getIDsOfNames(new String[] {\"enableContextMenu\"});\n\t\tif (ids !\u003d null) {\n\t\t\tplayer.setProperty(ids[0], new Variant(true));\n\t\t}\n\t\tids \u003d player.getIDsOfNames(new String[] {\"URL\"});\n\t\tif (ids !\u003d null) {\n\t\t\tVariant theFile \u003d new Variant(filename);\n\t\t\tplayer.setProperty(ids[0], theFile);\n\t\t}\n\t}\n\nHope it helps to find a solution\n\n",
    "Thanks for the sample code. I\u0027m able to replicate it now but I don\u0027t know why WMP 11 failed to work while the previous versions of WMP works.",
    "I tried for 2 days to find a workaround using the SWT API, but\nsomething deeper is probably required. It seems some people had the\nsame issue in VBA and found a workaround:\nhttp://p2p.wrox.com/topic.asp?TOPIC_ID\u003d58758\nthey put the control in a form and use the control that was created\nthere. If someone could find out how the form creates the object,\nmaybe it could be solved the same way for us.",
    "I read the attached P2P forum thread and to be honest I don\u0027t know how to translate the VB work around to Java. I\u0027ll do a little more searching.",
    "I have this problem too, using:\n\njava version \"1.6.0_02\"\nJava(TM) SE Runtime Environment (build 1.6.0_02-b06)\nJava HotSpot(TM) Client VM (build 1.6.0_02-b06, mixed mode, sharing)\n\nswt-3.3-win32-win32-x86.zip\n\nSorry to but in, but we are rather desperate for a fix/workaround.",
    "I was able to fix this by modifying the following line in OleControlSite.java (around line 102), from:\n\nint result \u003d COM.OleCreate(appClsid, COM.IIDIUnknown, COM.OLERENDER_DRAW, null, 0, tempStorage.getAddress(), address);\n\nto:\n\nint result \u003d COM.OleCreate(appClsid, COM.IIDIUnknown, COM.OLERENDER_DRAW, null, iOleClientSite.getAddress(), tempStorage.getAddress(), address);\n\nApparently WMP 11 needs the iOleClientSite at Ole creation.  I see that OleClientSite has a OleCreate and 2 OleCreateFromFile calls that would probably also need this parameter if this fix is acceptable.",
    "On second thought, I should probably use iOleControlSite.getAddress() instead of iOleClientSite. ",
    "I tried using OleControlSite -- it didn\u0027t work. The docs from MSDN says that it should be OleClientSite. By the way, thanks for the fix.",
    "Fixed \u003e 070926\n\nThe OleClientSite and OleControlSite are changed so that they call OleCreate and OleCreateFromFile with the handle to the OleClientSite. According to the docs, this parameter is optional (NULL) if we call SetClientSite later. However, WMP 11 requires it during creation."
  ],
  "commentCreationDates": [
    "2007-02-08T22:39:40+01:00",
    "2007-02-16T00:08:48+01:00",
    "2007-02-16T19:14:02+01:00",
    "2007-02-19T22:08:11+01:00",
    "2007-07-23T08:41:00+02:00",
    "2007-07-30T20:35:07+02:00",
    "2007-09-04T16:49:36+02:00",
    "2007-09-25T09:29:35+02:00",
    "2007-09-26T02:02:28+02:00",
    "2007-09-26T16:36:28+02:00",
    "2007-09-26T23:47:59+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.swt.SWTException",
      "message": "Failed to create Ole Client. result \u003d -2147467259",
      "elements": [
        {
          "method": "org.eclipse.swt.ole.win32.OLE.error",
          "source": "OLE.java:302"
        },
        {
          "method": "org.eclipse.swt.ole.win32.OleControlSite.\u003cinit\u003e",
          "source": "OleControlSite.java:101"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "173556",
      "date": "2007-02-08T22:39:40+01:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "major"
    }
  ],
  "groupId": "173556",
  "bugId": "173556",
  "date": "2007-02-08T22:39:40+01:00",
  "product": "Platform",
  "component": "SWT",
  "severity": "major"
}