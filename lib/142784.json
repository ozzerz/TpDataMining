{
  "comments": [
    "Build: I20060519-0010\n\nThese steps may look familiar...  Follow them carefully to get the bug.\n\n1) Create a new .product file in the *navigator* view\n2) In the product editor, set the product name to \"foo\" (don\u0027t save)\n3) In the navigator, select the product file and delete\n4) When prompted to confirm deletion, click yes\n5) When prompted to confirm save, click cancel\n6) Back in the product editor, change the product name to \"bar\"\n7) Now click the editor close tab for the product editor.\n\nA NullPointerException occurs.  Now we are in a really broken state.  Anything you do to change focus, such as opening wizards and dialogs will fail because the NPE occurs during a focusLost callback. The only thing you can do is close the workbench. A bunch more exceptions occur during shutdown.\n\nI will attach the log, but here is a snippet:\n\njava.lang.NullPointerException\n\tat org.eclipse.pde.internal.ui.editor.product.ProductInfoSection.getProduct(ProductInfoSection.java:250)\n\tat org.eclipse.pde.internal.ui.editor.product.ProductInfoSection.access$0(ProductInfoSection.java:249)\n\tat org.eclipse.pde.internal.ui.editor.product.ProductInfoSection$1.textValueChanged(ProductInfoSection.java:104)\n\tat org.eclipse.pde.internal.ui.parts.FormEntry.commit(FormEntry.java:226)\n\tat org.eclipse.pde.internal.ui.parts.FormEntry$4.focusLost(FormEntry.java:210)",
    "Created an attachment (id\u003d42028)\nLog file\n\n",
    "Note, it is also weird if you click \"yes\" when prompted to save, because this is all occuring after the file has been deleted. ProductEditor.contextRemoved is responding to an after the fact resource change event after the file has been deleted, but it sets the \"save\" flag to true when closing the editor. The result is that the user is prompted to save, but clicking yes the file is not saved.",
    "I thought about that when we were investigating the deadlock yesterday.\n\nIn the contextRemoved() method, we should not be calling close(true).  No need to prompt the user to save if the file is being deleted.\n\nTrivial fix,  but not critical for 3.2 though.  Perhaps 3.2.1",
    "I agree it\u0027s not for 3.2.  Even though the side-effect is severe, it is actually quite difficult to get into this state - it took me several attempts of purposely trying to break it before I got into the NPE state.  The user steps - confirming the delete, canceling the save, and then editing the file again, are not likely to occur in the wild.  Boris is going to enter a platform bug about making the platform more resilient to errors ocurring in a focus lost event.",
    "Yes, I filed Bug 142791 so that we can protect against Exceptions being thrown from focus listeners.\n",
    "Releasing fix into post32 branch: \n\n\tpublic void contextRemoved(InputContext context) {\n-\t\tclose(true);\n+\t\tclose(false);\n\t}\n\non single source pde editors. \n",
    "Created an attachment (id\u003d42046)\npatch\n\nif needed this patch can be applied to HEAD for the 3.2.1 fixpack",
    "fix released in 3.2.x maintenance branch."
  ],
  "commentCreationDates": [
    "2006-05-19T17:20:26+02:00",
    "2006-05-19T17:21:43+02:00",
    "2006-05-19T17:34:54+02:00",
    "2006-05-19T17:38:50+02:00",
    "2006-05-19T17:45:49+02:00",
    "2006-05-19T17:46:26+02:00",
    "2006-05-19T19:31:03+02:00",
    "2006-05-19T19:31:41+02:00",
    "2006-06-22T23:55:10+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.pde.internal.ui.editor.product.ProductInfoSection.getProduct",
          "source": "ProductInfoSection.java:250"
        },
        {
          "method": "org.eclipse.pde.internal.ui.editor.product.ProductInfoSection.access$0",
          "source": "ProductInfoSection.java:249"
        },
        {
          "method": "org.eclipse.pde.internal.ui.editor.product.ProductInfoSection$1.textValueChanged",
          "source": "ProductInfoSection.java:104"
        },
        {
          "method": "org.eclipse.pde.internal.ui.parts.FormEntry.commit",
          "source": "FormEntry.java:226"
        },
        {
          "method": "org.eclipse.pde.internal.ui.parts.FormEntry$4.focusLost",
          "source": "FormEntry.java:210"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "142784",
      "date": "2006-05-19T17:20:26+02:00",
      "product": "PDE",
      "component": "UI",
      "severity": "normal"
    }
  ],
  "groupId": "142784",
  "bugId": "142784",
  "date": "2006-05-19T17:20:26+02:00",
  "product": "PDE",
  "component": "UI",
  "severity": "normal"
}