{
  "comments": [
    "I20030729\n\nI got the stack below caused by a bug in my code. However, reading the API I\nwould not expect ISourceReference.getSource to throw an\nArrayIndexOutOfBoundsException\n\n!ENTRY org.eclipse.ui.workbench 4 2 Jul 29, 2003 15:43:05.868\n!MESSAGE Problems occurred when invoking code from plug-in:\n\"org.eclipse.ui.workbench\".\n!STACK 0\njava.lang.ArrayIndexOutOfBoundsException\n\tat\norg.eclipse.jdt.internal.ui.javaeditor.DocumentAdapter.getText(DocumentAdapter.java:383)\n\tat\norg.eclipse.jdt.internal.core.SourceRefElement.getSource(SourceRefElement.java:141)\n\tat org.eclipse.jdt.internal.ui.infoviews.SourceView.setInput(SourceView.java:209)\n\tat\norg.eclipse.jdt.internal.ui.infoviews.AbstractInfoView.setInputFrom(AbstractInfoView.java:244)\n\tat\norg.eclipse.jdt.internal.ui.infoviews.AbstractInfoView.selectionChanged(AbstractInfoView.java:168)\n\tat\norg.eclipse.ui.internal.AbstractSelectionService$4.run(AbstractSelectionService.java:178)\n\tat\norg.eclipse.core.internal.runtime.InternalPlatform.run(InternalPlatform.java:1015)\n\tat org.eclipse.core.runtime.Platform.run(Platform.java:420)\n\tat\norg.eclipse.ui.internal.AbstractSelectionService.firePostSelection(AbstractSelectionService.java:176)\n\tat\norg.eclipse.ui.internal.AbstractSelectionService$2.selectionChanged(AbstractSelectionService.java:76)\n\tat org.eclipse.jface.text.TextViewer.firePostSelectionChanged(TextViewer.java:2099)\n\tat org.eclipse.jface.text.TextViewer.firePostSelectionChanged(TextViewer.java:2052)\n\tat org.eclipse.jface.text.TextViewer$4.run(TextViewer.java:2031)\n\tat org.eclipse.swt.widgets.Display.runTimer(Display.java:2230)\n\tat org.eclipse.swt.widgets.Display.messageProc(Display.java:1764)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:1338)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:1876)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1680)\n\tat org.eclipse.ui.internal.Workbench.run(Workbench.java:1663)\n\tat\norg.eclipse.core.internal.boot.InternalBootLoader.run(InternalBootLoader.java:858)\n\tat org.eclipse.core.boot.BootLoader.run(BootLoader.java:461)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:291)\n\tat org.eclipse.core.launcher.Main.run(Main.java:747)\n\tat org.eclipse.core.launcher.Main.main(Main.java:583)",
    "Proposal:\n\n/**\n * @see ISourceReference\n */\npublic String getSource() throws JavaModelException {\n\tIOpenable openable \u003d getOpenableParent();\n\tIBuffer buffer \u003d openable.getBuffer();\n\tif (buffer \u003d\u003d null) {\n\t\treturn null;\n\t}\n\tISourceRange range \u003d getSourceRange();\n\tint offset \u003d range.getOffset();\n\tint length \u003d range.getLength();\n\tif (offset \u003d\u003d -1 || length \u003d\u003d 0 ) {\n\t\treturn null;\n\t}\n\ttry {\n\t\treturn buffer.getText(offset, length);\n\t} catch(RuntimeException e) {\n\t\tif (e instanceof IndexOutOfBoundsException) {\n\t\t\tthrow new JavaModelException(e, IJavaModelStatusConstants.INDEX_OUT_OF_BOUNDS);\n\t\t}\n\t\tthrow new JavaModelException(e, IStatus.ERROR);\n\t}\n}\n",
    "Yes, and maybe the Javadoc should explain when/why this exception happens.\n\nAnother solution could be to mention the ArrayIndexOutOfBoundsException directly\nin the API, but I think this is not the normal pattern for JDT Core APIs.\n\n",
    "No I don\u0027t like the idea of having ArrayIndexOutOfBoundsException directly in \nthe API. A runtime exception can occur while executing buffer.getText(...). We \nsimply need to convert this exception to a JavaModelException. This is \nspecified in the doc. The doc says:\n * @exception JavaModelException if this element does not exist or if an\n *      exception occurs while accessing its corresponding resource\n\nI believe this is enough. JavaModelException needs to be handled by callers of \ngetSource().\nThe proposal fixes the difference between the doc and the implementation.\n",
    "Fixed and released in HEAD.\n",
    "Change milestone.",
    "In case of an ArrayOutOfBoundsException during getSource(), null will be returned.\n",
    "Verified."
  ],
  "commentCreationDates": [
    "2003-07-30T11:29:10+02:00",
    "2003-07-30T21:32:45+02:00",
    "2003-07-31T08:25:47+02:00",
    "2003-07-31T16:32:56+02:00",
    "2003-08-28T15:03:48+02:00",
    "2003-08-28T15:04:01+02:00",
    "2003-08-28T16:29:50+02:00",
    "2003-10-08T13:27:59+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ArrayIndexOutOfBoundsException",
      "elements": [
        {
          "method": "org.eclipse.jdt.internal.ui.javaeditor.DocumentAdapter.getText",
          "source": "DocumentAdapter.java:383"
        },
        {
          "method": "org.eclipse.jdt.internal.core.SourceRefElement.getSource",
          "source": "SourceRefElement.java:141"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.infoviews.SourceView.setInput",
          "source": "SourceView.java:209"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.infoviews.AbstractInfoView.setInputFrom",
          "source": "AbstractInfoView.java:244"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.infoviews.AbstractInfoView.selectionChanged",
          "source": "AbstractInfoView.java:168"
        },
        {
          "method": "org.eclipse.ui.internal.AbstractSelectionService$4.run",
          "source": "AbstractSelectionService.java:178"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:1015"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:420"
        },
        {
          "method": "org.eclipse.ui.internal.AbstractSelectionService.firePostSelection",
          "source": "AbstractSelectionService.java:176"
        },
        {
          "method": "org.eclipse.ui.internal.AbstractSelectionService$2.selectionChanged",
          "source": "AbstractSelectionService.java:76"
        },
        {
          "method": "org.eclipse.jface.text.TextViewer.firePostSelectionChanged",
          "source": "TextViewer.java:2099"
        },
        {
          "method": "org.eclipse.jface.text.TextViewer.firePostSelectionChanged",
          "source": "TextViewer.java:2052"
        },
        {
          "method": "org.eclipse.jface.text.TextViewer$4.run",
          "source": "TextViewer.java:2031"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runTimer",
          "source": "Display.java:2230"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.messageProc",
          "source": "Display.java:1764"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessage",
          "source": "OS.java:1338"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:1876"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1680"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.run",
          "source": "Workbench.java:1663"
        },
        {
          "method": "org.eclipse.core.internal.boot.InternalBootLoader.run",
          "source": "InternalBootLoader.java:858"
        },
        {
          "method": "org.eclipse.core.boot.BootLoader.run",
          "source": "BootLoader.java:461"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:324"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:291"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:747"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:583"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "40937",
      "date": "2003-07-30T11:29:10+02:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    }
  ],
  "groupId": "40937",
  "bugId": "40937",
  "date": "2003-07-30T11:29:10+02:00",
  "product": "JDT",
  "component": "Core",
  "severity": "normal"
}