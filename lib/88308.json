{
  "comments": [
    "If I open a XML file that has a doctype declaration that reference a remote DTD\nfile (e.g. http://java.sun.com/dtd/web-app_2_3.dtd),\n\nthen when opening this XML file, system will try to do validation, and a job in\nthe background will fetch the remote file. Before this job finish, if I close\nthe XML file and reopen it, I will get an error.\n\n(See stack trace in .log at the end below)\n\nI tried to trace the problem, and I think the reason is the following:\n\n1. User open the XML editor, will create a ITextBuffer in buffer manager.\n2. The background job will call ModelManager.getModelForRead, which will\nincrease the reference count. This will keep the model in the model manager alive.\n3. User closed the editor, buffermanager.disconnect is called, the ITextBuffer\nin the buffermanager is disposed.\n4. Open the editor again, the text editor will call buffermanager.connect, and\nbuffermanager will create a new buffer, together with a new IDocument.\n5. ModelManager.getModel will return the old model.\n6. Now the old model\u0027s document will be different from the new IDocument created\nthrough buffermanager. Which result in inconsistency.\n\n\n\nStack trace:\n\norg.eclipse.jface.text.Assert$AssertionFailedException: Assertion failed: \n\tat org.eclipse.jface.text.Assert.isTrue(Assert.java:177)\n\tat org.eclipse.jface.text.Assert.isTrue(Assert.java:162)\n\tat\norg.eclipse.jface.text.source.AnnotationModel.disconnect(AnnotationModel.java:332)\n\tat org.eclipse.jface.text.source.SourceViewer.setDocument(SourceViewer.java:450)\n\tat\norg.eclipse.jface.text.source.projection.ProjectionViewer.setDocument(ProjectionViewer.java:362)\n\tat\norg.eclipse.wst.sse.ui.StructuredTextViewer.setDocument(StructuredTextViewer.java:1071)\n\tat org.eclipse.jface.text.source.SourceViewer.setDocument(SourceViewer.java:406)\n\tat org.eclipse.jface.text.TextViewer$1.widgetDisposed(TextViewer.java:1372)\n\tat org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:100)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:796)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:820)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:801)\n\tat org.eclipse.swt.widgets.Widget.releaseWidget(Widget.java:708)\n\tat org.eclipse.swt.widgets.Control.releaseWidget(Control.java:1480)\n\tat org.eclipse.swt.widgets.Scrollable.releaseWidget(Scrollable.java:192)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:373)\n\tat org.eclipse.swt.widgets.Canvas.releaseWidget(Canvas.java:118)\n\tat org.eclipse.swt.widgets.Widget.releaseResources(Widget.java:673)\n\tat org.eclipse.swt.widgets.Composite.releaseChildren(Composite.java:367)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:372)\n\tat org.eclipse.swt.widgets.Canvas.releaseWidget(Canvas.java:118)\n\tat org.eclipse.swt.widgets.Widget.releaseResources(Widget.java:673)\n\tat org.eclipse.swt.widgets.Composite.releaseChildren(Composite.java:367)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:372)\n\tat org.eclipse.swt.widgets.Widget.releaseResources(Widget.java:673)\n\tat org.eclipse.swt.widgets.Composite.releaseChildren(Composite.java:367)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:372)\n\tat org.eclipse.swt.widgets.Widget.releaseResources(Widget.java:673)\n\tat org.eclipse.swt.widgets.Composite.releaseChildren(Composite.java:367)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:372)\n\tat org.eclipse.swt.widgets.Widget.releaseResources(Widget.java:673)\n\tat org.eclipse.swt.widgets.Composite.releaseChildren(Composite.java:367)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:372)\n\tat org.eclipse.swt.widgets.Widget.releaseResources(Widget.java:673)\n\tat org.eclipse.swt.widgets.Composite.releaseChildren(Composite.java:367)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:372)\n\tat org.eclipse.swt.widgets.Widget.releaseResources(Widget.java:673)\n\tat org.eclipse.swt.widgets.Composite.releaseChildren(Composite.java:367)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:372)\n\tat org.eclipse.swt.widgets.Widget.releaseResources(Widget.java:673)\n\tat org.eclipse.swt.widgets.Composite.releaseChildren(Composite.java:367)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:372)\n\tat org.eclipse.swt.widgets.Widget.releaseResources(Widget.java:673)\n\tat org.eclipse.swt.widgets.Composite.releaseChildren(Composite.java:367)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:372)\n\tat org.eclipse.swt.widgets.Widget.releaseResources(Widget.java:673)\n\tat org.eclipse.swt.widgets.Composite.releaseChildren(Composite.java:367)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:372)\n\tat org.eclipse.swt.widgets.Widget.releaseResources(Widget.java:673)\n\tat org.eclipse.swt.widgets.Composite.releaseChildren(Composite.java:367)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:372)\n\tat org.eclipse.swt.widgets.Canvas.releaseWidget(Canvas.java:118)\n\tat org.eclipse.swt.widgets.Decorations.releaseWidget(Decorations.java:671)\n\tat org.eclipse.swt.widgets.Shell.releaseWidget(Shell.java:807)\n\tat org.eclipse.swt.widgets.Widget.dispose(Widget.java:368)\n\tat org.eclipse.swt.widgets.Decorations.dispose(Decorations.java:347)\n\tat org.eclipse.swt.widgets.Shell.dispose(Shell.java:487)\n\tat org.eclipse.swt.widgets.Display.release(Display.java:2479)\n\tat org.eclipse.swt.graphics.Device.dispose(Device.java:216)\n\tat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:112)\n\tat\norg.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:335)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:273)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:129)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:185)\n\tat org.eclipse.core.launcher.Main.run(Main.java:704)\n\tat org.eclipse.core.launcher.Main.main(Main.java:688)",
    "This happen on M3.",
    "This could be similar to bug 87017.",
    "Interesting, the way it\u0027s supposed to work is that unless the ModelManager\u0027s\nreference counts for both Edit and Read drop to zero, the ITextBuffer should\nremain connected by the FileBufferModelManager.  If the reconciler\u0027s job hasn\u0027t\nreleased for read, the model and text buffer should both still exist.  A\nconnect() from opening the editor a second time before the model is released by\nthe reconciler *should* result in the same buffer and model being shown.\n\nWill investigate.",
    "May also be related to bug 69289. \n\nI have, though, seen some places in our code (well, I fixed just one spot the\nother day) where we were doing \n\ngetmodel....\n doc \u003d model.getDocument\nreleasemodel ..\n... do something with doc ... \n\ninstead of \ngetmodel....\n doc \u003d model.getDocument\n... do something with doc ... \nreleasemodel ..\n\nWhile the former is incorrect, not sure it would result in the reported problem. \nTo help discover these type of cases, though, we may, what to add a debug\n.option that causes brute-force cleanup of all a model\u0027s refered-to data, just\nso it produces an obvious runtime error that could then be fixed. \n\nBTW, Yang, thanks for finding and helping diagnose such deep problems. ",
    "Haven\u0027t seen this in a while ... but, Nitin, mind do some sanity \nchecks, some visual innpections for places we may be using document/model \nafter its released?\n",
    "resolving as works for me, since I think fixed, but do not know what specific thing fixed it. If you still see, please reopen. \n",
    "Closing"
  ],
  "commentCreationDates": [
    "2005-03-17T10:51:14+01:00",
    "2005-03-17T10:52:47+01:00",
    "2005-03-17T15:32:25+01:00",
    "2005-03-17T17:43:28+01:00",
    "2005-03-17T18:01:09+01:00",
    "2005-06-20T22:03:18+02:00",
    "2006-04-25T06:38:53+02:00",
    "2006-06-29T20:27:36+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.jface.text.Assert$AssertionFailedException",
      "message": "Assertion failed:",
      "elements": [
        {
          "method": "org.eclipse.jface.text.Assert.isTrue",
          "source": "Assert.java:177"
        },
        {
          "method": "org.eclipse.jface.text.Assert.isTrue",
          "source": "Assert.java:162"
        },
        {
          "method": "org.eclipse.jface.text.source.AnnotationModel.disconnect",
          "source": "AnnotationModel.java:332"
        },
        {
          "method": "org.eclipse.jface.text.source.SourceViewer.setDocument",
          "source": "SourceViewer.java:450"
        },
        {
          "method": "org.eclipse.jface.text.source.projection.ProjectionViewer.setDocument",
          "source": "ProjectionViewer.java:362"
        },
        {
          "method": "org.eclipse.wst.sse.ui.StructuredTextViewer.setDocument",
          "source": "StructuredTextViewer.java:1071"
        },
        {
          "method": "org.eclipse.jface.text.source.SourceViewer.setDocument",
          "source": "SourceViewer.java:406"
        },
        {
          "method": "org.eclipse.jface.text.TextViewer$1.widgetDisposed",
          "source": "TextViewer.java:1372"
        },
        {
          "method": "org.eclipse.swt.widgets.TypedListener.handleEvent",
          "source": "TypedListener.java:100"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:796"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:820"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:801"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseWidget",
          "source": "Widget.java:708"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.releaseWidget",
          "source": "Control.java:1480"
        },
        {
          "method": "org.eclipse.swt.widgets.Scrollable.releaseWidget",
          "source": "Scrollable.java:192"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:373"
        },
        {
          "method": "org.eclipse.swt.widgets.Canvas.releaseWidget",
          "source": "Canvas.java:118"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseResources",
          "source": "Widget.java:673"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseChildren",
          "source": "Composite.java:367"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:372"
        },
        {
          "method": "org.eclipse.swt.widgets.Canvas.releaseWidget",
          "source": "Canvas.java:118"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseResources",
          "source": "Widget.java:673"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseChildren",
          "source": "Composite.java:367"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:372"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseResources",
          "source": "Widget.java:673"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseChildren",
          "source": "Composite.java:367"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:372"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseResources",
          "source": "Widget.java:673"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseChildren",
          "source": "Composite.java:367"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:372"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseResources",
          "source": "Widget.java:673"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseChildren",
          "source": "Composite.java:367"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:372"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseResources",
          "source": "Widget.java:673"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseChildren",
          "source": "Composite.java:367"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:372"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseResources",
          "source": "Widget.java:673"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseChildren",
          "source": "Composite.java:367"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:372"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseResources",
          "source": "Widget.java:673"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseChildren",
          "source": "Composite.java:367"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:372"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseResources",
          "source": "Widget.java:673"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseChildren",
          "source": "Composite.java:367"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:372"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseResources",
          "source": "Widget.java:673"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseChildren",
          "source": "Composite.java:367"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:372"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseResources",
          "source": "Widget.java:673"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseChildren",
          "source": "Composite.java:367"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:372"
        },
        {
          "method": "org.eclipse.swt.widgets.Canvas.releaseWidget",
          "source": "Canvas.java:118"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.releaseWidget",
          "source": "Decorations.java:671"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.releaseWidget",
          "source": "Shell.java:807"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.dispose",
          "source": "Widget.java:368"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.dispose",
          "source": "Decorations.java:347"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.dispose",
          "source": "Shell.java:487"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.release",
          "source": "Display.java:2479"
        },
        {
          "method": "org.eclipse.swt.graphics.Device.dispose",
          "source": "Device.java:216"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:112"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:335"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:273"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:129"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:324"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:185"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:704"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:688"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "88308",
      "date": "2005-03-17T10:51:14+01:00",
      "product": "Web Tools",
      "component": "wst.sse",
      "severity": "normal"
    }
  ],
  "groupId": "88308",
  "bugId": "88308",
  "date": "2005-03-17T10:51:14+01:00",
  "product": "Web Tools",
  "component": "wst.sse",
  "severity": "normal"
}