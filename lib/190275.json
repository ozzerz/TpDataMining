{
  "comments": [
    "I am getting a NoClassDefFound error only under Equinox M7 upwards when implementing a very simple JMX management server bundle. This works perfectly under M6 but fails under M7 under exactly the same configuration.\n\nUnder M6 :\nid      State       Bundle\n0       ACTIVE      org.eclipse.osgi_3.3.0.v20070321\n1       ACTIVE      org.eclipse.equinox.log_1.0.100.v20070226\n2       ACTIVE      org.eclipse.osgi.services_3.1.100.v20060918\n3       ACTIVE      com.bf.service.management.jmx_1.0.0\n\nUnder M7 and RC2\nid      State       Bundle\n0       ACTIVE      org.eclipse.osgi_3.3.0.v20070523\n1       ACTIVE      org.eclipse.equinox.log_1.0.100.v20070226\n2       ACTIVE      org.eclipse.osgi.services_3.1.100.v20060918\n3       RESOLVED    com.bf.service.management.jmx_1.0.0\n\nBundle 3 generates the following exception :\norg.osgi.framework.BundleException: Exception in com.bf.service.management.jmx.Activator.start() of bundle com.bf.service.management.jmx.\n        at org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator(BundleContextImpl.java:1018)\n        at org.eclipse.osgi.framework.internal.core.BundleContextImpl.start(BundleContextImpl.java:974)\n        at org.eclipse.osgi.framework.internal.core.BundleHost.startWorker(BundleHost.java:346)\n        at org.eclipse.osgi.framework.internal.core.AbstractBundle.resume(AbstractBundle.java:350)\n        at org.eclipse.osgi.framework.internal.core.Framework.resumeBundle(Framework.java:1118)\n        at org.eclipse.osgi.framework.internal.core.StartLevelManager.resumeBundles(StartLevelManager.java:634)\n        at org.eclipse.osgi.framework.internal.core.StartLevelManager.incFWSL(StartLevelManager.java:508)\n        at org.eclipse.osgi.framework.internal.core.StartLevelManager.doSetStartLevel(StartLevelManager.java:282)\n        at org.eclipse.osgi.framework.internal.core.StartLevelManager.dispatchEvent(StartLevelManager.java:468)\n        at org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent(EventManager.java:195)\n        at org.eclipse.osgi.framework.eventmgr.EventManager$EventThread.run(EventManager.java:297)\nCaused by: java.lang.NoClassDefFoundError: javax/management/MBeanServer\n        at com.bf.service.management.jmx.Activator.start(Activator.java:24)\n        at org.eclipse.osgi.framework.internal.core.BundleContextImpl$2.run(BundleContextImpl.java:999)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator(BundleContextImpl.java:993)\n        ... 10 more\n\nNested Exception:\njava.lang.NoClassDefFoundError: javax/management/MBeanServer\n        at com.bf.service.management.jmx.Activator.start(Activator.java:24)\n        at org.eclipse.osgi.framework.internal.core.BundleContextImpl$2.run(BundleContextImpl.java:999)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator(BundleContextImpl.java:993)\n        at org.eclipse.osgi.framework.internal.core.BundleContextImpl.start(BundleContextImpl.java:974)\n        at org.eclipse.osgi.framework.internal.core.BundleHost.startWorker(BundleHost.java:346)\n        at org.eclipse.osgi.framework.internal.core.AbstractBundle.resume(AbstractBundle.java:350)\n        at org.eclipse.osgi.framework.internal.core.Framework.resumeBundle(Framework.java:1118)\n        at org.eclipse.osgi.framework.internal.core.StartLevelManager.resumeBundles(StartLevelManager.java:634)\n        at org.eclipse.osgi.framework.internal.core.StartLevelManager.incFWSL(StartLevelManager.java:508)\n        at org.eclipse.osgi.framework.internal.core.StartLevelManager.doSetStartLevel(StartLevelManager.java:282)\n        at org.eclipse.osgi.framework.internal.core.StartLevelManager.dispatchEvent(StartLevelManager.java:468)\n        at org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent(EventManager.java:195)\n        at org.eclipse.osgi.framework.eventmgr.EventManager$EventThread.run(EventManager.java:297)\n\nAdditional info..\n\nThe bundle is a base Activator registering a single simple service class. \n\npublic class Activator implements BundleActivator\n{\n\n\tprivate JMXService service;\n\n\t/*\n\t * (non-Javadoc)\n\t * \n\t * @see org.osgi.framework.BundleActivator#start(org.osgi.framework.BundleContext)\n\t */\n\tpublic void start(BundleContext context) throws Exception\n\t{\n\n\t\t// create the model cache service\n\t\tservice \u003d new JMXService();\n\t\tservice.initialize();\n\n\t\t// register the service\n\t\tcontext.registerService(JMXService.class.getName(), service, new Hashtable());\n\n\t}\n\n\t/*\n\t * (non-Javadoc)\n\t * \n\t * @see org.osgi.framework.BundleActivator#stop(org.osgi.framework.BundleContext)\n\t */\n\tpublic void stop(BundleContext context) throws Exception\n\t{\n\n\t}\n\nThe Service, I have taken down to bare bones..\n\nimport javax.management.MBeanServer;\nimport javax.management.MBeanServerFactory;\n\npublic class JMXService\n{\n\tpublic void initialize()\n\t{\n\t\t// create an MBean server\n\t\t// All of these fail under M7\n\t\tMBeanServer mbs \u003d MBeanServerFactory.createMBeanServer();\n\t\t// MBeanServer mbs \u003d ManagementFactory.createMBeanServer();\n\t\t// MBeanServer mbs \u003d MBeanServerFactory.getPlatformMBeanServer();\n\t}\n\n}\n\nThis fails on both Mac OSX and Windows XP.",
    "Created an attachment (id\u003d69561)\ntestcase project\n\nI put this project together from your testcase, however I couldn\u0027t duplicate the problem. Can you give a bit more environment info?",
    "Can you try to run Eclipse pointing it the 1.5+ VM?\n\nIt could be that you have several VMs installed on your computer and Eclipse picks up 1.4 VM which doesn\u0027t have javax.management.MBeanServer?\n",
    "I am certainly using a 1.5 VM, here is the environment details from the osgi commandline..\n\nosgi\u003e getprop\njava.vendor\u003dApple Computer, Inc.\norg.osgi.service.http.port\u003d8083\norg.osgi.supports.framework.extension\u003dtrue\nsun.management.compiler\u003dHotSpot Client Compiler\nosgi.framework.beginningstartlevel\u003d1\ncom.bf.viaduct.metadata.location\u003d/Users/karl/Viaduct/workspace/runtime-New_configuration/test/\nos.name\u003dMac OS X\nsun.boot.class.path\u003d/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Classes/classes.jar:/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Classes/ui.jar:/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Classes/laf.jar:/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Classes/sunrsasign.jar:/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Classes/jsse.jar:/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Classes/jce.jar:/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Classes/charsets.jar\nosgi.ws\u003dcarbon\njava.vm.specification.vendor\u003dSun Microsystems Inc.\njava.runtime.version\u003d1.5.0_07-164\nosgi.noShutdown\u003dtrue\nviaduct.log.enable\u003dtrue\nuser.name\u003dkarl\norg.osgi.framework.system.packages\u003djavax.accessibility,javax.activity,javax.crypto,javax.crypto.interfaces,javax.crypto.spec,javax.imageio,javax.imageio.event,javax.imageio.metadata,javax.imageio.plugins.bmp,javax.imageio.plugins.jpeg,javax.imageio.spi,javax.imageio.stream,javax.management,javax.management.loading,javax.management.modelmbean,javax.management.monitor,javax.management.openmbean,javax.management.relation,javax.management.remote,javax.management.remote.rmi,javax.management.timer,javax.naming,javax.naming.directory,javax.naming.event,javax.naming.ldap,javax.naming.spi,javax.net,javax.net.ssl,javax.print,javax.print.attribute,javax.print.attribute.standard,javax.print.event,javax.rmi,javax.rmi.CORBA,javax.rmi.ssl,javax.security.auth,javax.security.auth.callback,javax.security.auth.kerberos,javax.security.auth.login,javax.security.auth.spi,javax.security.auth.x500,javax.security.cert,javax.security.sasl,javax.sound.midi,javax.sound.midi.spi,javax.sound.sampled,javax.sound.sampled.spi,javax.sql,javax.sql.rowset,javax.sql.rowset.serial,javax.sql.rowset.spi,javax.swing,javax.swing.border,javax.swing.colorchooser,javax.swing.event,javax.swing.filechooser,javax.swing.plaf,javax.swing.plaf.basic,javax.swing.plaf.metal,javax.swing.plaf.multi,javax.swing.plaf.synth,javax.swing.table,javax.swing.text,javax.swing.text.html,javax.swing.text.html.parser,javax.swing.text.rtf,javax.swing.tree,javax.swing.undo,javax.transaction,javax.transaction.xa,javax.xml,javax.xml.datatype,javax.xml.namespace,javax.xml.parsers,javax.xml.transform,javax.xml.transform.dom,javax.xml.transform.sax,javax.xml.transform.stream,javax.xml.validation,javax.xml.xpath,org.ietf.jgss,org.omg.CORBA,org.omg.CORBA_2_3,org.omg.CORBA_2_3.portable,org.omg.CORBA.DynAnyPackage,org.omg.CORBA.ORBPackage,org.omg.CORBA.portable,org.omg.CORBA.TypeCodePackage,org.omg.CosNaming,org.omg.CosNaming.NamingContextExtPackage,org.omg.CosNaming.NamingContextPackage,org.omg.Dynamic,org.omg.DynamicAny,org.omg.DynamicAny.DynAnyFactoryPackage,org.omg.DynamicAny.DynAnyPackage,org.omg.IOP,org.omg.IOP.CodecFactoryPackage,org.omg.IOP.CodecPackage,org.omg.Messaging,org.omg.PortableInterceptor,org.omg.PortableInterceptor.ORBInitInfoPackage,org.omg.PortableServer,org.omg.PortableServer.CurrentPackage,org.omg.PortableServer.POAManagerPackage,org.omg.PortableServer.POAPackage,org.omg.PortableServer.portable,org.omg.PortableServer.ServantLocatorPackage,org.omg.SendingContext,org.omg.stub.java.rmi,org.w3c.dom,org.w3c.dom.bootstrap,org.w3c.dom.events,org.w3c.dom.ls,org.xml.sax,org.xml.sax.ext,org.xml.sax.helpers\nawt.nativeDoubleBuffering\u003dtrue\nviaduct.jmx.host\u003dlocalhost\norg.osgi.framework.language\u003den\nuser.language\u003den\norg.osgi.framework.processor\u003di386\nosgi.syspath\u003d/Users/karl/eclipse/viaduct_runtime\nsun.boot.library.path\u003d/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Libraries\nosgi.manifest.cache\u003d/Users/karl/eclipse/viaduct_runtime/configuration/org.eclipse.osgi/manifests\nosgi.compatibility.bootdelegation\u003dfalse\njava.version\u003d1.5.0_07\norg.osgi.framework.os.name\u003dMacOSX\nuser.timezone\u003dAmerica/New_York\nosgi.bundles\u003dorg.eclipse.equinox.log@start, org.eclipse.osgi.services@start, com.bf.service.management.jmx@start\nsun.arch.data.model\u003d32\njava.endorsed.dirs\u003d/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Home/lib/endorsed\nsun.cpu.isalist\u003d\nsun.jnu.encoding\u003dMacRoman\nfile.encoding.pkg\u003dsun.io\norg.osgi.framework.vendor\u003dEclipse\nfile.separator\u003d/\njava.specification.name\u003dJava Platform API Specification\njava.class.version\u003d49.0\nuser.country\u003dUS\njava.home\u003d/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Home\nosgi.os\u003dmacosx\njava.vm.info\u003dmixed mode, sharing\nos.version\u003d10.4.9\nosgi.arch\u003dx86\nconfiguration.path\u003d/Users/karl/Viaduct/workspace/runtime-New_configuration/test/configurationlocations.configlocation\npath.separator\u003d:\njava.vm.version\u003d1.5.0_07-87\norg.osgi.supports.framework.fragment\u003dtrue\nosgi.console\u003d\njava.awt.printerjob\u003dapple.awt.CPrinterJob\nviaduct.log.filename\u003d/Users/karl/eclipse/viaduct_runtime/output.log\nsun.io.unicode.encoding\u003dUnicodeLittle\norg.osgi.framework.version\u003d1.4.0\nawt.toolkit\u003dapple.awt.CToolkit\nviaduct.log.port\u003d21211\nosgi.install.area\u003dfile:/Users/karl/eclipse/viaduct_runtime/\nosgi.framework\u003dfile:/Users/karl/eclipse/viaduct_runtime/org.eclipse.osgi_3.3.0.v20070523.jar\nuser.home\u003d/Users/karl\nosgi.bundlestore\u003d/Users/karl/eclipse/viaduct_runtime/configuration/org.eclipse.osgi/bundles\nosgi.nl\u003den_US\njava.specification.vendor\u003dSun Microsystems Inc.\nviaduct.jmx.port\u003d1616\njava.library.path\u003d.:/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java\njava.vendor.url\u003dhttp://apple.com/\norg.osgi.framework.os.version\u003d10.4.9\neclipse.startTime\u003d1180633787457\njava.vm.vendor\u003d\"Apple Computer, Inc.\"\ngopherProxySet\u003dfalse\njava.runtime.name\u003dJava(TM) 2 Runtime Environment, Standard Edition\njava.class.path\u003dorg.eclipse.osgi_3.3.0.v20070523.jar:/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Classes/.compatibility/14compatibility.jar\neclipse.exitdata\u003dAn error has occurred. See the log file\n/Users/karl/eclipse/viaduct_runtime/configuration/1180633787638.log.\njava.vm.specification.name\u003dJava Virtual Machine Specification\njava.vm.specification.version\u003d1.0\nsun.cpu.endian\u003dlittle\nsun.os.patch.level\u003dunknown\njava.io.tmpdir\u003d/tmp\njava.vendor.url.bug\u003dhttp://developer.apple.com/java/\neclipse.exitcode\u003d13\nos.arch\u003di386\njava.awt.graphicsenv\u003dapple.awt.CGraphicsEnvironment\njava.ext.dirs\u003d/Library/Java/Extensions:/System/Library/Java/Extensions:/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Home/lib/ext\nmrj.version\u003d1040.1.5.0_07-164\nuser.dir\u003d/Users/karl/eclipse/viaduct_runtime\norg.osgi.supports.framework.requirebundle\u003dtrue\ncom.bf.viaduct.metadata.cachetype\u003d0\nosgi.clean\u003dtrue\nline.separator\u003d\n\njava.vm.name\u003dJava HotSpot(TM) Client VM\neclipse.ee.install.verify\u003dfalse\nfile.encoding\u003dMacRoman\nosgi.framework.version\u003d3.3.0.v20070523\nsystem.loglevel\u003d3\njava.specification.version\u003d1.5\norg.osgi.framework.executionenvironment\u003dOSGi/Minimum-1.0,OSGi/Minimum-1.1,JRE-1.1,J2SE-1.2,J2SE-1.3,J2SE-1.4,J2SE-1.5\nviaduct.bypass.propertiesfile\u003dtrue\nosgi.logfile\u003d/Users/karl/eclipse/viaduct_runtime/configuration/1180633787638.log\nosgi.configuration.area\u003dfile:/Users/karl/eclipse/viaduct_runtime/configuration/\n\nosgi\u003e \n ",
    "One thing I did not mention is that if I run the project as a debug launched Equinox app in Eclipse, it works fine, even under M7 / RC2. Its only when run as a standalone osgi app..\n\nKarl",
    "Thanks that helps.\n--\nosgi.compatibility.bootdelegation\u003dfalse\n--\n\nWhen you run Equinox standalone you\u0027re running in OSGi \"strict\" mode. What this means is that it is \"mandatory\" to import all non java.* resources as this is what the OSGi spec stipulates.\nSee bug 178477\n\nTry adding imports for javax.management to your bundle.",
    "Ah yes excellent, that fixed it.\nWas this a recent change i.e M6 -\u003e M7 ?\n\nThanks for looking into this..\n\nKarl",
    "Yes... exactly between M6 and M7.\nEquinox is the reference implementation of OSGi R4 and R4.1 and the issue was brought to light partly in the context of the work done for JSR291.\n\nWe need to do a better job explaining the more strict behaviour spec\u0027ed by the er... spec however I\u0027m going to mark this bug as INVALID since we should always have Import-Package statements for non java.* packages.",
    "Changing OS from Mac OS to Mac OS X as per bug 185991"
  ],
  "commentCreationDates": [
    "2007-05-31T18:49:10+02:00",
    "2007-05-31T19:24:23+02:00",
    "2007-05-31T19:28:21+02:00",
    "2007-05-31T19:50:38+02:00",
    "2007-05-31T19:53:29+02:00",
    "2007-05-31T20:05:22+02:00",
    "2007-05-31T20:13:21+02:00",
    "2007-05-31T20:24:00+02:00",
    "2007-07-29T15:22:57+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.osgi.framework.BundleException",
      "message": "Exception in com.bf.service.management.jmx.Activator.start() of bundle com.bf.service.management.jmx.",
      "elements": [
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator",
          "source": "BundleContextImpl.java:1018"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl.start",
          "source": "BundleContextImpl.java:974"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleHost.startWorker",
          "source": "BundleHost.java:346"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.AbstractBundle.resume",
          "source": "AbstractBundle.java:350"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Framework.resumeBundle",
          "source": "Framework.java:1118"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.resumeBundles",
          "source": "StartLevelManager.java:634"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.incFWSL",
          "source": "StartLevelManager.java:508"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.doSetStartLevel",
          "source": "StartLevelManager.java:282"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.dispatchEvent",
          "source": "StartLevelManager.java:468"
        },
        {
          "method": "org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent",
          "source": "EventManager.java:195"
        },
        {
          "method": "org.eclipse.osgi.framework.eventmgr.EventManager$EventThread.run",
          "source": "EventManager.java:297"
        }
      ],
      "causedBy": {
        "exceptionType": "java.lang.NoClassDefFoundError",
        "message": "javax/management/MBeanServer",
        "elements": [
          {
            "method": "com.bf.service.management.jmx.Activator.start",
            "source": "Activator.java:24"
          },
          {
            "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl$2.run",
            "source": "BundleContextImpl.java:999"
          },
          {
            "method": "java.security.AccessController.doPrivileged",
            "source": "Native Method"
          },
          {
            "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator",
            "source": "BundleContextImpl.java:993"
          }
        ],
        "number": 0,
        "commentIndex": 0
      },
      "number": 0,
      "commentIndex": 0,
      "bugId": "190275",
      "date": "2007-05-31T18:49:10+02:00",
      "product": "Equinox",
      "component": "Framework",
      "severity": "major"
    },
    {
      "exceptionType": "java.lang.NoClassDefFoundError",
      "message": "javax/management/MBeanServer",
      "elements": [
        {
          "method": "com.bf.service.management.jmx.Activator.start",
          "source": "Activator.java:24"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl$2.run",
          "source": "BundleContextImpl.java:999"
        },
        {
          "method": "java.security.AccessController.doPrivileged",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator",
          "source": "BundleContextImpl.java:993"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl.start",
          "source": "BundleContextImpl.java:974"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleHost.startWorker",
          "source": "BundleHost.java:346"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.AbstractBundle.resume",
          "source": "AbstractBundle.java:350"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Framework.resumeBundle",
          "source": "Framework.java:1118"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.resumeBundles",
          "source": "StartLevelManager.java:634"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.incFWSL",
          "source": "StartLevelManager.java:508"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.doSetStartLevel",
          "source": "StartLevelManager.java:282"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.dispatchEvent",
          "source": "StartLevelManager.java:468"
        },
        {
          "method": "org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent",
          "source": "EventManager.java:195"
        },
        {
          "method": "org.eclipse.osgi.framework.eventmgr.EventManager$EventThread.run",
          "source": "EventManager.java:297"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "190275",
      "date": "2007-05-31T18:49:10+02:00",
      "product": "Equinox",
      "component": "Framework",
      "severity": "major"
    }
  ],
  "groupId": "190275",
  "bugId": "190275",
  "date": "2007-05-31T18:49:10+02:00",
  "product": "Equinox",
  "component": "Framework",
  "severity": "major"
}