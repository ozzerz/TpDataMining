{
  "comments": [
    "N20040925200, GTK+ 2.2.4, GNOME \n \nThe following test failure occurred in the nightly build. \n \njunit.framework.AssertionFailedError \n at \norg.eclipse.jface.tests.images.ImageCacheTest.testDispose(ImageCacheTest.java:122) \n at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) \n at \nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) \n at \nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) \n at org.eclipse.test.EclipseTestRunner.run(EclipseTestRunner.java:320) \n at org.eclipse.test.EclipseTestRunner.run(EclipseTestRunner.java:196) \n at org.eclipse.test.CoreTestApplication.runTests(CoreTestApplication.java:35) \n at org.eclipse.test.CoreTestApplication.run(CoreTestApplication.java:31) \n at \norg.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:335) \n at \norg.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:273) \n at \norg.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:129) \n at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) \n at \nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) \n at \nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) \n at org.eclipse.core.launcher.Main.basicRun(Main.java:185) \n at org.eclipse.core.launcher.Main.run(Main.java:704) \n at org.eclipse.core.launcher.Main.main(Main.java:688)",
    "This is a timing related issue. An image was removed from the image map by the\ncleaner thread, but the thread was told to stop when the dispose was called.\nSince the tread was stopped, it did not have a chance to dispose the images.\nSince the entry had been removed from the image map, it did not get disposed\neither in the dispose method.\n\nI need to add synchronization to the image cache to prevent stale data or race\nconditions like this one to occur.\n",
    "Looks like the \"dispose\" method would clean up entries in the image map. A \nlittle before the dispose method is called, an entry would be removed from the \nmap in the cleaner thread and wait for its images to be disposed (since it had \nbecome weakly referenced). Once the cache\u0027s dispose method has finished, the \nassertion would fail because that first image is waiting to be cleaned in the \ncleaner thread. The image does eventually get cleaned up (once the thread \nfinishes running).\n\nThe test itself was inadequate since should not rely on when the gc will run. \nI have fixed the test in head so that it is not dependent on when the garbage \ncollector will run. \n\nI am currently also adding synchronization mechanism for the map itself, as \nwell as the \"getImage()\" methods. I will also modify the \"dispose\" method of \nthe image cache to wait for the thread to stop, before it starts disposing the \nimages itself.\n",
    "Verified with Build id: 200411022000."
  ],
  "commentCreationDates": [
    "2004-10-26T19:45:05+02:00",
    "2004-10-26T20:08:55+02:00",
    "2004-10-26T22:50:17+02:00",
    "2004-11-03T15:09:57+01:00"
  ],
  "traces": [
    {
      "exceptionType": "junit.framework.AssertionFailedError",
      "elements": [
        {
          "method": "org.eclipse.jface.tests.images.ImageCacheTest.testDispose",
          "source": "ImageCacheTest.java:122"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "org.eclipse.test.EclipseTestRunner.run",
          "source": "EclipseTestRunner.java:320"
        },
        {
          "method": "org.eclipse.test.EclipseTestRunner.run",
          "source": "EclipseTestRunner.java:196"
        },
        {
          "method": "org.eclipse.test.CoreTestApplication.runTests",
          "source": "CoreTestApplication.java:35"
        },
        {
          "method": "org.eclipse.test.CoreTestApplication.run",
          "source": "CoreTestApplication.java:31"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:335"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:273"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:129"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:185"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:704"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:688"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "77036",
      "date": "2004-10-26T19:45:05+02:00",
      "product": "Platform",
      "component": "UI",
      "severity": "normal"
    }
  ],
  "groupId": "77036",
  "bugId": "77036",
  "date": "2004-10-26T19:45:05+02:00",
  "product": "Platform",
  "component": "UI",
  "severity": "normal"
}