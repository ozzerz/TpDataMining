{
  "comments": [
    "With specific logic example diagram (see attached).\n\nSteps:\n- Copy / paste entire logic diagram.\n- Paste copied shapes into diagram.\n- Drag pasted shapes into bottom circuit container.  Note will indicate which container to drag to.\n- Undo.\n\nResult:\norg.eclipse.core.commands.ExecutionException: While undoing the operation, an exception occurred\n\tat org.eclipse.core.commands.operations.DefaultOperationHistory.doUndo(DefaultOperationHistory.java:429)\n\tat org.eclipse.core.commands.operations.DefaultOperationHistory.undo(DefaultOperationHistory.java:1244)\n\tat org.eclipse.ui.operations.UndoActionHandler.runCommand(UndoActionHandler.java:66)\n\tat org.eclipse.ui.operations.OperationHistoryActionHandler$4.run(OperationHistoryActionHandler.java:279)\n\tat org.eclipse.jface.operation.ModalContext.runInCurrentThread(ModalContext.java:369)\n\tat org.eclipse.jface.operation.ModalContext.run(ModalContext.java:313)\n\tat org.eclipse.jface.dialogs.ProgressMonitorDialog.run(ProgressMonitorDialog.java:470)\n\tat org.eclipse.ui.internal.operations.TimeTriggeredProgressMonitorDialog.access$6(TimeTriggeredProgressMonitorDialog.java:1)\n\tat org.eclipse.ui.internal.operations.TimeTriggeredProgressMonitorDialog$2.run(TimeTriggeredProgressMonitorDialog.java:203)\n\tat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:69)\n\tat org.eclipse.ui.internal.operations.TimeTriggeredProgressMonitorDialog.run(TimeTriggeredProgressMonitorDialog.java:216)\n\tat org.eclipse.ui.operations.OperationHistoryActionHandler.run(OperationHistoryActionHandler.java:289)\n\tat org.eclipse.gmf.runtime.common.ui.action.actions.global.GlobalUndoAction.doRun(GlobalUndoAction.java:242)\n\tat org.eclipse.gmf.runtime.common.ui.action.AbstractActionHandler.run(AbstractActionHandler.java:288)\n\tat org.eclipse.gmf.runtime.common.ui.action.ActionManager$1.run(ActionManager.java:225)\n\tat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:69)\n\tat org.eclipse.gmf.runtime.common.ui.action.ActionManager.run(ActionManager.java:223)\n\tat org.eclipse.gmf.runtime.common.ui.action.AbstractActionHandler.runWithEvent(AbstractActionHandler.java:306)\n\tat org.eclipse.ui.actions.RetargetAction.runWithEvent(RetargetAction.java:229)\n\tat org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:539)\n\tat org.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:488)\n\tat org.eclipse.jface.action.ActionContributionItem$5.handleEvent(ActionContributionItem.java:400)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:925)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3346)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2966)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1914)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1878)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:419)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:143)\n\tat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:95)\n\tat org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:78)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:92)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:68)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:376)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:169)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:615)\n\tat org.eclipse.core.launcher.Main.invokeFramework(Main.java:336)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:280)\n\tat org.eclipse.core.launcher.Main.run(Main.java:977)\n\tat org.eclipse.core.launcher.Main.main(Main.java:952)\nCaused by: org.eclipse.emf.common.util.BasicEList$BasicIndexOutOfBoundsException: index\u003d5, size\u003d3\n\tat org.eclipse.emf.common.util.BasicEList.get(BasicEList.java:512)\n\tat org.eclipse.emf.ecore.change.impl.ListChangeImpl.applyAndReverse(ListChangeImpl.java:522)\n\tat org.eclipse.emf.ecore.change.impl.ChangeDescriptionImpl.preApply(ChangeDescriptionImpl.java:479)\n\tat org.eclipse.emf.ecore.change.impl.ChangeDescriptionImpl.applyAndReverse(ChangeDescriptionImpl.java:323)\n\tat org.eclipse.emf.transaction.util.CompositeChangeDescription.applyAndReverse(CompositeChangeDescription.java:96)\n\tat org.eclipse.emf.workspace.AbstractEMFOperation.doUndo(AbstractEMFOperation.java:428)\n\tat org.eclipse.gmf.runtime.emf.commands.core.command.AbstractTransactionalCommand.doUndo(AbstractTransactionalCommand.java:258)\n\tat org.eclipse.emf.workspace.AbstractEMFOperation.undo(AbstractEMFOperation.java:227)\n\tat org.eclipse.gmf.runtime.common.core.command.CompositeCommand.doUndoWithResult(CompositeCommand.java:627)\n\tat org.eclipse.gmf.runtime.common.core.command.AbstractCommand.undo(AbstractCommand.java:195)\n\tat org.eclipse.gmf.runtime.common.core.command.CompositeCommand.doUndoWithResult(CompositeCommand.java:627)\n\tat org.eclipse.gmf.runtime.common.core.command.AbstractCommand.undo(AbstractCommand.java:195)\n\tat org.eclipse.gmf.runtime.common.core.command.CompositeCommand.doUndoWithResult(CompositeCommand.java:627)\n\tat org.eclipse.gmf.runtime.common.core.command.AbstractCommand.undo(AbstractCommand.java:195)\n\tat org.eclipse.core.commands.operations.DefaultOperationHistory.doUndo(DefaultOperationHistory.java:413)\n\t... 43 more",
    "Created an attachment (id\u003d38667)\nlogic diagram file demonstrating problem\n\nThis is the logic diagram file demonstrating the problem.\n\nThis problem was observed with the M6a bits for EMFT on the M6 stack for GEF, EMF, GMF.",
    "Hi Steve,\nRuntime EMF will look into it and provide further info\nThanks\nVishy",
    "Created an attachment (id\u003d39332)\nPatch to get past the measurement-unit annotation problem\n\nAt first, it appeared to me that the problem was caused by the Copy operation performing a shallow copy (views only; no semantic) instead of a deep copy (semantic, also).  This is caused by the faked EAnnotation carrying the measurement-unit information non-deterministically ending up being the first element that the copy operation looks at to determine the metamodel that is being copied, and the corresponding clipboard support extension.  When the wrong clipboard support is selected, the copy/paste produces duplicate views on the *same* semantic elements.  Nesting a view of a circuit in another view of the same circuit can, I suppose, be expected to cause problems.\n\nThis is a problem which is fixed by this attachment (I recommend to apply it).\n\nHowever, the real cause of this bug is not this, but appears rather to be in the drag-and-drop of an object and its attached note into *any* circuit.\n\nFor example:\n  - open the diagram attached to this bug by Steve\n  - on the diagram surface, add a *new* OR gate and a note attached to it\n  - select the OR gate and its note, drag-and-drop them into *either* circuit\n    (or, even a new circuit)\n\nObserve that the OR gate is dropped into the circuit, but not the note.  It simply disappears!  The CircuitCanonicalEditPolicy is corrupting the stack by deleting the note view after it was dropped, but without recording this change.  So, undo will attempt to apply a change description that assumes the\npresence of the note view in the circuit view, and fails.",
    "Returning the bug to the GMF Runtime Diagram component to fix the CircuitCanonicalEditPolicy, which is corrupting the undo stack on refreshing after dropping an element with an attached note view into a circuit.\n\nI do recommend also applying the patch that I attached to fix an intermittent problem in copying that causes shallow copies.",
    "Hi Christian - I applied the patch locally, but now the measurement unit annotation seems to be lost when I do a paste.  When the method ClipboardUtil.pasteElementsFromString is called, only the Views are returned and not the annotation.  I traced the copy and the annotation is clearly being copied...  any ideas?",
    "Looks like the MeasurementUnit annotation is still being ignored when I don\u0027t apply the patch.  The paste logic doesn\u0027t seem to be deserializing it.  It definitely used to...\n\nI\u0027ll try and debug further, but if you had any insight I\u0027d appreciate it.\n\n",
    "Looks like this is a problem when another Clipboard operation helper is installed and overrides the default? ",
    "Or actually overrides the NotationClipboardOperationHelper?",
    "bugzilla 136975 gmf-head sshaw 060428 ExecutionException undoing drag and drop operation...\n\n- committed patch from Christian.  Also fixed CircuitCompartmentCanonicalEditPolicy in the logic example to not delete non semantic elements."
  ],
  "commentCreationDates": [
    "2006-04-17T14:44:22+02:00",
    "2006-04-17T14:46:07+02:00",
    "2006-04-18T03:05:11+02:00",
    "2006-04-24T20:28:03+02:00",
    "2006-04-24T20:30:40+02:00",
    "2006-04-24T22:47:20+02:00",
    "2006-04-27T00:04:29+02:00",
    "2006-04-28T17:50:19+02:00",
    "2006-04-28T17:52:14+02:00",
    "2006-04-28T22:22:44+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.core.commands.ExecutionException",
      "message": "While undoing the operation, an exception occurred",
      "elements": [
        {
          "method": "org.eclipse.core.commands.operations.DefaultOperationHistory.doUndo",
          "source": "DefaultOperationHistory.java:429"
        },
        {
          "method": "org.eclipse.core.commands.operations.DefaultOperationHistory.undo",
          "source": "DefaultOperationHistory.java:1244"
        },
        {
          "method": "org.eclipse.ui.operations.UndoActionHandler.runCommand",
          "source": "UndoActionHandler.java:66"
        },
        {
          "method": "org.eclipse.ui.operations.OperationHistoryActionHandler$4.run",
          "source": "OperationHistoryActionHandler.java:279"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext.runInCurrentThread",
          "source": "ModalContext.java:369"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext.run",
          "source": "ModalContext.java:313"
        },
        {
          "method": "org.eclipse.jface.dialogs.ProgressMonitorDialog.run",
          "source": "ProgressMonitorDialog.java:470"
        },
        {
          "method": "org.eclipse.ui.internal.operations.TimeTriggeredProgressMonitorDialog.access$6",
          "source": "TimeTriggeredProgressMonitorDialog.java:1"
        },
        {
          "method": "org.eclipse.ui.internal.operations.TimeTriggeredProgressMonitorDialog$2.run",
          "source": "TimeTriggeredProgressMonitorDialog.java:203"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:69"
        },
        {
          "method": "org.eclipse.ui.internal.operations.TimeTriggeredProgressMonitorDialog.run",
          "source": "TimeTriggeredProgressMonitorDialog.java:216"
        },
        {
          "method": "org.eclipse.ui.operations.OperationHistoryActionHandler.run",
          "source": "OperationHistoryActionHandler.java:289"
        },
        {
          "method": "org.eclipse.gmf.runtime.common.ui.action.actions.global.GlobalUndoAction.doRun",
          "source": "GlobalUndoAction.java:242"
        },
        {
          "method": "org.eclipse.gmf.runtime.common.ui.action.AbstractActionHandler.run",
          "source": "AbstractActionHandler.java:288"
        },
        {
          "method": "org.eclipse.gmf.runtime.common.ui.action.ActionManager$1.run",
          "source": "ActionManager.java:225"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:69"
        },
        {
          "method": "org.eclipse.gmf.runtime.common.ui.action.ActionManager.run",
          "source": "ActionManager.java:223"
        },
        {
          "method": "org.eclipse.gmf.runtime.common.ui.action.AbstractActionHandler.runWithEvent",
          "source": "AbstractActionHandler.java:306"
        },
        {
          "method": "org.eclipse.ui.actions.RetargetAction.runWithEvent",
          "source": "RetargetAction.java:229"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:539"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$2",
          "source": "ActionContributionItem.java:488"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$5.handleEvent",
          "source": "ActionContributionItem.java:400"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:925"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:3346"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2966"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1914"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1878"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:419"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:143"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:95"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:78"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:92"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:68"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:376"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:169"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:64"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:43"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:615"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:336"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:280"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:977"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:952"
        }
      ],
      "causedBy": {
        "exceptionType": "org.eclipse.emf.common.util.BasicEList$BasicIndexOutOfBoundsException",
        "message": "index\u003d5, size\u003d3",
        "elements": [
          {
            "method": "org.eclipse.emf.common.util.BasicEList.get",
            "source": "BasicEList.java:512"
          },
          {
            "method": "org.eclipse.emf.ecore.change.impl.ListChangeImpl.applyAndReverse",
            "source": "ListChangeImpl.java:522"
          },
          {
            "method": "org.eclipse.emf.ecore.change.impl.ChangeDescriptionImpl.preApply",
            "source": "ChangeDescriptionImpl.java:479"
          },
          {
            "method": "org.eclipse.emf.ecore.change.impl.ChangeDescriptionImpl.applyAndReverse",
            "source": "ChangeDescriptionImpl.java:323"
          },
          {
            "method": "org.eclipse.emf.transaction.util.CompositeChangeDescription.applyAndReverse",
            "source": "CompositeChangeDescription.java:96"
          },
          {
            "method": "org.eclipse.emf.workspace.AbstractEMFOperation.doUndo",
            "source": "AbstractEMFOperation.java:428"
          },
          {
            "method": "org.eclipse.gmf.runtime.emf.commands.core.command.AbstractTransactionalCommand.doUndo",
            "source": "AbstractTransactionalCommand.java:258"
          },
          {
            "method": "org.eclipse.emf.workspace.AbstractEMFOperation.undo",
            "source": "AbstractEMFOperation.java:227"
          },
          {
            "method": "org.eclipse.gmf.runtime.common.core.command.CompositeCommand.doUndoWithResult",
            "source": "CompositeCommand.java:627"
          },
          {
            "method": "org.eclipse.gmf.runtime.common.core.command.AbstractCommand.undo",
            "source": "AbstractCommand.java:195"
          },
          {
            "method": "org.eclipse.gmf.runtime.common.core.command.CompositeCommand.doUndoWithResult",
            "source": "CompositeCommand.java:627"
          },
          {
            "method": "org.eclipse.gmf.runtime.common.core.command.AbstractCommand.undo",
            "source": "AbstractCommand.java:195"
          },
          {
            "method": "org.eclipse.gmf.runtime.common.core.command.CompositeCommand.doUndoWithResult",
            "source": "CompositeCommand.java:627"
          },
          {
            "method": "org.eclipse.gmf.runtime.common.core.command.AbstractCommand.undo",
            "source": "AbstractCommand.java:195"
          },
          {
            "method": "org.eclipse.core.commands.operations.DefaultOperationHistory.doUndo",
            "source": "DefaultOperationHistory.java:413"
          }
        ],
        "number": 0,
        "commentIndex": 0
      },
      "number": 0,
      "commentIndex": 0,
      "bugId": "136975",
      "date": "2006-04-17T14:44:22+02:00",
      "product": "GMF",
      "component": "Runtime Diagram",
      "severity": "major"
    }
  ],
  "groupId": "136975",
  "bugId": "136975",
  "date": "2006-04-17T14:44:22+02:00",
  "product": "GMF",
  "component": "Runtime Diagram",
  "severity": "major"
}