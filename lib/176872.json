{
  "comments": [
    "After installing ATF an  eclipse -clean is required. This bug is to work with the Eclipse Core team to try to resolve the problem. \n\nTo duplicate the problem follow the instructions below. \n\nInstall ATF using the following instructions. I have attached a ATF build to the bug. This build works with the WTP 1.5.2 All-In-One. \n\nStart Eclipse, and select Help -\u003e Software Updates -\u003e Find and Install... \nSelect Search for new features to install \nSelect Next \nSelect New Archived Site... \nSelect the location of the downloaded update site zip file \nSelect Finish \nMake sure all ATF features are selected \nFollow the remaining prompts to install ATF \nAfter ATF is installed switch the Mozilla Perspective\nPress the Mozilla button (The blue \"M\" button)\nType is  a URL and finish. \n\nThe problem is that classes in our SWT fragment are not found. Doing an eclipse -clean fixes the problem. If you don\u0027t have XULRunner install, a dialog should pop-up saying XULRunner was not found. Instead the error log will have the following error. \n\njava.lang.NoClassDefFoundError: org/eclipse/swt/browser/MozillaCloseWindowListener\nat java.lang.Class.getDeclaredConstructors0(Native Method)\nat java.lang.Class.privateGetDeclaredConstructors(Unknown Source)\nat java.lang.Class.getConstructor0(Unknown Source)\nat java.lang.Class.newInstance0(Unknown Source)\nat java.lang.Class.newInstance(Unknown Source)\nat org.eclipse.core.internal.registry.osgi.RegistryStrategyOSGI.createExecutableExtension(RegistryStrategyOSGI.java:157)\nat org.eclipse.core.internal.registry.ExtensionRegistry.createExecutableExtension(ExtensionRegistry.java:759)\nat org.eclipse.core.internal.registry.ConfigurationElement.createExecutableExtension(ConfigurationElement.java:243)\nat org.eclipse.core.internal.registry.ConfigurationElementHandle.createExecutableExtension(ConfigurationElementHandle.java:51)\nat org.eclipse.ui.internal.WorkbenchPlugin.createExtension(WorkbenchPlugin.java:234)\nat org.eclipse.ui.internal.registry.EditorDescriptor.createEditor(EditorDescriptor.java:231)\nat org.eclipse.ui.internal.EditorManager.createPart(EditorManager.java:909)\nat org.eclipse.ui.internal.EditorReference.createPartHelper(EditorReference.java:549)\nat org.eclipse.ui.internal.EditorReference.createPart(EditorReference.java:372)\nat org.eclipse.ui.internal.WorkbenchPartReference.getPart(WorkbenchPartReference.java:566)\nat org.eclipse.ui.internal.PartPane.setVisible(PartPane.java:290)\nat org.eclipse.ui.internal.presentations.PresentablePart.setVisible(PresentablePart.java:140)\nat org.eclipse.ui.internal.presentations.util.PresentablePartFolder.select(PresentablePartFolder.java:268)\nat org.eclipse.ui.internal.presentations.util.LeftToRightTabOrder.select(LeftToRightTabOrder.java:65)\nat org.eclipse.ui.internal.presentations.util.TabbedStackPresentation.selectPart(TabbedStackPresentation.java:394)\nat org.eclipse.ui.internal.PartStack.refreshPresentationSelection(PartStack.java:1144)\nat org.eclipse.ui.internal.PartStack.setSelection(PartStack.java:1097)\nat org.eclipse.ui.internal.PartStack.showPart(PartStack.java:1311)\nat org.eclipse.ui.internal.PartStack.add(PartStack.java:455)\nat org.eclipse.ui.internal.EditorStack.add(EditorStack.java:102)\nat org.eclipse.ui.internal.PartStack.add(PartStack.java:441)\nat org.eclipse.ui.internal.EditorStack.add(EditorStack.java:111)\nat org.eclipse.ui.internal.EditorSashContainer.addEditor(EditorSashContainer.java:60)\nat org.eclipse.ui.internal.EditorAreaHelper.addToLayout(EditorAreaHelper.java:217)\nat org.eclipse.ui.internal.EditorAreaHelper.addEditor(EditorAreaHelper.java:207)\nat org.eclipse.ui.internal.EditorManager.createEditorTab(EditorManager.java:820)\nat org.eclipse.ui.internal.EditorManager.openEditorFromDescriptor(EditorManager.java:719)\nat org.eclipse.ui.internal.EditorManager.openEditor(EditorManager.java:680)\nat org.eclipse.ui.internal.WorkbenchPage.busyOpenEditorBatched(WorkbenchPage.java:2593)\nat org.eclipse.ui.internal.WorkbenchPage.busyOpenEditor(WorkbenchPage.java:2528)\nat org.eclipse.ui.internal.WorkbenchPage.access$10(WorkbenchPage.java:2520)\nat org.eclipse.ui.internal.WorkbenchPage$9.run(WorkbenchPage.java:2505)\nat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:67)\nat org.eclipse.ui.internal.WorkbenchPage.openEditor(WorkbenchPage.java:2500)\nat org.eclipse.ui.internal.WorkbenchPage.openEditor(WorkbenchPage.java:2477)\nat org.eclipse.ui.ide.IDE.openEditor(IDE.java:290)\nat org.eclipse.atf.mozilla.ide.ui.browser.util.MozBrowserUtil.openMozillaBrowser(Unknown Source)\nat org.eclipse.atf.mozilla.ide.ui.browser.OpenMozBrowserEditorAction.run(Unknown Source)\nat org.eclipse.atf.mozilla.ide.ui.browser.OpenMozBrowserEditorAction.run(Unknown Source)\nat org.eclipse.ui.internal.PluginAction.runWithEvent(PluginAction.java:254)\nat org.eclipse.ui.internal.WWinPluginAction.runWithEvent(WWinPluginAction.java:229)\nat org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:539)\nat org.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:488)\nat org.eclipse.jface.action.ActionContributionItem$6.handleEvent(ActionContributionItem.java:441)\nat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\nat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:928)\nat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3348)\nat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2968)\nat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1914)\nat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1878)\nat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:419)\nat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)\nat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:95)\nat org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:78)\nat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:92)\nat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:68)\nat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:400)\nat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:177)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\nat java.lang.reflect.Method.invoke(Unknown Source)\nat org.eclipse.core.launcher.Main.invokeFramework(Main.java:336)\nat org.eclipse.core.launcher.Main.basicRun(Main.java:280)\nat org.eclipse.core.launcher.Main.run(Main.java:977)\nat org.eclipse.core.launcher.Main.main(Main.java:952)",
    "The build is too large to attached to the bug. A build can be found on the ATF download page http://www.eclipse.org/atf/downloads/index.php\n",
    "The problem here is that several SWT fragments are being installed that add new constraints to the SWT bundle (via Require-Bundle). When new constraints are added from a fragment in this manner PackageAdmin.refreshPackages should be called to set things straight.\n\nUnfortunately, this call is not made, and further the platform state is cached preventing regeneration of the configuration next time the platform is restarted.\n\nThe use of \"-clean\" works, but is overkill as in addition to the platform cache, other bundle data is removed. Specifying \"-Dosgi.checkConfiguration\u003dtrue\" more closely targets just regenerating the platform configuration.\n\nRetargeting Platform-Update as I wonder if we could in someway recognize that the platform cache is not valid and should be recalculated next startup.\n\n\n",
    "Re-assigning to Framework. Perhaps we can do something to recognize this kind of change and recalculate our state.",
    "I think some extra checks could be done at shutdown to detect if unresolved fragments exists that are unresolved because they are adding new constraints.  If this is detected then we could force the state to re-resolve the host to get the fragments to attach for next restart.\n\nThe same could be done for optional constraints which get a supplier installed while they are resolved.\n\nWe need to pay attention to performance here.  Such an operation should can not take very long because we do not want to delay the shutdown process very long.",
    "Nothing going to be done for M3.  I think a better fix would be to put this policy into update.configurator (p2 simple.configurator).  When provisioning the configurator could detect the hosts and bundles with unresolved optional dependencies and force them to refresh.\n\nI will attach a patch for update.configurator with an idea of how this would work.",
    "Created an attachment (id\u003d81623)\nillustrative patch to update\n\nThis is an illustrative patch to update.configurator which will cause additional bundles to be refreshed on the following conditions\n\n1) An unresolved fragment which has a possible host which was previously resolved and the fragment has a ResolveError of type FRAGMENT_CONFLICT.  In this case we force the host to re-resolve to allow the fragment to attach.  Additional checks should probably be done to ensure the fragment does not have a true conflict\n\n2) A previously resolved bundle has an optional import-package which is not resolved but has a possible supplier in the State.  In this case we force the bundle to re-resolve to allow the optional import to wire.\n\n3) A previously resolved bundle has an optional require-bundle which is not resolved but has a possible supplier in the State.  In this case we force the bundle to re-resolve to allow the optional require to wire.\n\nSimon, perhaps you could port this to simple configurator?",
    "Moving to p2.  I think this policy should be implemented at the provisioning layer, not the Framework.",
    "I would be interested in understanding why calls to refreshPackages with the newly added fragment don\u0027t cause the potential host to be considered. \n\nAnyway, still planning to do for 3.4. The code attached to the patch can probably be used as is since the simple configurator is inspired from update configurator.",
    "Calling refresh packages on an unresolved bundle does not effect other bundles (i.e. the hosts) because there are no dependents on the bundle yet."
  ],
  "commentCreationDates": [
    "2007-03-09T22:35:14+01:00",
    "2007-03-09T22:43:52+01:00",
    "2007-03-12T23:18:05+01:00",
    "2007-03-13T22:00:00+01:00",
    "2007-08-03T21:29:20+02:00",
    "2007-10-30T18:02:39+01:00",
    "2007-10-30T19:25:41+01:00",
    "2007-11-15T22:31:05+01:00",
    "2007-11-17T05:33:22+01:00",
    "2007-11-17T05:44:34+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NoClassDefFoundError",
      "message": "org/eclipse/swt/browser/MozillaCloseWindowListener",
      "elements": [
        {
          "method": "java.lang.Class.getDeclaredConstructors0",
          "source": "Native Method"
        },
        {
          "method": "java.lang.Class.privateGetDeclaredConstructors",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.Class.getConstructor0",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.Class.newInstance0",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.Class.newInstance",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.core.internal.registry.osgi.RegistryStrategyOSGI.createExecutableExtension",
          "source": "RegistryStrategyOSGI.java:157"
        },
        {
          "method": "org.eclipse.core.internal.registry.ExtensionRegistry.createExecutableExtension",
          "source": "ExtensionRegistry.java:759"
        },
        {
          "method": "org.eclipse.core.internal.registry.ConfigurationElement.createExecutableExtension",
          "source": "ConfigurationElement.java:243"
        },
        {
          "method": "org.eclipse.core.internal.registry.ConfigurationElementHandle.createExecutableExtension",
          "source": "ConfigurationElementHandle.java:51"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchPlugin.createExtension",
          "source": "WorkbenchPlugin.java:234"
        },
        {
          "method": "org.eclipse.ui.internal.registry.EditorDescriptor.createEditor",
          "source": "EditorDescriptor.java:231"
        },
        {
          "method": "org.eclipse.ui.internal.EditorManager.createPart",
          "source": "EditorManager.java:909"
        },
        {
          "method": "org.eclipse.ui.internal.EditorReference.createPartHelper",
          "source": "EditorReference.java:549"
        },
        {
          "method": "org.eclipse.ui.internal.EditorReference.createPart",
          "source": "EditorReference.java:372"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchPartReference.getPart",
          "source": "WorkbenchPartReference.java:566"
        },
        {
          "method": "org.eclipse.ui.internal.PartPane.setVisible",
          "source": "PartPane.java:290"
        },
        {
          "method": "org.eclipse.ui.internal.presentations.PresentablePart.setVisible",
          "source": "PresentablePart.java:140"
        },
        {
          "method": "org.eclipse.ui.internal.presentations.util.PresentablePartFolder.select",
          "source": "PresentablePartFolder.java:268"
        },
        {
          "method": "org.eclipse.ui.internal.presentations.util.LeftToRightTabOrder.select",
          "source": "LeftToRightTabOrder.java:65"
        },
        {
          "method": "org.eclipse.ui.internal.presentations.util.TabbedStackPresentation.selectPart",
          "source": "TabbedStackPresentation.java:394"
        },
        {
          "method": "org.eclipse.ui.internal.PartStack.refreshPresentationSelection",
          "source": "PartStack.java:1144"
        },
        {
          "method": "org.eclipse.ui.internal.PartStack.setSelection",
          "source": "PartStack.java:1097"
        },
        {
          "method": "org.eclipse.ui.internal.PartStack.showPart",
          "source": "PartStack.java:1311"
        },
        {
          "method": "org.eclipse.ui.internal.PartStack.add",
          "source": "PartStack.java:455"
        },
        {
          "method": "org.eclipse.ui.internal.EditorStack.add",
          "source": "EditorStack.java:102"
        },
        {
          "method": "org.eclipse.ui.internal.PartStack.add",
          "source": "PartStack.java:441"
        },
        {
          "method": "org.eclipse.ui.internal.EditorStack.add",
          "source": "EditorStack.java:111"
        },
        {
          "method": "org.eclipse.ui.internal.EditorSashContainer.addEditor",
          "source": "EditorSashContainer.java:60"
        },
        {
          "method": "org.eclipse.ui.internal.EditorAreaHelper.addToLayout",
          "source": "EditorAreaHelper.java:217"
        },
        {
          "method": "org.eclipse.ui.internal.EditorAreaHelper.addEditor",
          "source": "EditorAreaHelper.java:207"
        },
        {
          "method": "org.eclipse.ui.internal.EditorManager.createEditorTab",
          "source": "EditorManager.java:820"
        },
        {
          "method": "org.eclipse.ui.internal.EditorManager.openEditorFromDescriptor",
          "source": "EditorManager.java:719"
        },
        {
          "method": "org.eclipse.ui.internal.EditorManager.openEditor",
          "source": "EditorManager.java:680"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchPage.busyOpenEditorBatched",
          "source": "WorkbenchPage.java:2593"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchPage.busyOpenEditor",
          "source": "WorkbenchPage.java:2528"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchPage.access$10",
          "source": "WorkbenchPage.java:2520"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchPage$9.run",
          "source": "WorkbenchPage.java:2505"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:67"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchPage.openEditor",
          "source": "WorkbenchPage.java:2500"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchPage.openEditor",
          "source": "WorkbenchPage.java:2477"
        },
        {
          "method": "org.eclipse.ui.ide.IDE.openEditor",
          "source": "IDE.java:290"
        },
        {
          "method": "org.eclipse.atf.mozilla.ide.ui.browser.util.MozBrowserUtil.openMozillaBrowser",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.atf.mozilla.ide.ui.browser.OpenMozBrowserEditorAction.run",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.atf.mozilla.ide.ui.browser.OpenMozBrowserEditorAction.run",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.ui.internal.PluginAction.runWithEvent",
          "source": "PluginAction.java:254"
        },
        {
          "method": "org.eclipse.ui.internal.WWinPluginAction.runWithEvent",
          "source": "WWinPluginAction.java:229"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:539"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$2",
          "source": "ActionContributionItem.java:488"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$6.handleEvent",
          "source": "ActionContributionItem.java:441"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:928"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:3348"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2968"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1914"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1878"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:419"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:95"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:78"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:92"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:68"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:400"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:177"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:336"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:280"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:977"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:952"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "176872",
      "date": "2007-03-09T22:35:14+01:00",
      "product": "Equinox",
      "component": "Incubator",
      "severity": "normal"
    }
  ],
  "groupId": "176872",
  "bugId": "176872",
  "date": "2007-03-09T22:35:14+01:00",
  "product": "Equinox",
  "component": "Incubator",
  "severity": "normal"
}