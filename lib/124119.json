{
  "comments": [
    "JDT/Core v_633\n\nWhen recompiling src libs, a NPE is detected inside method verification for type Retention. It comes across a method #value() with a null return type.\n\nInternal compiler error\njava.lang.NullPointerException\n\n\tat org.eclipse.jdt.internal.compiler.lookup.ReferenceBinding.detectAnnotationCycle(ReferenceBinding.java:431)\n\n\tat org.eclipse.jdt.internal.compiler.lookup.MethodVerifier15.verify(MethodVerifier15.java:552)\n\n\tat org.eclipse.jdt.internal.compiler.lookup.SourceTypeBinding.verifyMethods(SourceTypeBinding.java:1451)\n\n\tat org.eclipse.jdt.internal.compiler.lookup.CompilationUnitScope.verifyMethods(CompilationUnitScope.java:743)\n\n\tat org.eclipse.jdt.internal.compiler.Compiler.process(Compiler.java:512)\n\n\tat org.eclipse.jdt.internal.compiler.Compiler.compile(Compiler.java:332)\n\n\tat org.eclipse.jdt.internal.core.builder.AbstractImageBuilder.compile(AbstractImageBuilder.java:286)\n\n\tat org.eclipse.jdt.internal.core.builder.AbstractImageBuilder.compile(AbstractImageBuilder.java:251)\n\n\tat org.eclipse.jdt.internal.core.builder.BatchImageBuilder.build(BatchImageBuilder.java:50)\n\n\tat org.eclipse.jdt.internal.core.builder.JavaBuilder.buildAll(JavaBuilder.java:214)\n\n\tat org.eclipse.jdt.internal.core.builder.JavaBuilder.build(JavaBuilder.java:142)\n\n\tat org.eclipse.core.internal.events.BuildManager$2.run(BuildManager.java:593)\n\n\tat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n\n\tat org.eclipse.core.runtime.Platform.run(Platform.java:785)\n\n\tat org.eclipse.core.internal.events.BuildManager.basicBuild(BuildManager.java:168)\n\n\tat org.eclipse.core.internal.events.BuildManager.basicBuild(BuildManager.java:202)\n\n\tat org.eclipse.core.internal.events.BuildManager$1.run(BuildManager.java:231)\n\n\tat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n\n\tat org.eclipse.core.runtime.Platform.run(Platform.java:785)\n\n\tat org.eclipse.core.internal.events.BuildManager.basicBuild(BuildManager.java:234)\n\n\tat org.eclipse.core.internal.events.BuildManager.basicBuildLoop(BuildManager.java:253)\n\n\tat org.eclipse.core.internal.events.BuildManager.build(BuildManager.java:282)\n\n\tat org.eclipse.core.internal.resources.Workspace.build(Workspace.java:217)\n\n\tat org.eclipse.ui.actions.GlobalBuildAction$1.run(GlobalBuildAction.java:182)\n\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:58)",
    "The null return type feels a consequence of other badness (i.e. problem occurring elsewhere prior to this point). I would expect broken bindings to have been removed, and thus not be reachable in normal cases.\n\nNow, this scenario could be a reentrance one.",
    "When debugging it, I am finding something strange. During faultInTypes of offending unit (Retention), it thinks the methods have already be resolved, and doesn\u0027t redo it, though the return type of the #value() method is still null.\n\npublic MethodBinding[] methods() {\n\tif ((tagBits \u0026 TagBits.AreMethodsComplete) !\u003d 0)\n\t\treturn methods;",
    "Looking deeper, it appears we run before into the #methods() invocation, but at a stage where the list of methods is empty (forward ref when resolving annotations). Then later on, we find the bit already set, but a method got inserted.\n\nThis is what the stack looks when first entering the #methods() call for Retention.\n\nSourceTypeBinding.methods() line: 965\nSingleMemberAnnotation(Annotation).resolveType(BlockScope) line: 243\nASTNode.resolveAnnotations(BlockScope, Annotation[], Binding) line: 491\nSourceTypeBinding.getAnnotationTagBits() line: 646\nSingleTypeReference(ASTNode).isTypeUseDeprecated(TypeBinding, Scope) line: 377\nSingleTypeReference(TypeReference).resolveType(BlockScope, boolean) line: 134\nSingleTypeReference(TypeReference).resolveType(BlockScope) line: 118\nSingleMemberAnnotation(Annotation).resolveType(BlockScope) line: 229\nASTNode.resolveAnnotations(BlockScope, Annotation[], Binding) line: 491\nSourceTypeBinding.getAnnotationTagBits() line: 646\nSingleTypeReference(ASTNode).isTypeUseDeprecated(TypeBinding, Scope) line: 377\nSingleTypeReference(TypeReference).resolveType(BlockScope, boolean) line: 134\nSingleTypeReference(TypeReference).resolveType(BlockScope) line: 118\nMarkerAnnotation(Annotation).resolveType(BlockScope) line: 229\nASTNode.resolveAnnotations(BlockScope, Annotation[], Binding) line: 491\nSourceTypeBinding.getAnnotationTagBits() line: 646\nSingleTypeReference(ASTNode).isTypeUseDeprecated(TypeBinding, Scope) line: 377\nSingleTypeReference(TypeReference).resolveType(BlockScope, boolean) line: 134\nSingleTypeReference(TypeReference).resolveType(BlockScope) line: 118\nMarkerAnnotation(Annotation).resolveType(BlockScope) line: 229\nASTNode.resolveAnnotations(BlockScope, Annotation[], Binding) line: 491\nSourceTypeBinding.getAnnotationTagBits() line: 646\nQualifiedTypeReference(ASTNode).isTypeUseDeprecated(TypeBinding, Scope) line: 377\nQualifiedTypeReference(TypeReference).resolveType(ClassScope) line: 157\nQualifiedTypeReference(TypeReference).resolveSuperType(ClassScope) line: 107\nClassScope.findSupertype(TypeReference) line: 1106\nClassScope.connectSuperclass() line: 766\nClassScope.connectTypeHierarchy() line: 946\nCompilationUnitScope.connectTypeHierarchy() line: 278\nLookupEnvironment.completeTypeBindings() line: 195\nCompiler.beginToCompile(ICompilationUnit[]) line: 304\nCompiler.compile(ICompilationUnit[]) line: 318\nBatchImageBuilder(AbstractImageBuilder).compile(SourceFile[], SourceFile[]) line: 286\nBatchImageBuilder(AbstractImageBuilder).compile(SourceFile[]) line: 251\nBatchImageBuilder.build() line: 50\n\n",
    "Created an attachment (id\u003d33207)\nIntermediate patch\n\nMoved the bound check \u0026 deprecation check to deferred stage.\nHowever, in lookup env had to postpone the check until methods got build (if not the offending trace still occurs).\n\nWith the patch, however another NPE in lookupEnv occurs on line 190 (first stage of completeTypeBindings !?).",
    "Created an attachment (id\u003d33213)\nSlightly better version of the patch\n\n",
    "*** Bug 124301 has been marked as a duplicate of this bug. ***",
    "Addressed differently by implementing lazy resolution for @Deprecated annotation.\nSee bug 95056\n\n*** This bug has been marked as a duplicate of 95056 ***"
  ],
  "commentCreationDates": [
    "2006-01-17T13:46:04+01:00",
    "2006-01-17T13:55:54+01:00",
    "2006-01-17T14:33:22+01:00",
    "2006-01-17T14:35:42+01:00",
    "2006-01-18T14:07:44+01:00",
    "2006-01-18T15:14:57+01:00",
    "2006-01-18T15:38:20+01:00",
    "2006-01-18T17:49:05+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.jdt.internal.compiler.lookup.ReferenceBinding.detectAnnotationCycle",
          "source": "ReferenceBinding.java:431"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.lookup.MethodVerifier15.verify",
          "source": "MethodVerifier15.java:552"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.lookup.SourceTypeBinding.verifyMethods",
          "source": "SourceTypeBinding.java:1451"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.lookup.CompilationUnitScope.verifyMethods",
          "source": "CompilationUnitScope.java:743"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.Compiler.process",
          "source": "Compiler.java:512"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.Compiler.compile",
          "source": "Compiler.java:332"
        },
        {
          "method": "org.eclipse.jdt.internal.core.builder.AbstractImageBuilder.compile",
          "source": "AbstractImageBuilder.java:286"
        },
        {
          "method": "org.eclipse.jdt.internal.core.builder.AbstractImageBuilder.compile",
          "source": "AbstractImageBuilder.java:251"
        },
        {
          "method": "org.eclipse.jdt.internal.core.builder.BatchImageBuilder.build",
          "source": "BatchImageBuilder.java:50"
        },
        {
          "method": "org.eclipse.jdt.internal.core.builder.JavaBuilder.buildAll",
          "source": "JavaBuilder.java:214"
        },
        {
          "method": "org.eclipse.jdt.internal.core.builder.JavaBuilder.build",
          "source": "JavaBuilder.java:142"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager$2.run",
          "source": "BuildManager.java:593"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:785"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager.basicBuild",
          "source": "BuildManager.java:168"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager.basicBuild",
          "source": "BuildManager.java:202"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager$1.run",
          "source": "BuildManager.java:231"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:785"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager.basicBuild",
          "source": "BuildManager.java:234"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager.basicBuildLoop",
          "source": "BuildManager.java:253"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager.build",
          "source": "BuildManager.java:282"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.build",
          "source": "Workspace.java:217"
        },
        {
          "method": "org.eclipse.ui.actions.GlobalBuildAction$1.run",
          "source": "GlobalBuildAction.java:182"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:58"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "124119",
      "duplicateId": "95056",
      "date": "2006-01-17T13:46:04+01:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    }
  ],
  "groupId": "95056",
  "bugId": "124119",
  "duplicateId": "95056",
  "date": "2006-01-17T13:46:04+01:00",
  "product": "JDT",
  "component": "Core",
  "severity": "normal"
}