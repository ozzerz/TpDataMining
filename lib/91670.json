{
  "comments": [
    "When reading annotations from a package, the following error is thrown:\n\nException in thread \"main\" java.lang.ClassFormatError: Illegal class modifiers\nin class testcase/package-info: 0x1600\n\tat java.lang.ClassLoader.defineClass1(Native Method)\n\tat java.lang.ClassLoader.defineClass(ClassLoader.java:620)\n\tat java.security.SecureClassLoader.defineClass(SecureClassLoader.java:124)\n\tat java.net.URLClassLoader.defineClass(URLClassLoader.java:260)\n\tat java.net.URLClassLoader.access$100(URLClassLoader.java:56)\n\tat java.net.URLClassLoader$1.run(URLClassLoader.java:195)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:188)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:306)\n\tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:268)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:251)\n\tat java.lang.ClassLoader.loadClassInternal(ClassLoader.java:319)\n\tat java.lang.Class.forName0(Native Method)\n\tat java.lang.Class.forName(Class.java:242)\n\tat java.lang.Package.getPackageInfo(Package.java:350)\n\tat java.lang.Package.getAnnotation(Package.java:361)\n\tat testcase.Main.main(Main.java:9)\n\nThis only happens when eclipse (3.1m6) compiles package-info.java; if I use\njavac to compile it, reading package annotations works fine.",
    "Created an attachment (id\u003d19976)\nTest case for failure\n\nTestcase for the bug.  Create an eclipse project, compile these sources, and\nrun Main.",
    "I have some more info on the problem. IDEA can compile package-info fine, so I\ncompared the class files generated by both.\n\nHere is class file #1 (generated by Eclipse):\n\nCompiled from \"package-info.java\"\ninterface com.rbc.uk.proj.cobra.package-info\n  SourceFile: \"package-info.java\"\n  RuntimeVisibleAnnotations: length \u003d 0x10\n   00 01 00 08 00 02 00 09 73 00 0A 00 0B 73 00 0C\n   \n  minor version: 0\n  major version: 49\n  Constant pool:\nconst #1 \u003d Asciz\tcom/foo/package-info;\nconst #2 \u003d class\t#1;\t//  \"com/foo/package-info\"\nconst #3 \u003d Asciz\tjava/lang/Object;\nconst #4 \u003d class\t#3;\t//  java/lang/Object\nconst #5 \u003d Asciz\tSourceFile;\nconst #6 \u003d Asciz\tpackage-info.java;\nconst #7 \u003d Asciz\tRuntimeVisibleAnnotations;\nconst #8 \u003d Asciz\tLjavax/persistence/SequenceGenerator;;\nconst #9 \u003d Asciz\tname;\nconst #10 \u003d Asciz\tSEQ_GEN;\nconst #11 \u003d Asciz\tsequenceName;\nconst #12 \u003d Asciz\tSQ_CDB_IDS;\n\n{\n}\n\n\nAnd here is class file #2 (generated by IDEA):\n\nCompiled from \"package-info.java\"\ninterface com.rbc.uk.proj.cobra.package-info\n  SourceFile: \"package-info.java\"\n  RuntimeVisibleAnnotations: length \u003d 0x10\n   00 01 00 06 00 02 00 07 73 00 08 00 09 73 00 0A\n   \n  minor version: 0\n  major version: 49\n  Constant pool:\nconst #1 \u003d class\t#11;\t//  \"com/foo/package-info\"\nconst #2 \u003d class\t#12;\t//  java/lang/Object\nconst #3 \u003d Asciz\tSourceFile;\nconst #4 \u003d Asciz\tpackage-info.java;\nconst #5 \u003d Asciz\tRuntimeVisibleAnnotations;\nconst #6 \u003d Asciz\tLjavax/persistence/SequenceGenerator;;\nconst #7 \u003d Asciz\tname;\nconst #8 \u003d Asciz\tSEQ_GEN;\nconst #9 \u003d Asciz\tsequenceName;\nconst #10 \u003d Asciz\tSQ_CDB_IDS;\nconst #11 \u003d Asciz\tcom/foo/package-info;\nconst #12 \u003d Asciz\tjava/lang/Object;\n\n{\n}\n\nThe constant pool layouts are different. This may not be the problem - the issue\ncould be in one of the fields defined after the constant pool layout. I have\nbeen looking at\nhttp://java.sun.com/docs/books/vmspec/2nd-edition/html/ClassFile.doc.html#80959\nfor a comparison, but time is tight, so I will have to leave it for now. ",
    "Did you try with M7?",
    "Reproduced in M7.\nI am investigating.",
    "The problem comes from the fact that the synthetic bit was set.\nI removed it.\nFixed and released in HEAD.\nRegression test added in org.eclipse.jdt.core.tests.builder.PackageInfoTest.test002",
    "Thanks Oliver. I did eventually manage to trace it back to the access flags in\nthe class file, which were 0x1600 in the class file generated by Eclipse, which\nI presume is a result of ORing\n\nACC_INTERFACE | ACC_ABSTRACT | ACC_SYNTHETIC \n\nwhere the synthetic flag was erroneous. I presume that the correct value should\nbe 0x0600 then? If this is the case, this is also slightly confusing, as IDEA\u0027s\nclass files (which also work) have an access_flags field of 0x0200, which is\nACC_INTERFACE. It says in the class file format ref that if ACC_INTERFACE is\nset, ACC_ABSTRACT should also be set, so unless I\u0027m missing something, this\nshould also be invalid?\n\n",
    "I think you are right. We did set the synthetic bit because we considered this\nfake interface has no corresponding source and is purely generated by the\ncompiler. From my understanding of what synthetic means this should be set as\nsynthetic.\nIt seems that Sun is considering tagging it as synthetic in the future.\nSee http://bugs.sun.com/bugdatabase/view_bug.do?bug_id\u003d6232928\n\nThe VM spec say:\nIf the ACC_INTERFACE flag of this class file is set, its ACC_ABSTRACT flag must\nalso be set (?2.13.1) and its ACC_PUBLIC flag may be set. Such a class file must\nnot have any of the other flags in Table 4.1 set.\n\nthen the other class file should be invalid.\n\nAnyway, I removed the synthetic bit to workaround this VM bug.",
    "Verified for 3.1 RC1 with build I20050527-0010.\n"
  ],
  "commentCreationDates": [
    "2005-04-17T03:11:21+02:00",
    "2005-04-17T03:17:45+02:00",
    "2005-05-18T13:52:03+02:00",
    "2005-05-18T16:25:27+02:00",
    "2005-05-18T17:07:08+02:00",
    "2005-05-18T17:47:37+02:00",
    "2005-05-19T12:00:28+02:00",
    "2005-05-19T15:35:51+02:00",
    "2005-05-27T10:55:41+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ClassFormatError",
      "message": "Illegal class modifiers in class testcase/package-info: 0x1600",
      "elements": [
        {
          "method": "java.lang.ClassLoader.defineClass1",
          "source": "Native Method"
        },
        {
          "method": "java.lang.ClassLoader.defineClass",
          "source": "ClassLoader.java:620"
        },
        {
          "method": "java.security.SecureClassLoader.defineClass",
          "source": "SecureClassLoader.java:124"
        },
        {
          "method": "java.net.URLClassLoader.defineClass",
          "source": "URLClassLoader.java:260"
        },
        {
          "method": "java.net.URLClassLoader.access$100",
          "source": "URLClassLoader.java:56"
        },
        {
          "method": "java.net.URLClassLoader$1.run",
          "source": "URLClassLoader.java:195"
        },
        {
          "method": "java.security.AccessController.doPrivileged",
          "source": "Native Method"
        },
        {
          "method": "java.net.URLClassLoader.findClass",
          "source": "URLClassLoader.java:188"
        },
        {
          "method": "java.lang.ClassLoader.loadClass",
          "source": "ClassLoader.java:306"
        },
        {
          "method": "sun.misc.Launcher$AppClassLoader.loadClass",
          "source": "Launcher.java:268"
        },
        {
          "method": "java.lang.ClassLoader.loadClass",
          "source": "ClassLoader.java:251"
        },
        {
          "method": "java.lang.ClassLoader.loadClassInternal",
          "source": "ClassLoader.java:319"
        },
        {
          "method": "java.lang.Class.forName0",
          "source": "Native Method"
        },
        {
          "method": "java.lang.Class.forName",
          "source": "Class.java:242"
        },
        {
          "method": "java.lang.Package.getPackageInfo",
          "source": "Package.java:350"
        },
        {
          "method": "java.lang.Package.getAnnotation",
          "source": "Package.java:361"
        },
        {
          "method": "testcase.Main.main",
          "source": "Main.java:9"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "91670",
      "date": "2005-04-17T03:11:21+02:00",
      "product": "JDT",
      "component": "Core",
      "severity": "major"
    }
  ],
  "groupId": "91670",
  "bugId": "91670",
  "date": "2005-04-17T03:11:21+02:00",
  "product": "JDT",
  "component": "Core",
  "severity": "major"
}