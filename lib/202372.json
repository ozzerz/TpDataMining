{
  "comments": [
    "Build ID: I20070809-1105\n\nSteps To Reproduce:\nLaunch Eclipse 3.4M1. This does not happen everytime\n\nMore information:\n!ENTRY org.eclipse.mylyn 4 0 2007-09-06 06:40:35.421\n!MESSAGE Could not write: D:\\WorkspaceNew\\.metadata\\.mylyn\\contexts\\activity.xml.zip\n\n!STACK 0\njava.io.IOException: java.io.IOException: Stream closed\n\tat org.eclipse.mylyn.internal.context.core.SaxContextWriter.writeContextToStream(SaxContextWriter.java:60)\n\tat org.eclipse.mylyn.internal.context.core.InteractionContextExternalizer.writeContextToXml(InteractionContextExternalizer.java:81)\n\tat org.eclipse.mylyn.internal.context.core.InteractionContextManager.saveActivityContext(InteractionContextManager.java:687)\n\tat org.eclipse.mylyn.internal.context.core.InteractionContextManager.loadActivityMetaContext(InteractionContextManager.java:150)\n\tat org.eclipse.mylyn.internal.context.core.InteractionContextManager.getActivityMetaContext(InteractionContextManager.java:137)\n\tat org.eclipse.mylyn.internal.tasks.core.TaskActivityManager.reloadTimingData(TaskActivityManager.java:134)\n\tat org.eclipse.mylyn.tasks.ui.TaskListManager.resetAndRollOver(TaskListManager.java:431)\n\tat org.eclipse.mylyn.tasks.ui.TaskListManager.resetAndRollOver(TaskListManager.java:416)\n\tat org.eclipse.mylyn.tasks.ui.TaskListManager.readExistingOrCreateNewList(TaskListManager.java:285)\n\tat org.eclipse.mylyn.tasks.ui.TasksUiPlugin.start(TasksUiPlugin.java:343)\n\tat org.eclipse.osgi.framework.internal.core.BundleContextImpl$2.run(BundleContextImpl.java:999)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator(BundleContextImpl.java:993)\n\tat org.eclipse.osgi.framework.internal.core.BundleContextImpl.start(BundleContextImpl.java:974)\n\tat org.eclipse.osgi.framework.internal.core.BundleHost.startWorker(BundleHost.java:346)\n\tat org.eclipse.osgi.framework.internal.core.AbstractBundle.start(AbstractBundle.java:260)\n\tat org.eclipse.core.internal.runtime.InternalPlatform.start(InternalPlatform.java:877)\n\tat org.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation(PluginDescriptor.java:360)\n\tat org.eclipse.core.internal.plugins.PluginDescriptor.getPlugin(PluginDescriptor.java:340)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n\tat java.lang.reflect.Method.invoke(Unknown Source)\n\tat org.eclipse.ui.internal.EarlyStartupRunnable.getPluginForCompatibility(EarlyStartupRunnable.java:149)\n\tat org.eclipse.ui.internal.EarlyStartupRunnable.run(EarlyStartupRunnable.java:73)\n\tat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n\tat org.eclipse.ui.internal.Workbench$54.run(Workbench.java:2190)\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:55)",
    "Rob: could you look into this?  Perhaps it is a race condition from a recent change?  If not feel free to bounce back to me.\n\nJacques: could you let us know the exact Mylyn version that you are running?",
    "Hi,\n\nMylyn version is : 2.0.0.v20070828-0800. And thanks for your work, Mylyn is just great !",
    "Jacques: could you confirm that this happens repeatedly (upon subsequent workbench restart). This appears to be happening as part of a task activity refactoring that should be a one time operation. If it is never completing though this could happen repeatedly.  If this is a blocker, a temporary work around you could try moving your current activity.xml.zip (located in \u003cworkspace\u003e/.metadata/.mylyn/context/) to a backup location and start Eclipse. This will reset your activity timing and activation history though. \n\nThe cause of the exception isn\u0027t clear but may be due to migration happening in the same thread as plugin startup and will require investigation.\n\n",
    "Yes this happens from time to time. I got it at least 3 times since I use 3.4M1. This is not a blocker and I have some other issues with 3.4M1. But I\u0027m able to work with it.\n\nThanks",
    "I have not been unable to reproduce but have fixed a related issue. Friday\u0027s dev build will have these changes. Please let me know if this has been resolved or is still occurring. Thanks.",
    "HiRobert,\n\nI was willing to test the change but I\u0027m not sure if I have to download the plugin (then where ?) or something else ?\n\nCan you explain where is \"Friday\u0027s dev build\" please ?\n\nTIA\n\nJacques",
    "Jacques: you can get it via the update sites linked from the top of: http://www.eclipse.org/mylyn/downloads/builds.php  We plan on making the main download page more clear about this for the next release.",
    "Sorry Mik,\n\nI used http://www.eclipse.org/mylyn/downloads/ as reference (e3.4) but I\u0027m only getting integration branche in Eclipse update option.\n\nI still get the error from time to time for now, not a blocker.",
    "Created an attachment (id\u003d79003)\nminor improvements\n\nMinor things I noticed while looking at the implementation:\n\n- InteractionContextExternalizer.writeContextToXml() should close the output stream in a finally block\n- SaxContextReader.readContext() tries to rename file in the catch block before it is closed\n",
    "Created an attachment (id\u003d79004)\nmylyn/context/zip\n\n",
    "Steffen: interest in providing a patch?  Should be possible to write a unit test to get this to fail too.",
    "Made fixes mentioned in comment#9. Should be resolved along with changes made to bug#198155. Please reopen if you see this post 2.1 (Scheduled for this Wednesday).",
    "Rob, I just saw your commit that added the following code:\n\n...\n\t\t} catch (Throwable t) {\n\t\t\tif (fileInputStream !\u003d null) {\n\t\t\t\ttry {\n\t\t\t\t\tfileInputStream.close();\n\t\t\t\t} catch (IOException e) {\n\t\t\t\t\tStatusHandler.fail(e, \"Failed to close context input stream.\", false);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (inputStream !\u003d null) {\n\t\t\t\ttry {\n\t\t\t\t\tinputStream.close();\n\t\t\t\t} catch (IOException e) {\n\t\t\t\t\tStatusHandler.fail(e, \"Failed to close context input stream.\", false);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfile.renameTo(new File(file.getAbsolutePath() + \"-save\"));\n\t\t\treturn null;\n\t\t} finally {\n\t\t\tif (fileInputStream !\u003d null) {\n\t\t\t\ttry {\n\t\t\t\t\tfileInputStream.close();\n\t\t\t\t} catch (IOException e) {\n\t\t\t\t\tStatusHandler.fail(e, \"Failed to close context input stream.\", false);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (inputStream !\u003d null) {\n\t\t\t\ttry {\n\t\t\t\t\tinputStream.close();\n\t\t\t\t} catch (IOException e) {\n\t\t\t\t\tStatusHandler.fail(e, \"Failed to close context input stream.\", false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\nLeaving alone that same code will be invoked twice, that is a lot of duplication and it is also error prone, i.e. InteractionContextExternalizer.writeContextToXml() can fail to close streams when exception happens on closing.\n\nWe need to have some static method that would close all Closeable and report issues to the status handler, so that method could be used everywhere instead of this verbose construct. ",
    "Yes, sounds like a good idea since I\u0027m sure I\u0027ve seen similar code elsewhere. I\u0027ll drum up some util method for this...",
    "Rob: I saw the following in my log after first bootstrap to your updates (not the 2nd, have only done 2 so far).  There were a few of the following error, all similar trace:\n\neclipse.buildId\u003dI20070921-0919\njava.version\u003d1.6.0_02\njava.vendor\u003dSun Microsystems Inc.\nBootLoader constants: OS\u003dwin32, ARCH\u003dx86, WS\u003dwin32, NL\u003den_US\nFramework arguments:  -product org.eclipse.sdk.ide\nCommand-line arguments:  -product org.eclipse.sdk.ide -data C:\\Dev\\bootstrap -dev file:C:/Dev/build-e3.4/.metadata/.plugins/org.eclipse.pde.core/Bootstrap/dev.properties -os win32 -ws win32 -arch x86\n\nError\nMon Sep 24 22:07:19 PDT 2007\nUnable to write context activity\n\njava.io.IOException: Write error\nat java.io.FileOutputStream.write(Native Method)\nat java.util.zip.ZipOutputStream.writeInt(ZipOutputStream.java:445)\nat java.util.zip.ZipOutputStream.writeCEN(ZipOutputStream.java:376)\nat java.util.zip.ZipOutputStream.finish(ZipOutputStream.java:309)\nat java.util.zip.DeflaterOutputStream.close(DeflaterOutputStream.java:146)\nat java.util.zip.ZipOutputStream.close(ZipOutputStream.java:321)\nat org.eclipse.mylyn.internal.context.core.InteractionContextExternalizer.writeContextToXml(InteractionContextExternalizer.java:91)\nat org.eclipse.mylyn.internal.context.core.InteractionContextExternalizer.writeContextToXml(InteractionContextExternalizer.java:63)\nat org.eclipse.mylyn.internal.context.core.InteractionContextManager.saveActivityContext(InteractionContextManager.java:710)\nat org.eclipse.mylyn.internal.context.core.InteractionContextManager.deactivateContext(InteractionContextManager.java:596)\nat org.eclipse.mylyn.tasks.ui.TasksUiPlugin$1.taskDeactivated(TasksUiPlugin.java:214)\nat org.eclipse.mylyn.tasks.ui.TaskListManager.deactivateTask(TaskListManager.java:357)\nat org.eclipse.mylyn.internal.tasks.ui.actions.TaskDeactivateAction.run(TaskDeactivateAction.java:34)\nat org.eclipse.mylyn.internal.tasks.ui.views.TaskListCellModifier.toggleTaskActivation(TaskListCellModifier.java:106)\nat org.eclipse.mylyn.internal.tasks.ui.views.TaskListView$6.mouseDown(TaskListView.java:745)\nat org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:178)\n\n\n",
    "Minimized duplicate code as per comment#13. comment#15 addressed on  bug#198155."
  ],
  "commentCreationDates": [
    "2007-09-06T06:58:19+02:00",
    "2007-09-11T05:49:09+02:00",
    "2007-09-11T07:02:32+02:00",
    "2007-09-12T00:04:57+02:00",
    "2007-09-12T12:27:48+02:00",
    "2007-09-14T04:02:55+02:00",
    "2007-09-20T12:08:58+02:00",
    "2007-09-20T21:51:34+02:00",
    "2007-09-21T20:49:22+02:00",
    "2007-09-21T21:12:56+02:00",
    "2007-09-21T21:13:03+02:00",
    "2007-09-22T05:05:07+02:00",
    "2007-09-25T02:02:30+02:00",
    "2007-09-25T03:16:04+02:00",
    "2007-09-25T03:46:27+02:00",
    "2007-09-25T07:13:28+02:00",
    "2007-09-25T16:31:57+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.io.IOException",
      "message": "Stream closed",
      "elements": [
        {
          "method": "org.eclipse.mylyn.internal.context.core.SaxContextWriter.writeContextToStream",
          "source": "SaxContextWriter.java:60"
        },
        {
          "method": "org.eclipse.mylyn.internal.context.core.InteractionContextExternalizer.writeContextToXml",
          "source": "InteractionContextExternalizer.java:81"
        },
        {
          "method": "org.eclipse.mylyn.internal.context.core.InteractionContextManager.saveActivityContext",
          "source": "InteractionContextManager.java:687"
        },
        {
          "method": "org.eclipse.mylyn.internal.context.core.InteractionContextManager.loadActivityMetaContext",
          "source": "InteractionContextManager.java:150"
        },
        {
          "method": "org.eclipse.mylyn.internal.context.core.InteractionContextManager.getActivityMetaContext",
          "source": "InteractionContextManager.java:137"
        },
        {
          "method": "org.eclipse.mylyn.internal.tasks.core.TaskActivityManager.reloadTimingData",
          "source": "TaskActivityManager.java:134"
        },
        {
          "method": "org.eclipse.mylyn.tasks.ui.TaskListManager.resetAndRollOver",
          "source": "TaskListManager.java:431"
        },
        {
          "method": "org.eclipse.mylyn.tasks.ui.TaskListManager.resetAndRollOver",
          "source": "TaskListManager.java:416"
        },
        {
          "method": "org.eclipse.mylyn.tasks.ui.TaskListManager.readExistingOrCreateNewList",
          "source": "TaskListManager.java:285"
        },
        {
          "method": "org.eclipse.mylyn.tasks.ui.TasksUiPlugin.start",
          "source": "TasksUiPlugin.java:343"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl$2.run",
          "source": "BundleContextImpl.java:999"
        },
        {
          "method": "java.security.AccessController.doPrivileged",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator",
          "source": "BundleContextImpl.java:993"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl.start",
          "source": "BundleContextImpl.java:974"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleHost.startWorker",
          "source": "BundleHost.java:346"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.AbstractBundle.start",
          "source": "AbstractBundle.java:260"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.start",
          "source": "InternalPlatform.java:877"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation",
          "source": "PluginDescriptor.java:360"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.getPlugin",
          "source": "PluginDescriptor.java:340"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.ui.internal.EarlyStartupRunnable.getPluginForCompatibility",
          "source": "EarlyStartupRunnable.java:149"
        },
        {
          "method": "org.eclipse.ui.internal.EarlyStartupRunnable.run",
          "source": "EarlyStartupRunnable.java:73"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$54.run",
          "source": "Workbench.java:2190"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:55"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "202372",
      "date": "2007-09-06T06:58:19+02:00",
      "product": "Mylyn",
      "component": "Core",
      "severity": "major"
    },
    {
      "exceptionType": "java.io.IOException",
      "message": "Write error",
      "elements": [
        {
          "method": "java.io.FileOutputStream.write",
          "source": "Native Method"
        },
        {
          "method": "java.util.zip.ZipOutputStream.writeInt",
          "source": "ZipOutputStream.java:445"
        },
        {
          "method": "java.util.zip.ZipOutputStream.writeCEN",
          "source": "ZipOutputStream.java:376"
        },
        {
          "method": "java.util.zip.ZipOutputStream.finish",
          "source": "ZipOutputStream.java:309"
        },
        {
          "method": "java.util.zip.DeflaterOutputStream.close",
          "source": "DeflaterOutputStream.java:146"
        },
        {
          "method": "java.util.zip.ZipOutputStream.close",
          "source": "ZipOutputStream.java:321"
        },
        {
          "method": "org.eclipse.mylyn.internal.context.core.InteractionContextExternalizer.writeContextToXml",
          "source": "InteractionContextExternalizer.java:91"
        },
        {
          "method": "org.eclipse.mylyn.internal.context.core.InteractionContextExternalizer.writeContextToXml",
          "source": "InteractionContextExternalizer.java:63"
        },
        {
          "method": "org.eclipse.mylyn.internal.context.core.InteractionContextManager.saveActivityContext",
          "source": "InteractionContextManager.java:710"
        },
        {
          "method": "org.eclipse.mylyn.internal.context.core.InteractionContextManager.deactivateContext",
          "source": "InteractionContextManager.java:596"
        },
        {
          "method": "org.eclipse.mylyn.tasks.ui.TasksUiPlugin$1.taskDeactivated",
          "source": "TasksUiPlugin.java:214"
        },
        {
          "method": "org.eclipse.mylyn.tasks.ui.TaskListManager.deactivateTask",
          "source": "TaskListManager.java:357"
        },
        {
          "method": "org.eclipse.mylyn.internal.tasks.ui.actions.TaskDeactivateAction.run",
          "source": "TaskDeactivateAction.java:34"
        },
        {
          "method": "org.eclipse.mylyn.internal.tasks.ui.views.TaskListCellModifier.toggleTaskActivation",
          "source": "TaskListCellModifier.java:106"
        },
        {
          "method": "org.eclipse.mylyn.internal.tasks.ui.views.TaskListView$6.mouseDown",
          "source": "TaskListView.java:745"
        },
        {
          "method": "org.eclipse.swt.widgets.TypedListener.handleEvent",
          "source": "TypedListener.java:178"
        }
      ],
      "number": 1,
      "commentIndex": 15,
      "bugId": "202372",
      "date": "2007-09-25T07:13:28+02:00",
      "product": "Mylyn",
      "component": "Core",
      "severity": "major"
    }
  ],
  "groupId": "202372",
  "bugId": "202372",
  "date": "2007-09-06T06:58:19+02:00",
  "product": "Mylyn",
  "component": "Core",
  "severity": "major"
}