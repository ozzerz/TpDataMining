{
  "comments": [
    "Build: I-20040514 - 0800\n\nCreate a new plug-in project WITH a manifest.mf\n\nGo to the extensions tab.  Try to add an extension.  You will get the \nexception below.  Ahh, those listener transfers...\n\n\nError May 17, 2004 01:58:51.975 java.util.ConcurrentModificationException\njava.util.ConcurrentModificationException\n\tat java.util.AbstractList$Itr.checkForComodification(Unknown Source)\n\tat java.util.AbstractList$Itr.next(Unknown Source)\n\tat org.eclipse.pde.internal.core.AbstractModel.fireModelChanged\n(AbstractModel.java:62)\n\tat \norg.eclipse.pde.internal.core.bundle.BundlePluginModelBase.fireModelChanged\n(BundlePluginModelBase.java:141)\n\tat org.eclipse.pde.internal.core.bundle.BundlePluginBase.modelChanged\n(BundlePluginBase.java:43)\n\tat \norg.eclipse.pde.internal.ui.model.AbstractEditingModel.fireModelChanged\n(AbstractEditingModel.java:180)\n\tat \norg.eclipse.pde.internal.ui.model.plugin.PluginObjectNode.fireModelChanged\n(PluginObjectNode.java:178)\n\tat \norg.eclipse.pde.internal.ui.model.plugin.PluginObjectNode.fireStructureChanged\n(PluginObjectNode.java:170)\n\tat org.eclipse.pde.internal.ui.model.plugin.PluginBaseNode.add\n(PluginBaseNode.java:186)\n\tat org.eclipse.pde.internal.core.bundle.BundlePluginBase.add\n(BundlePluginBase.java:371)\n\tat \norg.eclipse.pde.internal.ui.wizards.extension.PointSelectionPage.finish\n(PointSelectionPage.java:356)\n\tat \norg.eclipse.pde.internal.ui.wizards.extension.NewExtensionWizard.performFinish\n(NewExtensionWizard.java:73)\n\tat org.eclipse.jface.wizard.WizardDialog.finishPressed\n(WizardDialog.java:607)\n\tat org.eclipse.jface.wizard.WizardDialog.buttonPressed\n(WizardDialog.java:305)\n\tat org.eclipse.jface.dialogs.Dialog$2.widgetSelected(Dialog.java:505)\n\tat org.eclipse.swt.widgets.TypedListener.handleEvent\n(TypedListener.java:89)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:796)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:2725)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2390)\n\tat org.eclipse.jface.window.Window.runEventLoop(Window.java:668)\n\tat org.eclipse.jface.window.Window.open(Window.java:648)\n\tat org.eclipse.pde.internal.ui.editor.plugin.ExtensionsSection$3.run\n(ExtensionsSection.java:378)\n\tat org.eclipse.swt.custom.BusyIndicator.showWhile\n(BusyIndicator.java:69)\n\tat \norg.eclipse.pde.internal.ui.editor.plugin.ExtensionsSection.handleNew\n(ExtensionsSection.java:368)\n\tat \norg.eclipse.pde.internal.ui.editor.plugin.ExtensionsSection.buttonSelected\n(ExtensionsSection.java:183)\n\tat \norg.eclipse.pde.internal.ui.editor.TreeSection$PartAdapter.buttonSelected\n(TreeSection.java:36)\n\tat \norg.eclipse.pde.internal.ui.parts.SharedPartWithButtons$SelectionHandler.button\nSelected(SharedPartWithButtons.java:34)\n\tat \norg.eclipse.pde.internal.ui.parts.SharedPartWithButtons$SelectionHandler.widget\nSelected(SharedPartWithButtons.java:27)\n\tat org.eclipse.swt.widgets.TypedListener.handleEvent\n(TypedListener.java:89)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:796)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:2725)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2390)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1353)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1324)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench\n(Workbench.java:243)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:141)\n\tat org.eclipse.ui.internal.ide.IDEApplication.run\n(IDEApplication.java:90)\n\tat org.eclipse.core.internal.runtime.PlatformActivator$1.run\n(PlatformActivator.java:298)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run\n(EclipseStarter.java:249)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run\n(EclipseStarter.java:126)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n\tat java.lang.reflect.Method.invoke(Unknown Source)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:269)\n\tat org.eclipse.core.launcher.Main.run(Main.java:722)\n\tat org.eclipse.core.launcher.Main.main(Main.java:706)",
    "Here is the listener transfer filter:\n\n\t\t\tsmodel.transferListenersTo(tmodel, new \nIModelChangedListenerFilter() {\n\t\t\t\tpublic boolean accept(IModelChangedListener \nlistener) {\n\t\t\t\t\tif (listener instanceof IFormPart ||\n\t\t\t\t\t\t\tlistener instanceof \nFormOutlinePage)\n\t\t\t\t\t\treturn true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\nObviously, only listeners that implement IFormPart or FormOutlinePage are \nmoved. This is unlikely to have caused the problem above. \n\nIt smells like bundle model -\u003e bundle plugin model cross-listening spagetti.",
    "I cannot reproduce this with the code from HEAD. I can add extensions without \nproblems.",
    "Upon re-reading the original text of the defect, I CAN reproduce it in a newly \ncreated project. \n\nThe problem was caused by the extensions section. When reacting to the \nextension addition event, it was firing the selection event. Details section \non the right was catching the event and creating the details part. The details \npart was adding itself as a model listener. This addition was happening in the \nmiddle of model change notification, and apparently Iterator didn\u0027t like this \nchange of the associated list. The moment AbstractModel asked for the next \nlistener, it fired the concurrent modification exception.\n\nThe simple fix is to create an array of listeners before iterating over them. \nThis way, notification of listeners is static because it uses the listeners \nthat existed at the beginning of the notification process. Listeners arriving \nor departing in the middle of the notification will be ignored. This is not a \nkludge - this is how java.util.Observable notifies observers, for example.",
    "Just a correction of the claim above: listeners arriving during the \nnotification will be ignored, while listeners departing will be needlessly \nnotified. There is a short window for this to happen, so I doubt it will cause \nany problems (otherwise we would know about them via \nConcurrentModificationException already)."
  ],
  "commentCreationDates": [
    "2004-05-17T08:13:44+02:00",
    "2004-05-17T19:07:35+02:00",
    "2004-05-17T19:13:22+02:00",
    "2004-05-17T21:30:04+02:00",
    "2004-05-17T21:33:03+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.util.ConcurrentModificationException",
      "elements": [
        {
          "method": "java.util.AbstractList$Itr.checkForComodification",
          "source": "Unknown Source"
        },
        {
          "method": "java.util.AbstractList$Itr.next",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.pde.internal.core.AbstractModel.fireModelChanged",
          "source": "AbstractModel.java:62"
        },
        {
          "method": "org.eclipse.pde.internal.core.bundle.BundlePluginModelBase.fireModelChanged",
          "source": "BundlePluginModelBase.java:141"
        },
        {
          "method": "org.eclipse.pde.internal.core.bundle.BundlePluginBase.modelChanged",
          "source": "BundlePluginBase.java:43"
        },
        {
          "method": "org.eclipse.pde.internal.ui.model.AbstractEditingModel.fireModelChanged",
          "source": "AbstractEditingModel.java:180"
        },
        {
          "method": "org.eclipse.pde.internal.ui.model.plugin.PluginObjectNode.fireModelChanged",
          "source": "PluginObjectNode.java:178"
        },
        {
          "method": "org.eclipse.pde.internal.ui.model.plugin.PluginObjectNode.fireStructureChanged",
          "source": "PluginObjectNode.java:170"
        },
        {
          "method": "org.eclipse.pde.internal.ui.model.plugin.PluginBaseNode.add",
          "source": "PluginBaseNode.java:186"
        },
        {
          "method": "org.eclipse.pde.internal.core.bundle.BundlePluginBase.add",
          "source": "BundlePluginBase.java:371"
        },
        {
          "method": "org.eclipse.pde.internal.ui.wizards.extension.PointSelectionPage.finish",
          "source": "PointSelectionPage.java:356"
        },
        {
          "method": "org.eclipse.pde.internal.ui.wizards.extension.NewExtensionWizard.performFinish",
          "source": "NewExtensionWizard.java:73"
        },
        {
          "method": "org.eclipse.jface.wizard.WizardDialog.finishPressed",
          "source": "WizardDialog.java:607"
        },
        {
          "method": "org.eclipse.jface.wizard.WizardDialog.buttonPressed",
          "source": "WizardDialog.java:305"
        },
        {
          "method": "org.eclipse.jface.dialogs.Dialog$2.widgetSelected",
          "source": "Dialog.java:505"
        },
        {
          "method": "org.eclipse.swt.widgets.TypedListener.handleEvent",
          "source": "TypedListener.java:89"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:796"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:2725"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2390"
        },
        {
          "method": "org.eclipse.jface.window.Window.runEventLoop",
          "source": "Window.java:668"
        },
        {
          "method": "org.eclipse.jface.window.Window.open",
          "source": "Window.java:648"
        },
        {
          "method": "org.eclipse.pde.internal.ui.editor.plugin.ExtensionsSection$3.run",
          "source": "ExtensionsSection.java:378"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:69"
        },
        {
          "method": "org.eclipse.pde.internal.ui.editor.plugin.ExtensionsSection.handleNew",
          "source": "ExtensionsSection.java:368"
        },
        {
          "method": "org.eclipse.pde.internal.ui.editor.plugin.ExtensionsSection.buttonSelected",
          "source": "ExtensionsSection.java:183"
        },
        {
          "method": "org.eclipse.pde.internal.ui.editor.TreeSection$PartAdapter.buttonSelected",
          "source": "TreeSection.java:36"
        },
        {
          "method": "org.eclipse.pde.internal.ui.parts.SharedPartWithButtons$SelectionHandler.buttonSelected",
          "source": "SharedPartWithButtons.java:34"
        },
        {
          "method": "org.eclipse.pde.internal.ui.parts.SharedPartWithButtons$SelectionHandler.widgetSelected",
          "source": "SharedPartWithButtons.java:27"
        },
        {
          "method": "org.eclipse.swt.widgets.TypedListener.handleEvent",
          "source": "TypedListener.java:89"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:796"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:2725"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2390"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1353"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1324"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:243"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:141"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:90"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:298"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:249"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:126"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:269"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:722"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:706"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "62439",
      "date": "2004-05-17T08:13:44+02:00",
      "product": "PDE",
      "component": "UI",
      "severity": "normal"
    }
  ],
  "groupId": "62439",
  "bugId": "62439",
  "date": "2004-05-17T08:13:44+02:00",
  "product": "PDE",
  "component": "UI",
  "severity": "normal"
}