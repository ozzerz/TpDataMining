{
  "comments": [
    "NPE occurs after droping an element from the palette (think selected element \nwill be resetted).\n\nAplies to 3.1M6 and 3.1M7\n\nProblem is not visible to users (exception catched anywhere) it only floods \nthe log file.\n\nRegards\nDirk\n\nStacktrace:\njava.lang.NullPointerException\n\tat org.eclipse.gef.editparts.AbstractEditPart.getRoot\n(AbstractEditPart.java:571)\n\tat org.eclipse.gef.editparts.AbstractEditPart.getViewer\n(AbstractEditPart.java:621)\n\tat \norg.eclipse.gef.internal.ui.palette.editparts.PaletteEditPart.getPaletteViewer\n(PaletteEditPart.java:214)\n\tat \norg.eclipse.gef.internal.ui.palette.editparts.ToolEntryEditPart$OtherToggleButt\nonTracker.handleNativeDragFinished(ToolEntryEditPart.java:202)\n\tat org.eclipse.gef.tools.AbstractTool.nativeDragFinished\n(AbstractTool.java:1076)\n\tat org.eclipse.gef.tools.SelectionTool.handleNativeDragFinished\n(SelectionTool.java:378)\n\tat org.eclipse.gef.tools.AbstractTool.nativeDragFinished\n(AbstractTool.java:1076)\n\tat org.eclipse.gef.EditDomain.nativeDragFinished(EditDomain.java:281)\n\tat \norg.eclipse.gef.ui.parts.DomainEventDispatcher.dispatchNativeDragFinished\n(DomainEventDispatcher.java:387)\n\tat org.eclipse.gef.ui.parts.GraphicalViewerImpl$1\n$TheLastListener.dragFinished(GraphicalViewerImpl.java:346)\n\tat org.eclipse.swt.dnd.DNDListener.handleEvent(DNDListener.java:35)\n\n\u003ccut\u003e",
    "Steps to reproduce?",
    "It might be a little difficult to reproduce. The qestion is if we are doing\nsomething we shouldn\u0027t do or if the palette is not handling our use case.\n\nThe situation is as follows. We rebuild the palette dynamically based on change\nevents of our model. This allows us to drop specific tools if the current model\nstate discourage the usage of these tools.\n\n-\u003e open editor, palette is build\n-\u003e drag and drop a CombinedTemplateCreationEntry from the palette into the editor\n\nUppon drop, we have the following call sequence:\n\n-\u003e AbstractTransferDropTargetListener#drop\n-\u003e CommandStack#execute\n-\u003e command updates model\n-\u003e model sends change event\n-\u003e editor receives change event\n-\u003e editor rebuilds the palette groups (PaletteContainer#setChildren)\n-\u003e DragSourceListener#dragFinished\n-\u003e PaletteSelectionTool#nativeDragFinished\n-\u003e ToolEntryEditPart$OtherToggleButtonTracker#handleNativeDragFinished\n-\u003e NPE, because the parent of the ToolEntryEditPart has become NULL\n\nActually the drag finished event is send to a OtherToggleButtonTracker of a\nToolEntryEditPart, which has become obsolete (parent was set to null) because of\nthe palette change. \n\nIMHO updating the palette due to model changes is a valid operation and should\nbe handled within GEF. We should also note that no exception was thrown with GEF\n3.0.",
    "\u003eIMHO updating the palette due to model changes is a valid operation\n\nYes, but is deleting an editpart while it is being dragged?  Unless, you\u0027re \nremvoing the item that was just added to the figure from the palette, the \nworkaround is to not rebuild the palette model completely, but just apply the \nchange set to it (which is also much more efficient).  Another option is to \nqueue the palette model update on the Display thread rather than doing it \nright when you get the notification.",
    "This shouldn\u0027t be too hard to fix, but it also won\u0027t be easy for us to test. \nCan you supply a patch instead, and we\u0027ll verify that no regressions are \nintroduced?\n\nDon\u0027t forget that GTK has a special tracked in the palette."
  ],
  "commentCreationDates": [
    "2005-05-27T15:55:40+02:00",
    "2005-05-27T16:16:56+02:00",
    "2005-05-30T14:16:53+02:00",
    "2005-05-31T09:37:01+02:00",
    "2005-05-31T15:57:58+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.gef.editparts.AbstractEditPart.getRoot",
          "source": "AbstractEditPart.java:571"
        },
        {
          "method": "org.eclipse.gef.editparts.AbstractEditPart.getViewer",
          "source": "AbstractEditPart.java:621"
        },
        {
          "method": "org.eclipse.gef.internal.ui.palette.editparts.PaletteEditPart.getPaletteViewer",
          "source": "PaletteEditPart.java:214"
        },
        {
          "method": "org.eclipse.gef.internal.ui.palette.editparts.ToolEntryEditPart$OtherToggleButtonTracker.handleNativeDragFinished",
          "source": "ToolEntryEditPart.java:202"
        },
        {
          "method": "org.eclipse.gef.tools.AbstractTool.nativeDragFinished",
          "source": "AbstractTool.java:1076"
        },
        {
          "method": "org.eclipse.gef.tools.SelectionTool.handleNativeDragFinished",
          "source": "SelectionTool.java:378"
        },
        {
          "method": "org.eclipse.gef.tools.AbstractTool.nativeDragFinished",
          "source": "AbstractTool.java:1076"
        },
        {
          "method": "org.eclipse.gef.EditDomain.nativeDragFinished",
          "source": "EditDomain.java:281"
        },
        {
          "method": "org.eclipse.gef.ui.parts.DomainEventDispatcher.dispatchNativeDragFinished",
          "source": "DomainEventDispatcher.java:387"
        },
        {
          "method": "org.eclipse.gef.ui.parts.GraphicalViewerImpl$1$TheLastListener.dragFinished",
          "source": "GraphicalViewerImpl.java:346"
        },
        {
          "method": "org.eclipse.swt.dnd.DNDListener.handleEvent",
          "source": "DNDListener.java:35"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "96975",
      "date": "2005-05-27T15:55:40+02:00",
      "product": "GEF",
      "component": "GEF",
      "severity": "normal"
    }
  ],
  "groupId": "96975",
  "bugId": "96975",
  "date": "2005-05-27T15:55:40+02:00",
  "product": "GEF",
  "component": "GEF",
  "severity": "normal"
}