{
  "comments": [
    "SWT-win32, v3229\n\nWhen a drop target is disposed of in DropTargetListener.drop,\nthe following exception is thrown:\n\nException in thread \"main\" java.lang.NullPointerException\n  at org.eclipse.swt.dnd.DropTarget.refresh(DropTarget.java:545)\n  at org.eclipse.swt.dnd.DropTarget.Drop(DropTarget.java:427)\n  at org.eclipse.swt.dnd.DropTarget$3.method6(DropTarget.java:238)\n  at org.eclipse.swt.internal.ole.win32.COMObject.callback6(COMObject.java:117)\n  at org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)\n  at org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:1879)\n  at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2964)\n\nThis is a recent regression.\n\n---\n\nimport org.eclipse.swt.dnd.*;\nimport org.eclipse.swt.widgets.*;\n\npublic class DropTargetTest {\n  public static void main(String[] args) {\n    Display display \u003d new Display();\n    \n    Shell shell \u003d new Shell(display);\n    shell.setText(\"Drop some text on the shell\");\n    \n    final DropTarget target \u003d new DropTarget(\n      shell,\n      DND.DROP_DEFAULT | DND.DROP_COPY);\n    \n    final TextTransfer transfer \u003d TextTransfer.getInstance();\n    target.setTransfer(new Transfer[] {transfer});\n    \n    target.addDropListener(new DropTargetAdapter() {\n      public void dragEnter(DropTargetEvent event) {\n        event.detail \u003d DND.DROP_COPY;\n      }\n      \n      public void drop(DropTargetEvent event) {\n        if (transfer.isSupportedType(event.currentDataType)) {\n          target.dispose();\n        }\n      }\n    });\n    \n    shell.setSize(400, 400);\n    shell.open();\n    \n    while (!shell.isDisposed()) {\n      if (!display.readAndDispatch()) display.sleep();\n    }\n    \n    display.dispose();\n  }\n}",
    "Thanks Florian - an excellent bug report as usual.\n\nFixed for this week\u0027s milestone build.",
    "fixed",
    "Verified with the latest SWT from CVS.\n\nOut of curiosity, I also checked what happened when the dispose() call\nis made from any of the other methods of DropTargetListener.\n\n-dragLeave:\n\nWhen the data is dropped (without leaving the target area), the following\nexception occurs:\n\nException in thread \"main\" org.eclipse.swt.SWTException: Widget is disposed\n  at org.eclipse.swt.SWT.error(SWT.java:3374)\n  at org.eclipse.swt.SWT.error(SWT.java:3297)\n  at org.eclipse.swt.SWT.error(SWT.java:3268)\n  at org.eclipse.swt.widgets.Widget.error(Widget.java:432)\n  at org.eclipse.swt.widgets.Widget.checkWidget(Widget.java:327)\n  at org.eclipse.swt.widgets.Widget.getStyle(Widget.java:598)\n  at org.eclipse.swt.dnd.DropTarget.setEventData(DropTarget.java:585)\n  at org.eclipse.swt.dnd.DropTarget.Drop(DropTarget.java:375)\n  at org.eclipse.swt.dnd.DropTarget$3.method6(DropTarget.java:238)\n  at org.eclipse.swt.internal.ole.win32.COMObject.callback6(COMObject.java:117)\n  at org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)\n  at org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:1879)\n  at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2964)\n\n-dropAccept:\n\nThis results in another NPE:\n\nException in thread \"main\" java.lang.NullPointerException\n  at org.eclipse.swt.dnd.DropTarget.Drop(DropTarget.java:408)\n  at org.eclipse.swt.dnd.DropTarget$3.method6(DropTarget.java:238)\n  at org.eclipse.swt.internal.ole.win32.COMObject.callback6(COMObject.java:117)\n  at org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)\n  at org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:1879)\n  at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2964)\n\nReopening since you might want to fix these cases too.",
    "Clearing stale milestone.",
    "Created an attachment (id\u003d54911)\nPatch to check for dispose\n\nSteve, can you verify this patch. Thanks."
  ],
  "commentCreationDates": [
    "2006-03-25T21:12:03+01:00",
    "2006-03-27T18:02:57+02:00",
    "2006-03-27T18:47:41+02:00",
    "2006-03-27T21:30:18+02:00",
    "2006-06-02T00:04:19+02:00",
    "2006-12-01T18:48:09+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.swt.dnd.DropTarget.refresh",
          "source": "DropTarget.java:545"
        },
        {
          "method": "org.eclipse.swt.dnd.DropTarget.Drop",
          "source": "DropTarget.java:427"
        },
        {
          "method": "org.eclipse.swt.dnd.DropTarget$3.method6",
          "source": "DropTarget.java:238"
        },
        {
          "method": "org.eclipse.swt.internal.ole.win32.COMObject.callback6",
          "source": "COMObject.java:117"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessage",
          "source": "OS.java:1879"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2964"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "133276",
      "date": "2006-03-25T21:12:03+01:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "normal"
    },
    {
      "exceptionType": "org.eclipse.swt.SWTException",
      "message": "Widget is disposed",
      "elements": [
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3374"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3297"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3268"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.error",
          "source": "Widget.java:432"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.checkWidget",
          "source": "Widget.java:327"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.getStyle",
          "source": "Widget.java:598"
        },
        {
          "method": "org.eclipse.swt.dnd.DropTarget.setEventData",
          "source": "DropTarget.java:585"
        },
        {
          "method": "org.eclipse.swt.dnd.DropTarget.Drop",
          "source": "DropTarget.java:375"
        },
        {
          "method": "org.eclipse.swt.dnd.DropTarget$3.method6",
          "source": "DropTarget.java:238"
        },
        {
          "method": "org.eclipse.swt.internal.ole.win32.COMObject.callback6",
          "source": "COMObject.java:117"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessage",
          "source": "OS.java:1879"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2964"
        }
      ],
      "number": 1,
      "commentIndex": 3,
      "bugId": "133276",
      "date": "2006-03-27T21:30:18+02:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.swt.dnd.DropTarget.Drop",
          "source": "DropTarget.java:408"
        },
        {
          "method": "org.eclipse.swt.dnd.DropTarget$3.method6",
          "source": "DropTarget.java:238"
        },
        {
          "method": "org.eclipse.swt.internal.ole.win32.COMObject.callback6",
          "source": "COMObject.java:117"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessage",
          "source": "OS.java:1879"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2964"
        }
      ],
      "number": 2,
      "commentIndex": 3,
      "bugId": "133276",
      "date": "2006-03-27T21:30:18+02:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "normal"
    }
  ],
  "groupId": "133276",
  "bugId": "133276",
  "date": "2006-03-25T21:12:03+01:00",
  "product": "Platform",
  "component": "SWT",
  "severity": "normal"
}