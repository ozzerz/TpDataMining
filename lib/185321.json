{
  "comments": [
    "HEAD, follow-up to bug 184971\n\nScenario from bug 184971 comment 1:\n- Open Synchronize view\n- Select \"Synchronize...\" from left-most toolbar menu. \n- In the resulting dialog, select \"CVS\" and click next.\n- Hit Esc to close the dialog\n\n\u003d\u003e 2 images are leaked (in HEAD), here\u0027s the trace from Sleak:\n\njava.lang.Error\n        at org.eclipse.swt.graphics.Device.new_Object(Device.java:787)\n        at org.eclipse.swt.graphics.Image.\u003cinit\u003e(Image.java:453)\n        at\norg.eclipse.jface.resource.ImageDescriptor.createImage(ImageDescriptor.java:291)\n        at\norg.eclipse.jface.resource.ImageDescriptor.createResource(ImageDescriptor.java:165)\n        at\norg.eclipse.jface.resource.DeviceResourceManager.allocate(DeviceResourceManager.java:56)\n        at\norg.eclipse.jface.resource.AbstractResourceManager.create(AbstractResourceManager.java:88)\n        at\norg.eclipse.jface.resource.LocalResourceManager.allocate(LocalResourceManager.java:82)\n        at\norg.eclipse.jface.resource.AbstractResourceManager.create(AbstractResourceManager.java:88)\n        at\norg.eclipse.jface.resource.ResourceManager.createImage(ResourceManager.java:172)\n        at\norg.eclipse.ui.internal.decorators.OverlayCache.getImageFor(OverlayCache.java:62)\n        at\norg.eclipse.ui.internal.decorators.OverlayCache.applyDescriptors(OverlayCache.java:85)\n        at\norg.eclipse.ui.internal.decorators.DecorationResult.decorateWithOverlays(DecorationResult.java:84)\n        at\norg.eclipse.ui.internal.decorators.DecorationScheduler.decorateWithOverlays(DecorationScheduler.java:180)\n        at\norg.eclipse.ui.internal.decorators.DecoratorManager.decorateImage(DecoratorManager.java:367)\n        at\norg.eclipse.jface.viewers.DecoratingLabelProvider.decorateSettings(DecoratingLabelProvider.java:379)\n        at\norg.eclipse.jface.viewers.DecoratingLabelProvider.updateLabel(DecoratingLabelProvider.java:346)\n        at\norg.eclipse.jface.viewers.WrappedViewerLabelProvider.update(WrappedViewerLabelProvider.java:183)\n        at\norg.eclipse.jface.viewers.ViewerColumn.refresh(ViewerColumn.java:135)\n        at\norg.eclipse.jface.viewers.AbstractTreeViewer.doUpdateItem(AbstractTreeViewer.java:895)\n        at\norg.eclipse.jface.viewers.AbstractTreeViewer$UpdateItemSafeRunnable.run(AbstractTreeViewer.java:97)\n        at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)",
    "AFAICS, the problem is in org.eclipse.ui.internal.decorators.OverlayCache.applyDescriptors(..), which calls ResourceManager.createImage(ImageDescriptor) on a new DecorationOverlayIcon, but never calls\nResourceManager.destroyImage(ImageDescriptor) as mandated by the Javadoc of createImage(..).\n\nThe only other way how images can be disposed is by calling OverlayCache.disposeAll(), but that\u0027s only called on shutdown.\n\nThis problem only becomes a real leak for images that are disposed after use, since their handles become 0, and thus the images can never be reused by AbstractResourceManager.create(DeviceResourceDescriptor), since map.get(descriptor) will never find the previous image.\nTherefore, the leak cannot be observed in the Package Explorer (since we cache all base images), but can be seen with comment 0, since those images are disposed after use.",
    "Update to steps in comment 0: you need to have outgoing CVS changes in your workspace, such that the Workspace and Java Workspace icons get decorations.",
    "This is a duplicate of 181215. We need to consider a general cleanup strategy for these images as there is no way to determine when the original image is no longer of any use.\n\n\n\n*** This bug has been marked as a duplicate of bug 181215 ***"
  ],
  "commentCreationDates": [
    "2007-05-03T13:40:52+02:00",
    "2007-05-03T13:52:44+02:00",
    "2007-05-03T18:29:13+02:00",
    "2007-05-04T13:58:02+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.Error",
      "elements": [
        {
          "method": "org.eclipse.swt.graphics.Device.new_Object",
          "source": "Device.java:787"
        },
        {
          "method": "org.eclipse.swt.graphics.Image.\u003cinit\u003e",
          "source": "Image.java:453"
        },
        {
          "method": "org.eclipse.jface.resource.ImageDescriptor.createImage",
          "source": "ImageDescriptor.java:291"
        },
        {
          "method": "org.eclipse.jface.resource.ImageDescriptor.createResource",
          "source": "ImageDescriptor.java:165"
        },
        {
          "method": "org.eclipse.jface.resource.DeviceResourceManager.allocate",
          "source": "DeviceResourceManager.java:56"
        },
        {
          "method": "org.eclipse.jface.resource.AbstractResourceManager.create",
          "source": "AbstractResourceManager.java:88"
        },
        {
          "method": "org.eclipse.jface.resource.LocalResourceManager.allocate",
          "source": "LocalResourceManager.java:82"
        },
        {
          "method": "org.eclipse.jface.resource.AbstractResourceManager.create",
          "source": "AbstractResourceManager.java:88"
        },
        {
          "method": "org.eclipse.jface.resource.ResourceManager.createImage",
          "source": "ResourceManager.java:172"
        },
        {
          "method": "org.eclipse.ui.internal.decorators.OverlayCache.getImageFor",
          "source": "OverlayCache.java:62"
        },
        {
          "method": "org.eclipse.ui.internal.decorators.OverlayCache.applyDescriptors",
          "source": "OverlayCache.java:85"
        },
        {
          "method": "org.eclipse.ui.internal.decorators.DecorationResult.decorateWithOverlays",
          "source": "DecorationResult.java:84"
        },
        {
          "method": "org.eclipse.ui.internal.decorators.DecorationScheduler.decorateWithOverlays",
          "source": "DecorationScheduler.java:180"
        },
        {
          "method": "org.eclipse.ui.internal.decorators.DecoratorManager.decorateImage",
          "source": "DecoratorManager.java:367"
        },
        {
          "method": "org.eclipse.jface.viewers.DecoratingLabelProvider.decorateSettings",
          "source": "DecoratingLabelProvider.java:379"
        },
        {
          "method": "org.eclipse.jface.viewers.DecoratingLabelProvider.updateLabel",
          "source": "DecoratingLabelProvider.java:346"
        },
        {
          "method": "org.eclipse.jface.viewers.WrappedViewerLabelProvider.update",
          "source": "WrappedViewerLabelProvider.java:183"
        },
        {
          "method": "org.eclipse.jface.viewers.ViewerColumn.refresh",
          "source": "ViewerColumn.java:135"
        },
        {
          "method": "org.eclipse.jface.viewers.AbstractTreeViewer.doUpdateItem",
          "source": "AbstractTreeViewer.java:895"
        },
        {
          "method": "org.eclipse.jface.viewers.AbstractTreeViewer$UpdateItemSafeRunnable.run",
          "source": "AbstractTreeViewer.java:97"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "185321",
      "duplicateId": "181215",
      "date": "2007-05-03T13:40:52+02:00",
      "product": "Platform",
      "component": "UI",
      "severity": "major"
    }
  ],
  "groupId": "181215",
  "bugId": "185321",
  "duplicateId": "181215",
  "date": "2007-05-03T13:40:52+02:00",
  "product": "Platform",
  "component": "UI",
  "severity": "major"
}