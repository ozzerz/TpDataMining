{
  "comments": [
    "MyClass.java\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\npublic class MyClass {\n\n\t@Retention({RententionPolicy.RUNTIME})\n\tprivate @interface MyAnnotation {\n\t}\n}\n\n---\n\nMyAspect.aj\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\nprivileged public aspect MyAspect {\n\n\tdeclare @type : MyClass+ : @MyClass.MyAnnotation;\n\n}\n\n---\n\nInternal Compiler Error:\n\njava.lang.ClassCastException\nat org.aspectj.org.eclipse.jdt.internal.compiler.ast.Annotation.detectStandardAnnotation(Annotation.java:99)\nat org.aspectj.org.eclipse.jdt.internal.compiler.ast.Annotation.resolveType(Annotation.java:280)\nat org.aspectj.org.eclipse.jdt.internal.compiler.ast.ASTNode.resolveAnnotations(ASTNode.java:436)\nat org.aspectj.org.eclipse.jdt.internal.compiler.lookup.SourceTypeBinding.getAnnotationTagBits(SourceTypeBinding.java:743)\nat org.aspectj.org.eclipse.jdt.internal.compiler.ast.Annotation.resolveType(Annotation.java:331)\nat org.aspectj.org.eclipse.jdt.internal.compiler.ast.ASTNode.resolveAnnotations(ASTNode.java:436)\nat org.aspectj.org.eclipse.jdt.internal.compiler.lookup.MethodBinding.getAnnotationTagBits(MethodBinding.java:450)\nat org.aspectj.org.eclipse.jdt.internal.compiler.lookup.SourceTypeBinding.resolveTypesFor(SourceTypeBinding.java:1268)\nat org.aspectj.org.eclipse.jdt.internal.compiler.lookup.SourceTypeBinding.methods(SourceTypeBinding.java:1081)\nat org.aspectj.ajdt.internal.compiler.ast.AspectDeclaration.checkSpec(AspectDeclaration.java:131)\nat org.aspectj.ajdt.internal.compiler.ast.AspectDeclaration.buildInterTypeAndPerClause(AspectDeclaration.java:1070)\nat org.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.buildInterTypeAndPerClause(AjLookupEnvironment.java:463)\nat org.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.collectAllITDsAndDeclares(AjLookupEnvironment.java:332)\nat org.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.completeTypeBindings(AjLookupEnvironment.java:173)\nat org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.beginToCompile(Compiler.java:301)\nat org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile(Compiler.java:315)\nat org.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilation(AjBuildManager.java:862)\nat org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild(AjBuildManager.java:242)\nat org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild(AjBuildManager.java:161)\nat org.aspectj.ajde.internal.CompilerAdapter.compile(CompilerAdapter.java:122)\nat org.aspectj.ajde.internal.AspectJBuildManager$CompilerThread.run(AspectJBuildManager.java:191)\n\nClassCastException thrown: org.aspectj.org.eclipse.jdt.internal.compiler.ast.ArrayInitializer",
    "Actually, it turns out the aspect isn\u0027t even needed.\n\nThis is enough to trigger the Internal Compiler Error:\n\nBug.java\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\npublic class Bug {\n\n\t@Retention({RetentionPolicy.RUNTIME})\n\tpublic @interface MyAnnotation {\n\t}\n}\n\n---\n\nI just realized that the @Retention meta-annotation isn\u0027t supposed to take an array-type value.  The problem goes away when I change it to the proper:\n\n@Retention(RetentionPolicy.RUNTIME)\n\nTherefore, this is a trivial bug.\n\nIt looks like the regular Java compiler also throws an Internal Compiler Error on the incorrect construct, so it\u0027s probably not specifically an AspectJ problem.",
    "Fix committed. May already be fixed in the Eclipse 3.2 compiler - we should look out when we move to it."
  ],
  "commentCreationDates": [
    "2006-06-24T19:30:16+02:00",
    "2006-06-24T19:37:56+02:00",
    "2006-07-05T11:41:00+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ClassCastException",
      "elements": [
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.ast.Annotation.detectStandardAnnotation",
          "source": "Annotation.java:99"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.ast.Annotation.resolveType",
          "source": "Annotation.java:280"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.ast.ASTNode.resolveAnnotations",
          "source": "ASTNode.java:436"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.lookup.SourceTypeBinding.getAnnotationTagBits",
          "source": "SourceTypeBinding.java:743"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.ast.Annotation.resolveType",
          "source": "Annotation.java:331"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.ast.ASTNode.resolveAnnotations",
          "source": "ASTNode.java:436"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.lookup.MethodBinding.getAnnotationTagBits",
          "source": "MethodBinding.java:450"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.lookup.SourceTypeBinding.resolveTypesFor",
          "source": "SourceTypeBinding.java:1268"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.lookup.SourceTypeBinding.methods",
          "source": "SourceTypeBinding.java:1081"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.ast.AspectDeclaration.checkSpec",
          "source": "AspectDeclaration.java:131"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.ast.AspectDeclaration.buildInterTypeAndPerClause",
          "source": "AspectDeclaration.java:1070"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.buildInterTypeAndPerClause",
          "source": "AjLookupEnvironment.java:463"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.collectAllITDsAndDeclares",
          "source": "AjLookupEnvironment.java:332"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.completeTypeBindings",
          "source": "AjLookupEnvironment.java:173"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.beginToCompile",
          "source": "Compiler.java:301"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile",
          "source": "Compiler.java:315"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilation",
          "source": "AjBuildManager.java:862"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild",
          "source": "AjBuildManager.java:242"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild",
          "source": "AjBuildManager.java:161"
        },
        {
          "method": "org.aspectj.ajde.internal.CompilerAdapter.compile",
          "source": "CompilerAdapter.java:122"
        },
        {
          "method": "org.aspectj.ajde.internal.AspectJBuildManager$CompilerThread.run",
          "source": "AspectJBuildManager.java:191"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "148537",
      "date": "2006-06-24T19:30:16+02:00",
      "product": "AspectJ",
      "component": "Compiler",
      "severity": "trivial"
    }
  ],
  "groupId": "148537",
  "bugId": "148537",
  "date": "2006-06-24T19:30:16+02:00",
  "product": "AspectJ",
  "component": "Compiler",
  "severity": "trivial"
}