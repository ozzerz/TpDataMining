{
  "comments": [
    "+++ This bug was initially created as a clone of Bug #62927 +++\n\nSimilar to Bug #62927 I get this exception but maybe the situation is a different one. \nIn Eclipse 3.1.2 Problems occurred when invoking code from plug-in: \"org.eclipse.core.runtime\" and the expected operation is not completed.\nIn Eclipse 3.2.1 Problems occurred when invoking code from plug-in: \"org.eclipse.equinox.preferences\" and the expected operation is completed, but only the first one.\n\nShort description: \nI mark my projects using IEclipsePreferences Nodes. When I import such a project I like to add a new, non existend library to the classpath of that project.\nIt throws java.lang.IllegalArgumentException: Attempted to beginRule: R/, does not match outer scope rule: P/test1\nat org.eclipse.core.internal.runtime.Assert.isLegal(Assert.java:58)\nat org.eclipse.core.internal.jobs.ThreadJob.illegalPush(ThreadJob.java:117)\n....\n\n\nAnd here the szenario to reproduce:\n\n\n1- create a plugin, use org.eclipse.core.runtime.preferences extension point and create your own modifier extending org.eclipse.core.runtime.preferences.PreferenceModifyListener.\n2- implement the modifier and try to extend the classpath of you project with a new library\n\nhere an example of the preApply() Method:\n\npublic IEclipsePreferences preApply(IEclipsePreferences node) {\n IEclipsePreferences ret \u003d super.preApply(node);\n if ( node.name().compareTo(\"a.b.myNode\")\u003d\u003d 0) {\n   String projectName \u003d node.get(\"a.b.myNode.name\",null);\n   IProject project \u003d ResourcesPlugin.getWorkspace().getRoot().getProject(projectName);      \n   try {\n       IJavaElement javaElement \u003d JavaCore.create(project);\n       IPath path \u003d new Path(project.getFullPath().append(\"gui/webapp/WEB-INF/lib/cis.jar\").toString());\n       IClasspathEntry[] cl \u003d javaElement.getJavaProject().getRawClasspath();\n\t\t\n       IClasspathEntry[] cNewEntries \u003d new IClasspathEntry[cl.length+1];\n       cNewEntries[0]\u003dJavaCore.newLibraryEntry(path,null,null);;\n\t//copy\n\tfor (int i\u003d1; i\u003ccNewEntries.length; i++) {\n\t\t\tcNewEntries[i] \u003d cl[i-1];\n\t}\n\tjavaElement.getJavaProject().setRawClasspath(cNewEntries,monitor);\t\n       \n\t\t\t\t\n       } catch (CoreException e) {\n       e.printStackTrace();}\n  return ret;\n}\n\n3- Using an Action plugin you can ensure the classpath extension works properly before importing the project in the next step.\nDo not forget to remove the entry from .classpath after each test.\n\n4- Launch the Application (plugin)\n5- create a java project \"test\"\n6- add .settings folder and create a node file a.b.myNode with this content:\n\na.b.myNode.name\u003dtest\neclipse.preferences.version\u003d1\n\n7- Delete the project without deleting its content\n8- Import the project as existing one\n\n\n\nIt\u0027s very short desription. If it is too short, fill free to ask more.\n\nbest regards\nJosef Haiduk",
    "Can you provide the complete stack trace of the exception?",
    "Without a stack trace this bug report is not useful. Anyone could be causing that exception by improperly using the IJobManager.beginRule API method.",
    "Here the exception:\nEclipse 3.1.2\n\njava.lang.IllegalArgumentException: Attempted to beginRule: R/, does not match outer scope rule: P/test1\nat org.eclipse.core.internal.runtime.Assert.isLegal(Assert.java:58)\nat org.eclipse.core.internal.jobs.ThreadJob.illegalPush(ThreadJob.java:117)\nat org.eclipse.core.internal.jobs.ThreadJob.push(ThreadJob.java:226)\nat org.eclipse.core.internal.jobs.ImplicitJobs.begin(ImplicitJobs.java:59)\nat org.eclipse.core.internal.jobs.JobManager.beginRule(JobManager.java:190)\nat org.eclipse.core.internal.resources.WorkManager.checkIn(WorkManager.java:96)\nat org.eclipse.core.internal.resources.Workspace.prepareOperation(Workspace.java:1676)\nat org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1716)\nat org.eclipse.jdt.internal.core.JavaModelOperation.runOperation(JavaModelOperation.java:782)\nat org.eclipse.jdt.internal.core.JavaProject.setRawClasspath(JavaProject.java:2846)\nat org.eclipse.jdt.internal.core.JavaProject.setRawClasspath(JavaProject.java:2862)\nat com.softwareag.xci.plugins.project.utils.CoreUtility.addToClasspath(CoreUtility.java:78)\nat com.softwareag.xci.plugins.project.utils.CoreUtility.addLibToClasspath(CoreUtility.java:85)\nat com.softwareag.xci.plugins.project.PreferenceModifyListener.preApply(PreferenceModifyListener.java:31)\nat org.eclipse.core.internal.preferences.PreferencesService$7.run(PreferencesService.java:1112)\nat org.eclipse.core.internal.runtime.InternalPlatform.run(InternalPlatform.java:1044)\nat org.eclipse.core.runtime.Platform.run(Platform.java:783)\nat org.eclipse.core.internal.preferences.PreferencesService.firePreApplyEvent(PreferencesService.java:1115)\nat org.eclipse.core.internal.preferences.PreferencesService.applyPreferences(PreferencesService.java:186)\nat org.eclipse.core.internal.resources.ProjectPreferences.read(ProjectPreferences.java:404)\nat org.eclipse.core.internal.resources.ProjectPreferences.updatePreferences(ProjectPreferences.java:426)\nat org.eclipse.core.internal.resources.File.updateMetadataFiles(File.java:416)\nat org.eclipse.core.internal.localstore.RefreshLocalVisitor.visit(RefreshLocalVisitor.java:294)\nat org.eclipse.core.internal.localstore.UnifiedTree.accept(UnifiedTree.java:83)\nat org.eclipse.core.internal.localstore.FileSystemResourceManager.refreshResource(FileSystemResourceManager.java:640)\nat org.eclipse.core.internal.localstore.FileSystemResourceManager.refresh(FileSystemResourceManager.java:627)\nat org.eclipse.core.internal.resources.Resource.refreshLocal(Resource.java:1244)\nat org.eclipse.core.internal.refresh.RefreshJob.runInWorkspace(RefreshJob.java:135)\nat org.eclipse.core.internal.resources.InternalWorkspaceJob.run(InternalWorkspaceJob.java:38)\nat org.eclipse.core.internal.jobs.Worker.run(Worker.java:76) \n\nEclipse 3.2.1\njava.lang.IllegalArgumentException: Attempted to beginRule: R/, does not match outer scope rule: P/test1\nat org.eclipse.core.runtime.Assert.isLegal(Assert.java:62)\nat org.eclipse.core.internal.jobs.ThreadJob.illegalPush(ThreadJob.java:116)\nat org.eclipse.core.internal.jobs.ThreadJob.push(ThreadJob.java:225)\nat org.eclipse.core.internal.jobs.ImplicitJobs.begin(ImplicitJobs.java:58)\nat org.eclipse.core.internal.jobs.JobManager.beginRule(JobManager.java:219)\nat org.eclipse.core.internal.resources.WorkManager.checkIn(WorkManager.java:96)\nat org.eclipse.core.internal.resources.Workspace.prepareOperation(Workspace.java:1684)\nat org.eclipse.core.internal.resources.Project.touch(Project.java:1035)\nat org.eclipse.jdt.internal.core.SetClasspathOperation.executeOperation(SetClasspathOperation.java:288)\nat org.eclipse.jdt.internal.core.JavaModelOperation.run(JavaModelOperation.java:720)\nat org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1737)\nat org.eclipse.jdt.internal.core.JavaModelOperation.runOperation(JavaModelOperation.java:784)\nat org.eclipse.jdt.internal.core.JavaProject.setRawClasspath(JavaProject.java:3016)\nat org.eclipse.jdt.internal.core.JavaProject.setRawClasspath(JavaProject.java:3032)\nat com.softwareag.xci.plugins.project.utils.CoreUtility.addToClasspath(CoreUtility.java:78)\nat com.softwareag.xci.plugins.project.utils.CoreUtility.addSourceLocations(CoreUtility.java:217)\nat com.softwareag.xci.plugins.project.PreferenceModifyListener.preApply(PreferenceModifyListener.java:32)\nat org.eclipse.core.internal.preferences.PreferencesService$4.run(PreferencesService.java:415)\nat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\nat org.eclipse.core.internal.preferences.PreferencesService.firePreApplyEvent(PreferencesService.java:418)\nat org.eclipse.core.internal.preferences.PreferencesService.applyPreferences(PreferencesService.java:113)\nat org.eclipse.core.internal.resources.ProjectPreferences.read(ProjectPreferences.java:254)\nat org.eclipse.core.internal.resources.ProjectPreferences.updatePreferences(ProjectPreferences.java:295)\nat org.eclipse.core.internal.resources.File.updateMetadataFiles(File.java:408)\nat org.eclipse.core.internal.localstore.RefreshLocalVisitor.visit(RefreshLocalVisitor.java:294)\nat org.eclipse.core.internal.localstore.UnifiedTree.accept(UnifiedTree.java:93)\nat org.eclipse.core.internal.localstore.FileSystemResourceManager.refreshResource(FileSystemResourceManager.java:726)\nat org.eclipse.core.internal.localstore.FileSystemResourceManager.refresh(FileSystemResourceManager.java:710)\nat org.eclipse.core.internal.resources.Resource.refreshLocal(Resource.java:1400)\nat org.eclipse.core.internal.refresh.RefreshJob.runInWorkspace(RefreshJob.java:141)\nat org.eclipse.core.internal.resources.InternalWorkspaceJob.run(InternalWorkspaceJob.java:38)\nat org.eclipse.core.internal.jobs.Worker.run(Worker.java:58)\n",
    "Reopening based on provided stack trace.",
    "This problem is caused by com.softwareag.xci.plugins.project.PreferenceModifyListener.  It is receiving a preference change event at a time when the thread owns a resource scheduling rule (a form of lock).  It then tries to set the Java classpath, which requires a different lock.  Since acquring two different locks in a thread would usually result in deadlock, we don\u0027t allow this to happen. Your listener should schedule a separate Job to update the classpath asynchronously."
  ],
  "commentCreationDates": [
    "2006-10-10T17:40:34+02:00",
    "2006-10-10T18:11:08+02:00",
    "2006-10-12T20:12:34+02:00",
    "2006-10-16T09:32:10+02:00",
    "2006-10-16T16:08:52+02:00",
    "2006-10-16T17:09:03+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.IllegalArgumentException",
      "message": "Attempted to beginRule: R/, does not match outer scope rule: P/test1",
      "elements": [
        {
          "method": "org.eclipse.core.internal.runtime.Assert.isLegal",
          "source": "Assert.java:58"
        },
        {
          "method": "org.eclipse.core.internal.jobs.ThreadJob.illegalPush",
          "source": "ThreadJob.java:117"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "160334",
      "date": "2006-10-10T17:40:34+02:00",
      "product": "Platform",
      "component": "Resources",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.IllegalArgumentException",
      "message": "Attempted to beginRule: R/, does not match outer scope rule: P/test1",
      "elements": [
        {
          "method": "org.eclipse.core.internal.runtime.Assert.isLegal",
          "source": "Assert.java:58"
        },
        {
          "method": "org.eclipse.core.internal.jobs.ThreadJob.illegalPush",
          "source": "ThreadJob.java:117"
        },
        {
          "method": "org.eclipse.core.internal.jobs.ThreadJob.push",
          "source": "ThreadJob.java:226"
        },
        {
          "method": "org.eclipse.core.internal.jobs.ImplicitJobs.begin",
          "source": "ImplicitJobs.java:59"
        },
        {
          "method": "org.eclipse.core.internal.jobs.JobManager.beginRule",
          "source": "JobManager.java:190"
        },
        {
          "method": "org.eclipse.core.internal.resources.WorkManager.checkIn",
          "source": "WorkManager.java:96"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.prepareOperation",
          "source": "Workspace.java:1676"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1716"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelOperation.runOperation",
          "source": "JavaModelOperation.java:782"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.setRawClasspath",
          "source": "JavaProject.java:2846"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.setRawClasspath",
          "source": "JavaProject.java:2862"
        },
        {
          "method": "com.softwareag.xci.plugins.project.utils.CoreUtility.addToClasspath",
          "source": "CoreUtility.java:78"
        },
        {
          "method": "com.softwareag.xci.plugins.project.utils.CoreUtility.addLibToClasspath",
          "source": "CoreUtility.java:85"
        },
        {
          "method": "com.softwareag.xci.plugins.project.PreferenceModifyListener.preApply",
          "source": "PreferenceModifyListener.java:31"
        },
        {
          "method": "org.eclipse.core.internal.preferences.PreferencesService$7.run",
          "source": "PreferencesService.java:1112"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:1044"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:783"
        },
        {
          "method": "org.eclipse.core.internal.preferences.PreferencesService.firePreApplyEvent",
          "source": "PreferencesService.java:1115"
        },
        {
          "method": "org.eclipse.core.internal.preferences.PreferencesService.applyPreferences",
          "source": "PreferencesService.java:186"
        },
        {
          "method": "org.eclipse.core.internal.resources.ProjectPreferences.read",
          "source": "ProjectPreferences.java:404"
        },
        {
          "method": "org.eclipse.core.internal.resources.ProjectPreferences.updatePreferences",
          "source": "ProjectPreferences.java:426"
        },
        {
          "method": "org.eclipse.core.internal.resources.File.updateMetadataFiles",
          "source": "File.java:416"
        },
        {
          "method": "org.eclipse.core.internal.localstore.RefreshLocalVisitor.visit",
          "source": "RefreshLocalVisitor.java:294"
        },
        {
          "method": "org.eclipse.core.internal.localstore.UnifiedTree.accept",
          "source": "UnifiedTree.java:83"
        },
        {
          "method": "org.eclipse.core.internal.localstore.FileSystemResourceManager.refreshResource",
          "source": "FileSystemResourceManager.java:640"
        },
        {
          "method": "org.eclipse.core.internal.localstore.FileSystemResourceManager.refresh",
          "source": "FileSystemResourceManager.java:627"
        },
        {
          "method": "org.eclipse.core.internal.resources.Resource.refreshLocal",
          "source": "Resource.java:1244"
        },
        {
          "method": "org.eclipse.core.internal.refresh.RefreshJob.runInWorkspace",
          "source": "RefreshJob.java:135"
        },
        {
          "method": "org.eclipse.core.internal.resources.InternalWorkspaceJob.run",
          "source": "InternalWorkspaceJob.java:38"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:76"
        }
      ],
      "number": 1,
      "commentIndex": 3,
      "bugId": "160334",
      "date": "2006-10-16T09:32:10+02:00",
      "product": "Platform",
      "component": "Resources",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.IllegalArgumentException",
      "message": "Attempted to beginRule: R/, does not match outer scope rule: P/test1",
      "elements": [
        {
          "method": "org.eclipse.core.runtime.Assert.isLegal",
          "source": "Assert.java:62"
        },
        {
          "method": "org.eclipse.core.internal.jobs.ThreadJob.illegalPush",
          "source": "ThreadJob.java:116"
        },
        {
          "method": "org.eclipse.core.internal.jobs.ThreadJob.push",
          "source": "ThreadJob.java:225"
        },
        {
          "method": "org.eclipse.core.internal.jobs.ImplicitJobs.begin",
          "source": "ImplicitJobs.java:58"
        },
        {
          "method": "org.eclipse.core.internal.jobs.JobManager.beginRule",
          "source": "JobManager.java:219"
        },
        {
          "method": "org.eclipse.core.internal.resources.WorkManager.checkIn",
          "source": "WorkManager.java:96"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.prepareOperation",
          "source": "Workspace.java:1684"
        },
        {
          "method": "org.eclipse.core.internal.resources.Project.touch",
          "source": "Project.java:1035"
        },
        {
          "method": "org.eclipse.jdt.internal.core.SetClasspathOperation.executeOperation",
          "source": "SetClasspathOperation.java:288"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelOperation.run",
          "source": "JavaModelOperation.java:720"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1737"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelOperation.runOperation",
          "source": "JavaModelOperation.java:784"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.setRawClasspath",
          "source": "JavaProject.java:3016"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.setRawClasspath",
          "source": "JavaProject.java:3032"
        },
        {
          "method": "com.softwareag.xci.plugins.project.utils.CoreUtility.addToClasspath",
          "source": "CoreUtility.java:78"
        },
        {
          "method": "com.softwareag.xci.plugins.project.utils.CoreUtility.addSourceLocations",
          "source": "CoreUtility.java:217"
        },
        {
          "method": "com.softwareag.xci.plugins.project.PreferenceModifyListener.preApply",
          "source": "PreferenceModifyListener.java:32"
        },
        {
          "method": "org.eclipse.core.internal.preferences.PreferencesService$4.run",
          "source": "PreferencesService.java:415"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.core.internal.preferences.PreferencesService.firePreApplyEvent",
          "source": "PreferencesService.java:418"
        },
        {
          "method": "org.eclipse.core.internal.preferences.PreferencesService.applyPreferences",
          "source": "PreferencesService.java:113"
        },
        {
          "method": "org.eclipse.core.internal.resources.ProjectPreferences.read",
          "source": "ProjectPreferences.java:254"
        },
        {
          "method": "org.eclipse.core.internal.resources.ProjectPreferences.updatePreferences",
          "source": "ProjectPreferences.java:295"
        },
        {
          "method": "org.eclipse.core.internal.resources.File.updateMetadataFiles",
          "source": "File.java:408"
        },
        {
          "method": "org.eclipse.core.internal.localstore.RefreshLocalVisitor.visit",
          "source": "RefreshLocalVisitor.java:294"
        },
        {
          "method": "org.eclipse.core.internal.localstore.UnifiedTree.accept",
          "source": "UnifiedTree.java:93"
        },
        {
          "method": "org.eclipse.core.internal.localstore.FileSystemResourceManager.refreshResource",
          "source": "FileSystemResourceManager.java:726"
        },
        {
          "method": "org.eclipse.core.internal.localstore.FileSystemResourceManager.refresh",
          "source": "FileSystemResourceManager.java:710"
        },
        {
          "method": "org.eclipse.core.internal.resources.Resource.refreshLocal",
          "source": "Resource.java:1400"
        },
        {
          "method": "org.eclipse.core.internal.refresh.RefreshJob.runInWorkspace",
          "source": "RefreshJob.java:141"
        },
        {
          "method": "org.eclipse.core.internal.resources.InternalWorkspaceJob.run",
          "source": "InternalWorkspaceJob.java:38"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:58"
        }
      ],
      "number": 2,
      "commentIndex": 3,
      "bugId": "160334",
      "date": "2006-10-16T09:32:10+02:00",
      "product": "Platform",
      "component": "Resources",
      "severity": "normal"
    }
  ],
  "groupId": "160334",
  "bugId": "160334",
  "date": "2006-10-10T17:40:34+02:00",
  "product": "Platform",
  "component": "Resources",
  "severity": "normal"
}