{
  "comments": [
    "This call worked before the renaming of the packages name recently done in the common archive codes. I reacted to the changes, but EARFile.save() no longer works. Note that EARFile.saveAs(Another URI) works though. \n\nI traced the code a bit and found that the delete on the old file failed in the following code:\n\n\tprotected void cleanupAfterTempSave(String aUri, java.io.File original, java.io.File destinationFile) throws SaveFailureException {\n\n\t\tcheckWriteable(original);\n\t\tboolean deleteWorked \u003d false;\n\t\tif (original.isDirectory() \u0026\u0026 !isRenameable(original)) {\n\t\t\tthrow new SaveFailureException(CommonArchiveResourceHandler.getString(CommonArchiveResourceHandler.unable_replace_EXC_, (new Object[]{original.getAbsolutePath()}))); //$NON-NLS-1$ \u003d \"Unable to replace original archive \"\n\t\t}\n\n\t\tfor (int i \u003d 0; i \u003c 10; i++) {\n\t\t\tif (ArchiveUtil.delete(original)) {\n\t\t\t\tdeleteWorked \u003d true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\t// TODO Major hack here; the problem is that a previous call\n\t\t\t\t// to close the source file may not yet have\n\t\t\t\t//been reflected in the os/vm; therefore a subsequent call\n\t\t\t\t// to delete fails. To get around this,\n\t\t\t\t//wait for a bit and retry; if it continues to fail, then\n\t\t\t\t// time out and throw an exception\n\t\t\t\tThread.sleep(250);\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\t//Ignore\n\t\t\t}\n\t\t}\n\n\nThe exception I got is:\nException in thread \"Thread-1\" java.lang.NoSuchFieldError: org/eclipse/jst/j2ee/\ncommonarchivecore/internal/CommonArchiveResourceHandler.unable_replace_EXC_\n        at org.eclipse.jst.j2ee.commonarchivecore.internal.impl.ArchiveImpl.clea\nnupAfterTempSave(ArchiveImpl.java:460)\n        at org.eclipse.jst.j2ee.commonarchivecore.internal.impl.ArchiveImpl.save\nAsNoReopen(ArchiveImpl.java:1320)\n        at org.eclipse.jst.j2ee.commonarchivecore.internal.impl.ArchiveImpl.save\nAs(ArchiveImpl.java:1248)\n        at org.eclipse.jst.j2ee.commonarchivecore.internal.impl.ArchiveImpl.save\n(ArchiveImpl.java:1207)",
    "Seems like there is a mismatch between classes; i.e. the missing field was added on 11/9 and the reference to it was also added on 11/9.  Raymond is going to double check his classpath to see if the problem goes away.",
    "I tried to use the same wccm jar for compile time and runtime, so that there\u0027s no mismatch of classes. I didn\u0027t see the missing field exception any more, but the save still failed. \n\nI also want to add that the root cause of the error is that the delete operation on the original file failed in the following code:\n\n for (int i \u003d 0; i \u003c 10; i++) {\n   if (ArchiveUtil.delete(original)) {\n    deleteWorked \u003d true;\n    break;\n   }\n   try {\n    // TODO Major hack here; the problem is that a previous call\n    // to close the source file may not yet have\n    //been reflected in the os/vm; therefore a subsequent call\n    // to delete fails. To get around this,\n    //wait for a bit and retry; if it continues to fail, then\n    // time out and throw an exception\n    Thread.sleep(250);\n   } catch (InterruptedException e) {\n    //Ignore\n   }\n  }\n\nSo that the saved temp file cannot be renamed to the original file\u0027s name. The saveAs() using another URI works though.\n",
    "Raymond moved up to a newer code base and this problem seems to have fixed itself.",
    "closing."
  ],
  "commentCreationDates": [
    "2005-11-30T21:30:32+01:00",
    "2005-11-30T23:38:50+01:00",
    "2005-12-01T14:56:58+01:00",
    "2005-12-01T17:00:24+01:00",
    "2005-12-01T17:01:34+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NoSuchFieldError",
      "message": "org/eclipse/jst/j2ee/ commonarchivecore/internal/CommonArchiveResourceHandler.unable_replace_EXC_",
      "elements": [
        {
          "method": "org.eclipse.jst.j2ee.commonarchivecore.internal.impl.ArchiveImpl.cleanupAfterTempSave",
          "source": "ArchiveImpl.java:460"
        },
        {
          "method": "org.eclipse.jst.j2ee.commonarchivecore.internal.impl.ArchiveImpl.saveAsNoReopen",
          "source": "ArchiveImpl.java:1320"
        },
        {
          "method": "org.eclipse.jst.j2ee.commonarchivecore.internal.impl.ArchiveImpl.saveAs",
          "source": "ArchiveImpl.java:1248"
        },
        {
          "method": "org.eclipse.jst.j2ee.commonarchivecore.internal.impl.ArchiveImpl.save",
          "source": "ArchiveImpl.java:1207"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "118708",
      "date": "2005-11-30T21:30:32+01:00",
      "product": "Web Tools",
      "component": "jst.j2ee",
      "severity": "critical"
    }
  ],
  "groupId": "118708",
  "bugId": "118708",
  "date": "2005-11-30T21:30:32+01:00",
  "product": "Web Tools",
  "component": "jst.j2ee",
  "severity": "critical"
}