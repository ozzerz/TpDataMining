{
  "comments": [
    "Jeff, Pascal and I have discussed this quite a bit, but never opened a bug for \nit. So here it is: update should not attempt to uninstall the automatically \nstarted bundles (osgi, runtime, configurator) because it did not install them \nitself. These bundles appear on the osig.bundles property.\nMore generally, update should not uninstall any bundles that it did not \ninstall (this could include bundles that have been installed by other \nconfigurators).\n\nAn example of this problem can be seen when updating eclipse itself (Ed\u0027s \nposting on the mailing list):\n\n \n!SESSION Apr 28, 2004 16:50:01.722 --------------------------------------------\n-\njava.version\u003d1.4.2_04\njava.vendor\u003dSun Microsystems Inc.\nBootLoader constants: OS\u003dwin32, ARCH\u003dx86, WS\u003dwin32, NL\u003den_US\n!ENTRY reference:file:c:/Program \nFiles/eclipse/plugins/org.eclipse.core.runtime_3.0.0/ 0 0 Apr 28, 2004 \n16:50:01.738\n!MESSAGE FrameworkEvent.ERROR\n!STACK 0\norg.osgi.framework.BundleException: The bundle could not be resolved. Reason: \nprobably another version has been chosen \n at org.eclipse.osgi.framework.internal.core.BundleHost.startWorker\n(BundleHost.java:395)\n at org.eclipse.osgi.framework.internal.core.AbstractBundle.resume\n(AbstractBundle.java:371)\n at org.eclipse.osgi.framework.internal.core.Framework.resumeBundle\n(Framework.java:1007)\n at org.eclipse.osgi.framework.internal.core.StartLevelManager.resumeBundles\n(StartLevelManager.java:571)\n at org.eclipse.osgi.framework.internal.core.StartLevelManager.incFWSL\n(StartLevelManager.java:482)\n at org.eclipse.osgi.framework.internal.core.StartLevelManager.doSetStartLevel\n(StartLevelManager.java:272)\n at org.eclipse.osgi.framework.internal.core.StartLevelManager.dispatchEvent\n(StartLevelManager.java:442)\n at org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent\n(EventManager.java:153)\n at org.eclipse.osgi.framework.eventmgr.EventThread$Queued.dispatchEvent\n(EventThread.java:56)\n at org.eclipse.osgi.framework.eventmgr.EventThread.run(EventThread.java:107)\n!ENTRY reference:file:c:/Program \nFiles/eclipse/plugins/org.eclipse.core.runtime_3.0.0.v20040426a/ 0 0 Apr 28, \n2004 16:50:01.801\n!MESSAGE FrameworkEvent.ERROR\n!STACK 0\norg.osgi.framework.BundleException: Exception in \norg.eclipse.core.internal.runtime.PlatformActivator.start() of bundle \norg.eclipse.core.runtime.\n at org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator\n(BundleContextImpl.java:990)\n at org.eclipse.osgi.framework.internal.core.BundleContextImpl.start\n(BundleContextImpl.java:952)\n at org.eclipse.osgi.framework.internal.core.BundleHost.startWorker\n(BundleHost.java:408)\n at org.eclipse.osgi.framework.internal.core.AbstractBundle.resume\n(AbstractBundle.java:371)\n at org.eclipse.osgi.framework.internal.core.Framework.resumeBundle\n(Framework.java:1007)\n at org.eclipse.osgi.framework.internal.core.StartLevelManager.resumeBundles\n(StartLevelManager.java:571)\n at org.eclipse.osgi.framework.internal.core.StartLevelManager.incFWSL\n(StartLevelManager.java:482)\n at org.eclipse.osgi.framework.internal.core.StartLevelManager.doSetStartLevel\n(StartLevelManager.java:272)\n at org.eclipse.osgi.framework.internal.core.StartLevelManager.dispatchEvent\n(StartLevelManager.java:442)\n at org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent\n(EventManager.java:153)\n at org.eclipse.osgi.framework.eventmgr.EventThread$Queued.dispatchEvent\n(EventThread.java:56)\n at org.eclipse.osgi.framework.eventmgr.EventThread.run(EventThread.java:107)\nNested exception:\njava.lang.NoClassDefFoundError: \norg/eclipse/osgi/service/systembundle/EntryLocator\n at java.lang.ClassLoader.defineClass0(Native Method)\n at java.lang.ClassLoader.defineClass(Unknown Source)\n at \norg.eclipse.osgi.framework.internal.defaultadaptor.DefaultClassLoader.defineCla\nss(DefaultClassLoader.java:296)\n...",
    "If Update doesn\u0027t uninstall them then how can Eclipse update itself?",
    "Those bundles are listed in config.ini and the framework is started by reading \nthe osgi.bundles properties and locating the appropriate bundles.\nCurrently, version is not shown in config.ini, so the latest version found \nwins. During updates, the update manager is supposed to update config.ini as \nnecessary, or, as in this case, leave it untouched.\nThe framework should uninstall the old version of those bundles and install \nthe newer version.\n\nThere is another bug for updating the config.ini, but for the time being, that \none is not needed.",
    "Fixed.\nAfter discussions with Jeff and Tom about osgi install API\u0027s, we decided to \nuse a little trick to identify the configurator that installs the bundles. As \nsuch, we first wrap the old install url \n(reference:file:/d:/eclipse/plugins/some_bundle/) by an update url \n(update:reference:file:/d:/eclipse/plugins/some_bundle/)\nand call context.install(url.toExternalForm(), url.openStream())\nso that the location is the url external form and the update can later query \nit and see if the bundle was one installed by it.\n\nNote: because the org.eclipse.osgi bundle does not keep track of location but \nit returns \"SystemBundle\", the update configurator is still trying to install \nit but fails. However, it will not uninstall it (that\u0027s the bug report).\n\nI will try to see if this fixes the updating of eclipse itself, or there is \nmore needed.\n"
  ],
  "commentCreationDates": [
    "2004-04-29T04:05:59+02:00",
    "2004-04-29T04:23:38+02:00",
    "2004-04-29T05:04:51+02:00",
    "2004-05-03T19:35:33+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.osgi.framework.BundleException",
      "message": "The bundle could not be resolved. Reason:  probably another version has been chosen",
      "elements": [
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleHost.startWorker",
          "source": "BundleHost.java:395"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.AbstractBundle.resume",
          "source": "AbstractBundle.java:371"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Framework.resumeBundle",
          "source": "Framework.java:1007"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.resumeBundles",
          "source": "StartLevelManager.java:571"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.incFWSL",
          "source": "StartLevelManager.java:482"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.doSetStartLevel",
          "source": "StartLevelManager.java:272"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.dispatchEvent",
          "source": "StartLevelManager.java:442"
        },
        {
          "method": "org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent",
          "source": "EventManager.java:153"
        },
        {
          "method": "org.eclipse.osgi.framework.eventmgr.EventThread$Queued.dispatchEvent",
          "source": "EventThread.java:56"
        },
        {
          "method": "org.eclipse.osgi.framework.eventmgr.EventThread.run",
          "source": "EventThread.java:107"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "60356",
      "date": "2004-04-29T04:05:59+02:00",
      "product": "Platform",
      "component": "Update",
      "severity": "blocker"
    },
    {
      "exceptionType": "org.osgi.framework.BundleException",
      "message": "Exception in  org.eclipse.core.internal.runtime.PlatformActivator.start() of bundle  org.eclipse.core.runtime.",
      "elements": [
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator",
          "source": "BundleContextImpl.java:990"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl.start",
          "source": "BundleContextImpl.java:952"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleHost.startWorker",
          "source": "BundleHost.java:408"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.AbstractBundle.resume",
          "source": "AbstractBundle.java:371"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Framework.resumeBundle",
          "source": "Framework.java:1007"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.resumeBundles",
          "source": "StartLevelManager.java:571"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.incFWSL",
          "source": "StartLevelManager.java:482"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.doSetStartLevel",
          "source": "StartLevelManager.java:272"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.dispatchEvent",
          "source": "StartLevelManager.java:442"
        },
        {
          "method": "org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent",
          "source": "EventManager.java:153"
        },
        {
          "method": "org.eclipse.osgi.framework.eventmgr.EventThread$Queued.dispatchEvent",
          "source": "EventThread.java:56"
        },
        {
          "method": "org.eclipse.osgi.framework.eventmgr.EventThread.run",
          "source": "EventThread.java:107"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "60356",
      "date": "2004-04-29T04:05:59+02:00",
      "product": "Platform",
      "component": "Update",
      "severity": "blocker"
    },
    {
      "exceptionType": "java.lang.NoClassDefFoundError",
      "message": "org/eclipse/osgi/service/systembundle/EntryLocator",
      "elements": [
        {
          "method": "java.lang.ClassLoader.defineClass0",
          "source": "Native Method"
        },
        {
          "method": "java.lang.ClassLoader.defineClass",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.defaultadaptor.DefaultClassLoader.defineClass",
          "source": "DefaultClassLoader.java:296"
        }
      ],
      "number": 2,
      "commentIndex": 0,
      "bugId": "60356",
      "date": "2004-04-29T04:05:59+02:00",
      "product": "Platform",
      "component": "Update",
      "severity": "blocker"
    }
  ],
  "groupId": "60356",
  "bugId": "60356",
  "date": "2004-04-29T04:05:59+02:00",
  "product": "Platform",
  "component": "Update",
  "severity": "blocker"
}