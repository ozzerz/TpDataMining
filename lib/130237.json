{
  "comments": [
    "I\u0027ve customized a Workbench window through ApplicationWorkbenchWindowAdvisor class using guidelines from RCP book. In ApplicationWorkbenchAdvisor class I turned on saving and restoring of Workbench (configurer.setSaveAndRestore(true)). When I quit RCP app I got message window which tells me that some error appear and do I will really quit. \n\nThis is a .log file:\n!SESSION 2006-03-02 22:58:36.015 -----------------------------------------------\neclipse.buildId\u003dunknown\njava.fullversion\u003dJ2RE 1.5.0 IBM J9 2.3 Windows XP x86-32 j9vmwi3223ifx-20060124 (JIT enabled)\nJ9VM - 20051027_03723_lHdSMR\nJIT  - 20051027_1437_r8\nGC   - 20051020_AA\nBootLoader constants: OS\u003dwin32, ARCH\u003dx86, WS\u003dwin32, NL\u003dsr_SP\nFramework arguments:  -product com.birosoft.exedra.product\nCommand-line arguments:  -product com.birosoft.exedra.product -data D:\\workspace/../runtime-exedra.product -dev file:D:/workspace/.metadata/.plugins/org.eclipse.pde.core/exedra.product/dev.properties -os win32 -ws win32 -arch x86\n\n!ENTRY org.eclipse.ui.workbench 4 2 2006-03-02 22:58:51.527\n!MESSAGE Problems occurred when invoking code from plug-in: \"org.eclipse.ui.workbench\".\n!STACK 0\njava.lang.NullPointerException\n\tat org.eclipse.ui.internal.WorkbenchWindow.saveTrimState(WorkbenchWindow.java:2421)\n\tat org.eclipse.ui.internal.WorkbenchWindow.saveState(WorkbenchWindow.java:2407)\n\tat org.eclipse.ui.internal.Workbench.saveState(Workbench.java:1934)\n\tat org.eclipse.ui.internal.Workbench.recordWorkbenchState(Workbench.java:1614)\n\tat org.eclipse.ui.internal.Workbench.access$5(Workbench.java:1611)\n\tat org.eclipse.ui.internal.Workbench$11.run(Workbench.java:673)\n\tat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n\tat org.eclipse.core.runtime.Platform.run(Platform.java:816)\n\tat org.eclipse.ui.internal.Workbench.busyClose(Workbench.java:671)\n\tat org.eclipse.ui.internal.Workbench.access$8(Workbench.java:630)\n\tat org.eclipse.ui.internal.Workbench$14.run(Workbench.java:827)\n\tat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:69)\n\tat org.eclipse.ui.internal.Workbench.close(Workbench.java:825)\n\tat org.eclipse.ui.internal.Workbench.close(Workbench.java:800)\n\tat org.eclipse.ui.internal.WorkbenchWindow.busyClose(WorkbenchWindow.java:612)\n\tat org.eclipse.ui.internal.WorkbenchWindow.access$0(WorkbenchWindow.java:591)\n\tat org.eclipse.ui.internal.WorkbenchWindow$2.run(WorkbenchWindow.java:697)\n\tat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:69)\n\tat org.eclipse.ui.internal.WorkbenchWindow.close(WorkbenchWindow.java:695)\n\tat org.eclipse.jface.window.Window.handleShellCloseEvent(Window.java:729)\n\tat org.eclipse.jface.window.Window$3.shellClosed(Window.java:676)\n\tat org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:159)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:925)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:949)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:934)\n\tat org.eclipse.swt.widgets.Decorations.closeWidget(Decorations.java:257)\n\tat org.eclipse.swt.widgets.Decorations.WM_CLOSE(Decorations.java:1605)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3238)\n\tat org.eclipse.swt.widgets.Decorations.windowProc(Decorations.java:1538)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:3965)\n\tat org.eclipse.swt.internal.win32.OS.DefWindowProcW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.DefWindowProc(OS.java:1794)\n\tat org.eclipse.swt.widgets.Shell.callWindowProc(Shell.java:433)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3324)\n\tat org.eclipse.swt.widgets.Decorations.windowProc(Decorations.java:1538)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:3965)\n\tat org.eclipse.swt.internal.win32.OS.DefWindowProcW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.DefWindowProc(OS.java:1794)\n\tat org.eclipse.swt.widgets.Shell.callWindowProc(Shell.java:433)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3324)\n\tat org.eclipse.swt.widgets.Decorations.windowProc(Decorations.java:1538)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:3965)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:1799)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2905)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1899)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1863)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:417)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:143)\n\tat com.birosoft.exedra.core.Application.run(Application.java:18)\n\tat org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:99)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:92)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:68)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:374)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:169)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:615)\n\tat org.eclipse.core.launcher.Main.invokeFramework(Main.java:338)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:282)\n\tat org.eclipse.core.launcher.Main.run(Main.java:977)\n\tat org.eclipse.core.launcher.Main.main(Main.java:952)\n\nSource of my ApplicationWorkbanchWindowAdvisor class could be found on http://pastebin.com/580978",
    "The important part is in \nApplicationWorkbenchWindowAdvisor extends WorkbenchWindowAdvisor {\n\tpublic void createWindowContents(Shell shell) {\n\t\tIWorkbenchWindowConfigurer configurer \u003d getWindowConfigurer();\n\t\tMenu menu \u003d configurer.createMenuBar();\n\t\tshell.setMenuBar(menu);\n\t\tFormLayout layout \u003d new FormLayout();\n\t\tlayout.marginWidth \u003d 0;\n\t\tlayout.marginHeight \u003d 0;\n\t\tshell.setLayout(layout);\n// ...\n\t}\n}\n\nPW\n",
    "The variable defaultLayout (of type TrimLayout) may be null if the WorkbenchWindowAdvisor defines custom window contents and layout. Some, but not all places where defaultLayout is used guard against this case.\n\nThis affects all RCP apps that define a custom layout.\n\nEric, back to you? ;-)",
    "(In reply to comment #2)\n\u003e The variable defaultLayout (of type TrimLayout) may be null if the\n\u003e WorkbenchWindowAdvisor defines custom window contents and layout. Some, but not\n\u003e all places where defaultLayout is used guard against this case.\n\u003e \n\u003e This affects all RCP apps that define a custom layout.\n\u003e \n\u003e Eric, back to you? ;-)\n\u003e \n\nActually, for this case bug is in saveState method which should not call a saveTrim method if defaultLayout is null or saveTrim will return if defaultLayout is null. I omit call for this method for myself using org.eclipse.ui.workbench source when defaultLayout is null. And now my RCP application saves its state without problems. Of course we expect that this will corrected in M6.",
    "(In reply to comment #2)\n\u003e The variable defaultLayout (of type TrimLayout) may be null if the\n\u003e WorkbenchWindowAdvisor defines custom window contents and layout. Some, but not\n\u003e all places where defaultLayout is used guard against this case.\n\u003e \n\u003e This affects all RCP apps that define a custom layout.\n\u003e \n\u003e Eric, back to you? ;-)\n\u003e \n\nActually, for this case bug is in saveState method which should not call a saveTrim method if defaultLayout is null or saveTrim will return if defaultLayout is null. I omit call for this method for myself using org.eclipse.ui.workbench source when defaultLayout is null. And now my RCP application saves its state without problems. Of course we expect that this will be corrected in M6.",
    "We should be protecting ourself from defaultLayout \u003d\u003d null in the save and restore Trim methods.\n\nPW\n",
    "\n\n*** This bug has been marked as a duplicate of 129343 ***"
  ],
  "commentCreationDates": [
    "2006-03-02T22:43:49+01:00",
    "2006-03-02T23:13:56+01:00",
    "2006-03-06T16:40:47+01:00",
    "2006-03-06T17:10:53+01:00",
    "2006-03-06T17:14:48+01:00",
    "2006-03-06T17:27:16+01:00",
    "2006-04-05T15:29:20+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.ui.internal.WorkbenchWindow.saveTrimState",
          "source": "WorkbenchWindow.java:2421"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchWindow.saveState",
          "source": "WorkbenchWindow.java:2407"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.saveState",
          "source": "Workbench.java:1934"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.recordWorkbenchState",
          "source": "Workbench.java:1614"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.access$5",
          "source": "Workbench.java:1611"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$11.run",
          "source": "Workbench.java:673"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:816"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.busyClose",
          "source": "Workbench.java:671"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.access$8",
          "source": "Workbench.java:630"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$14.run",
          "source": "Workbench.java:827"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:69"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.close",
          "source": "Workbench.java:825"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.close",
          "source": "Workbench.java:800"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchWindow.busyClose",
          "source": "WorkbenchWindow.java:612"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchWindow.access$0",
          "source": "WorkbenchWindow.java:591"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchWindow$2.run",
          "source": "WorkbenchWindow.java:697"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:69"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchWindow.close",
          "source": "WorkbenchWindow.java:695"
        },
        {
          "method": "org.eclipse.jface.window.Window.handleShellCloseEvent",
          "source": "Window.java:729"
        },
        {
          "method": "org.eclipse.jface.window.Window$3.shellClosed",
          "source": "Window.java:676"
        },
        {
          "method": "org.eclipse.swt.widgets.TypedListener.handleEvent",
          "source": "TypedListener.java:159"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:925"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:949"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:934"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.closeWidget",
          "source": "Decorations.java:257"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.WM_CLOSE",
          "source": "Decorations.java:1605"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3238"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.windowProc",
          "source": "Decorations.java:1538"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3965"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DefWindowProcW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DefWindowProc",
          "source": "OS.java:1794"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.callWindowProc",
          "source": "Shell.java:433"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3324"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.windowProc",
          "source": "Decorations.java:1538"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3965"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DefWindowProcW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DefWindowProc",
          "source": "OS.java:1794"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.callWindowProc",
          "source": "Shell.java:433"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3324"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.windowProc",
          "source": "Decorations.java:1538"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3965"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessage",
          "source": "OS.java:1799"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2905"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1899"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1863"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:417"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:143"
        },
        {
          "method": "com.birosoft.exedra.core.Application.run",
          "source": "Application.java:18"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:99"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:92"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:68"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:374"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:169"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:64"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:43"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:615"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:338"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:282"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:977"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:952"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "130237",
      "duplicateId": "129343",
      "date": "2006-03-02T22:43:49+01:00",
      "product": "Platform",
      "component": "UI",
      "severity": "major"
    }
  ],
  "groupId": "129343",
  "bugId": "130237",
  "duplicateId": "129343",
  "date": "2006-03-02T22:43:49+01:00",
  "product": "Platform",
  "component": "UI",
  "severity": "major"
}