{
  "comments": [
    "IAC does not correctly reference the com.ibm.icu.jar.\n\nWhen running applications (e.g. Manual Test View\u0027s attachment functionality) in the Integrated Agent Controller using the TPTP-4.3.1-200702051346 build, classes in the com.ibm.icu.jar cannot be found.  For example, when attaching a file to a manual test case using the Manual Test View running in the Integrated Agent Controller, the following exception is thrown:\n\njava.lang.NoClassDefFoundError: com.ibm.icu.text.NumberFormat\n\tat org.eclipse.tptp.test.manual.runner.ui.internal.util.SWTUtilities.addAttachmentTableItem(SWTUtilities.java:103)\n\tat org.eclipse.tptp.test.manual.runner.ui.internal.widgets.AttachmentsTableGroup$3.handleEvent(AttachmentsTableGroup.java:205)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:928)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3348)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2968)\n\tat org.eclipse.tptp.test.manual.runner.ui.internal.ManualTestView.open(ManualTestView.java:138)\n\tat org.eclipse.tptp.test.manual.runner.core.internal.ManualTestRunner.main(ManualTestRunner.java:199)\n\nRun the same scenario using the Agent Controller works as expected.",
    "Please evaluate need to address in 4.3.1",
    "I believe you meant 4.3.1 target since the 4.3 release is closed.",
    "(In reply to comment #2)\n\u003e I believe you meant 4.3.1 target since the 4.3 release is closed.\n\nSamson, can you update the target to an open release?\n",
    "The problem is caused by an improper ICU manifest file. The ICU jar shipped in Eclipse 3.2.1 does not contain the \"Bundle-ClassPath\" keyword in the manifest file when therefore the IAC will use the jar \"com.ibm.icu_3.4.5.jar\" itself.\n\nIn the current Eclipse 3.2.2 driver, the ICU manifest contains the \"Bundle-ClassPath\" keyword which supposed to list all the jar for this bundle. Unfortunately it is pointing to an invalid jar \"icu-data.jar\" and this fools the IAC to look for that jar. Therefore the classpath for ICU is not set correctly.\n\n",
    "*** Bug 174211 has been marked as a duplicate of this bug. ***",
    "*** Bug 174170 has been marked as a duplicate of this bug. ***",
    "Hi,\n\nI assume this problem is the same for TPTP 4.4, since the behavior for the URL Recorder failing, bugzilla 174211, which is now marked as a duplicate of this defect, is the same.  So, whatever the fix is will need to be applied to 4.4.  I think our convention now is to create a separate bugzilla for each affected target branch. \n\nThanks. ",
    "Created an attachment (id\u003d59069)\n4.3.1 patch file\n\n",
    "Created an attachment (id\u003d59070)\n4.3.1 hexl.jar file\n\nThis should workaround the problem.",
    "Hi Joe/Paul/DuWayne, please try the jar and review the patch. Thanks.",
    "(In reply to comment #10)\n\u003e Hi Joe/Paul/DuWayne, please try the jar and review the patch. Thanks.\n\nVerified as resolves the Manual Test issues:\n\nTPTP-4.3.1-200702051346\nTPTP-4.4.0-200702050100",
    "(In reply to comment #4)\n\nTwo issues:\n\n1) Has this issues been raised with the Eclipse/ICU Team?\n\n2) Will this patch continue to work once the manifest is corrected (e.g. testing with Eclipse 3.2.1)?\n",
    "Sorry, mistakenly assigned to component owner.",
    "Reply to comment #10.\n\nI have reviewed the patch and tested.  The URL recording problems with the IAC are resolved by the patched jar file in both 4.3.1 and 4.4 latest test builds.\n\nIt looks like you have tried to cover the variations that you expect.  So, I concur with delivering the change.  However, I concur with the two issues that Paul raised in his note above (comment #12) and believe those questions  should be answered.",
    "I reviewed the patch, and I have a concern.  \n\nWe can\u0027t construct a path to a plugin\u0027s jar file by appending \"/plugins\" to the eclipse home directory, because plugins don\u0027t necessarily live in the eclipse/plugin directory.  They may live in one of many different directories as specified by the eclipse configuration.  \n\nAs a practical example, the icu jar file would not be found by this code in any of IBM\u0027s consuming products (which all have empty plugin directories in their eclipse home directories, and are configured to pick up their plugins from a shared plugin directory in a different location.)\n\nI could suggest a couple of ways of recoding this, but neither of them seems optimal:\n\n1) You could use the parse the location returned by Bundle.getLocation() (instead of assuming that the bundle is installed in the eclipse home /plugins location.)  In the case of an IBM consuming product, you\u0027d see something like \"update@../SDP70Shared/plugins/com.ibm.icu_3.4.5.jar\", and that path is the location of the plugin relative to eclipse_home.  I don\u0027t know how that works if you have a configuration directory that is not relative to eclipse home (on a different drive, for example.)  I\u0027m also not sure if this is considered API (not the metod itself, but the fact that you can parse it to find the bundle\u0027s install location.)\n\n2) You could rework your classlaoding mechanism to delegate to the bundle\u0027s classloader directly (using Bundle.loadClass()).  This seems like the safer approach, but presumably requires more work.\n\nIt\u0027s worth noting that even if ICU fixes their problem of non-existing jars in their manifest, this would still be an issue for any plugin that packages some jars inside a plugin jar, but also includes its own class files directly within that same jar (thereby requiring a \".\" entry in the bundle-classpath.)",
    "I will try to answer all the questions here:\n\n1) Has this issues been raised with the Eclipse/ICU Team?\nNo.\n\n2) Will this patch continue to work once the manifest is corrected (e.g.\ntesting with Eclipse 3.2.1)?\nYes it will continue to work. Since the ICU manifest has two entries, which the first one \"icu-data.jar\" does not exist, the second entry \".\" refers to the jar itself so we use that \".\" to find the correct jar.\n\n3) Regarding Bundle.getLocation(), I remember this method was used before when IAC was still using internal Eclipse classes. Somehow I needed to remove it due to some reasons which I cannot recall right now. I agree that we should re-investigate this in 4.4 when we do the IAC-\u003eAC swap but having this changed in 4.3.1 is pretty destablizing. I wish you all agree.\n\n4) Regarding Bundle.loadClass(), I cannot use this because the IAC is going to construct and pass the CLASSPATH in a string form to Runtime.exec(). I can only do that loadClass() if the classes are going to be used in-process.\n",
    "(In reply to comment #16)\n\u003e I will try to answer all the questions here:\n\u003e 3) Regarding Bundle.getLocation(), I remember this method was used before when\n\u003e IAC was still using internal Eclipse classes. Somehow I needed to remove it due\n\u003e to some reasons which I cannot recall right now. I agree that we should\n\u003e re-investigate this in 4.4 when we do the IAC-\u003eAC swap but having this changed\n\u003e in 4.3.1 is pretty destablizing. I wish you all agree.\n\nI agree that we want to keep 4.3.1 stable, but I don\u0027t think we can ship this fix as-is, because it doesn\u0027t fix the problem in some very normal situations.  It won\u0027t work for any of IBM\u0027s consuming products this way, and the same may likely be the case for other consumers.\n\nI am still trying to find a better way to get the path to the jar file, but if we had to choose now, I think we would prefer parsing Bundle.getLocation to taking \"/plugins\" onto the eclipse home directory.  The former may break in a subsequent release, but the latter is sure to fail on the current release for some subset of consumers.",
    "Hi,\n\nI apologize for my earlier oversight in agreement with this fix, Joe is correct in the concerns he expressed that some consumming products will be broken.  I wish there was an easy answer to the problem at hand.\n\nDuWayne",
    "Now I recall why getLocation() is not being used for resolving the plugin location. I have debugged the IAC code and found out that when it tries to resolve the bundle location of the \"org.eclipse.osgi\" bundle the string returned is \"System Bundle\". The only way I know to resolve that osgi jar is to use cast the \"Bundle\" object to an Eclipse internal class \"SystemBundle\". Since I am not allowed to use internal Eclipse API I will need an alternative way to resolve the location.\n\nSo far only the osgi jar is having this \"System Bundle\" return string so I will only make the assumption that the location of the osgi jar is under Eclipse\u0027s \"plugins\" directory. If anyone knows how to resolve the osgi jar please let me know. Now we can assume that non-\"System Bundle\"s can be switched to use the \"getLocation()\" method to resolve the jars.\n\nI will attach another patch shortly.",
    "Created an attachment (id\u003d59223)\nPatch file for 4.3.1\n\n",
    "Created an attachment (id\u003d59224)\nPatch hexl.jar for 4.3.1\n\n",
    "Created an attachment (id\u003d59225)\nPatch file for 4.4.0\n\n",
    "Created an attachment (id\u003d59226)\nPatch hexl.jar for 4.4.0\n\n",
    "Update the sizing.",
    "Created an attachment (id\u003d59230)\nPatch file for 4.3.1\n\n",
    "Created an attachment (id\u003d59231)\nPatch hexl.jar for 4.3.1\n\n",
    "Created an attachment (id\u003d59232)\nPatch file for 4.4.0\n\n",
    "Created an attachment (id\u003d59233)\nPatch hexl.jar for 4.4.0\n\n",
    "Refreshed the patches and the jars.",
    "Hi Samson,\n\nOne additional case to check for in this code is when the portion after the update@ contains an absolute path to the plugin.  This will be the case if the eclipse configuration has locations on a different drive letter, for instance.\n\nThanks for plugging away at this.  I have sent a note off to a couple of OSGI experts to see if they have a suggestion for how to properly find the install location of a jarred plugin.  I\u0027ll let you know what I hear.",
    "Created an attachment (id\u003d59260)\nPatch file for 4.3.1\n\nAdditional absolute/relative path check suggested by Joe.",
    "Created an attachment (id\u003d59261)\nPatch hexl.jar for 4.3.1\n\nAdditional absolute/relative path check suggested by Joe.",
    "Created an attachment (id\u003d59262)\nPatch file for 4.4.0\n\nAdditional absolute/relative path check suggested by Joe.",
    "Created an attachment (id\u003d59263)\nPatch hexl.jar for 4.4.0\n\nAdditional absolute/relative path check suggested by Joe.",
    "Closing TPTP 4.3.1 and retargeting this to 4.4.",
    "Created an attachment (id\u003d59399)\nPatch file for 4.3.1\n\n",
    "Created an attachment (id\u003d59400)\nPatch hexl.jar for 4.3.1\n\n",
    "Hi all. Please review the latest 4.3.1 patch attached in this bugzilla. I have integrated the code given by the OSGI team to correctly locating the bundle jar(s). Thanks.",
    "I have reviewed the latest patch file and it looks good to me.",
    "I have tested the latest patch under the following scenarios:\n- Eclipse 3.2.0 + TPTP-4.3.1-200702191217 + patch\n- Eclipse 3.2.1 + TPTP-4.3.1-200702191217 + patch\n- Eclipse 3.2.2 + TPTP-4.3.1-200702191217 + patch\n\nAll looks good.\n\nThe following test cases have been run under each of the scenario above:\n- Manual Test with attachment\n- URL Recorder\n- URL Test\n- JUnit Test\n- Profiling (launch)\n- Profiling (attach)\n",
    "Fix checked in 2007/02/21.",
    "(In reply to comment #41)\n\u003e Fix checked in 2007/02/21.\n\n\nBoth 4.3.1 and 4.4.\n",
    "Note, this defect was not reproduced in TPTP 4.2.2 (TPTP-4.2.2-200701291553A) running on Eclipse 3.2.2.",
    "Verified (Manual Test execution) in TPTP-4.4.0-200702211545.",
    "Verified (HTTP Recording and URL Test execution) in TPTP-4.4.0-200702211545.\n",
    "Verified in TPTP-4.3.1-200702221346.",
    "Closing."
  ],
  "commentCreationDates": [
    "2007-02-06T18:25:15+01:00",
    "2007-02-09T03:17:45+01:00",
    "2007-02-09T14:55:51+01:00",
    "2007-02-09T14:56:25+01:00",
    "2007-02-15T16:19:36+01:00",
    "2007-02-15T16:22:06+01:00",
    "2007-02-15T16:22:20+01:00",
    "2007-02-15T16:43:10+01:00",
    "2007-02-15T16:50:51+01:00",
    "2007-02-15T16:51:23+01:00",
    "2007-02-15T17:27:27+01:00",
    "2007-02-16T18:20:51+01:00",
    "2007-02-16T18:23:30+01:00",
    "2007-02-16T18:24:21+01:00",
    "2007-02-16T20:27:10+01:00",
    "2007-02-16T20:31:57+01:00",
    "2007-02-16T20:46:35+01:00",
    "2007-02-16T21:13:48+01:00",
    "2007-02-16T21:44:26+01:00",
    "2007-02-17T08:52:38+01:00",
    "2007-02-17T08:53:43+01:00",
    "2007-02-17T08:54:23+01:00",
    "2007-02-17T08:54:44+01:00",
    "2007-02-17T08:55:21+01:00",
    "2007-02-17T08:59:58+01:00",
    "2007-02-17T17:36:59+01:00",
    "2007-02-17T17:37:30+01:00",
    "2007-02-17T17:37:51+01:00",
    "2007-02-17T17:38:27+01:00",
    "2007-02-17T17:39:25+01:00",
    "2007-02-19T13:08:57+01:00",
    "2007-02-19T14:49:39+01:00",
    "2007-02-19T14:50:02+01:00",
    "2007-02-19T14:50:20+01:00",
    "2007-02-19T14:50:40+01:00",
    "2007-02-20T17:34:37+01:00",
    "2007-02-20T18:15:13+01:00",
    "2007-02-20T18:15:42+01:00",
    "2007-02-20T18:16:42+01:00",
    "2007-02-20T19:23:00+01:00",
    "2007-02-20T20:19:15+01:00",
    "2007-02-22T15:27:41+01:00",
    "2007-02-22T16:29:12+01:00",
    "2007-02-22T16:46:19+01:00",
    "2007-02-22T19:43:03+01:00",
    "2007-02-22T20:57:40+01:00",
    "2007-02-26T17:45:39+01:00",
    "2007-02-26T17:45:54+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NoClassDefFoundError",
      "message": "com.ibm.icu.text.NumberForm",
      "elements": [
        {
          "method": "atorg.eclipse.tptp.test.manual.runner.ui.internal.util.SWTUtilities.addAttachmentTableItem",
          "source": "SWTUtilities.java:103"
        },
        {
          "method": "org.eclipse.tptp.test.manual.runner.ui.internal.widgets.AttachmentsTableGroup$3.handleEvent",
          "source": "AttachmentsTableGroup.java:205"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:928"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:3348"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2968"
        },
        {
          "method": "org.eclipse.tptp.test.manual.runner.ui.internal.ManualTestView.open",
          "source": "ManualTestView.java:138"
        },
        {
          "method": "org.eclipse.tptp.test.manual.runner.core.internal.ManualTestRunner.main",
          "source": "ManualTestRunner.java:199"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "173136",
      "date": "2007-02-06T18:25:15+01:00",
      "product": "TPTP Profiling",
      "component": "Platform.Execution",
      "severity": "blocker"
    }
  ],
  "groupId": "173136",
  "bugId": "173136",
  "date": "2007-02-06T18:25:15+01:00",
  "product": "TPTP Profiling",
  "component": "Platform.Execution",
  "severity": "blocker"
}