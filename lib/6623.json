{
  "comments": [
    "Plugin-startup can be called in the UI-thread, but \nAbstractUIPlugin.refreshPluginActions then fails.\n\norg.eclipse.swt.SWTException: Invalid thread access\n\tat org.eclipse.swt.SWT.error(SWT.java:1887)\n\tat org.eclipse.swt.SWT.error(SWT.java:1819)\n\tat org.eclipse.swt.widgets.Widget.error(Widget.java:366)\n\tat org.eclipse.swt.widgets.Widget.checkWidget(Widget.java(Compiled \nCode))\n\tat org.eclipse.swt.widgets.Tree.getSelection(Tree.java(Compiled Code))\n\tat org.eclipse.jface.viewers.TreeViewer.getSelection\n(TreeViewer.java:158)\n\tat org.eclipse.jface.viewers.AbstractTreeViewer.getSelectionFromWidget\n(AbstractTreeViewer.java:586)\n\tat org.eclipse.jface.viewers.StructuredViewer.getSelection\n(StructuredViewer.java:365)\n\tat org.eclipse.ui.internal.SelectionService.getSelection\n(SelectionService.java:64)\n\tat org.eclipse.ui.internal.WWinPluginAction.refreshSelection\n(WWinPluginAction.java:128)\n\tat org.eclipse.ui.internal.WWinPluginAction.refreshActionList\n(WWinPluginAction.java:52)\n\tat org.eclipse.ui.internal.Workbench.refreshPluginActions\n(Workbench.java:978)\n\tat org.eclipse.ui.plugin.AbstractUIPlugin.refreshPluginActions\n(AbstractUIPlugin.java:382)\n\tat org.eclipse.ui.plugin.AbstractUIPlugin.startup\n(AbstractUIPlugin.java:421)\n\tat org.eclipse.pde.selfhosting.internal.SelfHostingPlugin.startup\n(SelfHostingPlugin.java:176)\n\tat org.eclipse.core.internal.plugins.PluginDescriptor$1.run\n(PluginDescriptor.java:643)\n\tat org.eclipse.core.internal.runtime.InternalPlatform.run\n(InternalPlatform.java:818)\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor.internalDoPluginActivation\n(PluginDescriptor.java:655)\n\tat org.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation\n(PluginDescriptor.java:135)\n\tat org.eclipse.core.internal.plugins.PluginClassLoader.activatePlugin\n(PluginClassLoader.java:52)\n\tat \norg.eclipse.core.internal.plugins.PluginClassLoader.findClassParentsSelf\n(PluginClassLoader.java(Compiled Code))\n\tat org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass\n(DelegatingURLClassLoader.java(Compiled Code))\n\tat org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass\n(DelegatingURLClassLoader.java(Compiled Code))\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java(Compiled Code))\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor.createExecutableExtension\n(PluginDescriptor.java:79)\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor.createExecutableExtension\n(PluginDescriptor.java:116)\n\tat \norg.eclipse.core.internal.plugins.ConfigurationElement.createExecutableExtension\n(ConfigurationElement.java:96)\n\tat org.eclipse.debug.internal.core.Launcher.getDelegate\n(Launcher.java:92)\n\tat org.eclipse.debug.internal.ui.LaunchHistoryElement.getLaunchElement\n(LaunchHistoryElement.java:111)\n\tat org.eclipse.debug.internal.ui.DebugUIPlugin.removeDeletedHistories\n(DebugUIPlugin.java:1352)\n\tat org.eclipse.debug.internal.ui.DebugUIPlugin.removeDeletedHistories\n(DebugUIPlugin.java:1340)\n\tat \norg.eclipse.debug.internal.ui.DebugUIPlugin$ResourceDeletedVisitor.visit\n(DebugUIPlugin.java:202)\n\tat org.eclipse.core.internal.events.ResourceDelta.accept\n(ResourceDelta.java(Compiled Code))\n\tat org.eclipse.core.internal.events.ResourceDelta.accept\n(ResourceDelta.java(Compiled Code))\n\tat org.eclipse.core.internal.events.ResourceDelta.accept\n(ResourceDelta.java(Compiled Code))\n\tat org.eclipse.core.internal.events.ResourceDelta.accept\n(ResourceDelta.java(Compiled Code))\n\tat org.eclipse.core.internal.events.ResourceDelta.accept\n(ResourceDelta.java(Compiled Code))\n\tat org.eclipse.core.internal.events.ResourceDelta.accept\n(ResourceDelta.java(Compiled Code))\n\tat org.eclipse.core.internal.events.ResourceDelta.accept\n(ResourceDelta.java(Compiled Code))\n\tat org.eclipse.core.internal.events.ResourceDelta.accept\n(ResourceDelta.java(Compiled Code))\n\tat org.eclipse.core.internal.events.ResourceDelta.accept\n(ResourceDelta.java(Compiled Code))\n\tat org.eclipse.core.internal.events.ResourceDelta.accept\n(ResourceDelta.java(Compiled Code))\n\tat org.eclipse.debug.internal.ui.DebugUIPlugin.resourceChanged\n(DebugUIPlugin.java:1178)\n\tat org.eclipse.core.internal.events.NotificationManager$1.run\n(NotificationManager.java:125)\n\tat org.eclipse.core.internal.runtime.InternalPlatform.run\n(InternalPlatform.java:818)\n\tat org.eclipse.core.runtime.Platform.run(Platform.java:395)\n\tat org.eclipse.core.internal.events.NotificationManager.notify\n(NotificationManager.java:140)\n\tat org.eclipse.core.internal.events.NotificationManager.broadcastChanges\n(NotificationManager.java:43)\n\tat org.eclipse.core.internal.events.NotificationManager.broadcastChanges\n(NotificationManager.java:64)\n\tat org.eclipse.core.internal.resources.Workspace.broadcastChanges\n(Workspace.java:110)\n\tat org.eclipse.core.internal.resources.Workspace.endOperation\n(Workspace.java(Compiled Code))\n\tat org.eclipse.core.internal.resources.Workspace.build\n(Workspace.java:122)\n\tat org.eclipse.debug.internal.ui.DebugUIPlugin$9.run\n(DebugUIPlugin.java:1677)\n\tat org.eclipse.jface.operation.ModalContext$ModalContextThread.run\n(ModalContext.java:98)",
    "its 111204",
    "Can you provide steps that recreate this problem? ",
    "No, not for this case.\nA different scenario where plugin classloading is preformed in a non-UI thread \nis described in 1GO0FF9: IVECDT:ALL - C plugin deactivates when C project \nloaded before C perspective open\n\n1GO0FF9: -----\nSteps to recreate:\n1) Close any open C perspectives\n2) Shut down the workspace\n3) Delete any files from the C perspective metadata (I don\u0027t know if this step \nis really needed)\n4) Open WSDD\n5) connect to the repository:\n\tottcvs1.ott.oti.com/home/cvs/plugins\n6) Load the project: wince.rapi\n7) You will get the following walkback\n\nLog: Fri Nov 30 11:19:54 EST 2001\n2 org.eclipse.core.runtime 2 Problems occurred when invoking code from plug-in: \norg.eclipse.core.runtime.\norg.eclipse.jface.util.Assert$AssertionFailedException: null argument;\n\nStack trace:\n   java/lang/Throwable.\u003cinit\u003e()V\n   java/lang/Throwable.\u003cinit\u003e(Ljava/lang/String;)V\n   org/eclipse/jface/util/Assert$AssertionFailedException.\u003cinit\u003e\n(Ljava/lang/String;)V\n   org/eclipse/jface/util/Assert.isNotNull(Ljava/lang/Object;Ljava/lang/String;)\nV\n   org/eclipse/jface/util/Assert.isNotNull(Ljava/lang/Object;)V\n   org/eclipse/jface/resource/ImageRegistry.\u003cinit\u003e()V\n   org/eclipse/ui/plugin/AbstractUIPlugin.createImageRegistry()\nLorg/eclipse/jface/resource/ImageRegistry;\n   org/eclipse/ui/plugin/AbstractUIPlugin.getImageRegistry()\nLorg/eclipse/jface/resource/ImageRegistry;\n   com/ibm/ive/cdt/internal/ui/CPlugin.startup()V",
    "A similiar problem came up in the 1.0 development cycle. Check with Erich he \nmay remember this problem as well.\n\nI believe the cause was tracked down to a plugin attempting to \nintialize/allocate SWT resources before the UI plugin code that \nallocates the display and runs the event loop executes. It is a requirement\nthat the workbench starup code runs in the UI thread - otherwise every ISV \nwould need to sync/async exec their manipulation of widgets. \n\n",
    "The problem in 1.0 was that we tried to initialize our image registry in startup\n(). As startup can be called in any thread (not necessary the UI thread), \nDisplay.getCurrent (implicitly called in ImageRegistry) was null.\n\nWe fixed the problem by delay the initialization of the image registry to the \ntime of the first caller of getImage.\n\nThe bug described in this PR comes from the change in 11204:\nthe line\n  refreshPluginActions();\nadded to AbstractUIPlugin.startup() assumes that it is called in the UI thread.\n\nThere is a discussion in Eclipse Corner about threading and startup:\n\u0027Plugin.startup() called on non UI thread ?\u0027\n",
    "We should consider moving refreshPluginActions() elsewhere, or doing it in an \nasyncExec.\n\nIn the meantime, Debug can work around the problem by creating the launcher in \nthe UI thread (the launcher is a UI component after all).\n\nNote that it\u0027s not reasonable to expect that all clients do things this way, \nsince a non-UI client may be instantiating a class in a plugin which just \nhappens to subclass AbstractUIPlugin.",
    "Changed AbstractUIPlugin.refreshPluginActions() to do its work in an asyncExec.\nAdded warning to AbstractUIPlugin.startup() indicating that it does not \nnecessarily run in the UI thread.\n\nDebug team: in the stack trace, it seems strange that it needs to activate a \nplugin in order to removeDeletedHistories.",
    "*** Bug 8523 has been marked as a duplicate of this bug. ***"
  ],
  "commentCreationDates": [
    "2001-12-06T10:34:27+01:00",
    "2001-12-06T10:38:11+01:00",
    "2001-12-19T01:08:08+01:00",
    "2001-12-19T09:29:09+01:00",
    "2001-12-19T21:12:09+01:00",
    "2001-12-20T08:42:45+01:00",
    "2001-12-20T18:26:21+01:00",
    "2001-12-21T17:34:19+01:00",
    "2002-01-29T16:58:40+01:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.swt.SWTException",
      "message": "Invalid thread access",
      "elements": [
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:1887"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:1819"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.error",
          "source": "Widget.java:366"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.checkWidget",
          "source": "Widget.java(Compiled  Code)"
        },
        {
          "method": "org.eclipse.swt.widgets.Tree.getSelection",
          "source": "Tree.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.jface.viewers.TreeViewer.getSelection",
          "source": "TreeViewer.java:158"
        },
        {
          "method": "org.eclipse.jface.viewers.AbstractTreeViewer.getSelectionFromWidget",
          "source": "AbstractTreeViewer.java:586"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.getSelection",
          "source": "StructuredViewer.java:365"
        },
        {
          "method": "org.eclipse.ui.internal.SelectionService.getSelection",
          "source": "SelectionService.java:64"
        },
        {
          "method": "org.eclipse.ui.internal.WWinPluginAction.refreshSelection",
          "source": "WWinPluginAction.java:128"
        },
        {
          "method": "org.eclipse.ui.internal.WWinPluginAction.refreshActionList",
          "source": "WWinPluginAction.java:52"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.refreshPluginActions",
          "source": "Workbench.java:978"
        },
        {
          "method": "org.eclipse.ui.plugin.AbstractUIPlugin.refreshPluginActions",
          "source": "AbstractUIPlugin.java:382"
        },
        {
          "method": "org.eclipse.ui.plugin.AbstractUIPlugin.startup",
          "source": "AbstractUIPlugin.java:421"
        },
        {
          "method": "org.eclipse.pde.selfhosting.internal.SelfHostingPlugin.startup",
          "source": "SelfHostingPlugin.java:176"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor$1.run",
          "source": "PluginDescriptor.java:643"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:818"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.internalDoPluginActivation",
          "source": "PluginDescriptor.java:655"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation",
          "source": "PluginDescriptor.java:135"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginClassLoader.activatePlugin",
          "source": "PluginClassLoader.java:52"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginClassLoader.findClassParentsSelf",
          "source": "PluginClassLoader.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLClassLoader.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLClassLoader.java(Compiled Code)"
        },
        {
          "method": "java.lang.ClassLoader.loadClass",
          "source": "ClassLoader.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.createExecutableExtension",
          "source": "PluginDescriptor.java:79"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.createExecutableExtension",
          "source": "PluginDescriptor.java:116"
        },
        {
          "method": "org.eclipse.core.internal.plugins.ConfigurationElement.createExecutableExtension",
          "source": "ConfigurationElement.java:96"
        },
        {
          "method": "org.eclipse.debug.internal.core.Launcher.getDelegate",
          "source": "Launcher.java:92"
        },
        {
          "method": "org.eclipse.debug.internal.ui.LaunchHistoryElement.getLaunchElement",
          "source": "LaunchHistoryElement.java:111"
        },
        {
          "method": "org.eclipse.debug.internal.ui.DebugUIPlugin.removeDeletedHistories",
          "source": "DebugUIPlugin.java:1352"
        },
        {
          "method": "org.eclipse.debug.internal.ui.DebugUIPlugin.removeDeletedHistories",
          "source": "DebugUIPlugin.java:1340"
        },
        {
          "method": "org.eclipse.debug.internal.ui.DebugUIPlugin$ResourceDeletedVisitor.visit",
          "source": "DebugUIPlugin.java:202"
        },
        {
          "method": "org.eclipse.core.internal.events.ResourceDelta.accept",
          "source": "ResourceDelta.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.events.ResourceDelta.accept",
          "source": "ResourceDelta.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.events.ResourceDelta.accept",
          "source": "ResourceDelta.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.events.ResourceDelta.accept",
          "source": "ResourceDelta.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.events.ResourceDelta.accept",
          "source": "ResourceDelta.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.events.ResourceDelta.accept",
          "source": "ResourceDelta.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.events.ResourceDelta.accept",
          "source": "ResourceDelta.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.events.ResourceDelta.accept",
          "source": "ResourceDelta.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.events.ResourceDelta.accept",
          "source": "ResourceDelta.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.events.ResourceDelta.accept",
          "source": "ResourceDelta.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.debug.internal.ui.DebugUIPlugin.resourceChanged",
          "source": "DebugUIPlugin.java:1178"
        },
        {
          "method": "org.eclipse.core.internal.events.NotificationManager$1.run",
          "source": "NotificationManager.java:125"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:818"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:395"
        },
        {
          "method": "org.eclipse.core.internal.events.NotificationManager.notify",
          "source": "NotificationManager.java:140"
        },
        {
          "method": "org.eclipse.core.internal.events.NotificationManager.broadcastChanges",
          "source": "NotificationManager.java:43"
        },
        {
          "method": "org.eclipse.core.internal.events.NotificationManager.broadcastChanges",
          "source": "NotificationManager.java:64"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.broadcastChanges",
          "source": "Workspace.java:110"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.endOperation",
          "source": "Workspace.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.build",
          "source": "Workspace.java:122"
        },
        {
          "method": "org.eclipse.debug.internal.ui.DebugUIPlugin$9.run",
          "source": "DebugUIPlugin.java:1677"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext$ModalContextThread.run",
          "source": "ModalContext.java:98"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "6623",
      "date": "2001-12-06T10:34:27+01:00",
      "product": "Platform",
      "component": "UI",
      "severity": "normal"
    }
  ],
  "groupId": "6623",
  "bugId": "6623",
  "date": "2001-12-06T10:34:27+01:00",
  "product": "Platform",
  "component": "UI",
  "severity": "normal"
}