{
  "comments": [
    "Build ID: Build id: I20070621-1340\n\nSteps To Reproduce:\n1.I have a three service\n   test.ds.Service1\n   test.ds.Service2\n   test.ds.Service3\n2.1st run as OSGi Framework it was right.\n3.2nd run as OSGi Framework it throw an exception.\n\n\n\nMore information:\n\nService-Component: OSGI-INF/component.xml\n\nthe OSGI-INF/component.xml:\n\n\n\u003c?xml version\u003d\"1.0\" encoding\u003d\"UTF-8\"?\u003e\n\u003cscr:root xmlns:scr\u003d\"http://www.osgi.org/xmlns/scr/v1.0.0\"\u003e\n\n\t\u003ccomponent name\u003d\"Service1\" immediate\u003d\"true\"\u003e\n\t\t\u003cimplementation\n\t\t\tclass\u003d\"test.ds.Service1\" /\u003e\n\t\t\u003cproperty name\u003d\"socket.port\" value\u003d\"15808\"\n\t\t\ttype\u003d\"Integer\" /\u003e\n\t\u003c/component\u003e\n\n\t\u003ccomponent name\u003d\"Service2\" immediate\u003d\"true\"\u003e\n\t\t\u003cimplementation\n\t\t\tclass\u003d\"test.ds.Service2\" /\u003e\n\t\t\u003cproperty name\u003d\"socket.port\" value\u003d\"15809\"\n\t\t\ttype\u003d\"Integer\" /\u003e\n\t\u003c/component\u003e\n\t\u003ccomponent name\u003d\"Service3\" immediate\u003d\"true\"\u003e\n\t\t\u003cimplementation\n\t\t\tclass\u003d\"test.ds.Service3\" /\u003e\n\t\t\u003cproperty name\u003d\"socket.port\" value\u003d\"15810\"\n\t\t\ttype\u003d\"Integer\" /\u003e\n\t\u003c/component\u003e\n\n\u003c/scr:root\u003e\n\nWhen the property \"socket.port\" type is \"Integer\" , ServiceComponent.readObject(ServiceComponent.java:368) throw a java.io.EOFException. But when type is \"String\" there has no Exception.\n\nThe stack trace is:\n\n\tat java.io.DataInputStream.readFully(Unknown Source)\n\tat java.io.DataInputStream.readUTF(Unknown Source)\n\tat java.io.DataInputStream.readUTF(Unknown Source)\n\tat org.eclipse.equinox.ds.model.ServiceComponent.readObject(ServiceComponent.java:368)\n\tat org.eclipse.equinox.ds.storage.file.DBObject.readObject(DBObject.java:67)\n\tat org.eclipse.equinox.ds.storage.file.FileStorage.loadComponentsFromDB(FileStorage.java:108)\n\tat org.eclipse.equinox.ds.storage.file.FileStorage.loadComponentDefinitions(FileStorage.java:90)\n\tat org.eclipse.equinox.ds.SCRManager.startedBundle(SCRManager.java:468)\n\tat org.eclipse.equinox.ds.SCRManager.startIt(SCRManager.java:113)\n\tat org.eclipse.equinox.ds.Activator.initSCR(Activator.java:113)\n\tat org.eclipse.equinox.ds.Activator.start(Activator.java:168)\n\tat org.eclipse.osgi.framework.internal.core.BundleContextImpl$2.run(BundleContextImpl.java:999)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator(BundleContextImpl.java:993)\n\tat org.eclipse.osgi.framework.internal.core.BundleContextImpl.start(BundleContextImpl.java:974)\n\tat org.eclipse.osgi.framework.internal.core.BundleHost.startWorker(BundleHost.java:346)\n\tat org.eclipse.osgi.framework.internal.core.AbstractBundle.resume(AbstractBundle.java:350)\n\tat org.eclipse.osgi.framework.internal.core.Framework.resumeBundle(Framework.java:1118)\n\tat org.eclipse.osgi.framework.internal.core.StartLevelManager.resumeBundles(StartLevelManager.java:634)\n\tat org.eclipse.osgi.framework.internal.core.StartLevelManager.incFWSL(StartLevelManager.java:508)\n\tat org.eclipse.osgi.framework.internal.core.StartLevelManager.doSetStartLevel(StartLevelManager.java:282)\n\tat org.eclipse.osgi.framework.internal.core.StartLevelManager.dispatchEvent(StartLevelManager.java:468)\n\tat org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent(EventManager.java:195)\n\tat org.eclipse.osgi.framework.eventmgr.EventManager$EventThread.run(EventManager.java:297)\njava.io.EOFException\n\tat java.io.DataInputStream.readUnsignedShort(Unknown Source)\n\tat java.io.DataInputStream.readUTF(Unknown Source)\n\tat java.io.DataInputStream.readUTF(Unknown Source)\n\tat org.eclipse.equinox.ds.model.ServiceComponent.readObject(ServiceComponent.java:368)\n\tat org.eclipse.equinox.ds.storage.file.DBObject.readObject(DBObject.java:67)\n\tat org.eclipse.equinox.ds.storage.file.FileStorage.loadComponentsFromDB(FileStorage.java:108)\n\tat org.eclipse.equinox.ds.storage.file.FileStorage.loadComponentDefinitions(FileStorage.java:90)\n\tat org.eclipse.equinox.ds.SCRManager.startedBundle(SCRManager.java:468)\n\tat org.eclipse.equinox.ds.SCRManager.startIt(SCRManager.java:113)\n\tat org.eclipse.equinox.ds.Activator.initSCR(Activator.java:113)\n\tat org.eclipse.equinox.ds.Activator.start(Activator.java:168)\n\tat org.eclipse.osgi.framework.internal.core.BundleContextImpl$2.run(BundleContextImpl.java:999)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator(BundleContextImpl.java:993)\n\tat org.eclipse.osgi.framework.internal.core.BundleContextImpl.start(BundleContextImpl.java:974)\n\tat org.eclipse.osgi.framework.internal.core.BundleHost.startWorker(BundleHost.java:346)\n\tat org.eclipse.osgi.framework.internal.core.AbstractBundle.resume(AbstractBundle.java:350)\n\tat org.eclipse.osgi.framework.internal.core.Framework.resumeBundle(Framework.java:1118)\n\tat org.eclipse.osgi.framework.internal.core.StartLevelManager.resumeBundles(StartLevelManager.java:634)\n\tat org.eclipse.osgi.framework.internal.core.StartLevelManager.incFWSL(StartLevelManager.java:508)\n\tat org.eclipse.osgi.framework.internal.core.StartLevelManager.doSetStartLevel(StartLevelManager.java:282)\n\tat org.eclipse.osgi.framework.internal.core.StartLevelManager.dispatchEvent(StartLevelManager.java:468)\n\tat org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent(EventManager.java:195)\n\tat org.eclipse.osgi.framework.eventmgr.EventManager$EventThread.run(EventManager.java:297)\njava.lang.NullPointerException\n\tat java.util.Hashtable.put(Unknown Source)\n\tat org.eclipse.equinox.ds.model.ServiceComponentProp.initProperties(ServiceComponentProp.java:491)\n\tat org.eclipse.equinox.ds.model.ServiceComponentProp.\u003cinit\u003e(ServiceComponentProp.java:95)\n\tat org.eclipse.equinox.ds.Resolver.map(Resolver.java:233)\n\tat org.eclipse.equinox.ds.Resolver.enableComponents(Resolver.java:155)\n\tat org.eclipse.equinox.ds.SCRManager.performWork(SCRManager.java:621)\n\tat org.eclipse.equinox.ds.SCRManager$QueuedJob.dispatch(SCRManager.java:587)\n\tat org.eclipse.equinox.ds.WorkThread.run(WorkThread.java:84)\n\tat org.eclipse.equinox.util.impl.tpt.threadpool.Executor.run(Executor.java:84)\njava.lang.NullPointerException\n\tat java.util.Hashtable.put(Unknown Source)\n\tat org.eclipse.equinox.ds.model.ServiceComponentProp.initProperties(ServiceComponentProp.java:491)\n\tat org.eclipse.equinox.ds.model.ServiceComponentProp.\u003cinit\u003e(ServiceComponentProp.java:95)\n\tat org.eclipse.equinox.ds.Resolver.map(Resolver.java:233)\n\tat org.eclipse.equinox.ds.Resolver.enableComponents(Resolver.java:155)\n\tat org.eclipse.equinox.ds.SCRManager.performWork(SCRManager.java:621)\n\tat org.eclipse.equinox.ds.SCRManager$QueuedJob.dispatch(SCRManager.java:587)\n\tat org.eclipse.equinox.ds.WorkThread.run(WorkThread.java:84)\n\tat org.eclipse.equinox.util.impl.tpt.threadpool.Executor.run(Executor.java:84)",
    "Do you trigger this bug everytime, because I have trouble reproducing the issue? Can you describe more about the environment? VM, DS bundle version, etc.? ",
    "Created an attachment (id\u003d79812)\nall source code,and the SCR file , and cosole out\n\n",
    "(From update of attachment 79812)\n(In reply to comment #1)\n\u003e Do you trigger this bug everytime, because I have trouble reproducing the\n\u003e issue? Can you describe more about the environment? VM, DS bundle version,\n\u003e etc.? \n\u003e \n\nDelete all from workspace .metadata\\.plugins\\org.eclipse.pde.core\\* , run first don\u0027t trigger it. trigger it at the 2nd and not delete files.\n\n\n\nVM: sun jre1.6.0_02\nDS \u0026 util: check out from cvs\n\nPrograms arguments:-os ${target.os} -ws ${target.ws} -arch ${target.arch} -nl ${target.nl} -console\n\nVM arguments: -Declipse.ignoreApp\u003dtrue -Dosgi.noShutdown\u003dtrue -Dequinox.measurements.full\u003dtrue -Dequinox.measurements.bundles\u003dtrue -Dequinox.component.debug\u003dtrue -Dequinox.component.perf\u003dtrue -Dequinox.component.dbstore\u003dtrue -Dequinox.component.print\u003dtrue -Dxml.debug\u003dtrue\n\nid\tState       Bundle\n0\tACTIVE      org.eclipse.osgi_3.3.0.v20070530\n2\tACTIVE      org.eclipse.equinox.util_0.1.0.qualifier\n3\tACTIVE      test.ds_1.0.0\n4\tACTIVE      org.eclipse.osgi.services_3.1.200.v20070605\n5\tACTIVE      org.eclipse.equinox.ds_0.1.0.qualifier\n\nIn the attachments,has all source code,and the SCR file , and cosole out.",
    "Created an attachment (id\u003d79880)\npatch replacing properties with externalizable dictionary\n\nHere is a proposal fix the bug. Can you test with it?\n\nThe problem turns out to be caused by your default encoding charset and not very good choice of structure to be used for storage.",
    "(In reply to comment #4)\n\u003e Created an attachment (id\u003d79880) [details]\n\u003e patch replacing properties with externalizable dictionary\n\u003e \n\u003e Here is a proposal fix the bug. Can you test with it?\n\u003e \n\u003e The problem turns out to be caused by your default encoding charset and not\n\u003e very good choice of structure to be used for storage.\n\u003e \nI test it with this patch.\nIt\u0027s ok!",
    "Fixed: The patch is applied and committed",
    "(In reply to comment #6)\n\u003e Fixed: The patch is applied and committed\n\u003e \n\nIn the ServiceComponent.java file, from line 391 to 398. at the line 396 the value       \n was cast to String. So it is not support Integer , array ... but String is supported.\n\n391  ExternalizableDictionary dictionary \u003d new ExternalizableDictionary();\n392  dictionary.readObject(in);\n393  Properties props \u003d new Properties();\n394  \tfor (Enumeration keys \u003d dictionary.keys(); keys.hasMoreElements();) {\n395  \t\tString key \u003d (String) keys.nextElement();\n396  \t\tprops.put(key, dictionary.get(key).toString());\n397  \t}\n398  properties \u003d props;\n\n",
    "(In reply to comment #7)\n10x\nIt was fixed in CVS",
    "The fix is commited"
  ],
  "commentCreationDates": [
    "2007-10-01T20:47:35+02:00",
    "2007-10-05T10:56:47+02:00",
    "2007-10-05T16:54:48+02:00",
    "2007-10-05T16:55:49+02:00",
    "2007-10-08T10:59:22+02:00",
    "2007-10-08T17:51:19+02:00",
    "2007-10-19T15:02:59+02:00",
    "2007-10-20T18:17:07+02:00",
    "2007-10-24T13:31:15+02:00",
    "2007-10-24T13:36:52+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.io.EOFException",
      "elements": [
        {
          "method": "java.io.DataInputStream.readUnsignedShort",
          "source": "Unknown Source"
        },
        {
          "method": "java.io.DataInputStream.readUTF",
          "source": "Unknown Source"
        },
        {
          "method": "java.io.DataInputStream.readUTF",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.equinox.ds.model.ServiceComponent.readObject",
          "source": "ServiceComponent.java:368"
        },
        {
          "method": "org.eclipse.equinox.ds.storage.file.DBObject.readObject",
          "source": "DBObject.java:67"
        },
        {
          "method": "org.eclipse.equinox.ds.storage.file.FileStorage.loadComponentsFromDB",
          "source": "FileStorage.java:108"
        },
        {
          "method": "org.eclipse.equinox.ds.storage.file.FileStorage.loadComponentDefinitions",
          "source": "FileStorage.java:90"
        },
        {
          "method": "org.eclipse.equinox.ds.SCRManager.startedBundle",
          "source": "SCRManager.java:468"
        },
        {
          "method": "org.eclipse.equinox.ds.SCRManager.startIt",
          "source": "SCRManager.java:113"
        },
        {
          "method": "org.eclipse.equinox.ds.Activator.initSCR",
          "source": "Activator.java:113"
        },
        {
          "method": "org.eclipse.equinox.ds.Activator.start",
          "source": "Activator.java:168"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl$2.run",
          "source": "BundleContextImpl.java:999"
        },
        {
          "method": "java.security.AccessController.doPrivileged",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator",
          "source": "BundleContextImpl.java:993"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl.start",
          "source": "BundleContextImpl.java:974"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleHost.startWorker",
          "source": "BundleHost.java:346"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.AbstractBundle.resume",
          "source": "AbstractBundle.java:350"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Framework.resumeBundle",
          "source": "Framework.java:1118"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.resumeBundles",
          "source": "StartLevelManager.java:634"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.incFWSL",
          "source": "StartLevelManager.java:508"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.doSetStartLevel",
          "source": "StartLevelManager.java:282"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.dispatchEvent",
          "source": "StartLevelManager.java:468"
        },
        {
          "method": "org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent",
          "source": "EventManager.java:195"
        },
        {
          "method": "org.eclipse.osgi.framework.eventmgr.EventManager$EventThread.run",
          "source": "EventManager.java:297"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "205103",
      "date": "2007-10-01T20:47:35+02:00",
      "product": "Equinox",
      "component": "Incubator",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "java.util.Hashtable.put",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.equinox.ds.model.ServiceComponentProp.initProperties",
          "source": "ServiceComponentProp.java:491"
        },
        {
          "method": "org.eclipse.equinox.ds.model.ServiceComponentProp.\u003cinit\u003e",
          "source": "ServiceComponentProp.java:95"
        },
        {
          "method": "org.eclipse.equinox.ds.Resolver.map",
          "source": "Resolver.java:233"
        },
        {
          "method": "org.eclipse.equinox.ds.Resolver.enableComponents",
          "source": "Resolver.java:155"
        },
        {
          "method": "org.eclipse.equinox.ds.SCRManager.performWork",
          "source": "SCRManager.java:621"
        },
        {
          "method": "org.eclipse.equinox.ds.SCRManager$QueuedJob.dispatch",
          "source": "SCRManager.java:587"
        },
        {
          "method": "org.eclipse.equinox.ds.WorkThread.run",
          "source": "WorkThread.java:84"
        },
        {
          "method": "org.eclipse.equinox.util.impl.tpt.threadpool.Executor.run",
          "source": "Executor.java:84"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "205103",
      "date": "2007-10-01T20:47:35+02:00",
      "product": "Equinox",
      "component": "Incubator",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "java.util.Hashtable.put",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.equinox.ds.model.ServiceComponentProp.initProperties",
          "source": "ServiceComponentProp.java:491"
        },
        {
          "method": "org.eclipse.equinox.ds.model.ServiceComponentProp.\u003cinit\u003e",
          "source": "ServiceComponentProp.java:95"
        },
        {
          "method": "org.eclipse.equinox.ds.Resolver.map",
          "source": "Resolver.java:233"
        },
        {
          "method": "org.eclipse.equinox.ds.Resolver.enableComponents",
          "source": "Resolver.java:155"
        },
        {
          "method": "org.eclipse.equinox.ds.SCRManager.performWork",
          "source": "SCRManager.java:621"
        },
        {
          "method": "org.eclipse.equinox.ds.SCRManager$QueuedJob.dispatch",
          "source": "SCRManager.java:587"
        },
        {
          "method": "org.eclipse.equinox.ds.WorkThread.run",
          "source": "WorkThread.java:84"
        },
        {
          "method": "org.eclipse.equinox.util.impl.tpt.threadpool.Executor.run",
          "source": "Executor.java:84"
        }
      ],
      "number": 2,
      "commentIndex": 0,
      "bugId": "205103",
      "date": "2007-10-01T20:47:35+02:00",
      "product": "Equinox",
      "component": "Incubator",
      "severity": "normal"
    }
  ],
  "groupId": "205103",
  "bugId": "205103",
  "date": "2007-10-01T20:47:35+02:00",
  "product": "Equinox",
  "component": "Incubator",
  "severity": "normal"
}