{
  "comments": [
    "Build 20020212\n\n- I opened a self hosting workspace from the previous build, with only the \nresources perspective operation\n- The default installed JRE was a J9 VM\n- I caused a build to happen, and it looks like the PDE builder caused a whole \nchain of plugin activations, including JavaPlugin (strange that a core plugin \ncaused a UI plugin to load).\n- JavaPlugin initialization tries to access the Display, but is in the wrong \nthread so it fails to activate.\n\nStack trace:\n\n4 org.eclipse.core.runtime 2 Plugin org.eclipse.jdt.ui was unable to instantiate \nclass org.eclipse.jdt.internal.ui.JavaPlugin.\njava.lang.reflect.InvocationTargetException: org.eclipse.swt.SWTException: \nInvalid thread access\n\tat org.eclipse.swt.SWT.error(SWT.java:1887)\n\tat org.eclipse.swt.SWT.error(SWT.java:1819)\n\tat org.eclipse.swt.widgets.Display.checkDevice(Display.java(Compiled \nCode))\n\tat org.eclipse.swt.widgets.Display.checkDevice(Display.java(Compiled \nCode))\n\tat org.eclipse.swt.widgets.Display.disposeExec(Display.java:416)\n\tat \norg.eclipse.jdt.internal.ui.viewsupport.ImageDescriptorRegistry.hookDisplay(Imag\neDescriptorRegistry.java:78)\n\tat \norg.eclipse.jdt.internal.ui.viewsupport.ImageDescriptorRegistry.\u003cinit\u003e(ImageDesc\nriptorRegistry.java:42)\n\tat \norg.eclipse.jdt.internal.ui.viewsupport.ImageDescriptorRegistry.\u003cinit\u003e(ImageDesc\nriptorRegistry.java:30)\n\tat org.eclipse.jdt.internal.ui.JavaPlugin.\u003cinit\u003e(JavaPlugin.java:186)\n\tat java.lang.reflect.Constructor.newInstance(Native Method)\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor.internalDoPluginActivation(Pl\nuginDescriptor.java:687)\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation(PluginDesc\nriptor.java:184)\n\tat \norg.eclipse.core.internal.plugins.PluginClassLoader.activatePlugin(PluginClassLo\nader.java:52)\n\tat \norg.eclipse.core.internal.plugins.PluginClassLoader.findClassParentsSelf(PluginC\nlassLoader.java(Compiled Code))\n\tat \norg.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass(DelegatingURLC\nlassLoader.java(Compiled Code))\n\tat \norg.eclipse.core.internal.boot.DelegatingURLClassLoader.access$0(DelegatingURLCl\nassLoader.java:765)\n\tat \norg.eclipse.core.internal.boot.DelegatingURLClassLoader.findClassPrerequisites(D\nelegatingURLClassLoader.java(Compiled Code))\n\tat \norg.eclipse.core.internal.boot.DelegatingURLClassLoader.findClassPrerequisites(D\nelegatingURLClassLoader.java(Compiled Code))\n\tat \norg.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass(DelegatingURLC\nlassLoader.java(Compiled Code))\n\tat \norg.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass(DelegatingURLC\nlassLoader.java(Compiled Code))\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java(Compiled Code))\n\tat \norg.eclipse.jdt.internal.debug.ui.JDIDebugUIPlugin.\u003cinit\u003e(JDIDebugUIPlugin.java:\n63)\n\tat java.lang.reflect.Constructor.newInstance(Native Method)\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor.internalDoPluginActivation(Pl\nuginDescriptor.java:687)\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation(PluginDesc\nriptor.java:184)\n\tat \norg.eclipse.core.internal.plugins.PluginClassLoader.activatePlugin(PluginClassLo\nader.java:52)\n\tat \norg.eclipse.core.internal.plugins.PluginClassLoader.findClassParentsSelf(PluginC\nlassLoader.java(Compiled Code))\n\tat \norg.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass(DelegatingURLC\nlassLoader.java(Compiled Code))\n\tat \norg.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass(DelegatingURLC\nlassLoader.java(Compiled Code))\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java(Compiled Code))\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor.createExecutableExtension(Plu\nginDescriptor.java:128)\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor.createExecutableExtension(Plu\nginDescriptor.java:165)\n\tat \norg.eclipse.core.internal.plugins.ConfigurationElement.createExecutableExtension\n(ConfigurationElement.java:96)\n\tat \norg.eclipse.jdt.launching.JavaRuntime.initializeVMTypes(JavaRuntime.java:135)\n\tat \norg.eclipse.jdt.launching.JavaRuntime.getDefaultVMId(JavaRuntime.java:258)\n\tat \norg.eclipse.jdt.launching.JavaRuntime.getDefaultVMInstall(JavaRuntime.java:245)\n\tat \norg.eclipse.jdt.launching.JavaRuntime.initializeJREVariables(JavaRuntime.java:55\n6)\n\tat org.eclipse.pde.internal.PDEPlugin$1.run(PDEPlugin.java:315)\n\tat \norg.eclipse.core.internal.resources.Workspace.run(Workspace.java:1232)\n\tat org.eclipse.pde.internal.PDEPlugin.startup(PDEPlugin.java:320)\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor$1.run(PluginDescriptor.java:7\n01)\n\tat \norg.eclipse.core.internal.runtime.InternalPlatform.run(InternalPlatform.java:817\n)\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor.internalDoPluginActivation(Pl\nuginDescriptor.java:713)\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation(PluginDesc\nriptor.java:184)\n\tat \norg.eclipse.core.internal.plugins.PluginClassLoader.activatePlugin(PluginClassLo\nader.java:52)\n\tat \norg.eclipse.core.internal.plugins.PluginClassLoader.findClassParentsSelf(PluginC\nlassLoader.java(Compiled Code))\n\tat \norg.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass(DelegatingURLC\nlassLoader.java(Compiled Code))\n\tat \norg.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass(DelegatingURLC\nlassLoader.java(Compiled Code))\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java(Compiled Code))\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor.createExecutableExtension(Plu\nginDescriptor.java:128)\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor.createExecutableExtension(Plu\nginDescriptor.java:165)\n\tat \norg.eclipse.core.internal.plugins.ConfigurationElement.createExecutableExtension\n(ConfigurationElement.java:96)\n\tat \norg.eclipse.core.internal.events.BuildManager.instantiateBuilder(BuildManager.ja\nva:489)\n\tat \norg.eclipse.core.internal.events.BuildManager.getBuilder(BuildManager.java:321)\n\tat \norg.eclipse.core.internal.events.BuildManager.basicBuild(BuildManager.java:152)\n\tat \norg.eclipse.core.internal.events.BuildManager.basicBuild(BuildManager.java:184)\n\tat \norg.eclipse.core.internal.events.BuildManager$1.run(BuildManager.java:133)\n\tat \norg.eclipse.core.internal.runtime.InternalPlatform.run(InternalPlatform.java:817\n)\n\tat org.eclipse.core.runtime.Platform.run(Platform.java:395)\n\tat \norg.eclipse.core.internal.events.BuildManager.basicBuild(BuildManager.java:147)\n\tat \norg.eclipse.core.internal.events.BuildManager.build(BuildManager.java:230)\n\tat org.eclipse.core.internal.resources.Project.build(Project.java:105)\n\tat \norg.eclipse.ui.actions.BuildAction.invokeOperation(BuildAction.java:151)\n\tat \norg.eclipse.ui.actions.WorkspaceAction.execute(WorkspaceAction.java:111)\n\tat \norg.eclipse.ui.actions.WorkspaceAction$1.execute(WorkspaceAction.java:268)\n\tat \norg.eclipse.ui.actions.WorkspaceModifyOperation$1.run(WorkspaceModifyOperation.j\nava:64)\n\tat \norg.eclipse.core.internal.resources.Workspace.run(Workspace.java:1232)\n\tat \norg.eclipse.ui.actions.WorkspaceModifyOperation.run(WorkspaceModifyOperation.jav\na:78)\n\tat \norg.eclipse.jface.operation.ModalContext$ModalContextThread.run(ModalContext.jav\na:98)",
    "The issue with activating a plugin from a non-UI thread and the access to the \nimage registry is  well known. We have no good solution for this. Changing the \nstatic initialization of the image registry to a lazy loading scheme isn\u0027t a \nquick fix (not doable for M3).\n\nA workaround is to remove initializeJREVariables from the PDE startup code and \nmove it to the plugin importer. This ensures that plugins are imported with \ninitialzed JRE variables and the subsequent autobuild should work. This is the \nonly case I remember were you run into unitialized class path variables.\nDejan can you put in this change for M3? If you do so pls send us the bug back \nso that the issue isn\u0027t forgotten.\n\nNotice, that the current scheme will result in an earlier activation of JDT UI.",
    "The problem is that we want to register a dispose listener on a display from a \nthread that doesn\u0027t own the display. Possible solutions are:\n\n- SWT allows use to register the dispose listener from another thread\n- we register the dispose listener using async or sync exec\n  - sync could cause a dead lock\n  - async the disply could die before the listener gets registered.\n- we register the listener when \u0027get\u0027 is called the first time. But to be sure\n  to not get the same walkback we have to (a)sync this one too.\n\n\nQuestion regarding SWT: as far as I understand the SWT API it is possible to\ncreate an image in thread B for a display that is associated with thread A. \nSince this is possible it should also be possible to register a dispose \nlistener on a display from thread B.\n\nMike can you please comment on this.",
    "Looking at the activation chain again. The early activation of the JDT UI is \ntriggered by JDIDebugPluginUI constructor. It references the JDT UI internal \nhelper class ImageDescriptorRegistry and this activates as a side effect the \nJDT UI plugin. This helper class should be copied into org.eclipse.jdt.debug.ui \nthen the problem goes away (this class can\u0027t become API).\n\nI therefore propose the following \"fix strategy\":\n\n* for M3 JDTDebugPluginUI copies the ImageDescriptor helper class to their \nplugin.\n\n* To be investigated: whether SWT can allow to register dispose listeners from \nanother thread as described by Dirk below. The problem that the JavaUIPlugin \ncan be actived from a non-UI thread. This would solve the problem of activation \na UI plugin from a non UI thread in general.\n",
    "(forgot to add)\nUntil JDT has solved the class path variable initialization it would still be \nbenficial when PDE delays the call to InitializeJREVariables but this is no \nlonger critical for M3.\n\nAdressing the class path variable initialization is an issue that is on the JDT \nplan and will be addressed for 2.0.",
    "Fixed. Copied ImageDescriptorRegistry to java debug ui plug-in.",
    "Please verify (Darin S).",
    "Verified.",
    "Re:\n\u003e Question regarding SWT: as far as I understand the SWT API it\n\u003e is possible to create an image in thread B for a display that\n\u003e is associated with thread A. Since this is possible it should\n\u003e also be possible to register a dispose listener on a display\n\u003e from thread B.\n\nI don\u0027t follow this chain of logic, although I recognize why the\nfeature might be useful. The rule, such as it is, in SWT is just\nthat some graphics operations can be done from background threads.\nOperations on Display are not of this ilk.\n\nPresumably we *could* modify disposeExec() to be threadsafe, but this\nwould require care since it could introduce both new timing problems\nand, potentially at least, new opportunities for deadlock. This is not\nlikely to happen for R2.0. Please enter a separate feature request\nfor future consideration.\n\n"
  ],
  "commentCreationDates": [
    "2002-02-13T19:25:11+01:00",
    "2002-02-14T06:47:07+01:00",
    "2002-02-14T09:34:21+01:00",
    "2002-02-14T13:41:25+01:00",
    "2002-02-14T13:51:46+01:00",
    "2002-02-14T14:45:02+01:00",
    "2002-02-14T14:45:15+01:00",
    "2002-02-14T15:46:14+01:00",
    "2002-02-14T17:43:37+01:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.swt.SWTException",
      "message": "Invalid thread access",
      "elements": [
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:1887"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:1819"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.checkDevice",
          "source": "Display.java(Compiled  Code)"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.checkDevice",
          "source": "Display.java(Compiled  Code)"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.disposeExec",
          "source": "Display.java:416"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.viewsupport.ImageDescriptorRegistry.hookDisplay",
          "source": "Imag eDescriptorRegistry.java:78"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.viewsupport.ImageDescriptorRegistry.\u003cinit\u003e",
          "source": "ImageDesc riptorRegistry.java:42"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.viewsupport.ImageDescriptorRegistry.\u003cinit\u003e",
          "source": "ImageDesc riptorRegistry.java:30"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.JavaPlugin.\u003cinit\u003e",
          "source": "JavaPlugin.java:186"
        },
        {
          "method": "java.lang.reflect.Constructor.newInstance",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.internalDoPluginActivation",
          "source": "Pl uginDescriptor.java:687"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation",
          "source": "PluginDesc riptor.java:184"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginClassLoader.activatePlugin",
          "source": "PluginClassLo ader.java:52"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginClassLoader.findClassParentsSelf",
          "source": "PluginC lassLoader.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLC lassLoader.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.access$0",
          "source": "DelegatingURLCl assLoader.java:765"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.findClassPrerequisites",
          "source": "D elegatingURLClassLoader.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.findClassPrerequisites",
          "source": "D elegatingURLClassLoader.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLC lassLoader.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLC lassLoader.java(Compiled Code)"
        },
        {
          "method": "java.lang.ClassLoader.loadClass",
          "source": "ClassLoader.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.ui.JDIDebugUIPlugin.\u003cinit\u003e",
          "source": "JDIDebugUIPlugin.java: 63"
        },
        {
          "method": "java.lang.reflect.Constructor.newInstance",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.internalDoPluginActivation",
          "source": "Pl uginDescriptor.java:687"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation",
          "source": "PluginDesc riptor.java:184"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginClassLoader.activatePlugin",
          "source": "PluginClassLo ader.java:52"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginClassLoader.findClassParentsSelf",
          "source": "PluginC lassLoader.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLC lassLoader.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLC lassLoader.java(Compiled Code)"
        },
        {
          "method": "java.lang.ClassLoader.loadClass",
          "source": "ClassLoader.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.createExecutableExtension",
          "source": "Plu ginDescriptor.java:128"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.createExecutableExtension",
          "source": "Plu ginDescriptor.java:165"
        },
        {
          "method": "org.eclipse.core.internal.plugins.ConfigurationElement.createExecutableExtension",
          "source": "ConfigurationElement.java:96"
        },
        {
          "method": "org.eclipse.jdt.launching.JavaRuntime.initializeVMTypes",
          "source": "JavaRuntime.java:135"
        },
        {
          "method": "org.eclipse.jdt.launching.JavaRuntime.getDefaultVMId",
          "source": "JavaRuntime.java:258"
        },
        {
          "method": "org.eclipse.jdt.launching.JavaRuntime.getDefaultVMInstall",
          "source": "JavaRuntime.java:245"
        },
        {
          "method": "org.eclipse.jdt.launching.JavaRuntime.initializeJREVariables",
          "source": "JavaRuntime.java:55 6"
        },
        {
          "method": "org.eclipse.pde.internal.PDEPlugin$1.run",
          "source": "PDEPlugin.java:315"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1232"
        },
        {
          "method": "org.eclipse.pde.internal.PDEPlugin.startup",
          "source": "PDEPlugin.java:320"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor$1.run",
          "source": "PluginDescriptor.java:7 01"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:817 "
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.internalDoPluginActivation",
          "source": "Pl uginDescriptor.java:713"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation",
          "source": "PluginDesc riptor.java:184"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginClassLoader.activatePlugin",
          "source": "PluginClassLo ader.java:52"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginClassLoader.findClassParentsSelf",
          "source": "PluginC lassLoader.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLC lassLoader.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLC lassLoader.java(Compiled Code)"
        },
        {
          "method": "java.lang.ClassLoader.loadClass",
          "source": "ClassLoader.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.createExecutableExtension",
          "source": "Plu ginDescriptor.java:128"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.createExecutableExtension",
          "source": "Plu ginDescriptor.java:165"
        },
        {
          "method": "org.eclipse.core.internal.plugins.ConfigurationElement.createExecutableExtension",
          "source": "ConfigurationElement.java:96"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager.instantiateBuilder",
          "source": "BuildManager.ja va:489"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager.getBuilder",
          "source": "BuildManager.java:321"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager.basicBuild",
          "source": "BuildManager.java:152"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager.basicBuild",
          "source": "BuildManager.java:184"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager$1.run",
          "source": "BuildManager.java:133"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:817 "
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:395"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager.basicBuild",
          "source": "BuildManager.java:147"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager.build",
          "source": "BuildManager.java:230"
        },
        {
          "method": "org.eclipse.core.internal.resources.Project.build",
          "source": "Project.java:105"
        },
        {
          "method": "org.eclipse.ui.actions.BuildAction.invokeOperation",
          "source": "BuildAction.java:151"
        },
        {
          "method": "org.eclipse.ui.actions.WorkspaceAction.execute",
          "source": "WorkspaceAction.java:111"
        },
        {
          "method": "org.eclipse.ui.actions.WorkspaceAction$1.execute",
          "source": "WorkspaceAction.java:268"
        },
        {
          "method": "org.eclipse.ui.actions.WorkspaceModifyOperation$1.run",
          "source": "WorkspaceModifyOperation.j ava:64"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1232"
        },
        {
          "method": "org.eclipse.ui.actions.WorkspaceModifyOperation.run",
          "source": "WorkspaceModifyOperation.jav a:78"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext$ModalContextThread.run",
          "source": "ModalContext.jav a:98"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "9737",
      "date": "2002-02-13T19:25:11+01:00",
      "product": "JDT",
      "component": "Debug",
      "severity": "critical"
    }
  ],
  "groupId": "9737",
  "bugId": "9737",
  "date": "2002-02-13T19:25:11+01:00",
  "product": "JDT",
  "component": "Debug",
  "severity": "critical"
}