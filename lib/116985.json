{
  "comments": [
    "I\u0027m expreimenting with a type of refactoring using Eclipse 3.1. I\u0027m using the\nEclipse refactoring framework (org.eclipse.ltk.core.refactoring) to implement\nthis. My refactoring creates a CompositeChange containing two Changes. The first\nchange creates a new package using CreatePackageChange and the second one\ncreates a new class using CreateTextFileChange. The changes properly get\napplied. However, there is a problem while trying to undo. The UndoChange is \nagain a CompositeChange with two changes. The first one is DeleteFileChange (for\ndeleting the newly created class) and the second one is\nDeleteSourceManipulationChange (for deleting the package). The first change gets\napplied properly (the file is getting deleted), but the second change fails with\nan Exception \n\nAbnormal Workbench Condition\n\tReason:\n\tNewFile.java [in com.com1.com2.util [in \u003cproject root\u003e [in test]]] does not exist\n\nIt looks like the DeleteSourceManipulationChange is again trying to delete the\nalready deleted file.",
    "Moving to JDT UI",
    "Tobias, can you comment?",
    "Could anyone please look into this bug ASAP.",
    "Ravindra, could you please attach a stack trace to reproduce the error?",
    "Hi Tobias,\n\nI am attaching the error log for your reference. (This is same as the one sent to you before)\n\n!ENTRY org.eclipse.ui 4 0 2006-01-25 16:49:23.371\n!MESSAGE Action0.java [in com.com1.com2.ui.actions [in \u003cproject root\u003e [in test2]]] does not exist\n!STACK 0\norg.eclipse.core.commands.ExecutionException: Action0.java [in com.com1.com2.ui.actions [in \u003cproject root\u003e [in test2]]] does not exist\n\tat org.eclipse.ltk.internal.core.refactoring.UndoableOperation2ChangeAdapter.undo(UndoableOperation2ChangeAdapter.java:186)\n\tat org.eclipse.core.commands.operations.TriggeredOperations.undo(TriggeredOperations.java:216)\n\tat org.eclipse.core.commands.operations.DefaultOperationHistory.doUndo(DefaultOperationHistory.java:417)\n\tat org.eclipse.core.commands.operations.DefaultOperationHistory.undo(DefaultOperationHistory.java:1253)\n\tat org.eclipse.ui.operations.UndoActionHandler.runCommand(UndoActionHandler.java:64)\n\tat org.eclipse.ui.operations.OperationHistoryActionHandler$4.run(OperationHistoryActionHandler.java:239)\n\tat org.eclipse.jface.operation.ModalContext.runInCurrentThread(ModalContext.java:346)\n\tat org.eclipse.jface.operation.ModalContext.run(ModalContext.java:291)\n\tat org.eclipse.jface.dialogs.ProgressMonitorDialog.run(ProgressMonitorDialog.java:447)\n\tat org.eclipse.ui.internal.operations.TimeTriggeredProgressMonitorDialog.access$6(TimeTriggeredProgressMonitorDialog.java:1)\n\tat org.eclipse.ui.internal.operations.TimeTriggeredProgressMonitorDialog$2.run(TimeTriggeredProgressMonitorDialog.java:201)\n\tat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:69)\n\tat org.eclipse.ui.internal.operations.TimeTriggeredProgressMonitorDialog.run(TimeTriggeredProgressMonitorDialog.java:213)\n\tat org.eclipse.ui.operations.OperationHistoryActionHandler.run(OperationHistoryActionHandler.java:248)\n\tat org.eclipse.jface.action.Action.runWithEvent(Action.java:996)\n\tat org.eclipse.ui.actions.RetargetAction.runWithEvent(RetargetAction.java:222)\n\tat org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:538)\n\tat org.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:488)\n\tat org.eclipse.jface.action.ActionContributionItem$5.handleEvent(ActionContributionItem.java:400)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:843)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3080)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2713)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1699)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1663)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:367)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:143)\n\tat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:103)\n\tat org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:226)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:376)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:163)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:585)\n\tat org.eclipse.core.launcher.Main.invokeFramework(Main.java:334)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:278)\n\tat org.eclipse.core.launcher.Main.run(Main.java:973)\n\tat org.eclipse.core.launcher.Main.main(Main.java:948)\nCaused by: Java Model Exception: Java Model Status [Action0.java [in com.com1.com2.ui.actions [in \u003cproject root\u003e [in test2]]] does not exist]\n\tat org.eclipse.jdt.internal.core.MultiOperation.processElements(MultiOperation.java:175)\n\tat org.eclipse.jdt.internal.core.MultiOperation.executeOperation(MultiOperation.java:90)\n\tat org.eclipse.jdt.internal.core.JavaModelOperation.run(JavaModelOperation.java:718)\n\tat org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1719)\n\tat org.eclipse.jdt.internal.core.JavaModelOperation.runOperation(JavaModelOperation.java:782)\n\tat org.eclipse.jdt.internal.core.JavaModel.delete(JavaModel.java:132)\n\tat org.eclipse.jdt.internal.core.PackageFragment.delete(PackageFragment.java:149)\n\tat org.eclipse.jdt.internal.corext.refactoring.changes.DeleteSourceManipulationChange.doDelete(DeleteSourceManipulationChange.java:100)\n\tat org.eclipse.jdt.internal.corext.refactoring.changes.AbstractDeleteChange.perform(AbstractDeleteChange.java:37)\n\tat org.eclipse.ltk.core.refactoring.CompositeChange.perform(CompositeChange.java:279)\n\tat org.eclipse.ltk.internal.core.refactoring.UndoableOperation2ChangeAdapter$1.run(UndoableOperation2ChangeAdapter.java:309)\n\tat org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1719)\n\tat org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1739)\n\tat org.eclipse.ltk.internal.core.refactoring.UndoableOperation2ChangeAdapter.executeChange(UndoableOperation2ChangeAdapter.java:340)\n\tat org.eclipse.ltk.internal.core.refactoring.UndoableOperation2ChangeAdapter.undo(UndoableOperation2ChangeAdapter.java:170)",
    "The problem is that you are using CreateTextFileChange, which simply calls IFile#delete(...) during undo. This change operates on the IResource hierarchy, so the Java Model won\u0027t get updated unless you explicitely refresh the package fragment folder before executing the DeleteSourceManipulationChange.\n\nThe right way to go is to write changes based on IPackageFragment#createCompilationUnit(...) and call ICompilationUnit#delete(..) during undo."
  ],
  "commentCreationDates": [
    "2005-11-18T05:49:10+01:00",
    "2005-11-18T12:15:19+01:00",
    "2005-11-19T08:54:28+01:00",
    "2005-12-16T04:59:53+01:00",
    "2006-01-25T10:20:47+01:00",
    "2006-01-30T06:37:06+01:00",
    "2006-03-03T14:13:38+01:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.core.commands.ExecutionException",
      "message": "Action0.java [in com.com1.com2.ui.actions [in \u003cproject root\u003e [in test2]]] does not exist",
      "elements": [
        {
          "method": "org.eclipse.ltk.internal.core.refactoring.UndoableOperation2ChangeAdapter.undo",
          "source": "UndoableOperation2ChangeAdapter.java:186"
        },
        {
          "method": "org.eclipse.core.commands.operations.TriggeredOperations.undo",
          "source": "TriggeredOperations.java:216"
        },
        {
          "method": "org.eclipse.core.commands.operations.DefaultOperationHistory.doUndo",
          "source": "DefaultOperationHistory.java:417"
        },
        {
          "method": "org.eclipse.core.commands.operations.DefaultOperationHistory.undo",
          "source": "DefaultOperationHistory.java:1253"
        },
        {
          "method": "org.eclipse.ui.operations.UndoActionHandler.runCommand",
          "source": "UndoActionHandler.java:64"
        },
        {
          "method": "org.eclipse.ui.operations.OperationHistoryActionHandler$4.run",
          "source": "OperationHistoryActionHandler.java:239"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext.runInCurrentThread",
          "source": "ModalContext.java:346"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext.run",
          "source": "ModalContext.java:291"
        },
        {
          "method": "org.eclipse.jface.dialogs.ProgressMonitorDialog.run",
          "source": "ProgressMonitorDialog.java:447"
        },
        {
          "method": "org.eclipse.ui.internal.operations.TimeTriggeredProgressMonitorDialog.access$6",
          "source": "TimeTriggeredProgressMonitorDialog.java:1"
        },
        {
          "method": "org.eclipse.ui.internal.operations.TimeTriggeredProgressMonitorDialog$2.run",
          "source": "TimeTriggeredProgressMonitorDialog.java:201"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:69"
        },
        {
          "method": "org.eclipse.ui.internal.operations.TimeTriggeredProgressMonitorDialog.run",
          "source": "TimeTriggeredProgressMonitorDialog.java:213"
        },
        {
          "method": "org.eclipse.ui.operations.OperationHistoryActionHandler.run",
          "source": "OperationHistoryActionHandler.java:248"
        },
        {
          "method": "org.eclipse.jface.action.Action.runWithEvent",
          "source": "Action.java:996"
        },
        {
          "method": "org.eclipse.ui.actions.RetargetAction.runWithEvent",
          "source": "RetargetAction.java:222"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:538"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$2",
          "source": "ActionContributionItem.java:488"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$5.handleEvent",
          "source": "ActionContributionItem.java:400"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:843"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:3080"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2713"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1699"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1663"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:367"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:143"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:103"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:226"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:376"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:163"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:585"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:334"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:278"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:973"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:948"
        }
      ],
      "number": 0,
      "commentIndex": 5,
      "bugId": "116985",
      "date": "2006-01-30T06:37:06+01:00",
      "product": "JDT",
      "component": "UI",
      "severity": "normal"
    }
  ],
  "groupId": "116985",
  "bugId": "116985",
  "date": "2005-11-18T05:49:10+01:00",
  "product": "JDT",
  "component": "UI",
  "severity": "normal"
}