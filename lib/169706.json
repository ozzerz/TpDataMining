{
  "comments": [
    "There is a problem when the @annotation is used in a context where the annotation for the method is not declared neither in the type of the object instance nor in its super type. The following example shows the problem I have detected. The compiler throws the following exception:\n\njava.lang.IllegalStateException\nat org.aspectj.weaver.bcel.BcelShadow.getAnnotations(BcelShadow.java:1578)\nat org.aspectj.weaver.bcel.BcelShadow.initializeKindedAnnotationVars(BcelShadow.java:1603)\nat org.aspectj.weaver.bcel.BcelShadow.getKindedAnnotationVar(BcelShadow.java:1087)\nat org.aspectj.weaver.patterns.AnnotationPointcut.findResidueInternal(AnnotationPointcut.java:195)\nat org.aspectj.weaver.patterns.Pointcut.findResidue(Pointcut.java ... lasses \nwhen weaving \nwhen batch building BuildConfig[/home/pacz/workspace/.metadata/.plugins/org.eclipse.ajdt.core/MyBugTest.generated.lst] #Files\u003d7\n\n\nThe example:\n\npublic class A {\n\n    @MyAnnotation\n    public void foo() {\n\n    }\n\n}\n\npublic class B extends A {\n\n}\n\npublic class C extends B {\n\n}\n\npublic class Test {\n\n    public static void main(String args[]) {\n        C c \u003d new C();\n        c.foo();\n    }\n\n}\n\npublic aspect MyAspect {\n\n    // this throws an exception\n    before(MyAnnotation myAnnotation) : \n        call(@MyAnnotation * *..*.*(..)) \u0026\u0026\n        @annotation(myAnnotation) {\n\n    }\n\n    // this, however, works fine\n    // before() : \n    //     call(@MyAnnotation * *..*.*(..)) {\n    // \n    // }\n}",
    "you didn\u0027t include the declaration of the annotation type - but i made one up.  The bug here is that the hierarchy is more than 2 deep.  You have A \u003e B \u003e C.  If you have A \u003e C (ie. C extends A directly) then it would work without an error.\n\nI\u0027ve committed a testcase and the fix - thanks for supplying a minimal set of files that show the problem.",
    "fix available in latest dev build."
  ],
  "commentCreationDates": [
    "2007-01-05T17:50:26+01:00",
    "2007-01-08T15:58:16+01:00",
    "2007-01-09T08:44:18+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.IllegalStateException",
      "elements": [
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.getAnnotations",
          "source": "BcelShadow.java:1578"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.initializeKindedAnnotationVars",
          "source": "BcelShadow.java:1603"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.getKindedAnnotationVar",
          "source": "BcelShadow.java:1087"
        },
        {
          "method": "org.aspectj.weaver.patterns.AnnotationPointcut.findResidueInternal",
          "source": "AnnotationPointcut.java:195"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "169706",
      "date": "2007-01-05T17:50:26+01:00",
      "product": "AspectJ",
      "component": "Compiler",
      "severity": "blocker"
    }
  ],
  "groupId": "169706",
  "bugId": "169706",
  "date": "2007-01-05T17:50:26+01:00",
  "product": "AspectJ",
  "component": "Compiler",
  "severity": "blocker"
}