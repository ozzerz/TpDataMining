{
  "comments": [
    "- Profile the Eclipse workbench\n- Detach the agent\n\nNotice that the process terminates instead of the agent detaching.",
    "Asaf - Can you take a look at this.\n\nThe output on the console is \n[Error: EC JPIAgent received message (FATAL ERROR): Internal error (see log file).]",
    "This issue is related to the logic used inside Martini for redefining loaded classes (which happen during attach/detach). It may be related to the Eclipse/OSGi framework as we have yet to observed this failure with other Java application types. I need more time to root-cause this failure.\n",
    "The root-cause of this bug is that during detach (or attach), the current implementation for redefining loaded classes may need to force-load some classes into memory (specifically, classes which were already instrumented but not yet prepared). To force-load classes, the implementation calls the JNI FindClass function which uses the Java bootstrap class loader. This does not work in applications such as Eclipse, where each plugin manages its own classes with a specific class loader.\nThis bug will also prevent the JVMTI CPU and Heap profilers from attaching to a running workbench (this is not a detach-specific bug). It may also manifest itself in other applications which uses multiple class loader to achieve some sort of component isolations (e.g, J2EE servers).\n",
    "I have implemented and checked-in a workaround that does not require class redefinition. Attaching to/detaching from the CPU and Heap Profilers no longer cause crashes. \n\nRetargeting bug to the next iteration.\nChanging bug severity from \"critical\" to \"major\" as a workaround is available.",
    "raising sev",
    "Ali, given the workaround available, is this a candidate for deferral?",
    "Detaching the agent doesn\u0027t cause process termination but when the user right clicks a detached agent and clicks \"Attach to Agent\", the process terminates and the following exception is displayed:\n\n\njava.lang.NullPointerException\nnull\n\njava.lang.NullPointerException\n  at org.eclipse.tptp.platform.jvmti.client.internal.launcher.TIDelegateHelper.attachToAgent(TIDelegateHelper.java:574)\n  at org.eclipse.tptp.platform.jvmti.client.internal.launcher.TIDelegateHelper.attachToAgent(TIDelegateHelper.java:538)\n  at org.eclipse.tptp.platform.jvmti.client.internal.controlproviders.TIAgentControlProvider$TIAgentStateModifier.doAction(TIAgentControlProvider.java:321)\n  at org.eclipse.tptp.platform.jvmti.client.internal.controlproviders.TIAgentControlProvider$TIAgentStateModifier.performCollectiveAction(TIAgentControlProvider.java:271)\n  at org.eclipse.tptp.platform.jvmti.client.internal.controlproviders.TIAgentControlProvider$TIAgentStateModifier.attach(TIAgentControlProvider.java:221)\n  at org.eclipse.tptp.trace.ui.provisional.control.provider.AbstractAgentControlProvider$1$AttachControlItem.run(AbstractAgentControlProvider.java:108)\n  at org.eclipse.jface.action.Action.runWithEvent(Action.java:498)\n  at org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:545)\n  at org.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:490)\n  at org.eclipse.jface.action.ActionContributionItem$5.handleEvent(ActionContributionItem.java:402)\n  at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n  at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:938)\n...",
    "(In reply to comment #7)\nThe problem described by Ali is not related to this bug.\n\nRecommend to lower priority of this bug and defer to future.\n",
    "Joanna,\n\nAssuming Assaf is right, I think we need to open a separate critical defect (on the JVMTI client side) and have the severity of this defect lowered to major.",
    "There already appears to be a defect open for the problem that I\u0027ve mentioned:\nhttps://bugs.eclipse.org/bugs/show_bug.cgi?id\u003d186807",
    "Changed summary to better describe the bug",
    "Must be fixed in 4.4.0.1 to enable Bug 190802 which is also scheduled for 4.4.0.1",
    "Lowering the priority on this defect.\nWe are addressing P1\u0027s for 4.4.0.1",
    "Triaging 4.4.0.2 candidate defects for Joanna.  \n\nThis is a 4.4.0.2 candidate defect since deferred from 4.4.0.1.\n\nAsaf, please target to 4.4.0.2 when the field is available.\n",
    "Cannot be contained in 4402",
    "Resolved.\nThe current fix does not support IBM 1.5 JVM as it does not properly support the JVMTI RedefineClasses API.",
    "(In reply to comment #16)\n\u003e Resolved.\n\u003e The current fix does not support IBM 1.5 JVM as it does not properly support\n\u003e the JVMTI RedefineClasses API.\n\nSo in conclusion this problem is now just pending an IBM JRE fix an dis not restricted to OSGi as noted in the Summary?\nIf there is also an outstanding OSGi problem, it should be tracked separately as this will obviously affect any Eclipse or RCP developer.",
    "(In reply to comment #17)\n\u003e So in conclusion this problem is now just pending an IBM JRE fix an dis not\n\u003e restricted to OSGi as noted in the Summary?\n\nThat\u0027s correct. The fix resolves all known issues with OSGi/Eclipse-based applications.\n",
    "(In reply to comment #18)\n\u003e \n\u003e That\u0027s correct. The fix resolves all known issues with OSGi/Eclipse-based\n\u003e applications.\n\u003e \n\nThanks Asaf for the clarification. Can you update the bug summary then to reflect this. It seems the reference to OSGi is no longer needed and the bug was broader",
    "Changed bug summary to better describe the problem."
  ],
  "commentCreationDates": [
    "2007-03-26T20:21:01+02:00",
    "2007-03-27T01:59:54+02:00",
    "2007-03-27T12:21:54+02:00",
    "2007-03-29T20:44:27+02:00",
    "2007-04-22T16:38:23+02:00",
    "2007-05-28T18:33:14+02:00",
    "2007-05-28T21:54:59+02:00",
    "2007-05-28T22:36:08+02:00",
    "2007-05-29T07:57:52+02:00",
    "2007-05-29T16:18:06+02:00",
    "2007-05-29T16:32:16+02:00",
    "2007-06-20T11:24:07+02:00",
    "2007-06-21T08:19:28+02:00",
    "2007-06-29T20:17:01+02:00",
    "2007-07-16T15:11:07+02:00",
    "2007-08-03T07:59:27+02:00",
    "2007-08-23T12:41:00+02:00",
    "2007-08-23T13:15:26+02:00",
    "2007-08-27T10:28:33+02:00",
    "2007-08-27T14:53:29+02:00",
    "2007-08-27T15:23:33+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.tptp.platform.jvmti.client.internal.launcher.TIDelegateHelper.attachToAgent",
          "source": "TIDelegateHelper.java:574"
        },
        {
          "method": "org.eclipse.tptp.platform.jvmti.client.internal.launcher.TIDelegateHelper.attachToAgent",
          "source": "TIDelegateHelper.java:538"
        },
        {
          "method": "org.eclipse.tptp.platform.jvmti.client.internal.controlproviders.TIAgentControlProvider$TIAgentStateModifier.doAction",
          "source": "TIAgentControlProvider.java:321"
        },
        {
          "method": "org.eclipse.tptp.platform.jvmti.client.internal.controlproviders.TIAgentControlProvider$TIAgentStateModifier.performCollectiveAction",
          "source": "TIAgentControlProvider.java:271"
        },
        {
          "method": "org.eclipse.tptp.platform.jvmti.client.internal.controlproviders.TIAgentControlProvider$TIAgentStateModifier.attach",
          "source": "TIAgentControlProvider.java:221"
        },
        {
          "method": "org.eclipse.tptp.trace.ui.provisional.control.provider.AbstractAgentControlProvider$1$AttachControlItem.run",
          "source": "AbstractAgentControlProvider.java:108"
        },
        {
          "method": "org.eclipse.jface.action.Action.runWithEvent",
          "source": "Action.java:498"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:545"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$2",
          "source": "ActionContributionItem.java:490"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$5.handleEvent",
          "source": "ActionContributionItem.java:402"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:938"
        }
      ],
      "number": 0,
      "commentIndex": 7,
      "bugId": "179354",
      "date": "2007-05-28T22:36:08+02:00",
      "product": "TPTP Profiling",
      "component": "Platform.UI.ProfilingPerspective",
      "severity": "major"
    }
  ],
  "groupId": "179354",
  "bugId": "179354",
  "date": "2007-03-26T20:21:01+02:00",
  "product": "TPTP Profiling",
  "component": "Platform.UI.ProfilingPerspective",
  "severity": "major"
}