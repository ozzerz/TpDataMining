{
  "comments": [
    "Build ID: 3.3.0\n\n\nIn class org.eclipse.birt.report.data.oda.jdbc.Connection at line\n 91 - 111.\nIf the connProperties contains Constants.ODAJndiName, this connections must be tried first, to get a connection.\nIt should be handeled like in the \"doConnect(String driverClass, String url, String jndiNameUrl, Properties connectionProperties)\" method in org.eclipse.birt.report.data.oda.jdbc.JDBCDriverManager class.\n\n[quote]\n.....\n // no driverinfo extension for driverClass connectionFactory\n        \n        // if JNDI Data Source URL is defined, try use name service to get connection\n        Connection jndiDSConnection \u003d \n            getJndiDSConnection( driverClass, jndiNameUrl, connectionProperties );\n        \n        if ( jndiDSConnection !\u003d null )      // successful\n            return jndiDSConnection;         // done\n       \n        // no JNDI Data Source URL defined, or \n        // not able to get a JNDI data source connection, \n        // use the JDBC DriverManager instead to get a JDBC connection\n\t\tloadAndRegisterDriver(driverClass);\n\t\tif ( logger.isLoggable( Level.FINER ))\n\t\t\tlogger.finer( \"Calling DriverManager.getConnection. url\u003d\" + url ); //$NON-NLS-1$\n.....\n[/quote]\n\nSteps To Reproduce:\n1.) Create a datasource with only 1 \"Jndi Url\" in the Datesource (no other Properties).\n2.) Create a report with 1 Dataset and 2 or more Cubes.\n3.) Try to run the report with the report engine.\n\n\n-- Orkus9",
    "After \"Steps To Reproduce\", what will happen? Is there any exception or  issue appeared? Would you please give more detail infomation? \nIn addition, when creating a new jdbc data source, it will not success only to input 1 \"Jndi Url\" property, because database url can not be empty.\n\n\n   ",
    "1.) Create a report WITH jdbc-data-source and jndi-url.\nBirt creates e.g. a this xml-code:\n\u003cdata-sources\u003e\n  \u003coda-data-source extensionID\u003d\"org.eclipse.birt.report.data.oda.jdbc\" name\u003d\"Data   Source\" id\u003d\"39\"\u003e\n   \u003ctext-property name\u003d\"displayName\"\u003eData Source\u003c/text-property\u003e\n   \u003cproperty name\u003d\"odaDriverClass\"\u003eorg.postgresql.Driver\u003c/property\u003e\n   \u003cproperty name\u003d\"odaURL\"\u003ejdbc:postgresql://localhost:5432/db\u003c/property\u003e\n   \u003cproperty name\u003d\"odaUser\"\u003eabcd\u003c/property\u003e\n   \u003cencrypted-property name\u003d\"odaPassword\"\u003eZXRtc191c2VyXzAx\u003c/encrypted-property\u003e\n   \u003cproperty name\u003d\"odaJndiName\"\u003ejava:/ds.report\u003c/property\u003e\n \u003c/oda-data-source\u003e\n\u003c/data-sources\u003e\n\n2.) Remove the not needed properties e.g. in the \"xml-source-view\" editor, so that it looks like this:\n\n\u003cdata-sources\u003e\n  \u003coda-data-source extensionID\u003d\"org.eclipse.birt.report.data.oda.jdbc\" name\u003d\"Data   Source\" id\u003d\"39\"\u003e\n   \u003ctext-property name\u003d\"displayName\"\u003eData Source\u003c/text-property\u003e\n   \u003cproperty name\u003d\"odaJndiName\"\u003ejava:/ds.report\u003c/property\u003e\n \u003c/oda-data-source\u003e\n\u003c/data-sources\u003e\n\n(I do this programmatically, so that jdbc-data-source data were removed, because the are only needed for creating the birt-report.)\n\n3.) When you run the report in the runtime-engine, you get this error:\n\nFO: Sampledb plugin starts up. Current startCount\u003d0\n12:28:49,433 INFO  [STDOUT] Aug 21, 2007 10:28:49 AM org.eclipse.birt.report.data.oda.sampledb.SampledbPlugin init\nINFO: Creating Sampledb database at location /tmp/BIRTSampleDB_1187692129432_1ccb9cf\n12:28:56,318 INFO  [STDOUT] Aug 21, 2007 10:28:56 AM org.eclipse.birt.data.engine.impl.DataEngineImpl \u003cinit\u003e\nINFO: Data Engine starts up\n12:28:56,468 INFO  [STDOUT] Aug 21, 2007 10:28:56 AM org.eclipse.birt.data.engine.odaconsumer.ConnectionManager addProfileProviderService( Map )\nINFO: Added default property service: org.eclipse.datatools.connectivity.oda.profile.connectionPropertyService\n12:28:56,524 INFO  [STDOUT] Aug 21, 2007 10:28:56 AM org.eclipse.birt.data.engine.odaconsumer.ConnectionManager openConnection\nSEVERE: Cannot open connection.\norg.eclipse.birt.report.data.oda.jdbc.JDBCException: Missing properties in Connection.open(Properties).\n        at org.eclipse.birt.report.data.oda.jdbc.Connection.open(Connection.java:108)\n        at org.eclipse.datatools.connectivity.oda.consumer.helper.OdaConnection.open(OdaConnection.java:235)\n        at org.eclipse.birt.data.engine.odaconsumer.ConnectionManager.openConnection(ConnectionManager.java:149)\n        at org.eclipse.birt.data.engine.executor.DataSource.newConnection(DataSource.java:134)\n        at org.eclipse.birt.data.engine.executor.DataSource.open(DataSource.java:121)\n        at org.eclipse.birt.data.engine.impl.DataSourceRuntime.openOdiDataSource(DataSourceRuntime.java:214)\n        at org.eclipse.birt.data.engine.impl.QueryExecutor.openDataSource(QueryExecutor.java:265)\n        at org.eclipse.birt.data.engine.impl.QueryExecutor.prepareExecution(QueryExecutor.java:210)\n        at org.eclipse.birt.data.engine.impl.PreparedQuery.doPrepare(PreparedQuery.java:486)\n        at org.eclipse.birt.data.engine.impl.PreparedDataSourceQuery.execute(PreparedDataSourceQuery.java:161)\n        at org.eclipse.birt.data.engine.impl.PreparedOdaDSQuery.execute(PreparedOdaDSQuery.java:142)\n        at org.eclipse.birt.data.engine.impl.PreparedDataSourceQuery.execute(PreparedDataSourceQuery.java:141)\n        at org.eclipse.birt.report.engine.api.impl.GetParameterDefinitionTask.createDynamicSelectionChoices(GetParameterDefinitionTask.java:507)\n        at org.eclipse.birt.report.engine.api.impl.GetParameterDefinitionTask.getChoicesFromParameterQuery(GetParameterDefinitionTask.java:895)\n        at org.eclipse.birt.report.engine.api.impl.GetParameterDefinitionTask.getSelectionList(GetParameterDefinitionTask.java:351)\n.....\n\n\nIn class org.eclipse.birt.report.data.oda.jdbc.Connection at line\n 91 - 111, there is no checking of the \"Constants.ODAJndiName\" property, like i disribed in comment #1.\n",
    "I found the Bug and a workaround:\n\nAt class org.eclipse.birt.report.data.oda.jdbc.Connection at line 105-111:\n\nString url \u003d connProperties.getProperty( Constants.ODAURL );\nif ( url \u003d\u003d null || url.length( ) \u003d\u003d 0 )\n{ \n   throw new JDBCException( ResourceConstants.DRIVER_MISSING_PROPERTIES,\n   ResourceConstants.ERROR_MISSING_PROPERTIES );\n}\nconnectByUrl( url, connProperties );\n\nAt runtime you need no \"ODAURL\", cause you can have an jndi-connection.\nThe line 111 \"connectByUrl( url, connProperties );\" will only be called, if a ODAURL is set.\nCorrect would be:\n\nString url \u003d connProperties.getProperty( Constants.ODAURL );\nString jndiName \u003d connProperties.getProperty( Constants.ODAJndiName );\nif ( (url \u003d\u003d null || url.length( ) \u003d\u003d 0) \u0026\u0026 (jndiName \u003d\u003d null || jndiName.length() \u003d\u003d 0)  )\n{\nthrow new JDBCException( ResourceConstants.DRIVER_MISSING_PROPERTIES,\nResourceConstants.ERROR_MISSING_PROPERTIES );\n}\nconnectByUrl( url, connProperties );\n\n\n\nWorkaround is:\nSet a \"dummy\" odaurl. I discribed, that i removed the not needed properties manually (comment #2). Dont remove this line: \n \u003cproperty name\u003d\"odaURL\"\u003ejdbc:postgresql://localhost:5432/db\u003c/property\u003e,\nbut set it e.g. to  \u003cproperty name\u003d\"odaURL\"\u003edummy url\u003c/property\u003e\n\nThen all works fine. \n\nPS: Im removing the properties, so that someone, who gets the birt Report cant see the url and user of the database. He can upload it to our application and run the report, but he doesnt know anything about the database.",
    "This bug is occured when Odaurl is null and JndiNameUrl is not null.  Now we check these two values first, when they are both of null value, throw an exception. Otherwise, we will check JndiNameUrl first, if JndiNameUrl is null, then using Odaurl to try connecting."
  ],
  "commentCreationDates": [
    "2007-08-17T16:41:39+02:00",
    "2007-08-21T08:30:29+02:00",
    "2007-08-21T14:44:16+02:00",
    "2007-08-21T17:04:17+02:00",
    "2007-08-23T12:01:04+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.birt.report.data.oda.jdbc.JDBCException",
      "message": "Missing properties in Connection.open(Properties).",
      "elements": [
        {
          "method": "org.eclipse.birt.report.data.oda.jdbc.Connection.open",
          "source": "Connection.java:108"
        },
        {
          "method": "org.eclipse.datatools.connectivity.oda.consumer.helper.OdaConnection.open",
          "source": "OdaConnection.java:235"
        },
        {
          "method": "org.eclipse.birt.data.engine.odaconsumer.ConnectionManager.openConnection",
          "source": "ConnectionManager.java:149"
        },
        {
          "method": "org.eclipse.birt.data.engine.executor.DataSource.newConnection",
          "source": "DataSource.java:134"
        },
        {
          "method": "org.eclipse.birt.data.engine.executor.DataSource.open",
          "source": "DataSource.java:121"
        },
        {
          "method": "org.eclipse.birt.data.engine.impl.DataSourceRuntime.openOdiDataSource",
          "source": "DataSourceRuntime.java:214"
        },
        {
          "method": "org.eclipse.birt.data.engine.impl.QueryExecutor.openDataSource",
          "source": "QueryExecutor.java:265"
        },
        {
          "method": "org.eclipse.birt.data.engine.impl.QueryExecutor.prepareExecution",
          "source": "QueryExecutor.java:210"
        },
        {
          "method": "org.eclipse.birt.data.engine.impl.PreparedQuery.doPrepare",
          "source": "PreparedQuery.java:486"
        },
        {
          "method": "org.eclipse.birt.data.engine.impl.PreparedDataSourceQuery.execute",
          "source": "PreparedDataSourceQuery.java:161"
        },
        {
          "method": "org.eclipse.birt.data.engine.impl.PreparedOdaDSQuery.execute",
          "source": "PreparedOdaDSQuery.java:142"
        },
        {
          "method": "org.eclipse.birt.data.engine.impl.PreparedDataSourceQuery.execute",
          "source": "PreparedDataSourceQuery.java:141"
        },
        {
          "method": "org.eclipse.birt.report.engine.api.impl.GetParameterDefinitionTask.createDynamicSelectionChoices",
          "source": "GetParameterDefinitionTask.java:507"
        },
        {
          "method": "org.eclipse.birt.report.engine.api.impl.GetParameterDefinitionTask.getChoicesFromParameterQuery",
          "source": "GetParameterDefinitionTask.java:895"
        },
        {
          "method": "org.eclipse.birt.report.engine.api.impl.GetParameterDefinitionTask.getSelectionList",
          "source": "GetParameterDefinitionTask.java:351"
        }
      ],
      "number": 0,
      "commentIndex": 2,
      "bugId": "200370",
      "date": "2007-08-21T14:44:16+02:00",
      "product": "BIRT",
      "component": "Data",
      "severity": "normal"
    }
  ],
  "groupId": "200370",
  "bugId": "200370",
  "date": "2007-08-17T16:41:39+02:00",
  "product": "BIRT",
  "component": "Data",
  "severity": "normal"
}