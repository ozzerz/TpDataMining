{
  "comments": [
    "It is possible that this is not a bug, either because it\u0027s known \u0026 not \nsupported to because it\u0027s internal API, but it was rather unexpected, bizzare \nbehavor.  \n\nI have a plugin which depends on JDT-UI.  This plugin also happens to implement \nIStartup.  If at anypoint, I load the org.eclipse.jdt.internal.ui.JavaPlugin \nclass from earlyStartup(), the Plugin loader attempts to load JDT-UI, which \nthen promptly bombs out with invalid thread access and fails to load.  This \nonly happens if no JDT UI perspectives are loaded (in other words, on a fresh \nworkspace).  I will attach a simple plugin that demonstrates the problem.  Just \nrun it on a fresh workspace.  \n\nThe line it fails on seems to be \"manager.registerAdapters(new \nJavaElementAdapterFactory(), IJavaElement.class);\" in the startup() method.  \n\nThanks,\n\nAndrew",
    "Created an attachment (id\u003d1792)\nThis is a simple pluing that implements IStartup and references JDT-UI plugin.  Can be reproduced more subtle references too\n",
    "And the log:\n\n!ENTRY org.eclipse.core.runtime 4 2 Aug 05, 2002 09:44:56.61\n!MESSAGE Problems occurred when invoking code from plug-\nin: \"org.eclipse.core.runtime\".\n!STACK 0\njava.lang.ExceptionInInitializerError\n\tat org.eclipse.jdt.internal.ui.JavaPlugin.startup(JavaPlugin.java:183)\n\tat org.eclipse.core.internal.plugins.PluginDescriptor$1.run\n(PluginDescriptor.java:694)\n\tat org.eclipse.core.internal.runtime.InternalPlatform.run\n(InternalPlatform.java:831)\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor.internalDoPluginActivation\n(PluginDescriptor.java:706)\n\tat org.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation\n(PluginDescriptor.java:186)\n\tat org.eclipse.core.internal.plugins.PluginClassLoader.activatePlugin\n(PluginClassLoader.java:58)\n\tat \norg.eclipse.core.internal.plugins.PluginClassLoader.findClassParentsSelf\n(PluginClassLoader.java:136)\n\tat org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass\n(DelegatingURLClassLoader.java:750)\n\tat org.eclipse.core.internal.boot.DelegatingURLClassLoader.access$0\n(DelegatingURLClassLoader.java:744)\n\tat \norg.eclipse.core.internal.boot.DelegatingURLClassLoader$DelegateLoader.loadClass\n(DelegatingURLClassLoader.java:70)\n\tat \norg.eclipse.core.internal.boot.DelegatingURLClassLoader.findClassPrerequisites\n(DelegatingURLClassLoader.java:429)\n\tat org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass\n(DelegatingURLClassLoader.java:758)\n\tat org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass\n(DelegatingURLClassLoader.java:730)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:262)\n\tat java.lang.ClassLoader.loadClassInternal(ClassLoader.java:322)\n\tat org.test.jdtui.load.LoadPlugin.earlyStartup(LoadPlugin.java:72)\n\tat org.eclipse.ui.internal.Workbench$10.run(Workbench.java:1115)\n\tat org.eclipse.core.internal.runtime.InternalPlatform.run\n(InternalPlatform.java:831)\n\tat org.eclipse.core.runtime.Platform.run(Platform.java:416)\n\tat org.eclipse.ui.internal.Workbench$9.run(Workbench.java:1122)\n\tat java.lang.Thread.run(Thread.java:536)\nCaused by: org.eclipse.swt.SWTException: Invalid thread access\n\tat org.eclipse.swt.SWT.error(SWT.java:2119)\n\tat org.eclipse.swt.SWT.error(SWT.java:2051)\n\tat org.eclipse.swt.widgets.Display.error(Display.java:503)\n\tat org.eclipse.swt.widgets.Display.checkDevice(Display.java:370)\n\tat org.eclipse.swt.widgets.Display.disposeExec(Display.java:480)\n\tat \norg.eclipse.jdt.internal.ui.viewsupport.ImageDescriptorRegistry.hookDisplay\n(ImageDescriptorRegistry.java:79)\n\tat \norg.eclipse.jdt.internal.ui.viewsupport.ImageDescriptorRegistry.\u003cinit\u003e\n(ImageDescriptorRegistry.java:42)\n\tat \norg.eclipse.jdt.internal.ui.viewsupport.ImageDescriptorRegistry.\u003cinit\u003e\n(ImageDescriptorRegistry.java:30)\n\tat \norg.eclipse.jdt.internal.ui.JavaPlugin.internalGetImageDescriptorRegistry\n(JavaPlugin.java:317)\n\tat org.eclipse.jdt.internal.ui.JavaPlugin.getImageDescriptorRegistry\n(JavaPlugin.java:170)\n\tat \norg.eclipse.jdt.internal.ui.viewsupport.JavaElementImageProvider.\u003cinit\u003e\n(JavaElementImageProvider.java:79)\n\tat org.eclipse.jdt.internal.ui.JavaWorkbenchAdapter.\u003cinit\u003e\n(JavaWorkbenchAdapter.java:32)\n\tat org.eclipse.jdt.internal.ui.JavaElementAdapterFactory.\u003cclinit\u003e\n(JavaElementAdapterFactory.java:53)\n\t... 21 more\n!ENTRY org.eclipse.ui 4 2 Aug 05, 2002 09:44:56.872\n!MESSAGE Problems occurred when invoking code from plug-in: \"org.eclipse.ui\".\n!STACK 0\norg.eclipse.core.internal.boot.DelegatingLoaderException: \norg.eclipse.core.runtime.CoreException: Problems encountered starting up plug-\nin: \"org.eclipse.jdt.ui\".\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor.internalDoPluginActivation\n(PluginDescriptor.java:712)\n\tat org.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation\n(PluginDescriptor.java:186)\n\tat org.eclipse.core.internal.plugins.PluginClassLoader.activatePlugin\n(PluginClassLoader.java:58)\n\tat \norg.eclipse.core.internal.plugins.PluginClassLoader.findClassParentsSelf\n(PluginClassLoader.java:136)\n\tat org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass\n(DelegatingURLClassLoader.java:750)\n\tat org.eclipse.core.internal.boot.DelegatingURLClassLoader.access$0\n(DelegatingURLClassLoader.java:744)\n\tat \norg.eclipse.core.internal.boot.DelegatingURLClassLoader$DelegateLoader.loadClass\n(DelegatingURLClassLoader.java:70)\n\tat \norg.eclipse.core.internal.boot.DelegatingURLClassLoader.findClassPrerequisites\n(DelegatingURLClassLoader.java:429)\n\tat org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass\n(DelegatingURLClassLoader.java:758)\n\tat org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass\n(DelegatingURLClassLoader.java:730)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:262)\n\tat java.lang.ClassLoader.loadClassInternal(ClassLoader.java:322)\n\tat org.test.jdtui.load.LoadPlugin.earlyStartup(LoadPlugin.java:72)\n\tat org.eclipse.ui.internal.Workbench$10.run(Workbench.java:1115)\n\tat org.eclipse.core.internal.runtime.InternalPlatform.run\n(InternalPlatform.java:831)\n\tat org.eclipse.core.runtime.Platform.run(Platform.java:416)\n\tat org.eclipse.ui.internal.Workbench$9.run(Workbench.java:1122)\n\tat java.lang.Thread.run(Thread.java:536)\n!ENTRY org.eclipse.ui 4 4 Aug 05, 2002 09:44:56.892\n!MESSAGE Unhandled Exception\nUnhandled Exception\nReason:\n!ENTRY org.eclipse.ui 4 0 Aug 05, 2002 09:44:56.912\n!MESSAGE Unhandled Exception\n!STACK 0\norg.eclipse.core.internal.boot.DelegatingLoaderException: \norg.eclipse.core.runtime.CoreException: Problems encountered starting up plug-\nin: \"org.eclipse.jdt.ui\".\n\tat \norg.eclipse.core.internal.plugins.PluginDescriptor.internalDoPluginActivation\n(PluginDescriptor.java:712)\n\tat org.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation\n(PluginDescriptor.java:186)\n\tat org.eclipse.core.internal.plugins.PluginClassLoader.activatePlugin\n(PluginClassLoader.java:58)\n\tat \norg.eclipse.core.internal.plugins.PluginClassLoader.findClassParentsSelf\n(PluginClassLoader.java:136)\n\tat org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass\n(DelegatingURLClassLoader.java:750)\n\tat org.eclipse.core.internal.boot.DelegatingURLClassLoader.access$0\n(DelegatingURLClassLoader.java:744)\n\tat \norg.eclipse.core.internal.boot.DelegatingURLClassLoader$DelegateLoader.loadClass\n(DelegatingURLClassLoader.java:70)\n\tat \norg.eclipse.core.internal.boot.DelegatingURLClassLoader.findClassPrerequisites\n(DelegatingURLClassLoader.java:429)\n\tat org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass\n(DelegatingURLClassLoader.java:758)\n\tat org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass\n(DelegatingURLClassLoader.java:730)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:262)\n\tat java.lang.ClassLoader.loadClassInternal(ClassLoader.java:322)\n\tat org.test.jdtui.load.LoadPlugin.earlyStartup(LoadPlugin.java:72)\n\tat org.eclipse.ui.internal.Workbench$10.run(Workbench.java:1115)\n\tat org.eclipse.core.internal.runtime.InternalPlatform.run\n(InternalPlatform.java:831)\n\tat org.eclipse.core.runtime.Platform.run(Platform.java:416)\n\tat org.eclipse.ui.internal.Workbench$9.run(Workbench.java:1122)\n\tat java.lang.Thread.run(Thread.java:536)\nUnhandled Exception\n",
    "The problem is that the plugin loading occurs in a non UI thread. Deep down in \nthe initialization phase we try to hook a listener on the default display which \nresult in an InvalidThreadAccess exception from SWT. \n\nSolutions are:\n\n- initialise the statics in JavaElementAdapterFactory lazily (culprit is\n  JavaWorkbenchAdapter)\n- initialize the fImageProvider field in JavaWorkbenchAdapter lazily.",
    "\nJust in case this is causing someone else strife, the following workaround \nworks for me:\n\n\t/**\n\t * @see org.eclipse.ui.IStartup#earlyStartup()\n\t */\n\tpublic void earlyStartup() {\n\n               Display.getDefault().asyncExec(new Runnable() {\t\t\t\n\t\t\tpublic void run() {\n\t\t\t\t\n\t\t\t\tJavaPlugin.getDefault();\n\t\t\t}\n\t\t\t\t\n\t\t});\n                ....\n         }\n\t\t",
    "That workaround should say \"syncExec\", asyncExec causes a race condition.  \n\n-Andrew",
    "*** Bug 24723 has been marked as a duplicate of this bug. ***",
    "fixed \u003e 20021212\n\nThe JavaElementAdapterFactory is now initialized lazily"
  ],
  "commentCreationDates": [
    "2002-08-05T15:42:09+02:00",
    "2002-08-05T15:44:08+02:00",
    "2002-08-05T15:44:46+02:00",
    "2002-08-05T17:06:31+02:00",
    "2002-08-05T21:04:08+02:00",
    "2002-10-15T18:43:11+02:00",
    "2002-10-16T15:32:35+02:00",
    "2002-12-12T18:11:37+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ExceptionInInitializerError",
      "elements": [
        {
          "method": "org.eclipse.jdt.internal.ui.JavaPlugin.startup",
          "source": "JavaPlugin.java:183"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor$1.run",
          "source": "PluginDescriptor.java:694"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:831"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.internalDoPluginActivation",
          "source": "PluginDescriptor.java:706"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation",
          "source": "PluginDescriptor.java:186"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginClassLoader.activatePlugin",
          "source": "PluginClassLoader.java:58"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginClassLoader.findClassParentsSelf",
          "source": "PluginClassLoader.java:136"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLClassLoader.java:750"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.access$0",
          "source": "DelegatingURLClassLoader.java:744"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader$DelegateLoader.loadClass",
          "source": "DelegatingURLClassLoader.java:70"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.findClassPrerequisites",
          "source": "DelegatingURLClassLoader.java:429"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLClassLoader.java:758"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLClassLoader.java:730"
        },
        {
          "method": "java.lang.ClassLoader.loadClass",
          "source": "ClassLoader.java:262"
        },
        {
          "method": "java.lang.ClassLoader.loadClassInternal",
          "source": "ClassLoader.java:322"
        },
        {
          "method": "org.test.jdtui.load.LoadPlugin.earlyStartup",
          "source": "LoadPlugin.java:72"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$10.run",
          "source": "Workbench.java:1115"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:831"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:416"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$9.run",
          "source": "Workbench.java:1122"
        },
        {
          "method": "java.lang.Thread.run",
          "source": "Thread.java:536"
        }
      ],
      "causedBy": {
        "exceptionType": "org.eclipse.swt.SWTException",
        "message": "Invalid thread access",
        "elements": [
          {
            "method": "org.eclipse.swt.SWT.error",
            "source": "SWT.java:2119"
          },
          {
            "method": "org.eclipse.swt.SWT.error",
            "source": "SWT.java:2051"
          },
          {
            "method": "org.eclipse.swt.widgets.Display.error",
            "source": "Display.java:503"
          },
          {
            "method": "org.eclipse.swt.widgets.Display.checkDevice",
            "source": "Display.java:370"
          },
          {
            "method": "org.eclipse.swt.widgets.Display.disposeExec",
            "source": "Display.java:480"
          },
          {
            "method": "org.eclipse.jdt.internal.ui.viewsupport.ImageDescriptorRegistry.hookDisplay",
            "source": "ImageDescriptorRegistry.java:79"
          },
          {
            "method": "org.eclipse.jdt.internal.ui.viewsupport.ImageDescriptorRegistry.\u003cinit\u003e",
            "source": "ImageDescriptorRegistry.java:42"
          },
          {
            "method": "org.eclipse.jdt.internal.ui.viewsupport.ImageDescriptorRegistry.\u003cinit\u003e",
            "source": "ImageDescriptorRegistry.java:30"
          },
          {
            "method": "org.eclipse.jdt.internal.ui.JavaPlugin.internalGetImageDescriptorRegistry",
            "source": "JavaPlugin.java:317"
          },
          {
            "method": "org.eclipse.jdt.internal.ui.JavaPlugin.getImageDescriptorRegistry",
            "source": "JavaPlugin.java:170"
          },
          {
            "method": "org.eclipse.jdt.internal.ui.viewsupport.JavaElementImageProvider.\u003cinit\u003e",
            "source": "JavaElementImageProvider.java:79"
          },
          {
            "method": "org.eclipse.jdt.internal.ui.JavaWorkbenchAdapter.\u003cinit\u003e",
            "source": "JavaWorkbenchAdapter.java:32"
          },
          {
            "method": "org.eclipse.jdt.internal.ui.JavaElementAdapterFactory.\u003cclinit\u003e",
            "source": "JavaElementAdapterFactory.java:53"
          }
        ],
        "number": 0,
        "commentIndex": 0
      },
      "number": 0,
      "commentIndex": 2,
      "bugId": "22164",
      "date": "2002-08-05T15:44:46+02:00",
      "product": "JDT",
      "component": "UI",
      "severity": "normal"
    },
    {
      "exceptionType": "org.eclipse.core.runtime.CoreException",
      "message": "Problems encountered starting up plug- in: \"org.eclipse.jdt.ui\".",
      "elements": [
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.internalDoPluginActivation",
          "source": "PluginDescriptor.java:712"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation",
          "source": "PluginDescriptor.java:186"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginClassLoader.activatePlugin",
          "source": "PluginClassLoader.java:58"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginClassLoader.findClassParentsSelf",
          "source": "PluginClassLoader.java:136"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLClassLoader.java:750"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.access$0",
          "source": "DelegatingURLClassLoader.java:744"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader$DelegateLoader.loadClass",
          "source": "DelegatingURLClassLoader.java:70"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.findClassPrerequisites",
          "source": "DelegatingURLClassLoader.java:429"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLClassLoader.java:758"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLClassLoader.java:730"
        },
        {
          "method": "java.lang.ClassLoader.loadClass",
          "source": "ClassLoader.java:262"
        },
        {
          "method": "java.lang.ClassLoader.loadClassInternal",
          "source": "ClassLoader.java:322"
        },
        {
          "method": "org.test.jdtui.load.LoadPlugin.earlyStartup",
          "source": "LoadPlugin.java:72"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$10.run",
          "source": "Workbench.java:1115"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:831"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:416"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$9.run",
          "source": "Workbench.java:1122"
        },
        {
          "method": "java.lang.Thread.run",
          "source": "Thread.java:536"
        }
      ],
      "number": 1,
      "commentIndex": 2,
      "bugId": "22164",
      "date": "2002-08-05T15:44:46+02:00",
      "product": "JDT",
      "component": "UI",
      "severity": "normal"
    },
    {
      "exceptionType": "org.eclipse.core.runtime.CoreException",
      "message": "Problems encountered starting up plug- in: \"org.eclipse.jdt.ui\".",
      "elements": [
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.internalDoPluginActivation",
          "source": "PluginDescriptor.java:712"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginDescriptor.doPluginActivation",
          "source": "PluginDescriptor.java:186"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginClassLoader.activatePlugin",
          "source": "PluginClassLoader.java:58"
        },
        {
          "method": "org.eclipse.core.internal.plugins.PluginClassLoader.findClassParentsSelf",
          "source": "PluginClassLoader.java:136"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLClassLoader.java:750"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.access$0",
          "source": "DelegatingURLClassLoader.java:744"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader$DelegateLoader.loadClass",
          "source": "DelegatingURLClassLoader.java:70"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.findClassPrerequisites",
          "source": "DelegatingURLClassLoader.java:429"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLClassLoader.java:758"
        },
        {
          "method": "org.eclipse.core.internal.boot.DelegatingURLClassLoader.loadClass",
          "source": "DelegatingURLClassLoader.java:730"
        },
        {
          "method": "java.lang.ClassLoader.loadClass",
          "source": "ClassLoader.java:262"
        },
        {
          "method": "java.lang.ClassLoader.loadClassInternal",
          "source": "ClassLoader.java:322"
        },
        {
          "method": "org.test.jdtui.load.LoadPlugin.earlyStartup",
          "source": "LoadPlugin.java:72"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$10.run",
          "source": "Workbench.java:1115"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:831"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:416"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$9.run",
          "source": "Workbench.java:1122"
        },
        {
          "method": "java.lang.Thread.run",
          "source": "Thread.java:536"
        }
      ],
      "number": 2,
      "commentIndex": 2,
      "bugId": "22164",
      "date": "2002-08-05T15:44:46+02:00",
      "product": "JDT",
      "component": "UI",
      "severity": "normal"
    }
  ],
  "groupId": "22164",
  "bugId": "22164",
  "date": "2002-08-05T15:42:09+02:00",
  "product": "JDT",
  "component": "UI",
  "severity": "normal"
}