{
  "comments": [
    "I\u0027ve encountered a problem with the 2.1 M5 build.   When I open one of the \nEMF-based editors, I get a very long series of errors like this:\n\nCould not create action delegate.\nReason:\nAction must implement IEditorActionDelegate\n\nThis provides no information about the action involved nor about what was going \non at the time.  With some difficulty I tracked it to EditPluginAction.java:\n\n    protected IActionDelegate validateDelegate(Object obj) throws \nWorkbenchException {\n        if (obj instanceof IEditorActionDelegate)\n            return (IEditorActionDelegate)obj;\n        else\n        {\n            Thread.dumpStack();\n            System.err.println(\"#1#\" + getId());\n            System.err.println(\"#2#\" + obj);\n            System.err.println(\"#3#\" + obj.getClass());\n            throw new WorkbenchException(\"Action must implement \nIEditorActionDelegate\"); //$NON-NLS-1$\n        }\n    }\n\nI added the dump and the print to get more information.\n\nHere\u0027s what\u0027s on the stack at the time:\n\njava.lang.Exception: Stack trace\n\tat java.lang.Thread.dumpStack(Thread.java:1007)\n\tat \norg.eclipse.ui.internal.EditorPluginAction.validateDelegate(EditorPluginAction.j\nava:56)\n\tat \norg.eclipse.ui.internal.PluginAction.createDelegate(PluginAction.java:104)\n\tat \norg.eclipse.ui.internal.PluginAction.selectionChanged(PluginAction.java:269)\n\tat org.eclipse.ui.internal.PluginAction.\u003cinit\u003e(PluginAction.java:94)\n\tat \norg.eclipse.ui.internal.PartPluginAction.\u003cinit\u003e(PartPluginAction.java:30)\n\tat \norg.eclipse.ui.internal.EditorPluginAction.\u003cinit\u003e(EditorPluginAction.java:43)\n\tat \norg.eclipse.ui.internal.ActionDescriptor.createAction(ActionDescriptor.java:184)\n\tat \norg.eclipse.ui.internal.ActionDescriptor.\u003cinit\u003e(ActionDescriptor.java:120)\n\tat \norg.eclipse.ui.internal.ViewerActionBuilder.createActionDescriptor(ViewerActionB\nuilder.java:48)\n\tat \norg.eclipse.ui.internal.PluginActionBuilder.readElement(PluginActionBuilder.java\n:152)\n\tat \norg.eclipse.ui.internal.ViewerActionBuilder.readElement(ViewerActionBuilder.java\n:75)\n\tat \norg.eclipse.ui.internal.registry.RegistryReader.readElements(RegistryReader.java\n(Compiled Code))\n\tat \norg.eclipse.ui.internal.registry.RegistryReader.readElementChildren(RegistryRead\ner.java:117)\n\tat \norg.eclipse.ui.internal.PluginActionBuilder.readElement(PluginActionBuilder.java\n:135)\n\tat \norg.eclipse.ui.internal.ViewerActionBuilder.readElement(ViewerActionBuilder.java\n:75)\n\tat \norg.eclipse.ui.internal.registry.RegistryReader.readElements(RegistryReader.java\n(Compiled Code))\n\tat \norg.eclipse.ui.internal.registry.RegistryReader.readExtension(RegistryReader.jav\na:136)\n\tat \norg.eclipse.ui.internal.registry.RegistryReader.readRegistry(RegistryReader.java\n:148)\n\tat \norg.eclipse.ui.internal.PluginActionBuilder.readContributions(PluginActionBuilde\nr.java:108)\n\tat \norg.eclipse.ui.internal.ViewerActionBuilder.readViewerContributions(ViewerAction\nBuilder.java:91)\n\tat \norg.eclipse.ui.internal.PopupMenuExtender.readStaticActions(PopupMenuExtender.ja\nva:76)\n\tat \norg.eclipse.ui.internal.PopupMenuExtender.\u003cinit\u003e(PopupMenuExtender.java:39)\n\tat \norg.eclipse.ui.internal.PartSite.registerContextMenu(PartSite.java:151)\n\tat \norg.eclipse.emf.ecore.presentation.EcoreEditor.createContextMenuFor(EcoreEditor.\njava:785)\n\tat \norg.eclipse.emf.ecore.presentation.EcoreEditor.createPages(EcoreEditor.java:851)\n\tat \norg.eclipse.ui.part.MultiPageEditorPart.createPartControl(MultiPageEditorPart.ja\nva:160)\n\tat org.eclipse.ui.internal.PartPane$4.run(PartPane.java:138)\n\tat \norg.eclipse.core.internal.runtime.InternalPlatform.run(InternalPlatform.java:867\n)\n\tat org.eclipse.core.runtime.Platform.run(Platform.java:413)\n\tat \norg.eclipse.ui.internal.PartPane.createChildControl(PartPane.java:134)\n\tat org.eclipse.ui.internal.PartPane.createControl(PartPane.java:183)\n\tat \norg.eclipse.ui.internal.EditorWorkbook.createPage(EditorWorkbook.java:393)\n\tat org.eclipse.ui.internal.EditorWorkbook.add(EditorWorkbook.java:95)\n\tat org.eclipse.ui.internal.EditorArea.addEditor(EditorArea.java:49)\n\tat \norg.eclipse.ui.internal.EditorPresentation.openEditor(EditorPresentation.java:35\n2)\n\tat org.eclipse.ui.internal.EditorManager$2.run(EditorManager.java:556)\n\tat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:65)\n\tat \norg.eclipse.ui.internal.EditorManager.createEditorTab(EditorManager.java:545)\n\tat \norg.eclipse.ui.internal.EditorManager.openInternalEditor(EditorManager.java:639)\n\tat \norg.eclipse.ui.internal.EditorManager.openEditorFromDescriptor(EditorManager.jav\na:430)\n\tat \norg.eclipse.ui.internal.EditorManager.openEditor(EditorManager.java:402)\n\tat \norg.eclipse.ui.internal.WorkbenchPage.openEditor(WorkbenchPage.java:1988)\n\tat \norg.eclipse.ui.internal.WorkbenchPage.openEditor(WorkbenchPage.java:1836)\n\tat org.eclipse.ui.actions.OpenWithMenu.openEditor(OpenWithMenu.java:223)\n\tat org.eclipse.ui.actions.OpenWithMenu.access$000(OpenWithMenu.java:38)\n\tat \norg.eclipse.ui.actions.OpenWithMenu$2.handleEvent(OpenWithMenu.java:148)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java(Compiled \nCode))\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:836)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:1692)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:1410)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1289)\n\tat org.eclipse.ui.internal.Workbench.run(Workbench.java:1272)\n\tat \norg.eclipse.core.internal.boot.InternalBootLoader.run(InternalBootLoader.java:84\n5)\n\tat org.eclipse.core.boot.BootLoader.run(BootLoader.java:461)\n\tat java.lang.reflect.Method.invoke(Native Method)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:247)\n\tat org.eclipse.core.launcher.Main.run(Main.java:703)\n\tat org.eclipse.core.launcher.Main.main(Main.java:539)\n\nIt prints out information like this:\n\n#1#PluginAction.65\n#2#org.eclipse.debug.internal.ui.actions.CopyToClipboardActionDelegate@53f54a7\n#3#class org.eclipse.debug.internal.ui.actions.CopyToClipboardActionDelegate\n\nThis is what the EMF code is doing:\n\n  protected void createContextMenuFor(StructuredViewer viewer)\n  {\n    MenuManager contextMenu \u003d new MenuManager(\"#PopUp\");\n    contextMenu.add(new Separator(\"additions\"));\n    contextMenu.setRemoveAllWhenShown(true);\n    contextMenu.addMenuListener(this);\n    Menu menu\u003d contextMenu.createContextMenu(viewer.getControl());\n    viewer.getControl().setMenu(menu);\n    getSite().registerContextMenu(contextMenu.getId(), contextMenu, viewer);\n\nThis code worked on 2.0.3 but with 2.1 it doesn\u0027t.  \n\nIf I change it to this:\n\ngetSite().registerContextMenu(contextMenu, viewer);\n\nthe problem goes away.  So I\u0027m finally happy now, but there may be a lurking bug \nthat other clients will encounter later or maybe I\u0027ve been misusing the API all \nalong...",
    "It\u0027s better to use the part id to register the context menu (which you get by \nusing the new method) rather than a generic string like \"#PopUp\", since there\u0027s \nless chance of a conflict.\n\nCopyToClipboardActionDelegate does not implement IEditorActionDelegate.\nNot sure if it did in the past, but it shouldn\u0027t need to since it\u0027s only \ncontributed to the Debug view.\n\nThe contribution in org.eclipse.debug.ui lists org.eclipse.debug.ui.DebugView \nas the target id, so I wouldn\u0027t expect it to get processed at all for a context \nmenu registered against \"#PopUp\".\n\nDid we used to treat \"#PopUp\" differently, e.g. take it to mean the part\u0027s id?\n\nIn any case, the error reporting here could be much improved.\n\n\n\n\n",
    "Ed, could you search all the plugin.xml for those that \ncontain \"CopyToClipboardActionDelegate\" in them? And attach them to this PR as \nsoon as possible.\n\nI\u0027ve updated the code to include the action id in the error message. I know of \nnot code where we use #PopUp to mean something special.",
    "Simon,\n\nAll the \"problem actions\" are from the platform itself, so you don\u0027t need to get \nthem from me:\n\n\u003e grep CopyToClipboardActionDelegate plugins/*/plugin.xml\nplugins/org.eclipse.debug.ui_2.1.0/plugin.xml:               \nclass\u003d\"org.eclipse.debug.internal.ui.actions.CopyToClipboardActionDelegate\"\u0027\n\nIt seems you should be able to produce this with any example that\u0027s using \nregisterContextMenu already.  I.e., the first call here works, but the second \ncall gives a long list of IEditorActionDelgate errors (for platform actions):\n\n    //getSite().registerContextMenu(getSite().getId(), contextMenu, viewer);\n    getSite().registerContextMenu(contextMenu.getId(), contextMenu, viewer);\n\n",
    "Created a simple plugin with a view to reproduce this problem.\n\nThe call \"registerContextMenu(contextMenu.getId(), contextMenu, viewer)\" \nactually passes a null for the id. The call \"contextMenu.getId()\" returns null \nbecause no id was ever set on the MenuManager. The argument past to the \nMenuManager constructor is the title, not the id. The method \nregisterContextMenu expects a valid menu id. In 2.0.x, plugin developers were \njust lucky. I\u0027ve now added a check in the context menu extender to not attempt \nany static contributions if no menu id was provided. Object contributions are \nstill allowed as they are not depended on the menu id.",
    "I looked in the debug/ext tools code, and we have 4 references to \"#PopUp\". For \nexample, in AbstractDebugView:\n\n\tMenuManager menuMgr\u003d new MenuManager(\"#PopUp\"); //$NON-NLS-1$\n\tmenuMgr.setRemoveAllWhenShown(true);\n\tmenuMgr.addMenuListener(new IMenuListener() {\n\t\tpublic void menuAboutToShow(IMenuManager mgr) {\n\t\t\tfillContextMenu(mgr);\n\t\t}\n\t});\n\nWill we be broken?",
    "The \"#PopUp\" text your are passing to the MenuManager is just its title. Unless \nyou were using the results of MenuManager.getId() as the id to register your \ncontext menu, there should be no problem. We recommend that developers use the \n2 argument version of registerContextMenu since it uses the part id to register \nthe menu against. Only when your part has more than one context menu should it \nuse the 3 argument version of registerContextMenu. And in that case, the id \npassed in should be fully qualified (we recommend using the part id as the \nprefix)."
  ],
  "commentCreationDates": [
    "2003-02-25T21:41:25+01:00",
    "2003-02-26T05:10:27+01:00",
    "2003-03-03T20:28:36+01:00",
    "2003-03-03T21:15:34+01:00",
    "2003-03-04T16:18:11+01:00",
    "2003-03-05T16:44:17+01:00",
    "2003-03-05T17:14:29+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.Exception",
      "message": "Stack trace",
      "elements": [
        {
          "method": "java.lang.Thread.dumpStack",
          "source": "Thread.java:1007"
        },
        {
          "method": "org.eclipse.ui.internal.EditorPluginAction.validateDelegate",
          "source": "EditorPluginAction.j ava:56"
        },
        {
          "method": "org.eclipse.ui.internal.PluginAction.createDelegate",
          "source": "PluginAction.java:104"
        },
        {
          "method": "org.eclipse.ui.internal.PluginAction.selectionChanged",
          "source": "PluginAction.java:269"
        },
        {
          "method": "org.eclipse.ui.internal.PluginAction.\u003cinit\u003e",
          "source": "PluginAction.java:94"
        },
        {
          "method": "org.eclipse.ui.internal.PartPluginAction.\u003cinit\u003e",
          "source": "PartPluginAction.java:30"
        },
        {
          "method": "org.eclipse.ui.internal.EditorPluginAction.\u003cinit\u003e",
          "source": "EditorPluginAction.java:43"
        },
        {
          "method": "org.eclipse.ui.internal.ActionDescriptor.createAction",
          "source": "ActionDescriptor.java:184"
        },
        {
          "method": "org.eclipse.ui.internal.ActionDescriptor.\u003cinit\u003e",
          "source": "ActionDescriptor.java:120"
        },
        {
          "method": "org.eclipse.ui.internal.ViewerActionBuilder.createActionDescriptor",
          "source": "ViewerActionB uilder.java:48"
        },
        {
          "method": "org.eclipse.ui.internal.PluginActionBuilder.readElement",
          "source": "PluginActionBuilder.java :152"
        },
        {
          "method": "org.eclipse.ui.internal.ViewerActionBuilder.readElement",
          "source": "ViewerActionBuilder.java :75"
        },
        {
          "method": "org.eclipse.ui.internal.registry.RegistryReader.readElements",
          "source": "RegistryReader.java (Compiled Code)"
        },
        {
          "method": "org.eclipse.ui.internal.registry.RegistryReader.readElementChildren",
          "source": "RegistryRead er.java:117"
        },
        {
          "method": "org.eclipse.ui.internal.PluginActionBuilder.readElement",
          "source": "PluginActionBuilder.java :135"
        },
        {
          "method": "org.eclipse.ui.internal.ViewerActionBuilder.readElement",
          "source": "ViewerActionBuilder.java :75"
        },
        {
          "method": "org.eclipse.ui.internal.registry.RegistryReader.readElements",
          "source": "RegistryReader.java (Compiled Code)"
        },
        {
          "method": "org.eclipse.ui.internal.registry.RegistryReader.readExtension",
          "source": "RegistryReader.jav a:136"
        },
        {
          "method": "org.eclipse.ui.internal.registry.RegistryReader.readRegistry",
          "source": "RegistryReader.java :148"
        },
        {
          "method": "org.eclipse.ui.internal.PluginActionBuilder.readContributions",
          "source": "PluginActionBuilde r.java:108"
        },
        {
          "method": "org.eclipse.ui.internal.ViewerActionBuilder.readViewerContributions",
          "source": "ViewerAction Builder.java:91"
        },
        {
          "method": "org.eclipse.ui.internal.PopupMenuExtender.readStaticActions",
          "source": "PopupMenuExtender.ja va:76"
        },
        {
          "method": "org.eclipse.ui.internal.PopupMenuExtender.\u003cinit\u003e",
          "source": "PopupMenuExtender.java:39"
        },
        {
          "method": "org.eclipse.ui.internal.PartSite.registerContextMenu",
          "source": "PartSite.java:151"
        },
        {
          "method": "org.eclipse.emf.ecore.presentation.EcoreEditor.createContextMenuFor",
          "source": "EcoreEditor. java:785"
        },
        {
          "method": "org.eclipse.emf.ecore.presentation.EcoreEditor.createPages",
          "source": "EcoreEditor.java:851"
        },
        {
          "method": "org.eclipse.ui.part.MultiPageEditorPart.createPartControl",
          "source": "MultiPageEditorPart.ja va:160"
        },
        {
          "method": "org.eclipse.ui.internal.PartPane$4.run",
          "source": "PartPane.java:138"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:867 "
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:413"
        },
        {
          "method": "org.eclipse.ui.internal.PartPane.createChildControl",
          "source": "PartPane.java:134"
        },
        {
          "method": "org.eclipse.ui.internal.PartPane.createControl",
          "source": "PartPane.java:183"
        },
        {
          "method": "org.eclipse.ui.internal.EditorWorkbook.createPage",
          "source": "EditorWorkbook.java:393"
        },
        {
          "method": "org.eclipse.ui.internal.EditorWorkbook.add",
          "source": "EditorWorkbook.java:95"
        },
        {
          "method": "org.eclipse.ui.internal.EditorArea.addEditor",
          "source": "EditorArea.java:49"
        },
        {
          "method": "org.eclipse.ui.internal.EditorPresentation.openEditor",
          "source": "EditorPresentation.java:35 2"
        },
        {
          "method": "org.eclipse.ui.internal.EditorManager$2.run",
          "source": "EditorManager.java:556"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:65"
        },
        {
          "method": "org.eclipse.ui.internal.EditorManager.createEditorTab",
          "source": "EditorManager.java:545"
        },
        {
          "method": "org.eclipse.ui.internal.EditorManager.openInternalEditor",
          "source": "EditorManager.java:639"
        },
        {
          "method": "org.eclipse.ui.internal.EditorManager.openEditorFromDescriptor",
          "source": "EditorManager.jav a:430"
        },
        {
          "method": "org.eclipse.ui.internal.EditorManager.openEditor",
          "source": "EditorManager.java:402"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchPage.openEditor",
          "source": "WorkbenchPage.java:1988"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchPage.openEditor",
          "source": "WorkbenchPage.java:1836"
        },
        {
          "method": "org.eclipse.ui.actions.OpenWithMenu.openEditor",
          "source": "OpenWithMenu.java:223"
        },
        {
          "method": "org.eclipse.ui.actions.OpenWithMenu.access$000",
          "source": "OpenWithMenu.java:38"
        },
        {
          "method": "org.eclipse.ui.actions.OpenWithMenu$2.handleEvent",
          "source": "OpenWithMenu.java:148"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java(Compiled  Code)"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:836"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:1692"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:1410"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1289"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.run",
          "source": "Workbench.java:1272"
        },
        {
          "method": "org.eclipse.core.internal.boot.InternalBootLoader.run",
          "source": "InternalBootLoader.java:84 5"
        },
        {
          "method": "org.eclipse.core.boot.BootLoader.run",
          "source": "BootLoader.java:461"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:247"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:703"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:539"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "33140",
      "date": "2003-02-25T21:41:25+01:00",
      "product": "Platform",
      "component": "UI",
      "severity": "major"
    }
  ],
  "groupId": "33140",
  "bugId": "33140",
  "date": "2003-02-25T21:41:25+01:00",
  "product": "Platform",
  "component": "UI",
  "severity": "major"
}