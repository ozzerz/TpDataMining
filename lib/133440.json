{
  "comments": [
    "The following invalid annotation is accepted as legitimate:\n\npublic @interface MyAnnotation {\n   \n    enum MyEnum\n    {\n        VAL_1, VAL_2\n    }\n   \n    public MyEnum theValue() default null; //\u003c-- this should not be allowed\n}\n\nTo compound the problem, if you call MethodBinding.getDefaultValue() on that method, you get an IllegalStateException.\n\njava.lang.IllegalStateException: java.lang.Object@b3a420\nat org.eclipse.jdt.core.dom.ResolvedMemberValuePair.buildDOMValue(ResolvedMemberValuePair.java:91)\nat org.eclipse.jdt.core.dom.MethodBinding.getDefaultValue(MethodBinding.java:451)",
    "The null case is not checked in the enum case.\n",
    "Created an attachment (id\u003d37042)\nProposed fix\n\n",
    "Created an attachment (id\u003d37043)\nCorresponding regression test\n\n",
    "Fix looks good",
    "Fixed and released in HEAD.\nRegression test in org.eclipse.jdt.core.tests.compiler.regression.AnnotationTest.test196",
    "After this fix, will a call to getDefaultValue() on a method with an invalid null default still throw a IllegalStateException?",
    "Yes, since null should not happen.",
    "I could not get the IllegalStateException with or without the fix on a 3.2 build.\nnull is returned instead.",
    "We are still seeing the exception. I should have made this clear: I cut off the stack trace so it is:\n\njava.lang.IllegalStateException: java.lang.Object@b3a420\nat\norg.eclipse.jdt.core.dom.ResolvedMemberValuePair.buildDOMValue(ResolvedMemberValuePair.java:91)\nat\norg.eclipse.jdt.core.dom.MethodBinding.getDefaultValue(MethodBinding.java:451)\nat ...\n\nwhere \"...\" is external (non-JDT) code calling in. I think any time code calls getDefaultValue() on an invalid null default value. This is a problem, because even though the code is not valid, it can still show up in source.\n\nAre you seeing something different?",
    "What version are you using? I don\u0027t have the class org.eclipse.jdt.core.dom.ResolvedMemberValuePair anymore. It is now called org.eclipse.jdt.core.dom.MemberValuePairBinding.",
    "Verified for 3.2 M6 using build I20060329-0010.",
    "Dan was using the APT branch of jdt.core (3.1.2). Looking at the latest in HEAD, the same problem still exists: an IllegalStateException could be thrown if the user\u0027s source code is invalid.\n\nI\u0027ll attach a proposed fix for the IllegalStateException: return null instead.",
    "Created an attachment (id\u003d37224)\nFix for IllegalStateException\n\n",
    "Fixed and released in HEAD.",
    "Verified. There is nothing more to verify that what was done before."
  ],
  "commentCreationDates": [
    "2006-03-28T00:01:50+02:00",
    "2006-03-28T05:17:18+02:00",
    "2006-03-28T05:18:03+02:00",
    "2006-03-28T05:20:51+02:00",
    "2006-03-28T11:46:58+02:00",
    "2006-03-28T15:46:26+02:00",
    "2006-03-28T20:43:02+02:00",
    "2006-03-28T20:45:58+02:00",
    "2006-03-28T21:02:28+02:00",
    "2006-03-28T21:55:57+02:00",
    "2006-03-29T03:17:59+02:00",
    "2006-03-29T11:42:03+02:00",
    "2006-03-29T20:00:51+02:00",
    "2006-03-29T20:01:18+02:00",
    "2006-03-29T20:09:27+02:00",
    "2006-03-29T20:09:51+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.IllegalStateException",
      "message": "java.lang.Object@b3a420",
      "elements": [
        {
          "method": "org.eclipse.jdt.core.dom.ResolvedMemberValuePair.buildDOMValue",
          "source": "ResolvedMemberValuePair.java:91"
        },
        {
          "method": "org.eclipse.jdt.core.dom.MethodBinding.getDefaultValue",
          "source": "MethodBinding.java:451"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "133440",
      "date": "2006-03-28T00:01:50+02:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.IllegalStateException",
      "message": "java.lang.Object@b3a420",
      "elements": [
        {
          "method": "org.eclipse.jdt.core.dom.ResolvedMemberValuePair.buildDOMValue",
          "source": "ResolvedMemberValuePair.java:91"
        },
        {
          "method": "org.eclipse.jdt.core.dom.MethodBinding.getDefaultValue",
          "source": "MethodBinding.java:451"
        }
      ],
      "number": 1,
      "commentIndex": 9,
      "bugId": "133440",
      "date": "2006-03-28T21:55:57+02:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    }
  ],
  "groupId": "133440",
  "bugId": "133440",
  "date": "2006-03-28T00:01:50+02:00",
  "product": "JDT",
  "component": "Core",
  "severity": "normal"
}