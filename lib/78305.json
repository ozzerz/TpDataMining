{
  "comments": [
    "Steps to reproduce:\n1) Create a new class using the New Java Class toolbar option. It doesn\u0027t matter\nwhat name it is or what package it\u0027s in. Be sure to check the \"public static\nvoid main(String[] args)\" checkbox.\n\n2) After the class comes up in the editor, hit enter a few times to make some\nroom at the top of the file.\n\n3) Paste in a big chunk of Python. Not all chunks cause this problem, but I can\nget repeatable results using request.py from the MoinMoin wiki distribution\n(v1.2.4), available at http://moinmoin.wikiwikiweb.de/MoinMoinDownload. Save the\nfile to force compilation.\n\n4) Eclipse pops up an error dialog that reads, \"An internal error occurred\nduring: \"Java AST creation\". The .log contains:\n\n\n!ENTRY org.eclipse.core.runtime 4 2 2004-11-10 10:02:31.340\n!MESSAGE An internal error occurred during: \"Java AST creation\".\n!STACK 0\njava.lang.IllegalArgumentException\n\tat org.eclipse.jdt.core.dom.ASTNode.setSourceRange(ASTNode.java:2583)\n\tat\norg.eclipse.jdt.core.dom.ASTConverter.checkAndAddMultipleFieldDeclaration(ASTConverter.java:497)\n\tat\norg.eclipse.jdt.core.dom.ASTConverter.buildBodyDeclarations(ASTConverter.java:442)\n\tat org.eclipse.jdt.core.dom.ASTConverter.convert(ASTConverter.java:2545)\n\tat org.eclipse.jdt.core.dom.ASTConverter.convert(ASTConverter.java:1295)\n\tat\norg.eclipse.jdt.core.dom.CompilationUnitResolver.convert(CompilationUnitResolver.java:219)\n\tat org.eclipse.jdt.core.dom.ASTParser.internalCreateAST(ASTParser.java:743)\n\tat org.eclipse.jdt.core.dom.ASTParser.createAST(ASTParser.java:574)\n\tat\norg.eclipse.jdt.internal.ui.javaeditor.ASTProvider.createAST(ASTProvider.java:563)\n\tat org.eclipse.jdt.internal.ui.javaeditor.ASTProvider.getAST(ASTProvider.java:492)\n\tat\norg.eclipse.jdt.internal.ui.viewsupport.SelectionListenerWithASTManager$PartListenerGroup.calculateASTandInform(SelectionListenerWithASTManager.java:165)\n\tat\norg.eclipse.jdt.internal.ui.viewsupport.SelectionListenerWithASTManager$3.run(SelectionListenerWithASTManager.java:142)\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:66)\n\n!ENTRY org.eclipse.ui 4 4 2004-11-10 10:02:32.215\n!MESSAGE Unhandled event loop exception\n\n!ENTRY org.eclipse.ui 4 0 2004-11-10 10:02:32.231\n!MESSAGE Failed to execute runnable (java.lang.NullPointerException)\n!STACK 0\norg.eclipse.swt.SWTException: Failed to execute runnable\n(java.lang.NullPointerException)\n\tat org.eclipse.swt.SWT.error(SWT.java:2697)\n\tat org.eclipse.swt.SWT.error(SWT.java:2622)\n\tat org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:121)\n\tat org.eclipse.swt.widgets.Display.runAsyncMessages(Display.java:2771)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2451)\n\tat org.eclipse.jface.window.Window.runEventLoop(Window.java:718)\n\tat org.eclipse.jface.window.Window.open(Window.java:696)\n\tat org.eclipse.jface.dialogs.ErrorDialog.open(ErrorDialog.java:274)\n\tat\norg.eclipse.ui.internal.progress.ErrorNotificationManager.openErrorDialog(ErrorNotificationManager.java:153)\n\tat\norg.eclipse.ui.internal.progress.ErrorNotificationManager.access$2(ErrorNotificationManager.java:139)\n\tat\norg.eclipse.ui.internal.progress.ErrorNotificationManager$2.runInUIThread(ErrorNotificationManager.java:113)\n\tat org.eclipse.ui.progress.UIJob$1.run(UIJob.java:96)\n\tat org.eclipse.swt.widgets.RunnableLock.run(RunnableLock.java:35)\n\tat org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:118)\n\tat org.eclipse.swt.widgets.Display.runAsyncMessages(Display.java:2771)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2451)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1529)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1500)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:276)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:144)\n\tat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:102)\n\tat\norg.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:335)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:273)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:129)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:185)\n\tat org.eclipse.core.launcher.Main.run(Main.java:704)\n\tat org.eclipse.core.launcher.Main.main(Main.java:688)\n\n!ENTRY org.eclipse.ui 4 4 2004-11-10 10:02:32.231\n!MESSAGE *** SWT nested exception\n\n\n\nThe workaround is to ignore the dialog and edit the file behind it (since the\nerror dialog is not modal) and remove the offending Python code.",
    "Created an attachment (id\u003d15778)\nrequest.py from MoinMoin wiki v1.2.4\n\nThis file is a sort of \"exploit\" for this bug.",
    "David, this is due to the initializer inserted in the\nRecoveredUnit.add(AbstractMethodDeclaration methodDeclaration, int\nbracketBalanceValue). I don\u0027t understand why we create this initializer in case\nstart is 0. This means that the current type has not yet been closed.\nMoreover when we create the initializer we do:\n\t\t\tinitializer.declarationSourceStart \u003d end;\n\t\t\tinitializer.declarationSourceEnd \u003d start;\nThis looks suspicious. Its declarationSourceStart is greater than the\ncorresponding end.\nI will attach a test case.\nCould you please have a look?\n\nIf you replace that method with:\npublic RecoveredElement add(AbstractMethodDeclaration methodDeclaration, int\nbracketBalanceValue) {\n\n\t/* attach it to last type - if any */\n\tif (this.typeCount \u003e 0){\n\t\tRecoveredType type \u003d this.types[this.typeCount -1];\n\t\tint start \u003d type.bodyEnd;\n\t\tint end \u003d type.typeDeclaration.bodyEnd;\n\t\ttype.bodyEnd \u003d 0; // reset position\n\t\ttype.typeDeclaration.declarationSourceEnd \u003d 0; // reset position\n\t\ttype.typeDeclaration.bodyEnd \u003d 0;\n\t\t\n\t\tif(start !\u003d 0 \u0026\u0026 start \u003c end) {\n\t\t\tInitializer initializer \u003d new Initializer(new Block(0), 0);\n\t\t\tinitializer.bodyStart \u003d end;\n\t\t\tinitializer.bodyEnd \u003d end;\n\t\t\tinitializer.declarationSourceStart \u003d end;\n\t\t\tinitializer.declarationSourceEnd \u003d start;\n\t\t\ttype.add(initializer, bracketBalanceValue);\n\t\t}\n\t\t\n\t\treturn type.add(methodDeclaration, bracketBalanceValue);\n\t}\n\treturn this; // ignore\n}\n\nIt fixes the problem. I tried to fix the positions:\npublic RecoveredElement add(AbstractMethodDeclaration methodDeclaration, int\nbracketBalanceValue) {\n\n\t/* attach it to last type - if any */\n\tif (this.typeCount \u003e 0){\n\t\tRecoveredType type \u003d this.types[this.typeCount -1];\n\t\tint start \u003d type.bodyEnd;\n\t\tint end \u003d type.typeDeclaration.bodyEnd;\n\t\ttype.bodyEnd \u003d 0; // reset position\n\t\ttype.typeDeclaration.declarationSourceEnd \u003d 0; // reset position\n\t\ttype.typeDeclaration.bodyEnd \u003d 0;\n\t\t\n\t\tif(start !\u003d 0 \u0026\u0026 start \u003c end) {\n\t\t\tInitializer initializer \u003d new Initializer(new Block(0), 0);\n\t\t\tinitializer.bodyStart \u003d end;\n\t\t\tinitializer.bodyEnd \u003d end;\n\t\t\tinitializer.declarationSourceStart \u003d start;\n\t\t\tinitializer.declarationSourceEnd \u003d end;\n\t\t\ttype.add(initializer, bracketBalanceValue);\n\t\t}\n\t\t\n\t\treturn type.add(methodDeclaration, bracketBalanceValue);\n\t}\n\treturn this; // ignore\n}\n\nbut in this case, I broke tests in SourceElementParserTest and\nComplianceDiagnoseTest.",
    "Created an attachment (id\u003d15786)\nTest case\n\nI added this tests in ASTConverterTestAST3_2 as test0574.\n\n\t/**\n\t * https://bugs.eclipse.org/bugs/show_bug.cgi?id\u003d78305\n\t */\n\tpublic void test0574() throws JavaModelException {\n\t\tICompilationUnit sourceUnit \u003d getCompilationUnit(\"Converter\",\n\"src\", \"test0574\", \"X.java\"); //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$\n//$NON-NLS-4$\n\t\tASTNode result \u003d runConversion(AST.JLS3, sourceUnit, true);\n\t\tassertEquals(\"not a compilation unit\",\nASTNode.COMPILATION_UNIT, result.getNodeType()); //$NON-NLS-1$\n\t}\n\nI put the test case in the corresponding folder in the workspace resources.",
    "\n\n*** This bug has been marked as a duplicate of 78275 ***",
    "Verified for 3.1 M4 using build I200412140800.\n"
  ],
  "commentCreationDates": [
    "2004-11-10T16:27:34+01:00",
    "2004-11-10T16:28:45+01:00",
    "2004-11-10T22:31:32+01:00",
    "2004-11-10T22:33:20+01:00",
    "2004-11-16T14:52:39+01:00",
    "2004-12-14T15:45:10+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.IllegalArgumentException",
      "elements": [
        {
          "method": "org.eclipse.jdt.core.dom.ASTNode.setSourceRange",
          "source": "ASTNode.java:2583"
        },
        {
          "method": "org.eclipse.jdt.core.dom.ASTConverter.checkAndAddMultipleFieldDeclaration",
          "source": "ASTConverter.java:497"
        },
        {
          "method": "org.eclipse.jdt.core.dom.ASTConverter.buildBodyDeclarations",
          "source": "ASTConverter.java:442"
        },
        {
          "method": "org.eclipse.jdt.core.dom.ASTConverter.convert",
          "source": "ASTConverter.java:2545"
        },
        {
          "method": "org.eclipse.jdt.core.dom.ASTConverter.convert",
          "source": "ASTConverter.java:1295"
        },
        {
          "method": "org.eclipse.jdt.core.dom.CompilationUnitResolver.convert",
          "source": "CompilationUnitResolver.java:219"
        },
        {
          "method": "org.eclipse.jdt.core.dom.ASTParser.internalCreateAST",
          "source": "ASTParser.java:743"
        },
        {
          "method": "org.eclipse.jdt.core.dom.ASTParser.createAST",
          "source": "ASTParser.java:574"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.javaeditor.ASTProvider.createAST",
          "source": "ASTProvider.java:563"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.javaeditor.ASTProvider.getAST",
          "source": "ASTProvider.java:492"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.viewsupport.SelectionListenerWithASTManager$PartListenerGroup.calculateASTandInform",
          "source": "SelectionListenerWithASTManager.java:165"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.viewsupport.SelectionListenerWithASTManager$3.run",
          "source": "SelectionListenerWithASTManager.java:142"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:66"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "78305",
      "duplicateId": "78275",
      "date": "2004-11-10T16:27:34+01:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    },
    {
      "exceptionType": "org.eclipse.swt.SWTException",
      "message": "Failed to execute runnable (java.lang.NullPointerException)",
      "elements": [
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:2697"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:2622"
        },
        {
          "method": "org.eclipse.swt.widgets.Synchronizer.runAsyncMessages",
          "source": "Synchronizer.java:121"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runAsyncMessages",
          "source": "Display.java:2771"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2451"
        },
        {
          "method": "org.eclipse.jface.window.Window.runEventLoop",
          "source": "Window.java:718"
        },
        {
          "method": "org.eclipse.jface.window.Window.open",
          "source": "Window.java:696"
        },
        {
          "method": "org.eclipse.jface.dialogs.ErrorDialog.open",
          "source": "ErrorDialog.java:274"
        },
        {
          "method": "org.eclipse.ui.internal.progress.ErrorNotificationManager.openErrorDialog",
          "source": "ErrorNotificationManager.java:153"
        },
        {
          "method": "org.eclipse.ui.internal.progress.ErrorNotificationManager.access$2",
          "source": "ErrorNotificationManager.java:139"
        },
        {
          "method": "org.eclipse.ui.internal.progress.ErrorNotificationManager$2.runInUIThread",
          "source": "ErrorNotificationManager.java:113"
        },
        {
          "method": "org.eclipse.ui.progress.UIJob$1.run",
          "source": "UIJob.java:96"
        },
        {
          "method": "org.eclipse.swt.widgets.RunnableLock.run",
          "source": "RunnableLock.java:35"
        },
        {
          "method": "org.eclipse.swt.widgets.Synchronizer.runAsyncMessages",
          "source": "Synchronizer.java:118"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runAsyncMessages",
          "source": "Display.java:2771"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2451"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1529"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1500"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:276"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:144"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:102"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:335"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:273"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:129"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:324"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:185"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:704"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:688"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "78305",
      "duplicateId": "78275",
      "date": "2004-11-10T16:27:34+01:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    }
  ],
  "groupId": "78275",
  "bugId": "78305",
  "duplicateId": "78275",
  "date": "2004-11-10T16:27:34+01:00",
  "product": "JDT",
  "component": "Core",
  "severity": "normal"
}