{
  "comments": [
    "Build ID: I20070625-1500\n\nSteps To Reproduce:\nI a using aspectj 1.5.4.200705211336 with Eclipse 3.3 (and AJDT).\n\nIf I have a class in test.aspects package (C1) with a method with an @AspectJ annotation and extend that class in another package, I get several Exceptions (which are caught by Eclipse) when compiling:\n\n1)\norg.aspectj.weaver.BCException\nat org.aspectj.weaver.bcel.BcelShadow.createMethodGen(BcelShadow.java:3479)\nat org.aspectj.weaver.bcel.BcelShadow.extractMethod(BcelShadow.java:3332)\nat org.aspectj.weaver.bcel.BcelShadow.weaveAroundClosure(BcelShadow.java:2993)\nat org.aspectj.weaver.bcel.BcelShadow.weaveAroundInline(BcelShadow.java:2306)\nat org.aspectj.weaver.bcel.BcelAdvice.implementOn(BcelAdvice.java:272)\nat org.aspectj.weaver.Shadow.i ...                 ACONST_NULL\n                    ARETURN\n  end public Object run(Object[])\nend public class test.aspects.C3$InnerClass$AjcClosure1\n\n\n2)\norg.aspectj.weaver.BCException\nat org.aspectj.weaver.bcel.BcelShadow.createMethodGen(BcelShadow.java:3479)\nat org.aspectj.weaver.bcel.BcelShadow.extractMethod(BcelShadow.java:3332)\nat org.aspectj.weaver.bcel.BcelShadow.weaveAroundClosure(BcelShadow.java:2993)\nat org.aspectj.weaver.bcel.BcelShadow.weaveAroundInline(BcelShadow.java:2306)\nat org.aspectj.weaver.bcel.BcelAdvice.implementOn(BcelAdvice.java:272)\nat org.aspectj.weaver.Shadow.i ... nt;)V\n                    ACONST_NULL\n                    ARETURN\n  end public Object run(Object[])\nend public class test.aspects.C3$AjcClosure1\n\n3)\njava.lang.IllegalStateException\nat org.aspectj.weaver.Shadow.getThisType(Shadow.java:94)\nat org.aspectj.weaver.bcel.BcelShadow.createMethodGen(BcelShadow.java:3478)\nat org.aspectj.weaver.bcel.BcelShadow.extractMethod(BcelShadow.java:3332)\nat org.aspectj.weaver.bcel.BcelShadow.weaveAroundClosure(BcelShadow.java:2993)\nat org.aspectj.weaver.bcel.BcelShadow.weaveAroundInline(BcelShadow.java:2306)\nat org.aspectj.weaver.bcel.BcelAdvice.imple ... t;)V\n                    ACONST_NULL\n                    ARETURN\n  end public Object run(Object[])\nend public class test.aspects2.C2$AjcClosure3\n\n\nI will attach a test project that shows the exception\n\nMore information:",
    "Created an attachment (id\u003d74511)\nTest Project\n\nThe files inside of this Jar file should show the problem.",
    "Thanks for the example code.\n\nThe problem occurs because of a generated accessor.  Here is a simpler failing case:\n\n-- a/A.java --\npackage a;\n\npublic class A {\n  protected void m() {}\n}\n\n-- b/B.java --\npackage B;\n\npublic class B extends a.A {\n  protected class Inner {\n    public void foo() {\n      m();\n    }\n  }\n}\n\n-- X.aj --\npublic aspect X {\n  void around(): call(* m()) {}\n}\n--\n\najc -sourceroots .\n\njava.lang.IllegalStateException:\n        at org.aspectj.weaver.Shadow.getThisType(Shadow.java:94)\n        at org.aspectj.weaver.bcel.BcelShadow.createMethodGen(BcelShadow.java:3478)\n        at org.aspectj.weaver.bcel.BcelShadow.extractMethod(BcelShadow.java:3332)\n        at org.aspectj.weaver.bcel.BcelShadow.weaveAroundInline(BcelShadow.java:2351)\n        at org.aspectj.weaver.bcel.BcelAdvice.implementOn(BcelAdvice.java:272)\n\nAn accessor is generated in type B so that the call from the inner class can be made on the protected method in A.  The call to m() from the inner class calls the accessor.  It is the advising of the call made by the accessor method that causes the problem.  The method getThisType() goes bang because the accessor is static and so where the call to method m() is made, there is no \u0027this\u0027.\n\nThere is a related situation for other kinds of advice, however they don\u0027t manifest as a crash like this, they simply don\u0027t match the method call joinpoint when you think they perhaps ought to.  For example:\n\nbefore(): within(B.Inner) \u0026\u0026 call(* m())\n\nwill match if m() is public or not match if m() is protected - since in the protected case the call to m() has been converted to a call to the accessor method that is created in the outer class and the call to m() from the accessor is then *not* within(B.Inner).  From inside the accessor we have no idea who really made the call - so we cannot \u0027recover\u0027 the fact that it was a redirect from the inner type.\n\nSo... I can prevent the crash, that is easy. What to do about the wider issue is more difficult...",
    "fix the crash for 1.5.4 - think about the other problem for 1.6.0"
  ],
  "commentCreationDates": [
    "2007-07-24T23:55:22+02:00",
    "2007-07-24T23:56:34+02:00",
    "2007-10-09T18:34:17+02:00",
    "2007-10-26T14:17:16+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.aspectj.weaver.BCException",
      "elements": [
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.createMethodGen",
          "source": "BcelShadow.java:3479"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.extractMethod",
          "source": "BcelShadow.java:3332"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.weaveAroundClosure",
          "source": "BcelShadow.java:2993"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.weaveAroundInline",
          "source": "BcelShadow.java:2306"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelAdvice.implementOn",
          "source": "BcelAdvice.java:272"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "197719",
      "date": "2007-07-24T23:55:22+02:00",
      "product": "AspectJ",
      "component": "Compiler",
      "severity": "major"
    },
    {
      "exceptionType": "org.aspectj.weaver.BCException",
      "elements": [
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.createMethodGen",
          "source": "BcelShadow.java:3479"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.extractMethod",
          "source": "BcelShadow.java:3332"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.weaveAroundClosure",
          "source": "BcelShadow.java:2993"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.weaveAroundInline",
          "source": "BcelShadow.java:2306"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelAdvice.implementOn",
          "source": "BcelAdvice.java:272"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "197719",
      "date": "2007-07-24T23:55:22+02:00",
      "product": "AspectJ",
      "component": "Compiler",
      "severity": "major"
    },
    {
      "exceptionType": "java.lang.IllegalStateException",
      "elements": [
        {
          "method": "org.aspectj.weaver.Shadow.getThisType",
          "source": "Shadow.java:94"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.createMethodGen",
          "source": "BcelShadow.java:3478"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.extractMethod",
          "source": "BcelShadow.java:3332"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.weaveAroundClosure",
          "source": "BcelShadow.java:2993"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.weaveAroundInline",
          "source": "BcelShadow.java:2306"
        }
      ],
      "number": 2,
      "commentIndex": 0,
      "bugId": "197719",
      "date": "2007-07-24T23:55:22+02:00",
      "product": "AspectJ",
      "component": "Compiler",
      "severity": "major"
    },
    {
      "exceptionType": "java.lang.IllegalStateException",
      "message": "",
      "elements": [
        {
          "method": "org.aspectj.weaver.Shadow.getThisType",
          "source": "Shadow.java:94"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.createMethodGen",
          "source": "BcelShadow.java:3478"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.extractMethod",
          "source": "BcelShadow.java:3332"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelShadow.weaveAroundInline",
          "source": "BcelShadow.java:2351"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelAdvice.implementOn",
          "source": "BcelAdvice.java:272"
        }
      ],
      "number": 3,
      "commentIndex": 2,
      "bugId": "197719",
      "date": "2007-10-09T18:34:17+02:00",
      "product": "AspectJ",
      "component": "Compiler",
      "severity": "major"
    }
  ],
  "groupId": "197719",
  "bugId": "197719",
  "date": "2007-07-24T23:55:22+02:00",
  "product": "AspectJ",
  "component": "Compiler",
  "severity": "major"
}