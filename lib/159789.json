{
  "comments": [
    "This is new in WTP 1.5.1.\n\nIt happens with a JBoss 4 server.\n1) Create an EAR project (with web, ejb and app client project).\n2) Add it to the JBoss 4 server.\n3) Now Remove it again from the server. Choose \"Publish\" in context menu. The ant task for unpublishing runs:\n\"Buildfile: C:\\Temp\\eclipse\\plugins\\org.eclipse.jst.server.generic.jboss_1.5.1.v200609140551\\buildfiles\\jboss323.xml\nundeploy.j2ee.ear:\n   [delete] Deleting: C:\\Temp\\jboss-4.0.5.CR1\\server\\default\\deploy\\TestTest.ear\nBUILD SUCCESSFUL\nTotal time: 219 milliseconds\"\n\n4) Delete the projects from the workspace.\n5) Create a new EAR project.\n6) Add it to the server. Publishing fails with \"Could not publish to server\". One can see several (4 or 5) console windows with ant tasks popping up. The last one is this:\n\"Buildfile: C:\\Temp\\eclipse\\plugins\\org.eclipse.jst.server.generic.jboss_1.5.1.v200609140551\\buildfiles\\jboss323.xml\nundeploy.j2ee.ejb:\nBUILD SUCCESSFUL\nTotal time: 188 milliseconds\"\n\nThe \".log\" contains this:\n!SESSION 2006-10-04 21:30:14.015 -----------------------------------------------\neclipse.buildId\u003dM20060921-0945\njava.version\u003d1.5.0_08\njava.vendor\u003dSun Microsystems Inc.\nBootLoader constants: OS\u003dwin32, ARCH\u003dx86, WS\u003dwin32, NL\u003dde_DE\nCommand-line arguments:  -os win32 -ws win32 -arch x86\n\n!ENTRY org.eclipse.jst.jsp.core 4 4 2006-10-04 21:32:16.828\n!MESSAGE TestTestClient does not exist\n!STACK 1\nJava Model Exception: Java Model Status [TestTestClient does not exist]\n\tat org.eclipse.jdt.internal.core.JavaElement.newNotPresentException(JavaElement.java:485)\n\tat org.eclipse.jdt.internal.core.JavaProject.getUnderlyingResource(JavaProject.java:2284)\n\tat org.eclipse.jdt.internal.core.Openable.getCorrespondingResource(Openable.java:287)\n\tat org.eclipse.jst.jsp.core.taglib.TaglibIndex$ClasspathChangeListener.handleClasspathChange(TaglibIndex.java:142)\n\tat org.eclipse.jst.jsp.core.taglib.TaglibIndex$ClasspathChangeListener.elementChanged(TaglibIndex.java:100)\n\tat org.eclipse.jst.jsp.core.taglib.TaglibIndex$ClasspathChangeListener.elementChanged(TaglibIndex.java:87)\n\tat org.eclipse.jst.jsp.core.taglib.TaglibIndex$ClasspathChangeListener.elementChanged(TaglibIndex.java:72)\n\tat org.eclipse.jdt.internal.core.DeltaProcessor$3.run(DeltaProcessor.java:1458)\n\tat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n\tat org.eclipse.jdt.internal.core.DeltaProcessor.notifyListeners(DeltaProcessor.java:1448)\n\tat org.eclipse.jdt.internal.core.DeltaProcessor.firePostChangeDelta(DeltaProcessor.java:1296)\n\tat org.eclipse.jdt.internal.core.DeltaProcessor.fire(DeltaProcessor.java:1275)\n\tat org.eclipse.jdt.internal.core.DeltaProcessor.resourceChanged(DeltaProcessor.java:1833)\n\tat org.eclipse.jdt.internal.core.DeltaProcessingState.resourceChanged(DeltaProcessingState.java:444)\n\tat org.eclipse.core.internal.events.NotificationManager$2.run(NotificationManager.java:280)\n\tat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n\tat org.eclipse.core.internal.events.NotificationManager.notify(NotificationManager.java:274)\n\tat org.eclipse.core.internal.events.NotificationManager.broadcastChanges(NotificationManager.java:148)\n\tat org.eclipse.core.internal.resources.Workspace.broadcastPostChange(Workspace.java:256)\n\tat org.eclipse.core.internal.resources.Workspace.endOperation(Workspace.java:958)\n\tat org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1746)\n\tat org.eclipse.ui.actions.DeleteResourceAction$3.run(DeleteResourceAction.java:596)\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:58)\n!SUBENTRY 1 org.eclipse.jdt.core 4 969 2006-10-04 21:32:16.828\n!MESSAGE TestTestClient does not exist\n\n!ENTRY org.eclipse.jst.jsp.core 4 4 2006-10-04 21:32:16.828\n!MESSAGE TestTestEJB does not exist\n!STACK 1\nJava Model Exception: Java Model Status [TestTestEJB does not exist]\n\tat org.eclipse.jdt.internal.core.JavaElement.newNotPresentException(JavaElement.java:485)\n\tat org.eclipse.jdt.internal.core.JavaProject.getUnderlyingResource(JavaProject.java:2284)\n\tat org.eclipse.jdt.internal.core.Openable.getCorrespondingResource(Openable.java:287)\n\tat org.eclipse.jst.jsp.core.taglib.TaglibIndex$ClasspathChangeListener.handleClasspathChange(TaglibIndex.java:142)\n\tat org.eclipse.jst.jsp.core.taglib.TaglibIndex$ClasspathChangeListener.elementChanged(TaglibIndex.java:100)\n\tat org.eclipse.jst.jsp.core.taglib.TaglibIndex$ClasspathChangeListener.elementChanged(TaglibIndex.java:87)\n\tat org.eclipse.jst.jsp.core.taglib.TaglibIndex$ClasspathChangeListener.elementChanged(TaglibIndex.java:72)\n\tat org.eclipse.jdt.internal.core.DeltaProcessor$3.run(DeltaProcessor.java:1458)\n\tat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n\tat org.eclipse.jdt.internal.core.DeltaProcessor.notifyListeners(DeltaProcessor.java:1448)\n\tat org.eclipse.jdt.internal.core.DeltaProcessor.firePostChangeDelta(DeltaProcessor.java:1296)\n\tat org.eclipse.jdt.internal.core.DeltaProcessor.fire(DeltaProcessor.java:1275)\n\tat org.eclipse.jdt.internal.core.DeltaProcessor.resourceChanged(DeltaProcessor.java:1833)\n\tat org.eclipse.jdt.internal.core.DeltaProcessingState.resourceChanged(DeltaProcessingState.java:444)\n\tat org.eclipse.core.internal.events.NotificationManager$2.run(NotificationManager.java:280)\n\tat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n\tat org.eclipse.core.internal.events.NotificationManager.notify(NotificationManager.java:274)\n\tat org.eclipse.core.internal.events.NotificationManager.broadcastChanges(NotificationManager.java:148)\n\tat org.eclipse.core.internal.resources.Workspace.broadcastPostChange(Workspace.java:256)\n\tat org.eclipse.core.internal.resources.Workspace.endOperation(Workspace.java:958)\n\tat org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1746)\n\tat org.eclipse.ui.actions.DeleteResourceAction$3.run(DeleteResourceAction.java:596)\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:58)\n!SUBENTRY 1 org.eclipse.jdt.core 4 969 2006-10-04 21:32:16.828\n!MESSAGE TestTestEJB does not exist\n\n!ENTRY org.eclipse.jst.jsp.core 4 4 2006-10-04 21:32:16.828\n!MESSAGE TestTestWeb does not exist\n!STACK 1\nJava Model Exception: Java Model Status [TestTestWeb does not exist]\n\tat org.eclipse.jdt.internal.core.JavaElement.newNotPresentException(JavaElement.java:485)\n\tat org.eclipse.jdt.internal.core.JavaProject.getUnderlyingResource(JavaProject.java:2284)\n\tat org.eclipse.jdt.internal.core.Openable.getCorrespondingResource(Openable.java:287)\n\tat org.eclipse.jst.jsp.core.taglib.TaglibIndex$ClasspathChangeListener.handleClasspathChange(TaglibIndex.java:142)\n\tat org.eclipse.jst.jsp.core.taglib.TaglibIndex$ClasspathChangeListener.elementChanged(TaglibIndex.java:100)\n\tat org.eclipse.jst.jsp.core.taglib.TaglibIndex$ClasspathChangeListener.elementChanged(TaglibIndex.java:87)\n\tat org.eclipse.jst.jsp.core.taglib.TaglibIndex$ClasspathChangeListener.elementChanged(TaglibIndex.java:72)\n\tat org.eclipse.jdt.internal.core.DeltaProcessor$3.run(DeltaProcessor.java:1458)\n\tat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n\tat org.eclipse.jdt.internal.core.DeltaProcessor.notifyListeners(DeltaProcessor.java:1448)\n\tat org.eclipse.jdt.internal.core.DeltaProcessor.firePostChangeDelta(DeltaProcessor.java:1296)\n\tat org.eclipse.jdt.internal.core.DeltaProcessor.fire(DeltaProcessor.java:1275)\n\tat org.eclipse.jdt.internal.core.DeltaProcessor.resourceChanged(DeltaProcessor.java:1833)\n\tat org.eclipse.jdt.internal.core.DeltaProcessingState.resourceChanged(DeltaProcessingState.java:444)\n\tat org.eclipse.core.internal.events.NotificationManager$2.run(NotificationManager.java:280)\n\tat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n\tat org.eclipse.core.internal.events.NotificationManager.notify(NotificationManager.java:274)\n\tat org.eclipse.core.internal.events.NotificationManager.broadcastChanges(NotificationManager.java:148)\n\tat org.eclipse.core.internal.resources.Workspace.broadcastPostChange(Workspace.java:256)\n\tat org.eclipse.core.internal.resources.Workspace.endOperation(Workspace.java:958)\n\tat org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1746)\n\tat org.eclipse.ui.actions.DeleteResourceAction$3.run(DeleteResourceAction.java:596)\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:58)\n!SUBENTRY 1 org.eclipse.jdt.core 4 969 2006-10-04 21:32:16.828\n!MESSAGE TestTestWeb does not exist\n\n!ENTRY org.eclipse.jdt.core 4 969 2006-10-04 21:32:17.062\n!MESSAGE TestTestClient does not exist\n\n!ENTRY org.eclipse.jdt.core 4 969 2006-10-04 21:32:17.062\n!MESSAGE TestTestClient does not exist\n\n!ENTRY org.eclipse.wst.server.core 4 0 2006-10-04 21:32:38.406\n!MESSAGE Could not publish to the server.\n!STACK 0\njava.lang.NullPointerException\n\tat org.eclipse.jst.server.generic.core.internal.ServerTypeDefinitionUtil.getPublisherID(ServerTypeDefinitionUtil.java:86)\n\tat org.eclipse.jst.server.generic.core.internal.GenericServerBehaviour.removeFromServer(GenericServerBehaviour.java:118)\n\tat org.eclipse.jst.server.generic.core.internal.GenericServerBehaviour.publishModule(GenericServerBehaviour.java:80)\n\tat org.eclipse.wst.server.core.model.ServerBehaviourDelegate.publishModule(ServerBehaviourDelegate.java:676)\n\tat org.eclipse.wst.server.core.model.ServerBehaviourDelegate.publishModules(ServerBehaviourDelegate.java:756)\n\tat org.eclipse.wst.server.core.model.ServerBehaviourDelegate.publish(ServerBehaviourDelegate.java:611)\n\tat org.eclipse.wst.server.core.internal.Server.doPublish(Server.java:862)\n\tat org.eclipse.wst.server.core.internal.Server.publish(Server.java:850)\n\tat org.eclipse.wst.server.core.internal.PublishServerJob.run(PublishServerJob.java:142)\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:58)\n\n\nUnfortunately the eclipse server definition is completely broken now. You have to delete it from the \"Servers\" view, otherwise it is not even possible to start it again.",
    "Adding Rob to comment on the unpublish behavior. \n\nRob in this scenario step 3 actually removes the module from the server but then a second remove job comes on step 6 which is redundant. Is it really necessary to have this publish request? ",
    "OK, here is what I see occurring via some debugging (I was able to reproduce this with a generic WLS 9.2 adapter using 1.5.1), it is independent of project deletion and is related to either a error in the how the publish state for removed module is being updated; here is the test I performed:\n\n-publish a dynamic web project to the server\n-remove the module from the server\n-execute a publish\n-the server adapters undeploy logic is correct executed and the module is correctly cleared from the .metadata/.plugins/org.eclipse.wst.server.core/servers.xml file\n-execute a manual publish again on the server adapter; in ServerBehaviorDelegate.publish(), the call to addRemovedModules() is (incorrectly, I believe) adding a removed module for the already successfully removed project module (I believe this is because the publish state is not getting updated after the module is unpublished so the check against previously published modules to determine which module have been removed continues to return the same module)\n\nA simple modification of GenericServerBehavior.removeFromServer() to set the publish state to PUBLISH_STATE_NONE if no errors occurred during the unpublish call (similar to the logic for the non-removal case in publishModule()) eliminates the problem.\n\nQ: should publish state for removed modules be updated by server framework logic rather than server adapter logic in this case?",
    "I vote for adapter logic since this is the best place to determine the success of publish/unpublish.\nHaving said that I am also worried that these sorts of nifty details and lack of tests to confirm an adapter implementation is making it harder for others to create good quality implementations. \nAnyway I shall fix generic servers shortly.\n",
    "Were you going to try to get this approved for 1.5.2?",
    "It is a close call for 1.5.2, I will fix it for 2.0 for now",
    "released to HEAD",
    "Is it possible to get this into 1.5.3 ?",
    "Gorkem, were you planning to target this for 1.5.3 or to set it for 2.0M3 and leave it there?",
    "I will leave this as 2.0 since there is another bug 163715 for 1.5.3. ",
    "Verified against Eclipse 3.3M4 / WTP2.0M4, works fine now ! Closing."
  ],
  "commentCreationDates": [
    "2006-10-04T21:35:08+02:00",
    "2006-10-15T20:53:39+02:00",
    "2006-10-16T17:15:15+02:00",
    "2006-10-16T19:20:02+02:00",
    "2006-10-16T19:53:20+02:00",
    "2006-10-16T20:14:45+02:00",
    "2006-10-16T21:46:06+02:00",
    "2006-10-26T16:26:26+02:00",
    "2006-11-09T04:34:15+01:00",
    "2006-11-09T06:16:22+01:00",
    "2007-01-15T19:01:28+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.jst.server.generic.core.internal.ServerTypeDefinitionUtil.getPublisherID",
          "source": "ServerTypeDefinitionUtil.java:86"
        },
        {
          "method": "org.eclipse.jst.server.generic.core.internal.GenericServerBehaviour.removeFromServer",
          "source": "GenericServerBehaviour.java:118"
        },
        {
          "method": "org.eclipse.jst.server.generic.core.internal.GenericServerBehaviour.publishModule",
          "source": "GenericServerBehaviour.java:80"
        },
        {
          "method": "org.eclipse.wst.server.core.model.ServerBehaviourDelegate.publishModule",
          "source": "ServerBehaviourDelegate.java:676"
        },
        {
          "method": "org.eclipse.wst.server.core.model.ServerBehaviourDelegate.publishModules",
          "source": "ServerBehaviourDelegate.java:756"
        },
        {
          "method": "org.eclipse.wst.server.core.model.ServerBehaviourDelegate.publish",
          "source": "ServerBehaviourDelegate.java:611"
        },
        {
          "method": "org.eclipse.wst.server.core.internal.Server.doPublish",
          "source": "Server.java:862"
        },
        {
          "method": "org.eclipse.wst.server.core.internal.Server.publish",
          "source": "Server.java:850"
        },
        {
          "method": "org.eclipse.wst.server.core.internal.PublishServerJob.run",
          "source": "PublishServerJob.java:142"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:58"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "159789",
      "date": "2006-10-04T21:35:08+02:00",
      "product": "Web Tools",
      "component": "jst.server",
      "severity": "major"
    }
  ],
  "groupId": "159789",
  "bugId": "159789",
  "date": "2006-10-04T21:35:08+02:00",
  "product": "Web Tools",
  "component": "jst.server",
  "severity": "major"
}