{
  "comments": [
    "The methods of CElementLabelProvider can be called from non-ui threads.\n\norg.eclipse.swt.SWTException: Invalid thread access\nat org.eclipse.swt.SWT.error(SWT.java:3478)\nat org.eclipse.swt.SWT.error(SWT.java:3401)\nat org.eclipse.swt.SWT.error(SWT.java:3372)\nat org.eclipse.swt.widgets.Display.error(Display.java:1003)\nat org.eclipse.swt.widgets.Display.checkDevice(Display.java:663)\nat org.eclipse.swt.widgets.Display.getSystemColor(Display.java:1993)\nat org.eclipse.cdt.internal.ui.viewsupport.CUILabelProvider.\u003cinit\u003e(CUILabelProvider.java:57)\nat org.eclipse.cdt.ui.CElementLabelProvider.\u003cinit\u003e(CElementLabelProvider.java:102)\nat org.eclipse.cdt.ui.CElementLabelProvider.\u003cinit\u003e(CElementLabelProvider.java:94)\nat org.eclipse.cdt.internal.ui.CWorkbenchAdapter.\u003cinit\u003e(CWorkbenchAdapter.java:36)\nat org.eclipse.cdt.internal.ui.CElementAdapterFactory.getWorkbenchAdapter(CElementAdapterFactory.java:102)\nat org.eclipse.cdt.internal.ui.CElementAdapterFactory.getAdapter(CElementAdapterFactory.java:71)\nat org.eclipse.core.internal.runtime.AdapterManager.getAdapter(AdapterManager.java:277)\nat org.eclipse.core.runtime.PlatformObject.getAdapter(PlatformObject.java:66)\nat org.eclipse.cdt.internal.core.model.CElement.getAdapter(CElement.java:67)\nat org.eclipse.cdt.debug.internal.ui.views.modules.ModuleLabelProvider.getLabel(ModuleLabelProvider.java:42)\nat org.eclipse.debug.internal.ui.model.elements.ElementLabelProvider.retrieveLabel(ElementLabelProvider.java:182)\nat org.eclipse.debug.internal.ui.model.elements.ElementLabelProvider$LabelUpdater.run(ElementLabelProvider.java:137)\nat org.eclipse.debug.internal.ui.model.elements.ElementLabelProvider$LabelJob.run(ElementLabelProvider.java:60)\nat org.eclipse.core.internal.jobs.Worker.run(Worker.java:58)",
    "Changing severity to major because the bug prevents the expansion of binaries in the Modules view.",
    "I\u0027ll look into it.",
    "Created an attachment (id\u003d60560)\nProposed fix\n\nThis patch overrides ElementLabelProvider.requiresUIJob() to return true. This way, the label update is done in a UI Job.",
    "Mikhail, could you try the patch if it works for you? Thanks.",
    "(In reply to comment #4)\n\u003e Mikhail, could you try the patch if it works for you? Thanks.\n\nTony, it works, but there is a problem with this solution. It blocks the UI for the time of label retrieval. I don\u0027t want to make the Modules view blocking and dependent on something that is done outside of the view\u0027s implementation.\nI would prefer the solution we discussed at EclipseCon to create the background color once when the plugin is loaded and reuse it.\n \n",
    "Ok, but there is no guarantee that the problem won\u0027t occur again in a different place, e.g. when an image is requested that is not already cached and therefore needs to be created. Using a label provider on a background thread is inherently dangerous if it was not designed as such.",
    "I committed a fix to CUILabelProvider which guarantees that the color is created on the display thread only.",
    "(In reply to comment #6)\n\u003e Using a label provider on a background thread is\n\u003e inherently dangerous if it was not designed as such.\n\nIt should be designed to be called from non-UI threads. All views should be non-blocking, it\u0027s a common rule. By the way, it\u0027s WindRiver who pushed it into the Eclipse Debug platform. The modules view implementation just follows it. And I believe it\u0027s a matter of time when the C Project view will be redesigned in the same way.\n"
  ],
  "commentCreationDates": [
    "2007-03-09T22:33:12+01:00",
    "2007-03-09T22:35:52+01:00",
    "2007-03-12T11:19:14+01:00",
    "2007-03-12T16:51:23+01:00",
    "2007-03-15T11:50:03+01:00",
    "2007-03-22T16:07:58+01:00",
    "2007-03-22T16:33:29+01:00",
    "2007-03-22T16:49:00+01:00",
    "2007-03-22T16:53:39+01:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.swt.SWTException",
      "message": "Invalid thread access",
      "elements": [
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3478"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3401"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3372"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.error",
          "source": "Display.java:1003"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.checkDevice",
          "source": "Display.java:663"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.getSystemColor",
          "source": "Display.java:1993"
        },
        {
          "method": "org.eclipse.cdt.internal.ui.viewsupport.CUILabelProvider.\u003cinit\u003e",
          "source": "CUILabelProvider.java:57"
        },
        {
          "method": "org.eclipse.cdt.ui.CElementLabelProvider.\u003cinit\u003e",
          "source": "CElementLabelProvider.java:102"
        },
        {
          "method": "org.eclipse.cdt.ui.CElementLabelProvider.\u003cinit\u003e",
          "source": "CElementLabelProvider.java:94"
        },
        {
          "method": "org.eclipse.cdt.internal.ui.CWorkbenchAdapter.\u003cinit\u003e",
          "source": "CWorkbenchAdapter.java:36"
        },
        {
          "method": "org.eclipse.cdt.internal.ui.CElementAdapterFactory.getWorkbenchAdapter",
          "source": "CElementAdapterFactory.java:102"
        },
        {
          "method": "org.eclipse.cdt.internal.ui.CElementAdapterFactory.getAdapter",
          "source": "CElementAdapterFactory.java:71"
        },
        {
          "method": "org.eclipse.core.internal.runtime.AdapterManager.getAdapter",
          "source": "AdapterManager.java:277"
        },
        {
          "method": "org.eclipse.core.runtime.PlatformObject.getAdapter",
          "source": "PlatformObject.java:66"
        },
        {
          "method": "org.eclipse.cdt.internal.core.model.CElement.getAdapter",
          "source": "CElement.java:67"
        },
        {
          "method": "org.eclipse.cdt.debug.internal.ui.views.modules.ModuleLabelProvider.getLabel",
          "source": "ModuleLabelProvider.java:42"
        },
        {
          "method": "org.eclipse.debug.internal.ui.model.elements.ElementLabelProvider.retrieveLabel",
          "source": "ElementLabelProvider.java:182"
        },
        {
          "method": "org.eclipse.debug.internal.ui.model.elements.ElementLabelProvider$LabelUpdater.run",
          "source": "ElementLabelProvider.java:137"
        },
        {
          "method": "org.eclipse.debug.internal.ui.model.elements.ElementLabelProvider$LabelJob.run",
          "source": "ElementLabelProvider.java:60"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:58"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "176871",
      "date": "2007-03-09T22:33:12+01:00",
      "product": "CDT",
      "component": "UI",
      "severity": "major"
    }
  ],
  "groupId": "176871",
  "bugId": "176871",
  "date": "2007-03-09T22:33:12+01:00",
  "product": "CDT",
  "component": "UI",
  "severity": "major"
}