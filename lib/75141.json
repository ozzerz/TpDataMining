{
  "comments": [
    "Hi,\n\nplease run this snippet. After the page has loaded, simply close the tab. On my\nWinXP the application freezes and after sometime a SWT Widget is disposed\nException is thrown:\n\npublic class Main {\n\tpublic static void main(String[] args) {\n\t\tDisplay display \u003d new Display();\n\t\tImage image \u003d new Image(display, 16, 16);\n\t\tShell shell \u003d new Shell(display);\n\t\tshell.setMaximized(true);\n\t\tshell.setLayout(new GridLayout());\n\t\tCTabFolder folder \u003d new CTabFolder(shell, SWT.CLOSE);\n\t\tfolder.setLayoutData(new GridData(GridData.FILL_BOTH));\n\n\t\tfinal CTabItem item \u003d new CTabItem(folder, SWT.NONE);\n\t\titem.setText(\"Browser Tab\");\n\t\titem.setImage(image);\n\t\tComposite comp \u003d new Composite(folder, SWT.NONE);\n\t\tcomp.setLayout(new GridLayout());\n\t\tcomp.setLayoutData(new GridData(GridData.FILL_BOTH));\n\t\tfinal Browser browser \u003d new Browser(comp, SWT.NONE);\n\t\tbrowser.setLayoutData(new GridData(GridData.FILL_BOTH));\n\t\titem.setControl(comp);\n\t\nbrowser.setUrl(\"http://packetswitched.blogspot.com/2004/09/30-half-life-2-scenes-in-30-seconds.html\");\n\n\t\tfolder.addCTabFolder2Listener(new CTabFolder2Adapter() {\n\t\t\tpublic void close(CTabFolderEvent event) {\n\t\t\t\titem.getImage().dispose();\n\t\t\t\titem.getControl().dispose();\n\t\t\t\titem.dispose();\n\t\t\t}\n\t\t});\n\t\tshell.pack();\n\t\tshell.open();\n\t\twhile (!shell.isDisposed()) {\n\t\t\tif (!display.readAndDispatch())\n\t\t\t\tdisplay.sleep();\n\t\t}\n\t\tdisplay.dispose();\n\t}\n}\n\nI am not able to reproduce the crash, in case I am not disposing the CTabItems\nimage in the Close listener. I am very much wondering why and how the CTabItem\u0027s\nimage is related to the content of the browser, which in this case is an ActiveX\nto show the windows Media player.\n\nBen",
    "I don\u0027t see the problem on win2000.  CC to try on XP.\n",
    "More details on the Exception and the Media Player:\n\nMy System is WinXP running Service Pack 2 and Media Player version\nis 9.00.00.3250.\n\nIt does not make a difference if the video is playing or not. It\nseems to be sufficient that the Media Player ActiveX plugin is loaded\nin the IE.\n\nDetailed description what\u0027s happning:\n1.) Close Tab containing the Browser\n2.) The close button on the CTabItem becomes invisible\n3.) System usage climbs up to 98%, more and more memory is consumed\n4.) An exception is given out to the console, but the program\nis still running and using 98% system:\n\n\norg.eclipse.swt.SWTException: Graphic is disposed\n\tat org.eclipse.swt.SWT.error(SWT.java:2691)\n\tat org.eclipse.swt.SWT.error(SWT.java:2616)\n\tat org.eclipse.swt.SWT.error(SWT.java:2587)\n\tat org.eclipse.swt.graphics.Image.getBounds(Image.java:917)\n\tat org.eclipse.swt.custom.CTabItem.drawSelected(CTabItem.java:358)\n\tat org.eclipse.swt.custom.CTabItem.onPaint(CTabItem.java:589)\n\tat org.eclipse.swt.custom.CTabFolder.drawTabArea(CTabFolder.java:1132)\n\tat org.eclipse.swt.custom.CTabFolder.onPaint(CTabFolder.java:2226)\n\tat org.eclipse.swt.custom.CTabFolder$1.handleEvent(CTabFolder.java:290)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:796)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:820)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:805)\n\tat org.eclipse.swt.widgets.Composite.WM_PAINT(Composite.java:805)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3026)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:3349)\n\tat org.eclipse.swt.internal.win32.OS.VtblCall(Native Method)\n\tat org.eclipse.swt.internal.ole.win32.IOleObject.Close(IOleObject.java:24)\n\tat\norg.eclipse.swt.ole.win32.OleClientSite.releaseObjectInterfaces(OleClientSite.java:1040)\n\tat\norg.eclipse.swt.ole.win32.OleControlSite.releaseObjectInterfaces(OleControlSite.java:614)\n\tat org.eclipse.swt.ole.win32.OleClientSite.onDispose(OleClientSite.java:826)\n\tat org.eclipse.swt.ole.win32.OleClientSite.access$1(OleClientSite.java:821)\n\tat org.eclipse.swt.ole.win32.OleClientSite$1.handleEvent(OleClientSite.java:125)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:796)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:820)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:801)\n\tat org.eclipse.swt.widgets.Widget.releaseWidget(Widget.java:708)\n\tat org.eclipse.swt.widgets.Control.releaseWidget(Control.java:1482)\n\tat org.eclipse.swt.widgets.Scrollable.releaseWidget(Scrollable.java:192)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:373)\n\tat org.eclipse.swt.widgets.Widget.releaseResources(Widget.java:673)\n\tat org.eclipse.swt.widgets.Composite.releaseChildren(Composite.java:367)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:372)\n\tat org.eclipse.swt.widgets.Widget.releaseResources(Widget.java:673)\n\tat org.eclipse.swt.widgets.Composite.releaseChildren(Composite.java:367)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:372)\n\tat org.eclipse.swt.widgets.Widget.releaseResources(Widget.java:673)\n\tat org.eclipse.swt.widgets.Composite.releaseChildren(Composite.java:367)\n\tat org.eclipse.swt.widgets.Composite.releaseWidget(Composite.java:372)\n\tat org.eclipse.swt.widgets.Widget.dispose(Widget.java:368)\n\tat Main$1.close(Main.java:50)\n\tat org.eclipse.swt.custom.CTabFolder.onMouse(CTabFolder.java:2118)\n\tat org.eclipse.swt.custom.CTabFolder$1.handleEvent(CTabFolder.java:289)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:796)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:2783)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2442)\n\tat Main.main(Main.java:57)",
    "Some more info:\n\nThe TabItem does not close itself after pressing the close button. The content\nof the browser remains. The only thing I noticed, the Media Player control\nshowing a black screen becomes slightly brighter when closing the tab.\nInteresting, not sure what\u0027s that to do with it.\n\nDealing with the problem, I got out what the problem is:\nI am first disposing the TabItems Image, and then the control. But disposing the\ncontrol that contains the Browser results in a call to repaint  of the CTabItem.\nThat throws the widget disposed exception since the Image was already disposed\nthat time.\n\nThe very interesting thing about this is, that disposing a Browser containing\nthe media player results in 3 calls to paint() of the CTabItem. Whereas\ndisplaying a normal webpage results in 2 calls to paint(). That is why my way to\ndispose the Image works with normal webpages.\n\nSo, disposing the CTabItems image after disposing the CTabItems content does fix\nthis problem. Still its kind of strange that in one case the CTabItem is\nrepainted, although disposed.",
    "Ok on XP without SP2 - to be checked with SP2",
    "Reproduced with SP2",
    "The problem is in the snippet. The image must be removed from the tab item \nbefore being disposed.\n\n\nReplace\npublic void close(CTabFolderEvent event) {\n\t\t\t\titem.getImage().dispose();\n\t\t\t\titem.getControl().dispose();\n\t\t\t\titem.dispose();\n\t\t\t}\n\nwith\n\n\t\t\t\t\tImage image \u003d item.getImage();\n\t\t\t\t\titem.setImage(null);\n\t\t\t\t\titem.getControl().dispose();\n\t\t\t\t\titem.dispose();\n\t\t\t\t\timage.dispose();",
    "Verified. \n\nThanks,\nBen"
  ],
  "commentCreationDates": [
    "2004-09-28T08:46:26+02:00",
    "2004-09-28T14:07:49+02:00",
    "2004-09-28T15:00:02+02:00",
    "2004-09-28T15:10:15+02:00",
    "2004-09-28T19:11:28+02:00",
    "2005-03-29T18:44:53+02:00",
    "2005-03-29T18:52:14+02:00",
    "2005-03-29T19:25:18+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.swt.SWTException",
      "message": "Graphic is disposed",
      "elements": [
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:2691"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:2616"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:2587"
        },
        {
          "method": "org.eclipse.swt.graphics.Image.getBounds",
          "source": "Image.java:917"
        },
        {
          "method": "org.eclipse.swt.custom.CTabItem.drawSelected",
          "source": "CTabItem.java:358"
        },
        {
          "method": "org.eclipse.swt.custom.CTabItem.onPaint",
          "source": "CTabItem.java:589"
        },
        {
          "method": "org.eclipse.swt.custom.CTabFolder.drawTabArea",
          "source": "CTabFolder.java:1132"
        },
        {
          "method": "org.eclipse.swt.custom.CTabFolder.onPaint",
          "source": "CTabFolder.java:2226"
        },
        {
          "method": "org.eclipse.swt.custom.CTabFolder$1.handleEvent",
          "source": "CTabFolder.java:290"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:796"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:820"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:805"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.WM_PAINT",
          "source": "Composite.java:805"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3026"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3349"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.VtblCall",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.ole.win32.IOleObject.Close",
          "source": "IOleObject.java:24"
        },
        {
          "method": "org.eclipse.swt.ole.win32.OleClientSite.releaseObjectInterfaces",
          "source": "OleClientSite.java:1040"
        },
        {
          "method": "org.eclipse.swt.ole.win32.OleControlSite.releaseObjectInterfaces",
          "source": "OleControlSite.java:614"
        },
        {
          "method": "org.eclipse.swt.ole.win32.OleClientSite.onDispose",
          "source": "OleClientSite.java:826"
        },
        {
          "method": "org.eclipse.swt.ole.win32.OleClientSite.access$1",
          "source": "OleClientSite.java:821"
        },
        {
          "method": "org.eclipse.swt.ole.win32.OleClientSite$1.handleEvent",
          "source": "OleClientSite.java:125"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:796"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:820"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:801"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseWidget",
          "source": "Widget.java:708"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.releaseWidget",
          "source": "Control.java:1482"
        },
        {
          "method": "org.eclipse.swt.widgets.Scrollable.releaseWidget",
          "source": "Scrollable.java:192"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:373"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseResources",
          "source": "Widget.java:673"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseChildren",
          "source": "Composite.java:367"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:372"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseResources",
          "source": "Widget.java:673"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseChildren",
          "source": "Composite.java:367"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:372"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.releaseResources",
          "source": "Widget.java:673"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseChildren",
          "source": "Composite.java:367"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.releaseWidget",
          "source": "Composite.java:372"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.dispose",
          "source": "Widget.java:368"
        },
        {
          "method": "Main$1.close",
          "source": "Main.java:50"
        },
        {
          "method": "org.eclipse.swt.custom.CTabFolder.onMouse",
          "source": "CTabFolder.java:2118"
        },
        {
          "method": "org.eclipse.swt.custom.CTabFolder$1.handleEvent",
          "source": "CTabFolder.java:289"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:796"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:2783"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2442"
        },
        {
          "method": "Main.main",
          "source": "Main.java:57"
        }
      ],
      "number": 0,
      "commentIndex": 2,
      "bugId": "75141",
      "date": "2004-09-28T15:00:02+02:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "normal"
    }
  ],
  "groupId": "75141",
  "bugId": "75141",
  "date": "2004-09-28T08:46:26+02:00",
  "product": "Platform",
  "component": "SWT",
  "severity": "normal"
}