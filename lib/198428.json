{
  "comments": [
    "Build: 3.3\n\nI selected a launch configuration, and clicked the delete button in the launch configuration dialog. This caused a deadlock. The problem seems to be that the LaunchDialog is forking an operation in a modal context thread during a resource change event.  The operation then tries to run a workspace operation, but is blocked because the UI thread has the workspace lock (workspace lock is held during POST_CHANGE resource change events).",
    "I suppose it\u0027s obvious from looking at the stack, but I should mention that the launch configuration being deleted was shared in my workspace.",
    "Created an attachment (id\u003d75054)\nStack trace during deadlock\n\nIt would be even more obvious if I actually provided the stack dump ;)",
    "Findings so far:\n\n1. The problem is easily reproducible using the following steps:\n     a. create two java launch configurations A and B, and make them both shared in the  \n         workspace\n     b. open B in an editor and remove the resource mapping attributes\n     c. open the launch dialog, select and delete A\n     d. expected: A is deleted and B is selected. happens: when trying to select B deadlock \n         occurs\n\nThe Reason:\n\nA notification that a configuration has been deleted coming from a resource delta visitor; at this time we are holding a lock on the workspace. From here the LCD responds to a config being deleted by removing it from the viewer and running preservingSelection, which attempts to select the next best config in the viewer. In doing so, when responding to the new config being selected, it is auto-migrated (putting in the resource mappings) and an attempt to save it is made. This attempt to save spawns a thread from the modal context which in turn tries to use a workspace runnable to save the config to the workspace, which can\u0027t happen as the thread we are already in has the lock on the workspace.\n\nIf we take out the forked modal context thread we confirm that the current thread already has a lock on the workspace getting the following error:\n\norg.eclipse.core.internal.resources.ResourceException: The resource tree is locked for modifications.\nat org.eclipse.core.internal.resources.WorkManager.checkIn(WorkManager.java:115)\nat org.eclipse.core.internal.resources.Workspace.prepareOperation(Workspace.java:1744)\nat org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1792)\nat org.eclipse.debug.internal.core.LaunchConfigurationWorkingCopy.doSave(LaunchConfigurationWorkingCopy.java:218)\nat org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationTabGroupViewer$10.run(LaunchConfigurationTabGroupViewer.java:1360)\nat org.eclipse.jface.operation.ModalContext.runInCurrentThread(ModalContext.java:369)\nat org.eclipse.jface.operation.ModalContext.run(ModalContext.java:313)\nat org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationsDialog.run(LaunchConfigurationsDialog.java:1279)\nat org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationTabGroupViewer.handleApplyPressed(LaunchConfigurationTabGroupViewer.java:1365)\nat org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationsDialog.handleLaunchConfigurationSelectionChanged(LaunchConfigurationsDialog.java:973)\nat org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationsDialog$4.selectionChanged(LaunchConfigurationsDialog.java:565)\nat org.eclipse.jface.viewers.StructuredViewer$3.run(StructuredViewer.java:842)\nat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\nat org.eclipse.core.runtime.Platform.run(Platform.java:857)\nat org.eclipse.ui.internal.JFaceUtil$1.run(JFaceUtil.java:46)\nat org.eclipse.jface.util.SafeRunnable.run(SafeRunnable.java:193)\nat org.eclipse.jface.viewers.StructuredViewer.firePostSelectionChanged(StructuredViewer.java:840)\nat org.eclipse.jface.viewers.StructuredViewer.setSelection(StructuredViewer.java:1640)\nat org.eclipse.jface.viewers.TreeViewer.setSelection(TreeViewer.java:1083)\nat org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationViewer.preservingSelection(LaunchConfigurationViewer.java:109)\nat org.eclipse.jface.viewers.AbstractTreeViewer.remove(AbstractTreeViewer.java:2101)\nat org.eclipse.jface.viewers.AbstractTreeViewer.remove(AbstractTreeViewer.java:2155)\nat org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationViewer.remove(LaunchConfigurationViewer.java:149)\nat org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationView.handleConfigurationRemoved(LaunchConfigurationView.java:364)\nat org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationView.launchConfigurationRemoved(LaunchConfigurationView.java:349)\nat org.eclipse.debug.internal.core.LaunchManager$ConfigurationNotifier.run(LaunchManager.java:196)\nat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\nat org.eclipse.debug.internal.core.LaunchManager$ConfigurationNotifier.notify(LaunchManager.java:180)\nat org.eclipse.debug.internal.core.LaunchManager.launchConfigurationDeleted(LaunchManager.java:2099)\nat org.eclipse.debug.internal.core.LaunchManager$LaunchManagerVisitor.visit(LaunchManager.java:392)\nat org.eclipse.core.internal.events.ResourceDelta.accept(ResourceDelta.java:67)\nat org.eclipse.core.internal.events.ResourceDelta.accept(ResourceDelta.java:76)\nat org.eclipse.core.internal.events.ResourceDelta.accept(ResourceDelta.java:76)\nat org.eclipse.core.internal.events.ResourceDelta.accept(ResourceDelta.java:48)\nat org.eclipse.debug.internal.core.LaunchManager.resourceChanged(LaunchManager.java:2228)\nat org.eclipse.core.internal.events.NotificationManager$2.run(NotificationManager.java:282)\nat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\nat org.eclipse.core.internal.events.NotificationManager.notify(NotificationManager.java:276)\nat org.eclipse.core.internal.events.NotificationManager.broadcastChanges(NotificationManager.java:148)\nat org.eclipse.core.internal.resources.Workspace.broadcastPostChange(Workspace.java:311)\nat org.eclipse.core.internal.resources.Workspace.endOperation(Workspace.java:1018)\nat org.eclipse.core.internal.resources.Resource.delete(Resource.java:725)\n...\n\u003csnip\u003e",
    "We are experiencing this same exact problem in our 3.3 based product. The user has no choice but to do a hard kill of Eclipse via the Windows task manager, making this a serious bug in my opinion.",
    "Created an attachment (id\u003d83983)\npatch\n\nSolution is to have LaunchConfigurationView.launchConfigurationRemoved(..) handle the change aynchronously, allowing the change notification to proceed. All the launch config listener methods in the view should follow this pattern.",
    "Fix released to HEAD. Marking as 3.3.2 candidate, pending PMC approval - justification is that the UI deadlocks and Eclipse must be killed when this happens. Fix is simple/safe - submit an SWT async exec to handle the change notification.",
    "Created an attachment (id\u003d84016)\npatch for 3.3.2 maintenance branch\n\n",
    "+1 for 3.3.2",
    "Created an attachment (id\u003d84414)\npatch\n\nThe patch introduced bug 211815. Incorporated the fix to bug 211815 in latest patch and released to maintenance stream.",
    "Fixed.",
    "Please verify, Mike.",
    "verified in HEAD and 3.3.2",
    "bug 212164 was a side-effect of this bug and has been fixed in HEAD and 3.3.2 as well",
    "212581 was yet another side-effect of this fix, which has been fixed in HEAD and 3.3.2"
  ],
  "commentCreationDates": [
    "2007-07-31T17:59:14+02:00",
    "2007-07-31T18:09:29+02:00",
    "2007-07-31T18:11:36+02:00",
    "2007-08-01T20:38:59+02:00",
    "2007-11-21T03:11:59+01:00",
    "2007-11-28T15:31:50+01:00",
    "2007-11-28T15:34:26+01:00",
    "2007-11-28T21:11:45+01:00",
    "2007-12-03T22:03:27+01:00",
    "2007-12-04T14:10:11+01:00",
    "2007-12-04T14:12:39+01:00",
    "2007-12-04T14:12:54+01:00",
    "2007-12-04T16:03:45+01:00",
    "2007-12-06T19:24:22+01:00",
    "2007-12-12T21:52:38+01:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.core.internal.resources.ResourceException",
      "message": "The resource tree is locked for modifications.",
      "elements": [
        {
          "method": "org.eclipse.core.internal.resources.WorkManager.checkIn",
          "source": "WorkManager.java:115"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.prepareOperation",
          "source": "Workspace.java:1744"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1792"
        },
        {
          "method": "org.eclipse.debug.internal.core.LaunchConfigurationWorkingCopy.doSave",
          "source": "LaunchConfigurationWorkingCopy.java:218"
        },
        {
          "method": "org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationTabGroupViewer$10.run",
          "source": "LaunchConfigurationTabGroupViewer.java:1360"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext.runInCurrentThread",
          "source": "ModalContext.java:369"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext.run",
          "source": "ModalContext.java:313"
        },
        {
          "method": "org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationsDialog.run",
          "source": "LaunchConfigurationsDialog.java:1279"
        },
        {
          "method": "org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationTabGroupViewer.handleApplyPressed",
          "source": "LaunchConfigurationTabGroupViewer.java:1365"
        },
        {
          "method": "org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationsDialog.handleLaunchConfigurationSelectionChanged",
          "source": "LaunchConfigurationsDialog.java:973"
        },
        {
          "method": "org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationsDialog$4.selectionChanged",
          "source": "LaunchConfigurationsDialog.java:565"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer$3.run",
          "source": "StructuredViewer.java:842"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:857"
        },
        {
          "method": "org.eclipse.ui.internal.JFaceUtil$1.run",
          "source": "JFaceUtil.java:46"
        },
        {
          "method": "org.eclipse.jface.util.SafeRunnable.run",
          "source": "SafeRunnable.java:193"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.firePostSelectionChanged",
          "source": "StructuredViewer.java:840"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.setSelection",
          "source": "StructuredViewer.java:1640"
        },
        {
          "method": "org.eclipse.jface.viewers.TreeViewer.setSelection",
          "source": "TreeViewer.java:1083"
        },
        {
          "method": "org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationViewer.preservingSelection",
          "source": "LaunchConfigurationViewer.java:109"
        },
        {
          "method": "org.eclipse.jface.viewers.AbstractTreeViewer.remove",
          "source": "AbstractTreeViewer.java:2101"
        },
        {
          "method": "org.eclipse.jface.viewers.AbstractTreeViewer.remove",
          "source": "AbstractTreeViewer.java:2155"
        },
        {
          "method": "org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationViewer.remove",
          "source": "LaunchConfigurationViewer.java:149"
        },
        {
          "method": "org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationView.handleConfigurationRemoved",
          "source": "LaunchConfigurationView.java:364"
        },
        {
          "method": "org.eclipse.debug.internal.ui.launchConfigurations.LaunchConfigurationView.launchConfigurationRemoved",
          "source": "LaunchConfigurationView.java:349"
        },
        {
          "method": "org.eclipse.debug.internal.core.LaunchManager$ConfigurationNotifier.run",
          "source": "LaunchManager.java:196"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.debug.internal.core.LaunchManager$ConfigurationNotifier.notify",
          "source": "LaunchManager.java:180"
        },
        {
          "method": "org.eclipse.debug.internal.core.LaunchManager.launchConfigurationDeleted",
          "source": "LaunchManager.java:2099"
        },
        {
          "method": "org.eclipse.debug.internal.core.LaunchManager$LaunchManagerVisitor.visit",
          "source": "LaunchManager.java:392"
        },
        {
          "method": "org.eclipse.core.internal.events.ResourceDelta.accept",
          "source": "ResourceDelta.java:67"
        },
        {
          "method": "org.eclipse.core.internal.events.ResourceDelta.accept",
          "source": "ResourceDelta.java:76"
        },
        {
          "method": "org.eclipse.core.internal.events.ResourceDelta.accept",
          "source": "ResourceDelta.java:76"
        },
        {
          "method": "org.eclipse.core.internal.events.ResourceDelta.accept",
          "source": "ResourceDelta.java:48"
        },
        {
          "method": "org.eclipse.debug.internal.core.LaunchManager.resourceChanged",
          "source": "LaunchManager.java:2228"
        },
        {
          "method": "org.eclipse.core.internal.events.NotificationManager$2.run",
          "source": "NotificationManager.java:282"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.core.internal.events.NotificationManager.notify",
          "source": "NotificationManager.java:276"
        },
        {
          "method": "org.eclipse.core.internal.events.NotificationManager.broadcastChanges",
          "source": "NotificationManager.java:148"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.broadcastPostChange",
          "source": "Workspace.java:311"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.endOperation",
          "source": "Workspace.java:1018"
        },
        {
          "method": "org.eclipse.core.internal.resources.Resource.delete",
          "source": "Resource.java:725"
        }
      ],
      "number": 0,
      "commentIndex": 3,
      "bugId": "198428",
      "date": "2007-08-01T20:38:59+02:00",
      "product": "Platform",
      "component": "Debug",
      "severity": "normal"
    }
  ],
  "groupId": "198428",
  "bugId": "198428",
  "date": "2007-07-31T17:59:14+02:00",
  "product": "Platform",
  "component": "Debug",
  "severity": "normal"
}