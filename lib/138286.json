{
  "comments": [
    "When using perthis() with an aspect, I see the following Internal Compiler \n\nAJDT 1.3.1 / AspectJ 1.5.1a\nBuild 20060406092046\nEclipse 3.1.2, Windows XP, JDK 1.5\n\n\nError:\n\njava.lang.ClassCastException\nat org.aspectj.weaver.patterns.PerThisOrTargetPointcutVisitor.getPerTypePointcut(PerThisOrTargetPointcutVisitor.java:41)\nat org.aspectj.weaver.patterns.PerThisOrTargetPointcutVisitor.visit(PerThisOrTargetPointcutVisitor.java:108)\nat org.aspectj.weaver.patterns.AndPointcut.accept(AndPointcut.java:119)\nat org.aspectj.weaver.patterns.PerThisOrTargetPointcutVisitor.getPerTypePointcut(PerThisOrTargetPointcutVisitor.java:41)\nat org.aspectj.weaver.PerObjectInterfaceTypeMunger.getTestTypePattern(PerObjectInterfaceTypeMunger.java:64)\nat org.aspectj.weaver.PerObjectInterfaceTypeMunger.matches(PerObjectInterfaceTypeMunger.java:85)\nat org.aspectj.weaver.ConcreteTypeMunger.matches(ConcreteTypeMunger.java:65)\nat org.aspectj.weaver.bcel.BcelClassWeaver.weave(BcelClassWeaver.java:508)\nat org.aspectj.weaver.bcel.BcelClassWeaver.weave(BcelClassWeaver.java:109)\nat org.aspectj.weaver.bcel.BcelWeaver.weave(BcelWeaver.java:1560)\nat org.aspectj.weaver.bcel.BcelWeaver.weaveWithoutDump(BcelWeaver.java:1511)\nat org.aspectj.weaver.bcel.BcelWeaver.weaveAndNotify(BcelWeaver.java:1291)\nat org.aspectj.weaver.bcel.BcelWeaver.weave(BcelWeaver.java:1089)\nat org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.weave(AjCompilerAdapter.java:311)\nat org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.afterCompiling(AjCompilerAdapter.java:183)\nat org.aspectj.ajdt.internal.compiler.CompilerAdapter.ajc$afterReturning$org_aspectj_ajdt_internal_compiler_CompilerAdapter$2$f9cc9ca0(CompilerAdapter.aj:70)\nat org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile(Compiler.java:367)\nat org.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilation(AjBuildManager.java:862)\nat org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild(AjBuildManager.java:242)\nat org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild(AjBuildManager.java:161)\nat org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild(AjBuildManager.java:278)\nat org.aspectj.ajdt.internal.core.builder.AjBuildManager.incrementalBuild(AjBuildManager.java:168)\nat org.aspectj.ajde.internal.CompilerAdapter.compile(CompilerAdapter.java:117)\nat org.aspectj.ajde.internal.AspectJBuildManager$CompilerThread.run(AspectJBuildManager.java:191)\n\ntrouble in: \npublic abstract class org.apache.tapestry.internal.aspects.AbstractClassTargetting extends java.lang.Object:\n  public void \u003cinit\u003e():\n                    ALOAD_0     // Lorg/apache/tapestry/internal/aspects/AbstractClassTargetting; this   (line 10)\n                    INVOKESPECIAL java.lang.Object.\u003cinit\u003e ()V\n    initialization(void org.apache.tapestry.internal.aspects.AbstractClassTargetting.\u003cinit\u003e())\n    |               ALOAD_0\n    |               INVOKEVIRTUAL java.lang.Object.getClass ()Ljava/lang/Class;\n    |               LDC org.apache.tapestry.internal.annotations.Synchronized\n    |               INVOKEVIRTUAL java.lang.Class.isAnnotationPresent (Ljava/lang/Class;)Z\n    |               IFEQ L0\n    |               ALOAD_0\n    |               INVOKESTATIC org.apache.tapestry.internal.aspects.InternalSynchronization.ajc$perObjectBind (Ljava/lang/Object;)V\n    | constructor-execution(void org.apache.tapestry.internal.aspects.AbstractClassTargetting.\u003cinit\u003e())\n    | |         L0: ALOAD_0\n    | |             INVOKEVIRTUAL java.lang.Object.getClass ()Ljava/lang/Class;\n    | |             LDC org.apache.tapestry.internal.annotations.Synchronized\n    | |             INVOKEVIRTUAL java.lang.Class.isAnnotationPresent (Ljava/lang/Class;)Z\n    | |             IFEQ L1\n    | |             ALOAD_0\n    | |             INVOKESTATIC org.apache.tapestry.internal.aspects.InternalSynchronization.ajc$perObjectBind (Ljava/lang/Object;)V\n    | |         L1: RETURN\n    | constructor-execution(void org.apache.tapestry.internal.aspects.AbstractClassTargetting.\u003cinit\u003e())\n    initialization(void org.apache.tapestry.internal.aspects.AbstractClassTargetting.\u003cinit\u003e())\n  end public void \u003cinit\u003e()\n\n  abstract void ajc$pointcut$$targetClasses$274()    org.aspectj.weaver.MethodDeclarationLineNumber: 16:628\n;\n\nend public abstract class org.apache.tapestry.internal.aspects.AbstractClassTargetting\n\nwhen weaving type org.apache.tapestry.internal.aspects.AbstractClassTargetting\nwhen weaving aspects \nwhen weaving \nwhen batch building BuildConfig[C:\\workspace\\.metadata\\.plugins\\org.eclipse.ajdt.core\\tapestry5.generated.lst] #Files\u003d70\n\n\n\nI\u0027ll attach the corresponding files.",
    "Created an attachment (id\u003d39367)\nAbstract aspect\n\n",
    "Created an attachment (id\u003d39368)\nConcrete aspect\n\n",
    "Created an attachment (id\u003d39369)\nAnnotation\n\n",
    "Created an attachment (id\u003d39541)\npatch containing failing testcase\n\nFrom the supplied testcase I\u0027ve narrowed it down to a smaller version which reproduces the problem. Apply the attached patch to the tests project.",
    "I\u0027ve fixed this - based on the fix I\u0027ve slightly reworked the testcase to confirm it\u0027s behaving as expected when the code runs.  The problem is that the perthis() is entirely depending on annotation existence - which (somewhere in the depths) causes us problems when we try and treat an AnnotationTypePattern as a TypePattern, when they are different things.  We have to create an \u0027AnyWithAnnotationTypePattern()\u0027 whose contents are the AnnotationTypePattern - then we can treat this new object as a standard TypePattern. clear ;)",
    "fix available, will be in AJDT shortly."
  ],
  "commentCreationDates": [
    "2006-04-25T00:29:34+02:00",
    "2006-04-25T00:30:23+02:00",
    "2006-04-25T00:30:48+02:00",
    "2006-04-25T00:31:10+02:00",
    "2006-04-26T17:35:49+02:00",
    "2006-04-26T18:58:38+02:00",
    "2006-04-27T12:16:08+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ClassCastException",
      "elements": [
        {
          "method": "org.aspectj.weaver.patterns.PerThisOrTargetPointcutVisitor.getPerTypePointcut",
          "source": "PerThisOrTargetPointcutVisitor.java:41"
        },
        {
          "method": "org.aspectj.weaver.patterns.PerThisOrTargetPointcutVisitor.visit",
          "source": "PerThisOrTargetPointcutVisitor.java:108"
        },
        {
          "method": "org.aspectj.weaver.patterns.AndPointcut.accept",
          "source": "AndPointcut.java:119"
        },
        {
          "method": "org.aspectj.weaver.patterns.PerThisOrTargetPointcutVisitor.getPerTypePointcut",
          "source": "PerThisOrTargetPointcutVisitor.java:41"
        },
        {
          "method": "org.aspectj.weaver.PerObjectInterfaceTypeMunger.getTestTypePattern",
          "source": "PerObjectInterfaceTypeMunger.java:64"
        },
        {
          "method": "org.aspectj.weaver.PerObjectInterfaceTypeMunger.matches",
          "source": "PerObjectInterfaceTypeMunger.java:85"
        },
        {
          "method": "org.aspectj.weaver.ConcreteTypeMunger.matches",
          "source": "ConcreteTypeMunger.java:65"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelClassWeaver.weave",
          "source": "BcelClassWeaver.java:508"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelClassWeaver.weave",
          "source": "BcelClassWeaver.java:109"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.weave",
          "source": "BcelWeaver.java:1560"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.weaveWithoutDump",
          "source": "BcelWeaver.java:1511"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.weaveAndNotify",
          "source": "BcelWeaver.java:1291"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.weave",
          "source": "BcelWeaver.java:1089"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.weave",
          "source": "AjCompilerAdapter.java:311"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.afterCompiling",
          "source": "AjCompilerAdapter.java:183"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.CompilerAdapter.ajc$afterReturning$org_aspectj_ajdt_internal_compiler_CompilerAdapter$2$f9cc9ca0",
          "source": "CompilerAdapter.aj:70"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile",
          "source": "Compiler.java:367"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilation",
          "source": "AjBuildManager.java:862"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild",
          "source": "AjBuildManager.java:242"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild",
          "source": "AjBuildManager.java:161"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild",
          "source": "AjBuildManager.java:278"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.incrementalBuild",
          "source": "AjBuildManager.java:168"
        },
        {
          "method": "org.aspectj.ajde.internal.CompilerAdapter.compile",
          "source": "CompilerAdapter.java:117"
        },
        {
          "method": "org.aspectj.ajde.internal.AspectJBuildManager$CompilerThread.run",
          "source": "AspectJBuildManager.java:191"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "138286",
      "date": "2006-04-25T00:29:34+02:00",
      "product": "AspectJ",
      "component": "Compiler",
      "severity": "normal"
    }
  ],
  "groupId": "138286",
  "bugId": "138286",
  "date": "2006-04-25T00:29:34+02:00",
  "product": "AspectJ",
  "component": "Compiler",
  "severity": "normal"
}