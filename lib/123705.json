{
  "comments": [
    "When scripting in Java, I try to get the http servlet request.\nIReportContext.getHttpServletRequest() returns an object, which by inspection seems to implement javax.servlet.HttpServletRequest.\nBut I get a ClassCastException when trying to cast the object to a HttpServletRequest.\n\nThe java project with the event handler class has $ECLIPSE_HOME/plugins/org.eclipse.tomcat_4.1.30.1/servlet.jar on the build path.\n\nI\u0027m guessing there might be a class loader problem?\n\nHere is the code:\npublic void onCreate(IImageInstance image, IReportContext reportContext) {\n    Object o \u003d reportContext.getHttpServletRequest();\n    Class[] interfaces \u003d o.getClass().getInterfaces();\n    for (int i \u003d 0; i \u003c interfaces.length; i++)\n        System.out.println(interfaces[i]);\n    HttpServletRequest request \u003d\n        (HttpServletRequest)reportContext.getHttpServletRequest();\n}\n\nThe printout of the System.out is:\ninterface javax.servlet.http.HttpServletRequest\n\nThe exception is:\n\nError0 : Error.UnhandledScriptError ( 1 time(s) )\ndetail : org.eclipse.birt.report.engine.api.EngineException: Unhandled exception when executing script at org.eclipse.birt.report.engine.script.internal.ScriptExecutor.addException(ScriptExecutor.java:204) at org.eclipse.birt.report.engine.script.internal.ScriptExecutor.addException(ScriptExecutor.java:194) at org.eclipse.birt.report.engine.script.internal.ImageScriptExecutor.handleOnCreate(ImageScriptExecutor.java:62) at org.eclipse.birt.report.engine.executor.ImageItemExecutor.execute(ImageItemExecutor.java:120) at org.eclipse.birt.report.engine.executor.ReportExecutorVisitor.visitImageItem(ReportExecutorVisitor.java:203) at org.eclipse.birt.report.engine.ir.ImageItemDesign.accept(ImageItemDesign.java:91) at org.eclipse.birt.report.engine.executor.ReportExecutor.execute(ReportExecutor.java:121) at org.eclipse.birt.report.engine.executor.ReportExecutor.execute(ReportExecutor.java:87) at org.eclipse.birt.report.engine.api.impl.RunAndRenderTask.run(RunAndRenderTask.java:175) at org.eclipse.birt.report.services.ReportEngineService.runAndRenderReport(ReportEngineService.java:442) at org.eclipse.birt.report.viewer.aggregation.layout.EngineFragment.doService(EngineFragment.java:100) at org.eclipse.birt.report.viewer.aggregation.BaseFragment.service(BaseFragment.java:156) at org.eclipse.birt.report.viewer.servlet.ViewerServlet.doGet(ViewerServlet.java:172) at javax.servlet.http.HttpServlet.service(HttpServlet.java:740) at org.apache.axis.transport.http.AxisServletBase.service(AxisServletBase.java:327) at javax.servlet.http.HttpServlet.service(HttpServlet.java:853) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:256) at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643) at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480) at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191) at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643) at org.apache.catalina.valves.CertificatesValve.invoke(CertificatesValve.java:246) at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641) at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480) at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995) at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2422) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180) at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643) at org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:171) at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641) at org.eclipse.tomcat.internal.EclipseErrorReportValve.invoke(EclipseErrorReportValve.java:153) at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641) at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480) at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174) at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643) at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480) at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995) at org.apache.coyote.tomcat4.CoyoteAdapter.service(CoyoteAdapter.java:199) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:828) at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:700) at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:584) at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:683) at java.lang.Thread.run(Thread.java:534)Caused by: java.lang.ClassCastException at ImageImpl.onCreate(ImageImpl.java:22) at org.eclipse.birt.report.engine.script.internal.ImageScriptExecutor.handleOnCreate(ImageScriptExecutor.java:59) ... 44 more",
    "This is a class loader issue in the script framework. Reassign to DaZhen since he has found a solution.",
    "Let me know if change is necessary for viewer part.",
    "When load the handler class , the parent class loader is the webapp class loader.\n",
    "reopen this bug since it fails in 2.1.0.  It was fixed in 2.1.0.",
    "There is a servlet.jar in the core plugin, it is used to compile the PlatformServletContext servlet. This JAR shouldn\u0027t be packaged into the final distribution plugin. If this class cast exception is casued by this JAR, we need choose either one of the following solutions:\n1. remove the JAR file, set the core.plugin depends on the tomcat plugin (optional).\n\n2. remove the JAR files, move the PlatformServletContext to view plugin.\n\n3. The user shouldn\u0027t use the source of core-plugin to debug the script, he/she need install the distribute package to the Eclipse. ",
    "Looks like there has been a regression and this problem is back in.  Note, this only happens in the Java Event Handler.  \n\nI have a simple report that calls:\n\n public void initialize(IReportContext reportContext) {\n\n        Object o \u003d reportContext.getHttpServletRequest();\n        Class[] interfaces \u003d o.getClass().getInterfaces();\n        for (int i \u003d 0; i \u003c interfaces.length; i++) {\n            System.out.println(\"interface \" + i + \" \" + interfaces[i]);\n          // Always returns\n          // interface 0 interface javax.servlet.http.HttpServletRequest\n        }\n\n\n        HttpServletRequest request \u003d null;\n        try {\n           request \u003d (HttpServletRequest) reportContext.getHttpServletRequest();\n           // NEVER goes here\n           System.out.println(\"serverName \" + request.getServerName());   \n        } catch (Exception e) {\n            System.out.println(\"Failure to cast \" + e.getMessage());  \n            // always goes here\n            e.printStackTrace();\n        }\n\n",
    "Are you using the Eclipse debuger to debug the event handler? does the event handler\u0027s project in the debuger\u0027s class path? \n\nIf so, the eclipse will add the event handler\u0027s classpath to the debuger which cause the exception.\n\nCan you close the event handler project and retry? It seems ok in the distribute enviroment.",
    "fixed"
  ],
  "commentCreationDates": [
    "2006-01-13T02:00:49+01:00",
    "2006-01-13T20:30:09+01:00",
    "2006-01-13T20:52:25+01:00",
    "2006-01-17T05:09:37+01:00",
    "2006-08-17T22:48:07+02:00",
    "2006-08-18T10:00:32+02:00",
    "2006-08-18T16:01:36+02:00",
    "2006-08-24T04:28:26+02:00",
    "2006-08-25T09:58:10+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.birt.report.engine.api.EngineException",
      "message": "Unhandled exception when executing script",
      "elements": [
        {
          "method": "org.eclipse.birt.report.engine.script.internal.ScriptExecutor.addException",
          "source": "ScriptExecutor.java:204"
        },
        {
          "method": "org.eclipse.birt.report.engine.script.internal.ScriptExecutor.addException",
          "source": "ScriptExecutor.java:194"
        },
        {
          "method": "org.eclipse.birt.report.engine.script.internal.ImageScriptExecutor.handleOnCreate",
          "source": "ImageScriptExecutor.java:62"
        },
        {
          "method": "org.eclipse.birt.report.engine.executor.ImageItemExecutor.execute",
          "source": "ImageItemExecutor.java:120"
        },
        {
          "method": "org.eclipse.birt.report.engine.executor.ReportExecutorVisitor.visitImageItem",
          "source": "ReportExecutorVisitor.java:203"
        },
        {
          "method": "org.eclipse.birt.report.engine.ir.ImageItemDesign.accept",
          "source": "ImageItemDesign.java:91"
        },
        {
          "method": "org.eclipse.birt.report.engine.executor.ReportExecutor.execute",
          "source": "ReportExecutor.java:121"
        },
        {
          "method": "org.eclipse.birt.report.engine.executor.ReportExecutor.execute",
          "source": "ReportExecutor.java:87"
        },
        {
          "method": "org.eclipse.birt.report.engine.api.impl.RunAndRenderTask.run",
          "source": "RunAndRenderTask.java:175"
        },
        {
          "method": "org.eclipse.birt.report.services.ReportEngineService.runAndRenderReport",
          "source": "ReportEngineService.java:442"
        },
        {
          "method": "org.eclipse.birt.report.viewer.aggregation.layout.EngineFragment.doService",
          "source": "EngineFragment.java:100"
        },
        {
          "method": "org.eclipse.birt.report.viewer.aggregation.BaseFragment.service",
          "source": "BaseFragment.java:156"
        },
        {
          "method": "org.eclipse.birt.report.viewer.servlet.ViewerServlet.doGet",
          "source": "ViewerServlet.java:172"
        },
        {
          "method": "javax.servlet.http.HttpServlet.service",
          "source": "HttpServlet.java:740"
        },
        {
          "method": "org.apache.axis.transport.http.AxisServletBase.service",
          "source": "AxisServletBase.java:327"
        },
        {
          "method": "javax.servlet.http.HttpServlet.service",
          "source": "HttpServlet.java:853"
        },
        {
          "method": "org.apache.catalina.core.ApplicationFilterChain.internalDoFilter",
          "source": "ApplicationFilterChain.java:247"
        },
        {
          "method": "org.apache.catalina.core.ApplicationFilterChain.doFilter",
          "source": "ApplicationFilterChain.java:193"
        },
        {
          "method": "org.apache.catalina.core.StandardWrapperValve.invoke",
          "source": "StandardWrapperValve.java:256"
        },
        {
          "method": "org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext",
          "source": "StandardPipeline.java:643"
        },
        {
          "method": "org.apache.catalina.core.StandardPipeline.invoke",
          "source": "StandardPipeline.java:480"
        },
        {
          "method": "org.apache.catalina.core.ContainerBase.invoke",
          "source": "ContainerBase.java:995"
        },
        {
          "method": "org.apache.catalina.core.StandardContextValve.invoke",
          "source": "StandardContextValve.java:191"
        },
        {
          "method": "org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext",
          "source": "StandardPipeline.java:643"
        },
        {
          "method": "org.apache.catalina.valves.CertificatesValve.invoke",
          "source": "CertificatesValve.java:246"
        },
        {
          "method": "org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext",
          "source": "StandardPipeline.java:641"
        },
        {
          "method": "org.apache.catalina.core.StandardPipeline.invoke",
          "source": "StandardPipeline.java:480"
        },
        {
          "method": "org.apache.catalina.core.ContainerBase.invoke",
          "source": "ContainerBase.java:995"
        },
        {
          "method": "org.apache.catalina.core.StandardContext.invoke",
          "source": "StandardContext.java:2422"
        },
        {
          "method": "org.apache.catalina.core.StandardHostValve.invoke",
          "source": "StandardHostValve.java:180"
        },
        {
          "method": "org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext",
          "source": "StandardPipeline.java:643"
        },
        {
          "method": "org.apache.catalina.valves.ErrorDispatcherValve.invoke",
          "source": "ErrorDispatcherValve.java:171"
        },
        {
          "method": "org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext",
          "source": "StandardPipeline.java:641"
        },
        {
          "method": "org.eclipse.tomcat.internal.EclipseErrorReportValve.invoke",
          "source": "EclipseErrorReportValve.java:153"
        },
        {
          "method": "org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext",
          "source": "StandardPipeline.java:641"
        },
        {
          "method": "org.apache.catalina.core.StandardPipeline.invoke",
          "source": "StandardPipeline.java:480"
        },
        {
          "method": "org.apache.catalina.core.ContainerBase.invoke",
          "source": "ContainerBase.java:995"
        },
        {
          "method": "org.apache.catalina.core.StandardEngineValve.invoke",
          "source": "StandardEngineValve.java:174"
        },
        {
          "method": "org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext",
          "source": "StandardPipeline.java:643"
        },
        {
          "method": "org.apache.catalina.core.StandardPipeline.invoke",
          "source": "StandardPipeline.java:480"
        },
        {
          "method": "org.apache.catalina.core.ContainerBase.invoke",
          "source": "ContainerBase.java:995"
        },
        {
          "method": "org.apache.coyote.tomcat4.CoyoteAdapter.service",
          "source": "CoyoteAdapter.java:199"
        },
        {
          "method": "org.apache.coyote.http11.Http11Processor.process",
          "source": "Http11Processor.java:828"
        },
        {
          "method": "org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection",
          "source": "Http11Protocol.java:700"
        },
        {
          "method": "org.apache.tomcat.util.net.TcpWorkerThread.runIt",
          "source": "PoolTcpEndpoint.java:584"
        },
        {
          "method": "org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run",
          "source": "ThreadPool.java:683"
        },
        {
          "method": "java.lang.Thread.run",
          "source": "Thread.java:534"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "123705",
      "date": "2006-01-13T02:00:49+01:00",
      "product": "BIRT",
      "component": "Report Engine",
      "severity": "critical"
    },
    {
      "exceptionType": "java.lang.ClassCastException",
      "elements": [
        {
          "method": "ImageImpl.onCreate",
          "source": "ImageImpl.java:22"
        },
        {
          "method": "org.eclipse.birt.report.engine.script.internal.ImageScriptExecutor.handleOnCreate",
          "source": "ImageScriptExecutor.java:59"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "123705",
      "date": "2006-01-13T02:00:49+01:00",
      "product": "BIRT",
      "component": "Report Engine",
      "severity": "critical"
    }
  ],
  "groupId": "123705",
  "bugId": "123705",
  "date": "2006-01-13T02:00:49+01:00",
  "product": "BIRT",
  "component": "Report Engine",
  "severity": "critical"
}