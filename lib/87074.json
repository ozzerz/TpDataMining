{
  "comments": [
    "[SWT and JFace from Eclipse 3.1 M5a]\n\nTo reproduce, run the attached code, hit \"END\" to jump to the end of the table,\nand start navigating upwards with the up arrow.  The first element in the\nviewable area will be blank; hitting ENTER on it causes the following:\n\n\njava.lang.ArrayIndexOutOfBoundsException: 179\n\tat\norg.eclipse.jface.viewers.deferred.ConcurrentTableUpdator.updateTable(ConcurrentTableUpdator.java:362)\n\tat\norg.eclipse.jface.viewers.deferred.ConcurrentTableUpdator.checkVisibleRange(ConcurrentTableUpdator.java:289)\n\tat\norg.eclipse.jface.viewers.deferred.BackgroundContentProvider.checkVisibleRange(BackgroundContentProvider.java:442)\n\tat\norg.eclipse.jface.viewers.deferred.DeferredContentProvider.updateElement(DeferredContentProvider.java:198)\n\tat org.eclipse.jface.viewers.TableViewer$1.handleEvent(TableViewer.java:105)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:842)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:866)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:851)\n\tat org.eclipse.swt.widgets.Table.checkData(Table.java:195)\n\tat org.eclipse.swt.widgets.Table.wmNotifyChild(Table.java:3581)\n\tat org.eclipse.swt.widgets.Control.WM_NOTIFY(Control.java:3553)\n\tat org.eclipse.swt.widgets.Composite.WM_NOTIFY(Composite.java:994)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3075)\n\tat org.eclipse.swt.widgets.Decorations.windowProc(Decorations.java:1493)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:3480)\n\tat org.eclipse.swt.internal.win32.OS.CallWindowProcW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.CallWindowProc(OS.java:1543)\n\tat org.eclipse.swt.widgets.Table.callWindowProc(Table.java:173)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3109)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:3480)\n\tat org.eclipse.swt.internal.win32.OS.CallWindowProcW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.CallWindowProc(OS.java:1543)\n\tat org.eclipse.swt.widgets.Table.callWindowProc(Table.java:173)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3109)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:3480)\n\tat org.eclipse.swt.internal.win32.OS.SendMessageW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.SendMessage(OS.java:2184)\n\tat org.eclipse.swt.widgets.Table.setRedraw(Table.java:2492)\n\tat org.eclipse.jface.viewers.TableViewer.inputChanged(TableViewer.java:662)\n\tat org.eclipse.jface.viewers.ContentViewer.setInput(ContentViewer.java:248)\n\tat org.eclipse.jface.viewers.StructuredViewer.setInput(StructuredViewer.java:1323)\n\tat\ncom.sdm.hw.client.swt.tests.DeferredContentProviderTest$1.widgetDefaultSelected(DeferredContentProviderTest.java:99)\n\tat org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:96)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:842)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:2908)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2541)\n\tat org.eclipse.jface.window.Window.runEventLoop(Window.java:718)\n\tat org.eclipse.jface.window.Window.open(Window.java:696)\n\tat\ncom.sdm.hw.client.swt.tests.DeferredContentProviderTest.main(DeferredContentProviderTest.java:67)\n\n\nThe code in question:\n---\npackage com.sdm.hw.client.swt.tests;\n\nimport java.util.Comparator;\n\nimport org.eclipse.jface.viewers.IContentProvider;\nimport org.eclipse.jface.viewers.ILabelProviderListener;\nimport org.eclipse.jface.viewers.ITableLabelProvider;\nimport org.eclipse.jface.viewers.TableViewer;\nimport org.eclipse.jface.viewers.deferred.DeferredContentProvider;\nimport org.eclipse.jface.viewers.deferred.SetModel;\nimport org.eclipse.jface.window.ApplicationWindow;\nimport org.eclipse.swt.SWT;\nimport org.eclipse.swt.events.SelectionAdapter;\nimport org.eclipse.swt.events.SelectionEvent;\nimport org.eclipse.swt.graphics.Image;\nimport org.eclipse.swt.graphics.Point;\nimport org.eclipse.swt.widgets.Composite;\nimport org.eclipse.swt.widgets.Control;\nimport org.eclipse.swt.widgets.Shell;\nimport org.eclipse.swt.widgets.Table;\nimport org.eclipse.swt.widgets.TableColumn;\n\n/**\n * Works with JFace 20050215-2100 and later.  Won\u0027t compile with a version\nearlier than 20050125-0800.\n * @author sue\n */\npublic class DeferredContentProviderTest extends ApplicationWindow {\n\n\tprivate static final int HEIGHT \u003d 200;\n\tprivate static final int WIDTH \u003d 400;\n\t\n\tprivate class MyTableLabelProvider implements ITableLabelProvider {\n\t\tpublic void addListener(ILabelProviderListener listener) {}\n\t\tpublic void dispose() {}\n\t\tpublic Image getColumnImage(Object element, int columnIndex) {\n\t\t\treturn null;\n\t\t}\n\t\tpublic String getColumnText(Object element, int columnIndex) {\n\t\t\treturn (String) element;\n\t\t}\n\t\tpublic boolean isLabelProperty(Object element, String property) {\n\t\t\treturn false;\n\t\t}\n\t\tpublic void removeListener(ILabelProviderListener listener) {}\n\t}\n\t\n\tprivate class MyComparator implements Comparator {\n\t    public int compare(Object o1, Object o2) {\n\t        int i1 \u003d Integer.parseInt(((String) o1).substring(8));\n\t        int i2 \u003d Integer.parseInt(((String) o2).substring(8));\n\t        return i1-i2;\n\t    }\n\t}\n\n\tprivate ITableLabelProvider labelProvider \u003d new MyTableLabelProvider();\n\tprivate IContentProvider contentProvider \u003d new DeferredContentProvider(new\nMyComparator());\n\tprivate SetModel model \u003d new SetModel();\n\t\n\tpublic static void main(String[] args) {\n\t\tSystem.out.println(\n\t\t\t\"To recreate the ArrayIndexOutOfBounds bug:\\n\"\n\t\t\t+ \"- Press End to navigate to the end of the table\\n\"\n\t\t\t+ \"- Scroll upwards with the arrow keys; the element at the top of the\nvisible area will be blank\\n\"\n\t\t\t+ \"- Press enter on the blank item to call viewer.setInput()\\n\" \n\t\t\t+ \"- Behaviour happens intermittently; scroll up and try a different element\nif the first one\\n\" \n\t\t\t+ \"  doesn\u0027t immediately throw the exception.\");\n\t\tnew DeferredContentProviderTest().open();\n    }\n\t\n\tpublic DeferredContentProviderTest() {\n\t\tsuper(null);\n\t\tsetBlockOnOpen(true);\n    }\n\n    protected void configureShell(Shell shell) {\n\t\tsuper.configureShell(shell);\n\t\tshell.setText(\"Virtual Table test program\");\n\t}\n    \n\tprotected Control createContents(Composite parent) {\n\t\tTable table \u003d new Table(parent, SWT.VIRTUAL);\n\t\tTableColumn column \u003d new TableColumn(table, SWT.NONE);\n\t\tcolumn.setWidth(WIDTH);\n\t\t\n\t\tfinal TableViewer viewer \u003d new TableViewer(table);\n\t\tviewer.setContentProvider(contentProvider);\n\t\tviewer.setLabelProvider(labelProvider);\n\t\tviewer.setInput(model);\n\t\t\n\t\tString[] string \u003d new String[200];\n\t\tfor (int i\u003d0; i\u003c200; i++) {\n\t\t    string[i] \u003d \"element#\" + i;\n\t\t}\n\t\tmodel.addAll(string);\n\n\t\ttable.addSelectionListener(new SelectionAdapter() {\n\t\t\tpublic void widgetDefaultSelected(SelectionEvent e) {\n\t\t\t\tSystem.out.println(\"calling viewer.setInput()\");\n\t\t\t\tviewer.setInput(model);\n\t\t\t}\n\t\t});\n\t\t\n\t\treturn table;\n\t}\n\t\n\tprotected Point getInitialSize() {\n\t\treturn new Point(WIDTH, HEIGHT);\n\t}\n\t\n}",
    "Created an attachment (id\u003d18438)\nTest code that reproduces the bug\n",
    "Thanks for the detailed bug report. Fixed in head.",
    "Verified using the attached test case in I20050401-1205",
    "Forgot to flag as verified. :-)"
  ],
  "commentCreationDates": [
    "2005-03-03T15:13:27+01:00",
    "2005-03-03T15:15:01+01:00",
    "2005-03-11T05:45:45+01:00",
    "2005-04-01T21:51:36+02:00",
    "2005-04-01T21:51:50+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ArrayIndexOutOfBoundsException",
      "message": "179",
      "elements": [
        {
          "method": "org.eclipse.jface.viewers.deferred.ConcurrentTableUpdator.updateTable",
          "source": "ConcurrentTableUpdator.java:362"
        },
        {
          "method": "org.eclipse.jface.viewers.deferred.ConcurrentTableUpdator.checkVisibleRange",
          "source": "ConcurrentTableUpdator.java:289"
        },
        {
          "method": "org.eclipse.jface.viewers.deferred.BackgroundContentProvider.checkVisibleRange",
          "source": "BackgroundContentProvider.java:442"
        },
        {
          "method": "org.eclipse.jface.viewers.deferred.DeferredContentProvider.updateElement",
          "source": "DeferredContentProvider.java:198"
        },
        {
          "method": "org.eclipse.jface.viewers.TableViewer$1.handleEvent",
          "source": "TableViewer.java:105"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:842"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:866"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:851"
        },
        {
          "method": "org.eclipse.swt.widgets.Table.checkData",
          "source": "Table.java:195"
        },
        {
          "method": "org.eclipse.swt.widgets.Table.wmNotifyChild",
          "source": "Table.java:3581"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.WM_NOTIFY",
          "source": "Control.java:3553"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.WM_NOTIFY",
          "source": "Composite.java:994"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3075"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.windowProc",
          "source": "Decorations.java:1493"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3480"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.CallWindowProcW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.CallWindowProc",
          "source": "OS.java:1543"
        },
        {
          "method": "org.eclipse.swt.widgets.Table.callWindowProc",
          "source": "Table.java:173"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3109"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3480"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.CallWindowProcW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.CallWindowProc",
          "source": "OS.java:1543"
        },
        {
          "method": "org.eclipse.swt.widgets.Table.callWindowProc",
          "source": "Table.java:173"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3109"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3480"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.SendMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.SendMessage",
          "source": "OS.java:2184"
        },
        {
          "method": "org.eclipse.swt.widgets.Table.setRedraw",
          "source": "Table.java:2492"
        },
        {
          "method": "org.eclipse.jface.viewers.TableViewer.inputChanged",
          "source": "TableViewer.java:662"
        },
        {
          "method": "org.eclipse.jface.viewers.ContentViewer.setInput",
          "source": "ContentViewer.java:248"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.setInput",
          "source": "StructuredViewer.java:1323"
        },
        {
          "method": "com.sdm.hw.client.swt.tests.DeferredContentProviderTest$1.widgetDefaultSelected",
          "source": "DeferredContentProviderTest.java:99"
        },
        {
          "method": "org.eclipse.swt.widgets.TypedListener.handleEvent",
          "source": "TypedListener.java:96"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:842"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:2908"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2541"
        },
        {
          "method": "org.eclipse.jface.window.Window.runEventLoop",
          "source": "Window.java:718"
        },
        {
          "method": "org.eclipse.jface.window.Window.open",
          "source": "Window.java:696"
        },
        {
          "method": "com.sdm.hw.client.swt.tests.DeferredContentProviderTest.main",
          "source": "DeferredContentProviderTest.java:67"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "87074",
      "date": "2005-03-03T15:13:27+01:00",
      "product": "Platform",
      "component": "UI",
      "severity": "normal"
    }
  ],
  "groupId": "87074",
  "bugId": "87074",
  "date": "2005-03-03T15:13:27+01:00",
  "product": "Platform",
  "component": "UI",
  "severity": "normal"
}