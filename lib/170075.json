{
  "comments": [
    "Build ID: M20060921-0945\n\nSteps To Reproduce:\n1. Install TPTP profiler 4.3.0 and New Java Profiler\n2. Get Harmony JRE snapshot from http://harmony.apache.org\n3. Set up New Agent Controller to use Harmony JRE\n4. Run Eclipse and create HelloWorld application\n5. Start profiling HelloWorld and choose Execution Time Analysis\n6. See VerifyError exception dump appeared in output console\n\n\nMore information:\nHarmony JVM rejects HelloWorld class instrumented by TPTP JVMTI profiler and throws VerifyError exception:\n\nUncaught exception in main:\njava.lang.VerifyError: (class: HelloWorld, method: \u003cinit\u003e()V) Uninitialized reference usage\n\tat java.lang.VMClassRegistry.defineClass(Native Method)\n\tat java.lang.ClassLoader.defineClass(Unknown Source)\n\tat java.security.SecureClassLoader.defineClass(SecureClassLoader.java:70)\n\tat java.net.URLClassLoader.findClassImpl(URLClassLoader.java:1137)\n\tat java.net.URLClassLoader$4.run(URLClassLoader.java:619)\n\tat java.net.URLClassLoader$4.run(URLClassLoader.java:1)\n\tat java.security.AccessController.doPrivilegedImpl(Unknown Source)\n\tat java.security.AccessController.doPrivileged(Unknown Source)\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:621)\n\tat java.lang.ClassLoader.loadClass(Unknown Source)\n\tat java.lang.ClassLoader$SystemClassLoader.loadClass(Unknown Source)\n\tat java.lang.ClassLoader.loadClass(Unknown Source)\nFAILED to invoke JVM.\n\nIt looks like that Martini CG instrumentation is incorrect, though it is accepted by Sun and JRockit JRE. Below is explanation from Harmony developers.\n\n-----------------------------------------------------\nAccording Java Specification 1.5 Chapter 4.11.1.1:\n?There is never an uninitialized class instance in a local variable in code protected by an exception handler.?\n\nThere is a disassembler of instrumented class:\n\nMethod name:\"\u003cinit\u003e\" public Signature: 6\u003d()void\nAttribute \"Code\", length:95, max_stack:2, max_locals:1, code_length:45\n  0: getstatic #41\u003d\u003cField mytests.HelloWorld.sm_bAlreadyInvoked70056 boolean\u003e\n  3: ldc_w #62\u003d\u003cInteger 70056\u003e\n  6: invokestatic #53\u003d\u003cMethod org.eclipse.tptp.martini.CGProxy.MethodEnter (boolean,int)void\u003e\n  9: getstatic #41\u003d\u003cField mytests.HelloWorld.sm_bAlreadyInvoked70056 boolean\u003e\n 12: ifne 19\n 15: iconst_1\n 16: putstatic #41\u003d\u003cField mytests.HelloWorld.sm_bAlreadyInvoked70056 boolean\u003e\n 19: aload_0\n 20: invokespecial #8\u003d\u003cMethod java.lang.Object.\u003cinit\u003e ()void\u003e\n 23: goto_w 28\n 28: nop\n 29: ldc_w #62\u003d\u003cInteger 70056\u003e\n 32: invokestatic #57\u003d\u003cMethod org.eclipse.tptp.martini.CGProxy.MethodLeave (int)void\u003e\n 35: nop\n 36: return\n 37: ldc_w #62\u003d\u003cInteger 70056\u003e\n 40: invokestatic #57\u003d\u003cMethod org.eclipse.tptp.martini.CGProxy.MethodLeave (int)void\u003e\n 43: nop\n 44: athrow\nExceptions (count: 1):\n  start: 19, end: 29, handler: 37, type: 0 /* finally */\nAttribute \"LineNumberTable\", length:6, count: 1\n  line: 3 at pc: 19\nAttribute \"LocalVariableTable\", length:12, count: 1\n  slot#0: name: 12\u003dthis, type: 13\u003dmytests.HelloWorld (pc: 19 length: 26)\n\nAs you can see try block protects a class constructor. Uninitialized reference of class is contained in local variables on this basic block.\n\nWhy reference VM doesn?t reject such class, this is a question of investigation. And I could take some time.\n\nI suggest several ways to complete test run:\n1.\tChange classes instrumentation to correct one. \n2.\tDisable verifier and repeat TPTP tests run. \n\nTo disable verifier VM need to give an option in command line: -XDvm.use_verifier\u003dfalse.\n-----------------------------------------------------",
    "I have confirmed this to be an issue with the Martini Call Graph instrumentation adaptor.",
    "Verifier in Harmony JVM was updated to follow RI behavior and don\u0027t reject those classes which are accepted by RI. Now, the current implementation of TPTP JVMTI profiler works with Harmony as well.",
    "Based on the latest Harmony test results, I recommend to lower the priority of this bug. Retargetting to future."
  ],
  "commentCreationDates": [
    "2007-01-10T12:46:13+01:00",
    "2007-01-10T12:52:06+01:00",
    "2007-02-16T09:49:36+01:00",
    "2007-04-12T07:51:55+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.VerifyError",
      "message": "(class: HelloWorld, method: \u003cinit\u003e()V) Uninitialized reference usage",
      "elements": [
        {
          "method": "java.lang.VMClassRegistry.defineClass",
          "source": "Native Method"
        },
        {
          "method": "java.lang.ClassLoader.defineClass",
          "source": "Unknown Source"
        },
        {
          "method": "java.security.SecureClassLoader.defineClass",
          "source": "SecureClassLoader.java:70"
        },
        {
          "method": "java.net.URLClassLoader.findClassImpl",
          "source": "URLClassLoader.java:1137"
        },
        {
          "method": "java.net.URLClassLoader$4.run",
          "source": "URLClassLoader.java:619"
        },
        {
          "method": "java.net.URLClassLoader$4.run",
          "source": "URLClassLoader.java:1"
        },
        {
          "method": "java.security.AccessController.doPrivilegedImpl",
          "source": "Unknown Source"
        },
        {
          "method": "java.security.AccessController.doPrivileged",
          "source": "Unknown Source"
        },
        {
          "method": "java.net.URLClassLoader.findClass",
          "source": "URLClassLoader.java:621"
        },
        {
          "method": "java.lang.ClassLoader.loadClass",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.ClassLoader$SystemClassLoader.loadClass",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.ClassLoader.loadClass",
          "source": "Unknown Source"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "170075",
      "date": "2007-01-10T12:46:13+01:00",
      "product": "TPTP Profiling",
      "component": "Platform.Agents.JVMTI",
      "severity": "normal"
    }
  ],
  "groupId": "170075",
  "bugId": "170075",
  "date": "2007-01-10T12:46:13+01:00",
  "product": "TPTP Profiling",
  "component": "Platform.Agents.JVMTI",
  "severity": "normal"
}