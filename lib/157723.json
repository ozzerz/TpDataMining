{
  "comments": [
    "The resolver State is incorrectly allowed to be flushed from memory after a new dynamic import package is resolved.  This causes inconsistencies in the state models that eventually will lead to a NPE when we try to repopulate the state back into memory from disk.  The NPE looks something like the following:\n\njava.lang.NullPointerException\n\tat org.eclipse.osgi.internal.resolver.StateReader.readBundleDescriptionLazyData(StateReader.java:249)\n\tat org.eclipse.osgi.internal.resolver.StateReader.fullyLoad(StateReader.java:616)\n\tat org.eclipse.osgi.internal.resolver.BundleDescriptionImpl.fullyLoad(BundleDescriptionImpl.java:452)\n\tat org.eclipse.osgi.internal.resolver.BundleDescriptionImpl.getResolvedRequires(BundleDescriptionImpl.java:167)\n\tat org.eclipse.osgi.framework.internal.core.BundleLoader.initialize(BundleLoader.java:133)\n\tat org.eclipse.osgi.framework.internal.core.BundleLoader.\u003cinit\u003e(BundleLoader.java:128)\n\tat org.eclipse.osgi.framework.internal.core.BundleLoaderProxy.getBundleLoader(BundleLoaderProxy.java:57)\n\tat org.eclipse.osgi.framework.internal.core.BundleHost.getBundleLoader(BundleHost.java:526)\n\tat org.eclipse.osgi.framework.internal.core.BundleHost.checkLoader(BundleHost.java:197)\n\tat org.eclipse.osgi.framework.internal.core.BundleHost.loadClass(BundleHost.java:224)\n\tat org.eclipse.osgi.framework.internal.core.AbstractBundle.loadClass(AbstractBundle.java:1245)\n\tat org.eclipse.core.internal.registry.osgi.RegistryStrategyOSGI.createExecutableExtension(RegistryStrategyOSGI.java:147)\n\tat org.eclipse.core.internal.registry.ExtensionRegistry.createExecutableExtension(ExtensionRegistry.java:759)\n\tat org.eclipse.core.internal.registry.ConfigurationElement.createExecutableExtension(ConfigurationElement.java:243)\n\tat org.eclipse.core.internal.registry.ConfigurationElementHandle.createExecutableExtension(ConfigurationElementHandle.java:51)\n\tat org.eclipse.ui.internal.WorkbenchPlugin$1.run(WorkbenchPlugin.java:242)\n\tat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:67)\n\tat org.eclipse.ui.internal.WorkbenchPlugin.createExtension(WorkbenchPlugin.java:238)\n\tat org.eclipse.ui.internal.PluginAction.createDelegate(PluginAction.java:120)\n\tat org.eclipse.ui.internal.PluginAction.runWithEvent(PluginAction.java:225)\n\tat org.eclipse.ui.internal.WWinPluginAction.runWithEvent(WWinPluginAction.java:229)\n\tat org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:539)\n\tat org.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:488)\n\tat org.eclipse.jface.action.ActionContributionItem$5.handleEvent(ActionContributionItem.java:400)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:928)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3348)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2968)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1914)\n\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1878)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:419)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)\n\tat com.ibm.rcp.personality.framework.internal.RCPApplication.run(RCPApplication.java:70)\n\tat org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:78)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:92)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:68)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:400)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:177)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:615)\n\tat org.eclipse.core.launcher.Main.invokeFramework(Main.java:336)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:280)\n\tat org.eclipse.core.launcher.Main.run(Main.java:977)\n\tat com.ibm.rcp.core.internal.launcher.Main.startLaunch(Main.java:847)\n\tat com.ibm.rcp.core.internal.launcher.Main.main(Main.java:1261)",
    "Created an attachment (id\u003d50440)\npatch\n\nThis patch adds a check to make sure a dynamic cache change has not occurred before allowing the state to be flushed.",
    "Looks like this can happen quite easily in some reasonable scenarios for people who are looking to ship products based on 3.2.1.  Tom claims that the risk level is \"very low\".  Lots of testing is warranted and the patch should be explained to Pascal for sanity checking.\n\nOtherwise +1 for 3.2.1",
    "Created an attachment (id\u003d50460)\npatch\n\nUpdated patch to reset the fullyLoaded flag when unloading the state.",
    "Created an attachment (id\u003d50466)\npatch\n\nNeed to check if reader is null before synchronizing on it in fullyLoad().",
    "The patch looks good to me.\n+1",
    "latest patch has been released to 3.2.1 and to HEAD for 3.3."
  ],
  "commentCreationDates": [
    "2006-09-19T05:06:55+02:00",
    "2006-09-19T05:12:30+02:00",
    "2006-09-19T05:31:38+02:00",
    "2006-09-19T15:50:55+02:00",
    "2006-09-19T16:24:15+02:00",
    "2006-09-19T16:28:22+02:00",
    "2006-09-19T17:44:43+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.osgi.internal.resolver.StateReader.readBundleDescriptionLazyData",
          "source": "StateReader.java:249"
        },
        {
          "method": "org.eclipse.osgi.internal.resolver.StateReader.fullyLoad",
          "source": "StateReader.java:616"
        },
        {
          "method": "org.eclipse.osgi.internal.resolver.BundleDescriptionImpl.fullyLoad",
          "source": "BundleDescriptionImpl.java:452"
        },
        {
          "method": "org.eclipse.osgi.internal.resolver.BundleDescriptionImpl.getResolvedRequires",
          "source": "BundleDescriptionImpl.java:167"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleLoader.initialize",
          "source": "BundleLoader.java:133"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleLoader.\u003cinit\u003e",
          "source": "BundleLoader.java:128"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleLoaderProxy.getBundleLoader",
          "source": "BundleLoaderProxy.java:57"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleHost.getBundleLoader",
          "source": "BundleHost.java:526"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleHost.checkLoader",
          "source": "BundleHost.java:197"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleHost.loadClass",
          "source": "BundleHost.java:224"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.AbstractBundle.loadClass",
          "source": "AbstractBundle.java:1245"
        },
        {
          "method": "org.eclipse.core.internal.registry.osgi.RegistryStrategyOSGI.createExecutableExtension",
          "source": "RegistryStrategyOSGI.java:147"
        },
        {
          "method": "org.eclipse.core.internal.registry.ExtensionRegistry.createExecutableExtension",
          "source": "ExtensionRegistry.java:759"
        },
        {
          "method": "org.eclipse.core.internal.registry.ConfigurationElement.createExecutableExtension",
          "source": "ConfigurationElement.java:243"
        },
        {
          "method": "org.eclipse.core.internal.registry.ConfigurationElementHandle.createExecutableExtension",
          "source": "ConfigurationElementHandle.java:51"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchPlugin$1.run",
          "source": "WorkbenchPlugin.java:242"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:67"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchPlugin.createExtension",
          "source": "WorkbenchPlugin.java:238"
        },
        {
          "method": "org.eclipse.ui.internal.PluginAction.createDelegate",
          "source": "PluginAction.java:120"
        },
        {
          "method": "org.eclipse.ui.internal.PluginAction.runWithEvent",
          "source": "PluginAction.java:225"
        },
        {
          "method": "org.eclipse.ui.internal.WWinPluginAction.runWithEvent",
          "source": "WWinPluginAction.java:229"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:539"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$2",
          "source": "ActionContributionItem.java:488"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$5.handleEvent",
          "source": "ActionContributionItem.java:400"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:928"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:3348"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2968"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1914"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1878"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:419"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "com.ibm.rcp.personality.framework.internal.RCPApplication.run",
          "source": "RCPApplication.java:70"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:78"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:92"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:68"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:400"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:177"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:64"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:43"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:615"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:336"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:280"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:977"
        },
        {
          "method": "com.ibm.rcp.core.internal.launcher.Main.startLaunch",
          "source": "Main.java:847"
        },
        {
          "method": "com.ibm.rcp.core.internal.launcher.Main.main",
          "source": "Main.java:1261"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "157723",
      "date": "2006-09-19T05:06:55+02:00",
      "product": "Equinox",
      "component": "Framework",
      "severity": "normal"
    }
  ],
  "groupId": "157723",
  "bugId": "157723",
  "date": "2006-09-19T05:06:55+02:00",
  "product": "Equinox",
  "component": "Framework",
  "severity": "normal"
}