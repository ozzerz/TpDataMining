{
  "comments": [
    "We\u0027ve found a case where the OpenWithMenu fails and causes a \nNullPointerException that is not caught. This defect was found on M5, and is \ncritical because you can no longer access the actions on the rest of the popup \nmenu, which may not be available anywhere else. The problem can be reproduced \nwith the following steps:\n\n1) Start Eclipse and use the Open With menu in the\n   Navigator to open a file with a non-default editor.\n2) Shutdown.\n3) Do something to change the editor that you used. Some possibilities:\n   a) Remove the extension point.\n   b) Change the id.\n   c) Remove the plugin.\n   All of these things can occur when migrating between\n   two versions of an Eclipse based product, or when\n   using the same workspace with two products, etc.\n4) Reopen Eclipse and right-click on the same file. Only\n   the first few items in the menu will be visible in the\n   menu, and the last item, the Open With menu, is empty.\n   An internal error occurs and a dialog will show you an\n   exception in OpenWithMenu.fill().\n\nThe place where the code fails is shown below. When the preferred editor no \nlonger exists, the preferredEditor variable is null and causes a \nNullPointerException as shown. Further below is the stack trace.\n\n------------------- Code Snippet -------------------\n\n/* (non-Javadoc)\n * Fills the menu with perspective items.\n */\npublic void fill(Menu menu, int index) {\n\tIFile file \u003d getFileResource();\n\tif (file \u003d\u003d null) {\n\t\treturn;\n\t}\n\n\tIEditorDescriptor defaultEditor \u003d registry.getDefaultEditor();\n\tIEditorDescriptor preferredEditor \u003d registry.getDefaultEditor(file);\n\tObject[] editors \u003d sorter.sort(registry.getEditors(file));\n\tboolean defaultFound \u003d false;\n\n\tfor (int i \u003d 0; i \u003c editors.length; i++) {\n\t\tIEditorDescriptor editor \u003d (IEditorDescriptor) editors[i];\n\t\tcreateMenuItem(menu, editor, editor.getId().equals\n(\u003e\u003epreferredEditor\u003c\u003c.getId()));\n\t\tif (editor.getId().equals(defaultEditor.getId()))\n\t\t\tdefaultFound \u003d true;\n\t}\n\n------------------- Log Error -------------------\n\n\u003clog-entry date\u003d\"Fri Apr 19 17:48:55 EDT 2002\"\u003e\n  \u003cstatus\n     plugin-id\u003d\"org.eclipse.core.resources\"\n     severity\u003d\"INFO\"\n     message\u003d\"Unhandled exception caught in event loop.\"\n     code\u003d\"4\"\u003e\n  \u003c/status\u003e\n\u003c/log-entry\u003e\n\u003clog-entry date\u003d\"Fri Apr 19 17:48:55 EDT 2002\"\u003e\n  \u003cstatus\n     plugin-id\u003d\"org.eclipse.ui\"\n     severity\u003d\"ERROR\"\n     message\u003d\"java.lang.NullPointerException\"\n     code\u003d\"0\"\u003e\n    \u003cexception\n       message\u003d\"null\"\n       trace\u003d\"\njava.lang.NullPointerException\n\tat org.eclipse.ui.actions.OpenWithMenu.fill(OpenWithMenu.java:172)\n\tat org.eclipse.jface.action.MenuManager.update(MenuManager.java\n(Compiled Code))\n\tat org.eclipse.jface.action.MenuManager.update(MenuManager.java:444)\n\tat org.eclipse.jface.action.MenuManager.fill(MenuManager.java:187)\n\tat org.eclipse.jface.action.MenuManager.update(MenuManager.java\n(Compiled Code))\n\tat org.eclipse.jface.action.MenuManager.update(MenuManager.java:444)\n\tat org.eclipse.jface.action.MenuManager.handleAboutToShow\n(MenuManager.java:307)\n\tat org.eclipse.jface.action.MenuManager.access$0(MenuManager.java:303)\n\tat org.eclipse.jface.action.MenuManager$2.menuShown\n(MenuManager.java:333)\n\tat org.eclipse.swt.widgets.TypedListener.handleEvent\n(TypedListener.java:112)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java\n(Compiled Code))\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:841)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:827)\n\tat org.eclipse.swt.widgets.Control.WM_INITMENUPOPUP(Control.java:2984)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java(Compiled \nCode))\n\tat org.eclipse.swt.widgets.Decorations.windowProc(Decorations.java:1334)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java(Compiled \nCode))\n\tat org.eclipse.swt.internal.win32.OS.TrackPopupMenu(Native Method)\n\tat org.eclipse.swt.widgets.Menu.setVisible(Menu.java:810)\n\tat org.eclipse.swt.widgets.Control.WM_CONTEXTMENU(Control.java:2797)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java(Compiled \nCode))\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java(Compiled \nCode))\n\tat org.eclipse.swt.internal.win32.OS.CallWindowProcW(Native Method)\n\tat org.eclipse.swt.widgets.Tree.callWindowProc(Tree.java(Compiled Code))\n\tat org.eclipse.swt.widgets.Tree.callWindowProc(Tree.java(Compiled Code))\n\tat org.eclipse.swt.widgets.Control.WM_RBUTTONUP(Control.java:3676)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java(Compiled \nCode))\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java(Compiled \nCode))\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:1211)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:1206)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:836)\n\tat org.eclipse.ui.internal.Workbench.run(Workbench.java:819)\n\tat org.eclipse.core.internal.boot.InternalBootLoader.run\n(InternalBootLoader.java:777)\n\tat org.eclipse.core.boot.BootLoader.run(BootLoader.java:319)\n\tat java.lang.reflect.Method.invoke(Native Method)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:190)\n\tat org.eclipse.core.launcher.Main.run(Main.java:549)\n\tat org.eclipse.core.launcher.Main.main(Main.java:390)\n\"\u003e\n    \u003c/exception\u003e\n  \u003c/status\u003e\n\u003c/log-entry\u003e",
    "Added the appropriate null checks.\nThanks for the detailed report.\nThis will be in tomorrow\u0027s integration build.\n",
    "Although the null check fixees were released in today\u0027s build, I had trouble \nactually reproducing the problem.\nI tried the following:\n- add a new \"Foo Editor\" extension in plugin.xml, for file extension \"txt\"\n- launch target\n- open a .txt file using Open With \u003e Foo Editor\n- close it\n- exit target \n- remove \"Foo Editor\" extension from plugin.xml\n- relaunch target\n- the menu popped up OK\n\nIt also worked when I changed the file extension to \"foo\".\n\nLooking through the code, I could not see how this would occur, since getEditors\n(IFile) should return an empty list if getDefaultEditor(IFile) returns null.\nIt\u0027s possible that manually removing a registered editor association using \nworkbench preferences would cause this.\nIs this the case you hit?\n\nCould you please provide concrete steps to reproduce this on M5, so I can \ndetermine whether a patch is needed.\n\nReopening PR as patch candidate for M5.\n",
    "Needed for Friday\u0027s build.",
    "Was fixed in M5\u0027.",
    "Cleaning up - verified long ago."
  ],
  "commentCreationDates": [
    "2002-04-21T16:29:58+02:00",
    "2002-04-22T23:10:51+02:00",
    "2002-04-23T20:54:25+02:00",
    "2002-04-24T22:57:32+02:00",
    "2002-05-07T16:56:40+02:00",
    "2005-06-30T00:01:07+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.ui.actions.OpenWithMenu.fill",
          "source": "OpenWithMenu.java:172"
        },
        {
          "method": "org.eclipse.jface.action.MenuManager.update",
          "source": "MenuManager.java (Compiled Code)"
        },
        {
          "method": "org.eclipse.jface.action.MenuManager.update",
          "source": "MenuManager.java:444"
        },
        {
          "method": "org.eclipse.jface.action.MenuManager.fill",
          "source": "MenuManager.java:187"
        },
        {
          "method": "org.eclipse.jface.action.MenuManager.update",
          "source": "MenuManager.java (Compiled Code)"
        },
        {
          "method": "org.eclipse.jface.action.MenuManager.update",
          "source": "MenuManager.java:444"
        },
        {
          "method": "org.eclipse.jface.action.MenuManager.handleAboutToShow",
          "source": "MenuManager.java:307"
        },
        {
          "method": "org.eclipse.jface.action.MenuManager.access$0",
          "source": "MenuManager.java:303"
        },
        {
          "method": "org.eclipse.jface.action.MenuManager$2.menuShown",
          "source": "MenuManager.java:333"
        },
        {
          "method": "org.eclipse.swt.widgets.TypedListener.handleEvent",
          "source": "TypedListener.java:112"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java (Compiled Code)"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:841"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:827"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.WM_INITMENUPOPUP",
          "source": "Control.java:2984"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java(Compiled  Code)"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.windowProc",
          "source": "Decorations.java:1334"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java(Compiled  Code)"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.TrackPopupMenu",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.widgets.Menu.setVisible",
          "source": "Menu.java:810"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.WM_CONTEXTMENU",
          "source": "Control.java:2797"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java(Compiled  Code)"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java(Compiled  Code)"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.CallWindowProcW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.widgets.Tree.callWindowProc",
          "source": "Tree.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.swt.widgets.Tree.callWindowProc",
          "source": "Tree.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.WM_RBUTTONUP",
          "source": "Control.java:3676"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java(Compiled  Code)"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java(Compiled  Code)"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessage",
          "source": "OS.java:1211"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:1206"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:836"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.run",
          "source": "Workbench.java:819"
        },
        {
          "method": "org.eclipse.core.internal.boot.InternalBootLoader.run",
          "source": "InternalBootLoader.java:777"
        },
        {
          "method": "org.eclipse.core.boot.BootLoader.run",
          "source": "BootLoader.java:319"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:190"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:549"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:390"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "14291",
      "date": "2002-04-21T16:29:58+02:00",
      "product": "Platform",
      "component": "UI",
      "severity": "blocker"
    }
  ],
  "groupId": "14291",
  "bugId": "14291",
  "date": "2002-04-21T16:29:58+02:00",
  "product": "Platform",
  "component": "UI",
  "severity": "blocker"
}