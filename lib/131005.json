{
  "comments": [
    "ABC Facet definition:\n\n\t\u003cextension point\u003d\"org.eclipse.wst.common.project.facet.core.facets\"\u003e\n\t  \u003cproject-facet id\u003d\"abc\"\u003e\n\t    \u003clabel\u003eABC\u003c/label\u003e\n\t    \u003cdescription\u003eABC description\u003c/description\u003e\t    \n\t  \u003c/project-facet\u003e\n\t\n\t  \u003cproject-facet-version facet\u003d\"abc\" version\u003d\"1.0\"\u003e\n\t  \u003caction type\u003d\"install\"\u003e \n\t    \u003cdelegate class\u003d\"ABCFacetInstallDelegate\"/\u003e\n\t    \u003cconfig-factory class\u003d\"ABCFacetInstallDataModelProvider\"/\u003e\n\t  \u003c/action\u003e\t  \n\t  \u003cconstraint\u003e\n        \u003cor\u003e        \t\n\t        \u003crequires facet\u003d\"jst.java\" version\u003d\"\u0026gt;\u003d1.3\"/\u003e\n        \t\u003crequires facet\u003d\"jst.web\" version\u003d\"2.2,2.3\"/\u003e\n        \u003c/or\u003e\t\t  \n\t    \u003c/constraint\u003e\n\t  \u003c/project-facet-version\u003e\n\t  \u003cpreset id\u003d\"abc.preset\"\u003e\n\t  \u003clabel\u003emy preset\u003c/label\u003e\n\t  \u003cfacet id\u003d\"jst.java\" version\u003d\"5.0\"/\u003e\t\n\t  \u003cfacet id\u003d\"jst.web\" version\u003d\"2.3\"/\u003e \n\t  \u003cfacet id\u003d\"abc\" version\u003d\"1.0\"/\u003e\n\t  \u003c/preset\u003e\t  \t   \n      \u003ctemplate id\u003d\"template.abc\"\u003e\n      \t\u003clabel\u003eABC\u003c/label\u003e      \t     \t\n      \t\u003cfixed facet\u003d\"jst.java\"/\u003e      \t\n      \t\u003cfixed facet\u003d\"abc\"/\u003e        \t\n      \u003c/template\u003e\n      \u003ctemplate id\u003d\"template.abc2\"\u003e\n      \t\u003clabel\u003eabc 2\u003c/label\u003e  \n      \t\u003cpreset id\u003d\"abc.preset\"/\u003e      \t    \t\n      \t\u003cfixed facet\u003d\"jst.java\"/\u003e   \n      \t\u003cfixed facet\u003d\"jst.web\"/\u003e   \t\n      \t\u003cfixed facet\u003d\"abc\"/\u003e      \t     \t\n      \u003c/template\u003e\n\u003c/extension\u003e\n\n\nSome developers get this IllegalArgumentException in a self hosted image, others see it in the single instance scenario.  The project wizard fails to display the first page due to this exception.\n\nEven with WTP 1.0.1 out, it is still not clear how to achieve certain things with regard to the Facet Selection panel of the Add/remove facets wizard page.  I want the user to see a particular combination of preselected facets based on which of my project wizards is launched, thus the use of the two templates and the presets above.  Does facet documentation exist now?  I see very limited use of the template and preset attributes, thus there is not enough to get educated on how to achieve the results desired.\n\nStack trace:\njava.lang.IllegalArgumentException\n                at org.eclipse.wst.common.project.facet.ui.internal.FacetsSelectionPanel.selectPreset(FacetsSelectionPanel.java:725)\n                at org.eclipse.wst.common.project.facet.ui.internal.FacetsSelectionPage.createControl(FacetsSelectionPage.java:149)\n                at org.eclipse.jface.wizard.Wizard.createPageControls(Wizard.java:179)\n                at org.eclipse.wst.common.project.facet.ui.AddRemoveFacetsWizard.createPageControls(AddRemoveFacetsWizard.java:259)\n                at org.eclipse.jface.wizard.WizardDialog.createPageControls(WizardDialog.java:611)\n                at org.eclipse.jface.wizard.WizardDialog.setWizard(WizardDialog.java:965)\n                at org.eclipse.jface.wizard.WizardDialog.updateForPage(WizardDialog.java:1016)\n                at org.eclipse.jface.wizard.WizardDialog.access$2(WizardDialog.java:1013)\n                at org.eclipse.jface.wizard.WizardDialog$4.run(WizardDialog.java:1003)\n                at org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:69)\n                at org.eclipse.jface.wizard.WizardDialog.showPage(WizardDialog.java:1001)\n                at org.eclipse.jface.wizard.WizardDialog.nextPressed(WizardDialog.java:753)\n                at org.eclipse.jface.wizard.WizardDialog.buttonPressed(WizardDialog.java:345)\n                at org.eclipse.jface.dialogs.Dialog$2.widgetSelected(Dialog.java:556)\n                at org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:90)\n                at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n                at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:843)\n                at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3125)\n                at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2758)\n                at org.eclipse.jface.window.Window.runEventLoop(Window.java:809)\n                at org.eclipse.jface.window.Window.open(Window.java:787)\n                at org.eclipse.ui.actions.NewProjectAction.run(NewProjectAction.java:114)\n                at org.eclipse.jface.action.Action.runWithEvent(Action.java:996)\n                at org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:538)\n                at org.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:488)\n                at org.eclipse.jface.action.ActionContributionItem$5.handleEvent(ActionContributionItem.java:400)\n                at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n                at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:843)\n                at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3125)\n                at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2758)\n                at org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1699)\n                at org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1663)\n                at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:367)\n                at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:143)\n                at org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:103)",
    "Rosa,\n\nYou are missing this from your facet definition:\n\n\u003cextension point\u003d\"org.eclipse.wst.common.project.facet.core.runtimes\"\u003e\n  \u003csupported\u003e\n    \u003cruntime-component any\u003d\"true\"/\u003e\n    \u003cfacet id\u003d\"abc\"/\u003e\n  \u003c/supported\u003e\n\u003c/extension\u003e\n\nWithout this, your facet will be filtered out if a runtime is selected as it\u0027s marked as not supported for all runimes. It would show up though if you did not pick any runtime. If the facet is filtered out so will your preset. In that case you would get this exception if you tried to programatically select it. \n\nI am going to change this into an enhancement to track improving the error message.",
    "I have that as well in my plugin definition, I just didn\u0027t post it because I did not think it mattered.  Here is the rest of it.  Still did not make a difference from what I can tell.\n\n\u003cextension\n        point\u003d\"org.eclipse.wst.common.project.facet.core.runtimes\"\u003e\n        \u003csupported\u003e\n      \u003cruntime-component\n         id\u003d\"adopter runtime\"\n         version\u003d\"x.x\"/\u003e\n      \u003cfacet\n         id\u003d\"abc\"\n         version\u003d\"1.0\"/\u003e\n    \u003c/supported\u003e\n   \u003cadapter\u003e\n      \u003cruntime-component\n         id\u003d\"adopter runtime\" version\u003d\"x.x\"/\u003e\n      \u003cfactory\n         class\u003d\"ABC.facet.ABCRuntimeClasspathProvider$Factory\"/\u003e\n      \u003ctype\n         class\u003d\"org.eclipse.jst.common.project.facet.core.IClasspathProvider\"/\u003e\n    \u003c/adapter\u003e\n\nThis is a hot bug for us since it will not allow us to exit test.",
    "1. What runtimes do you have defined in your workspace? Try deleting all except the one(s) that you have marked as supporting your \"abc 1.0\" facet.\n\n2. What are you doing to cause the preset to be selected? Are you creating a new wizard by subclassing FacetedProjectWizard? Something else?",
    "1.  The developer that gets this problem has only one target runtime defined which shows up in the dropdown box.  However, we just noticed, that this dropdown in the NewProjectDataModelFacetWizard has a blank entry as well.  Not sure if that would present a problem so just mentioning it.\n\n2.  I have a wizard that derives from NewProjectDataModelFacetWizard.  In it, I have these methods which I added to support what I needed to do.\n\nprotected IFacetedProjectTemplate getTemplate() {\t\n\treturn ProjectFacetsManager.getTemplate(\"template.abc2\");\n}\n\n/**\n * @see org.eclipse.jface.wizard.IWizard#addPages()\n * @author Rosa Naranjo\n */\npublic void addPages() {\n\tsuper.addPages();\tthis.facetsSelectionPage.setInitialPreset(getTemplate().getInitialPreset() );\n}",
    "1. What is the type of the runtime in the workspace of the developer who is seeing this problem? Is it the one that supports your \"abc 1.0\" facet. Could you double-check?\n\n2. You have to do additional work in your wizard. Basically, you need to control which runtime is selected when the wizard starts up. If you don\u0027t take steps to make sure that the runtime is one that can support facets composing your preset, you cannot be assured that selecting the preset in the way that you are doing will succeed.",
    "1.  Yes, it is.  It is a target runtime that has not been released yet.\n\n2.  The target runtime we are talking about is the runtime that is selected by default already.  So since it always worked that way from the first time I added the facet runtime definition:  \u003cextension point\u003d\"org.eclipse.wst.common.project.facet.core.runtimes\"\u003e\n  \u003csupported\u003e\n      \u003cruntime-component\n         id\u003d\"adopter runtime\"\n         version\u003d\"x.x\"/\u003e\n      \u003cfacet\n         id\u003d\"abc\"\n         version\u003d\"1.0\"/\u003e\n    \u003c/supported\u003e\n\u003c/extension\u003e\n\n\nit did not seem like anything additional was required.  My preset is associated with facet\u003dabc which according to the above states that it should be supported by target runtime id\u003d\"adopter runtime\"",
    "What other way is there to ensure that you display to the user the fixed facet that you pre-req and at a particular version?\n\nI am now seeing the problem on my WTP only product for which I have associated the Apache Tomcat 5.0 server.\n\n\u003csupported\u003e\n      \u003cruntime-component\n         id\u003d\"org.eclipse.jst.server.tomcat\"\n         version\u003d\"5.0\"/\u003e\n      \u003cfacet\n         id\u003d\"abc\"\n         version\u003d\"1.0\"/\u003e\n    \u003c/supported\u003e\n    \u003cadapter\u003e\n      \u003cruntime-component\n         id\u003d\"org.eclipse.jst.server.tomcat\"/\u003e\n      \u003cfactory\n         class\u003d\"com.ABC.facet.ABCRuntimeClasspathProvider$Factory\"/\u003e\n      \u003ctype\n         class\u003d\"org.eclipse.jst.common.project.facet.core.IClasspathProvider\"/\u003e\n    \u003c/adapter\u003e\n\nFirst, when there is no Apache Tomcat Server 5.0 instance defined, there is no error starting the wizard and the Target Runtime dropdown is empty.  Then, when I define the Apache Tomcat server and restart the same wizard, I get the error.",
    "Rosa,\n\nIt sounds like you have a bare wtp repro of the problem. Could you attach a zip of a plugin with you repro? That would help a lot in being able to understand what is it that you are seeing. Thanks.",
    "No I do not actually have a bare repro that I can send at the moment.  What I really need as a workaround, is to know how to have a preset show up as part of a template being applied.  If I should not have done it as part of the addPages() method, then where?   \n\nThe only example I see of a preset is the Web XDoclet in org.eclipse.jst.j2ee.ejb.annotations.xdoclet.  The only difference between that implementation and mine is \n\n1.  runtime \u003d \"any\" for the facet for which the preset is defined.\n2.  there is no wizard calling this:\nthis.facetsSelectionPage.setInitialPreset(getTemplate().getInitialPreset()",
    "turns out that setting my preset with this line was the problem, as far as the reproducible scenario was concerned.  However, this had been working for awhile with the same adopter runtime, so not sure how it got past the filter checks in the past.  When I changed the preset for the jst.java facet to version\u003d1.4 then it was fine.  \n\n\u003cfacet id\u003d\"jst.java\" version\u003d\"5.0\"/\u003e\n\nPlease do provide the error message enhancement as this was a bear to debug.",
    "Changed the selectPreset method so that instead of throwing the IllegalArgumentException, it figures out which facet is causing the preset to be not selectable, logs a detailed error message, and continues silently (no exception and no preset selected).\n\nHere is the error message that I got in my test case when I attempted to select the ejb xdoclet facet from the addPages of the Dynamic Web Project wizard.\n\n\"Could not select preset EJB Project with XDoclet. Required facet EJBDoclet (XDoclet) 1.2.3 is not visible.\"\n",
    "I would like to change this back from enhancement to a bug for the following reason:\n\nI would like my facet in the WTP only use case to allow being associated with any runtime.  Thus, I have changed my runtime facet definition to be the following:\n\n\u003cextension\n        point\u003d\"org.eclipse.wst.common.project.facet.core.runtimes\"\u003e\n        \u003csupported\u003e\n      \u003cruntime-component any\u003d\"true\"/\u003e\n      \u003cfacet\n         id\u003d\"abc\"\n         version\u003d\"1.0\"/\u003e\n    \u003c/supported\u003e\n   \u003cadapter\u003e\n      \u003cruntime-component any\u003d\"true\"/\u003e\n      \u003cfactory\n         class\u003d\"ABC.facet.ABCRuntimeClasspathProvider$Factory\"/\u003e\n      \u003ctype\n         class\u003d\"org.eclipse.jst.common.project.facet.core.IClasspathProvider\"/\u003e\n    \u003c/adapter\u003e\n\nMy facet also can be compatible with any JDK \u003e\u003d1.3, so in my preset I want to preselect the latest JDK since I must select something.  I wish it would just let it default to whatever the runtime that will be selected must use.  But, this does not seem possible.  Without the removal of the IllegalArgumentException and the much nicer error handling, my wizard is dead (won\u0027t come up) unless I happen to pick a level of the Java facet which is the one that will be compatible with a runtime that my users end up selecting.  ",
    "Rosa,\n\nI am afraid this is not something that I can support. A preset is a fixed list of facets and their versions. \n\nI would suggest that if your facet requires jst.java \u003e\u003d 1.3, then your preset should list jst.java 1.3. That will make it applicable to any runtime that supports jst.java 1.3+. The user can then select a newer version of jst.java, if desired.",
    "Released the change to provide the detailed error message for the next I-build.",
    "This is part of a mass update to close out all stale WTP resolved bugs from the 1.0.x and 1.5.0 timeframe.  If you feel this bug was closed inappropriately, please reopen.\n\nThanks, John Lanuti"
  ],
  "commentCreationDates": [
    "2006-03-09T00:11:20+01:00",
    "2006-03-09T14:57:07+01:00",
    "2006-03-09T15:19:10+01:00",
    "2006-03-09T16:20:07+01:00",
    "2006-03-09T16:47:59+01:00",
    "2006-03-09T16:58:12+01:00",
    "2006-03-09T17:30:55+01:00",
    "2006-03-09T19:37:37+01:00",
    "2006-03-09T20:57:28+01:00",
    "2006-03-09T22:42:02+01:00",
    "2006-03-10T01:02:41+01:00",
    "2006-03-13T21:08:54+01:00",
    "2006-03-13T23:31:44+01:00",
    "2006-03-13T23:39:47+01:00",
    "2006-03-14T00:34:06+01:00",
    "2006-11-28T20:59:13+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.IllegalArgumentException",
      "elements": [
        {
          "method": "org.eclipse.wst.common.project.facet.ui.internal.FacetsSelectionPanel.selectPreset",
          "source": "FacetsSelectionPanel.java:725"
        },
        {
          "method": "org.eclipse.wst.common.project.facet.ui.internal.FacetsSelectionPage.createControl",
          "source": "FacetsSelectionPage.java:149"
        },
        {
          "method": "org.eclipse.jface.wizard.Wizard.createPageControls",
          "source": "Wizard.java:179"
        },
        {
          "method": "org.eclipse.wst.common.project.facet.ui.AddRemoveFacetsWizard.createPageControls",
          "source": "AddRemoveFacetsWizard.java:259"
        },
        {
          "method": "org.eclipse.jface.wizard.WizardDialog.createPageControls",
          "source": "WizardDialog.java:611"
        },
        {
          "method": "org.eclipse.jface.wizard.WizardDialog.setWizard",
          "source": "WizardDialog.java:965"
        },
        {
          "method": "org.eclipse.jface.wizard.WizardDialog.updateForPage",
          "source": "WizardDialog.java:1016"
        },
        {
          "method": "org.eclipse.jface.wizard.WizardDialog.access$2",
          "source": "WizardDialog.java:1013"
        },
        {
          "method": "org.eclipse.jface.wizard.WizardDialog$4.run",
          "source": "WizardDialog.java:1003"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:69"
        },
        {
          "method": "org.eclipse.jface.wizard.WizardDialog.showPage",
          "source": "WizardDialog.java:1001"
        },
        {
          "method": "org.eclipse.jface.wizard.WizardDialog.nextPressed",
          "source": "WizardDialog.java:753"
        },
        {
          "method": "org.eclipse.jface.wizard.WizardDialog.buttonPressed",
          "source": "WizardDialog.java:345"
        },
        {
          "method": "org.eclipse.jface.dialogs.Dialog$2.widgetSelected",
          "source": "Dialog.java:556"
        },
        {
          "method": "org.eclipse.swt.widgets.TypedListener.handleEvent",
          "source": "TypedListener.java:90"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:843"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:3125"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2758"
        },
        {
          "method": "org.eclipse.jface.window.Window.runEventLoop",
          "source": "Window.java:809"
        },
        {
          "method": "org.eclipse.jface.window.Window.open",
          "source": "Window.java:787"
        },
        {
          "method": "org.eclipse.ui.actions.NewProjectAction.run",
          "source": "NewProjectAction.java:114"
        },
        {
          "method": "org.eclipse.jface.action.Action.runWithEvent",
          "source": "Action.java:996"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:538"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$2",
          "source": "ActionContributionItem.java:488"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$5.handleEvent",
          "source": "ActionContributionItem.java:400"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:843"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:3125"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2758"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1699"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1663"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:367"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:143"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:103"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "131005",
      "date": "2006-03-09T00:11:20+01:00",
      "product": "Web Tools",
      "component": "wst.common",
      "severity": "enhancement"
    }
  ],
  "groupId": "131005",
  "bugId": "131005",
  "date": "2006-03-09T00:11:20+01:00",
  "product": "Web Tools",
  "component": "wst.common",
  "severity": "enhancement"
}