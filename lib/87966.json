{
  "comments": [
    "i20050308\n\norg.eclipse.pde.junit.runtime has a soft pre-requisite against\norg.eclipse.core.runtime.compatibility. But when running with 3.* targets where\nthe compatibility plug-in is not available, it does not work, because it makes\nuse of deprecated API (Platform.getPluginRegistry(),\nIPluginDescriptor#getPluginClassLoader()) that is implemented in the\ncompatibility layer:\n\nIllegalStateException\n\tat org.eclipse.core.runtime.Platform.getPluginRegistry(Platform.java:665)\n\tat\norg.eclipse.pde.internal.junit.runtime.RemotePluginTestRunner.getClassLoader(RemotePluginTestRunner.java:44)\n\tat\norg.eclipse.jdt.internal.junit.runner.RemoteTestRunner.loadSuiteClass(RemoteTestRunner.java:424)\n\tat\norg.eclipse.jdt.internal.junit.runner.RemoteTestRunner.getTest(RemoteTestRunner.java:378)\n\tat\norg.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:441)\n\tat\norg.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:342)\n\tat\norg.eclipse.pde.internal.junit.runtime.RemotePluginTestRunner.main(RemotePluginTestRunner.java:36)\n\tat\norg.eclipse.pde.internal.junit.runtime.CoreTestApplication.run(CoreTestApplication.java:25)",
    "correct.  as long as we support backward compatibility to run 2.1 Junit tests, \nwe cannot get rid of this use of deprecated call.\nThis 3.0 pde/junit code needs to run against a 2.1 target (where PDE JUnit did \nnot exist).\n\nSuggestions welcome if there is an actual solution, which I doubt.",
    "actually, there might be hope.\nright now, we have 4 Junit apps (2 for 3.x platforms, and 2 for 2.x platforms).\nHowever, all Junit apps call the same RemotePluginTestRunner, which contains a \ndeprecated call(per 3.0 standards).\n\nSo if you have two forms (2.x and 3.x-based) of RemotePluginTestRunner.  It \nshould work. \n\nWe need to compile against 3.x, but we only need to run against 2.x.",
    "ok, for us to do anything about this, we need to return a Classloader object, \ngiven a bundle id.\n\nAs far as I can see, there is no equivalent to the deprecated \nIPluginDescriptor.getPluginClassLoader() in the new runtime, which is \nproblematic.\n\nJeff, is there something I am missing?",
    "I can answer this one. There is no API for obtaining a bundle\u0027s classloader, but\nit is easy to provide your own classloader that delegates to bundle\u0027s\nloadClass/getResource methods:\n\npublic class BundleClassLoader extends ClassLoader {\n  private Bundle bundle;\n  public BundleClassLoader(Bundle target) {\n    this.bundle \u003d target;\n  }\n  protected Class findClass(String name) throws ClassNotFoundException {\n    return bundle.loadClass(name);\n  }\n  protected URL findResource(String name) {\n    return bundle.getResource(name);\n  }\n}",
    "suggest you also include the getResources() method",
    "Right. It would be as trivial as:\n\npublic class BundleClassLoader extends ClassLoader {\n  ...\n  protected Enumeration findResources(String name) {\n    return bundle.getResources(name);\n  }\n}",
    "done as suggested by my friend and contemporary RC.\nalso threw in a getResources() method.",
    "See bug 88356 for another impediment for running plug-in tests without\ncompatibility."
  ],
  "commentCreationDates": [
    "2005-03-14T19:05:09+01:00",
    "2005-03-14T19:40:17+01:00",
    "2005-03-14T20:29:21+01:00",
    "2005-03-14T20:54:12+01:00",
    "2005-03-14T21:46:11+01:00",
    "2005-03-14T22:52:58+01:00",
    "2005-03-15T16:07:02+01:00",
    "2005-03-16T03:38:53+01:00",
    "2005-03-17T18:29:50+01:00"
  ],
  "traces": [
    {
      "exceptionType": "IllegalStateException",
      "elements": [
        {
          "method": "org.eclipse.core.runtime.Platform.getPluginRegistry",
          "source": "Platform.java:665"
        },
        {
          "method": "org.eclipse.pde.internal.junit.runtime.RemotePluginTestRunner.getClassLoader",
          "source": "RemotePluginTestRunner.java:44"
        },
        {
          "method": "org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.loadSuiteClass",
          "source": "RemoteTestRunner.java:424"
        },
        {
          "method": "org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.getTest",
          "source": "RemoteTestRunner.java:378"
        },
        {
          "method": "org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests",
          "source": "RemoteTestRunner.java:441"
        },
        {
          "method": "org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run",
          "source": "RemoteTestRunner.java:342"
        },
        {
          "method": "org.eclipse.pde.internal.junit.runtime.RemotePluginTestRunner.main",
          "source": "RemotePluginTestRunner.java:36"
        },
        {
          "method": "org.eclipse.pde.internal.junit.runtime.CoreTestApplication.run",
          "source": "CoreTestApplication.java:25"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "87966",
      "date": "2005-03-14T19:05:09+01:00",
      "product": "PDE",
      "component": "UI",
      "severity": "normal"
    }
  ],
  "groupId": "87966",
  "bugId": "87966",
  "date": "2005-03-14T19:05:09+01:00",
  "product": "PDE",
  "component": "UI",
  "severity": "normal"
}