{
  "comments": [
    "I was generating a patch and clicking Finish on the wizard would not close the \nwizard even though the patch was created succesfully. It turned out that the \nproblem was that writing to the console caused an error due to word wrap being \non. There are two problems here. There was no error message shown to the user \nand writing to the console should not cause a command to fail.",
    "The problem is that the ModalContext run method runs the event loop but exists \nif there is any runtime exception. It should handle the case of SWT exceptions \nby logging them and allowing the wizard to continue running to completion. The \nWorkbenchAdvisor handleVeventLoopException does a similar thing. The \nrunEventLoop in the JFace Window class also has a similar guard.\n\norg.eclipse.swt.SWTException: Failed to execute runnable \n(java.lang.ArrayIndexOutOfBoundsException)\n\tat java.lang.Throwable.\u003cinit\u003e(Throwable.java)\n\tat java.lang.Throwable.\u003cinit\u003e(Throwable.java)\n\tat org.eclipse.swt.SWTException.\u003cinit\u003e(SWTException.java:81)\n\tat org.eclipse.swt.SWT.error(SWT.java:2697)\n\tat org.eclipse.swt.SWT.error(SWT.java:2622)\n\tat org.eclipse.swt.widgets.Synchronizer.runAsyncMessages\n(Synchronizer.java:121)\n\tat org.eclipse.swt.widgets.Display.runAsyncMessages(Display.java)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java)\n\tat org.eclipse.jface.operation.ModalContext$ModalContextThread.block\n(ModalContext.java)\n\tat org.eclipse.jface.operation.ModalContext.run(ModalContext.java)\n\tat org.eclipse.jface.wizard.WizardDialog.run(WizardDialog.java:824)\n\tat \norg.eclipse.team.internal.ccvs.ui.wizards.GenerateDiffFileWizard.performFinish\n(GenerateDiffFileWizard.java:703)\n\tat org.eclipse.jface.wizard.WizardDialog.finishPressed\n(WizardDialog.java:670)\n\tat org.eclipse.jface.wizard.WizardDialog.buttonPressed\n(WizardDialog.java:342)\n\tat org.eclipse.jface.dialogs.Dialog$2.widgetSelected(Dialog.java:543)\n\tat org.eclipse.swt.widgets.TypedListener.handleEvent\n(TypedListener.java:89)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java)\n\tat org.eclipse.jface.window.Window.runEventLoop(Window.java)\n\tat org.eclipse.jface.window.Window.open(Window.java:696)\n\tat \norg.eclipse.team.internal.ccvs.ui.actions.GenerateDiffFileAction.execute\n(GenerateDiffFileAction.java:41)\n\tat org.eclipse.team.internal.ccvs.ui.actions.CVSAction.run\n(CVSAction.java:70)\n\tat org.eclipse.ui.actions.ActionDelegate.runWithEvent\n(ActionDelegate.java:70)\n\tat org.eclipse.ui.internal.PluginAction.runWithEvent\n(PluginAction.java:288)\n\tat \norg.eclipse.jface.action.ActionContributionItem.handleWidgetSelection\n(ActionContributionItem.java:946)\n\tat org.eclipse.jface.action.ActionContributionItem.access$2\n(ActionContributionItem.java:896)\n\tat org.eclipse.jface.action.ActionContributionItem$7.handleEvent\n(ActionContributionItem.java:810)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1529)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1500)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench\n(Workbench.java:276)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:144)\n\tat org.eclipse.ui.internal.ide.IDEApplication.run\n(IDEApplication.java:102)\n\tat org.eclipse.core.internal.runtime.PlatformActivator$1.run\n(PlatformActivator.java:335)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run\n(EclipseStarter.java:273)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run\n(EclipseStarter.java:129)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:84)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:59)\n\tat java.lang.reflect.Method.invoke(Method.java:390)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:185)\n\tat org.eclipse.core.launcher.Main.run(Main.java:704)\n\tat org.eclipse.core.launcher.Main.main(Main.java:688)",
    "Can someone provide an update on this bug report?",
    "I agree that an error while processing SWT events while waiting for the modal\ncontext operation to complete should not affect the modal context operation, and\nshould not appear as a failure to the caller.\n\nMatt, are you actually hitting this problem in LWP too?\n\nMarking for investigation for M4.  Boris, did you encounter anything similar in\nyour recent work on ModalContext and asyncExec?\n\nMatt, if you want to propose a patch, it would be appreciated.\n",
    "Yes, we are running into this problem in LWP.  I\u0027m proposing a simple patch\nwhich is to fall back on the same error handling strategy that can be found in\norg.eclipse.jface.window.Window",
    "Created an attachment (id\u003d28353)\npatch to fix this bug\n\nPatch is based on version v20050623 of the org.eclipse.jface plugin.",
    "Created an attachment (id\u003d28392)\nUpdated patch - previous patch is wrong\n\nPrevious patch was wrong. ",
    "Fixed \u003e20051201.\nThanks for the proposed patch.  The fix is slightly different, but the spirit is the same - that the exceptions should be caught and logged to allow the modal context thread to continue.  ",
    "Susan, shouldn\u0027t the problem be logged using Policy.getLog().log() instead of printing to System.err? Also, when catching Throwable, we need to be extra careful, see:\nBug 61963 [Workbench] dangerous practice of catching Throwable\n",
    "Thanks for checking this Boris.\nI should probably wrap this exception in a status and use the logger.  The only reason I did not is that I have similar uses of System.err that I need to clean up and figured I\u0027d get to it with bug #107136.  I\u0027ll cc you on that bug, as I wasn\u0027t sure how to get rid of the other use of System.err in ModalContext.\n\nre:  bug #61963 - I\u0027ll append this use case to that bug.  I\u0027d like to adopt whatever consistent practice we think is acceptable for the other cases.  Is the intention that we may start throwing certain exceptions (such as OutOfMemoryError, etc.) and catching the rest...?",
    "Verified in I20051213-0010 on WinXP.\n\n(In case this needs to be reverified in the future, here\u0027s what I did...)\nVerified by brute forcing a failure in the ModalContext.block() event loop itself:\n\ntry {\n   if (!display.readAndDispatch()) display.sleep();\n   \"hello\".charAt(10); //$NON-NLS-1$ }\n\nThen, if you run the New Project Wizard (Simple Project), you\u0027ll get the failures when finishing the wizard.  Note the wizard finishes to completion and the failures are reported in the console.\n\nSide note:\nBug #107136 and Bug #61963 remain open to address Boris\u0027 comments in the future"
  ],
  "commentCreationDates": [
    "2004-11-09T20:32:26+01:00",
    "2004-11-10T14:57:37+01:00",
    "2005-10-17T17:54:10+02:00",
    "2005-10-17T20:38:33+02:00",
    "2005-10-17T21:18:58+02:00",
    "2005-10-17T21:19:56+02:00",
    "2005-10-18T17:22:53+02:00",
    "2005-12-01T22:48:45+01:00",
    "2005-12-02T02:14:20+01:00",
    "2005-12-02T18:34:07+01:00",
    "2005-12-13T22:25:57+01:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.swt.SWTException",
      "message": "Failed to execute runnable  (java.lang.ArrayIndexOutOfBoundsException)",
      "elements": [
        {
          "method": "java.lang.Throwable.\u003cinit\u003e",
          "source": "Throwable.java"
        },
        {
          "method": "java.lang.Throwable.\u003cinit\u003e",
          "source": "Throwable.java"
        },
        {
          "method": "org.eclipse.swt.SWTException.\u003cinit\u003e",
          "source": "SWTException.java:81"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:2697"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:2622"
        },
        {
          "method": "org.eclipse.swt.widgets.Synchronizer.runAsyncMessages",
          "source": "Synchronizer.java:121"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runAsyncMessages",
          "source": "Display.java"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext$ModalContextThread.block",
          "source": "ModalContext.java"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext.run",
          "source": "ModalContext.java"
        },
        {
          "method": "org.eclipse.jface.wizard.WizardDialog.run",
          "source": "WizardDialog.java:824"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ui.wizards.GenerateDiffFileWizard.performFinish",
          "source": "GenerateDiffFileWizard.java:703"
        },
        {
          "method": "org.eclipse.jface.wizard.WizardDialog.finishPressed",
          "source": "WizardDialog.java:670"
        },
        {
          "method": "org.eclipse.jface.wizard.WizardDialog.buttonPressed",
          "source": "WizardDialog.java:342"
        },
        {
          "method": "org.eclipse.jface.dialogs.Dialog$2.widgetSelected",
          "source": "Dialog.java:543"
        },
        {
          "method": "org.eclipse.swt.widgets.TypedListener.handleEvent",
          "source": "TypedListener.java:89"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java"
        },
        {
          "method": "org.eclipse.jface.window.Window.runEventLoop",
          "source": "Window.java"
        },
        {
          "method": "org.eclipse.jface.window.Window.open",
          "source": "Window.java:696"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ui.actions.GenerateDiffFileAction.execute",
          "source": "GenerateDiffFileAction.java:41"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ui.actions.CVSAction.run",
          "source": "CVSAction.java:70"
        },
        {
          "method": "org.eclipse.ui.actions.ActionDelegate.runWithEvent",
          "source": "ActionDelegate.java:70"
        },
        {
          "method": "org.eclipse.ui.internal.PluginAction.runWithEvent",
          "source": "PluginAction.java:288"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:946"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$2",
          "source": "ActionContributionItem.java:896"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$7.handleEvent",
          "source": "ActionContributionItem.java:810"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1529"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1500"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:276"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:144"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:102"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:335"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:273"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:129"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:84"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:57"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:59"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:390"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:185"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:704"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:688"
        }
      ],
      "number": 0,
      "commentIndex": 1,
      "bugId": "78222",
      "date": "2004-11-10T14:57:37+01:00",
      "product": "Platform",
      "component": "UI",
      "severity": "normal"
    }
  ],
  "groupId": "78222",
  "bugId": "78222",
  "date": "2004-11-09T20:32:26+01:00",
  "product": "Platform",
  "component": "UI",
  "severity": "normal"
}