{
  "comments": [
    "Build ID: M20060921-0945\n\nSteps To Reproduce:\n1. Copy and paste this into a build.xml file:\n\n\u003cproject\n\tname\u003d\"Build specific targets and properties\"\n\tdefault\u003d\"postBuild\"\u003e\n\t\u003ctarget name\u003d\"postBuild\"\u003e\n\t\t\u003cecho file\u003d\"${site.xml}\"\u003e\n\t\t\t\u003c![CDATA[\u003c?xml version\u003d\"1.0\" encoding\u003d\"UTF-8\"?\u003e\n            \u003csite\u003e]]\u003e\n\t\t\u003c/echo\u003e\n\t\u003c/target\u003e\n\u003c/project\u003e\n\n2. Choose \"Source -\u003e Format Document\" from navigator popup menu.\n\n\n\nMore information:\nThe problem doesn\u0027t occur when CDATA is removed.\n\nHere is the exception I see in the log:\n\norg.eclipse.swt.SWTException: Invalid thread access\n\tat org.eclipse.swt.SWT.error(SWT.java:3374)\n\tat org.eclipse.swt.SWT.error(SWT.java:3297)\n\tat org.eclipse.swt.SWT.error(SWT.java:3268)\n\tat org.eclipse.swt.widgets.Widget.error(Widget.java:435)\n\tat org.eclipse.swt.widgets.Widget.checkWidget(Widget.java:331)\n\tat org.eclipse.swt.custom.StyledText.getSelectionRange(StyledText.java:3977)\n\tat org.eclipse.jface.text.TextViewer.getSelectedRange(TextViewer.java:2032)\n\tat org.eclipse.jface.text.TextViewer.rememberDocumentSelection(TextViewer.java:4545)\n\tat org.eclipse.jface.text.TextViewer.disableRedrawing(TextViewer.java:4572)\n\tat org.eclipse.jface.text.TextViewer.setRedraw(TextViewer.java:4612)\n\tat org.eclipse.jface.text.TextViewer.setRedraw(TextViewer.java:4590)\n\tat org.eclipse.jface.text.TextViewer$RewriteTarget.setRedraw(TextViewer.java:1009)\n\tat org.eclipse.jface.text.TextViewer$DocumentRewriteSessionListener.documentRewriteSessionChanged(TextViewer.java:1188)\n\tat org.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.fireDocumentRewriteSessionEvent(BasicStructuredDocument.java:2887)\n\tat org.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.internalStartRewriteSession(BasicStructuredDocument.java:2754)\n\tat org.eclipse.wst.sse.core.internal.text.JobSafeStructuredDocument.startRewriteSession(JobSafeStructuredDocument.java:189)\n\tat org.eclipse.wst.sse.core.internal.format.AbstractStructuredFormatProcessor.formatModel(AbstractStructuredFormatProcessor.java:313)\n\tat org.eclipse.wst.sse.core.internal.format.AbstractStructuredFormatProcessor.formatModel(AbstractStructuredFormatProcessor.java:299)\n\tat org.eclipse.wst.sse.core.internal.format.AbstractStructuredFormatProcessor.formatFile(AbstractStructuredFormatProcessor.java:194)\n\tat org.eclipse.wst.sse.ui.internal.actions.FormatActionDelegate.format(FormatActionDelegate.java:127)\n\tat org.eclipse.wst.sse.ui.internal.actions.FormatActionDelegate.format(FormatActionDelegate.java:146)\n\tat org.eclipse.wst.sse.ui.internal.actions.FormatActionDelegate.process(FormatActionDelegate.java:178)\n\tat org.eclipse.wst.sse.ui.internal.actions.FormatActionDelegate$FormatJob.run(FormatActionDelegate.java:96)\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:58)",
    "I\u0027ve seen this too, perhaps similar, when an ant file is open in an editor, and format chosen from navigator. In my case, cdata was not part of the scenerio. \n\nI think my issue was that there is not a correct StructuredDocument created for ant files. But, not sure. \n\n",
    "A structured document is being created for the ant file.  But the execution delegate is not set in the document because the ant editor is open, not an sse editor.  So when our background format action is invoked, the document doesn\u0027t realize it\u0027s already in an editor and we eventually get invalid thread access."
  ],
  "commentCreationDates": [
    "2007-03-21T17:55:10+01:00",
    "2007-05-28T05:48:26+02:00",
    "2007-05-31T19:36:52+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.swt.SWTException",
      "message": "Invalid thread access",
      "elements": [
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3374"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3297"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3268"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.error",
          "source": "Widget.java:435"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.checkWidget",
          "source": "Widget.java:331"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.getSelectionRange",
          "source": "StyledText.java:3977"
        },
        {
          "method": "org.eclipse.jface.text.TextViewer.getSelectedRange",
          "source": "TextViewer.java:2032"
        },
        {
          "method": "org.eclipse.jface.text.TextViewer.rememberDocumentSelection",
          "source": "TextViewer.java:4545"
        },
        {
          "method": "org.eclipse.jface.text.TextViewer.disableRedrawing",
          "source": "TextViewer.java:4572"
        },
        {
          "method": "org.eclipse.jface.text.TextViewer.setRedraw",
          "source": "TextViewer.java:4612"
        },
        {
          "method": "org.eclipse.jface.text.TextViewer.setRedraw",
          "source": "TextViewer.java:4590"
        },
        {
          "method": "org.eclipse.jface.text.TextViewer$RewriteTarget.setRedraw",
          "source": "TextViewer.java:1009"
        },
        {
          "method": "org.eclipse.jface.text.TextViewer$DocumentRewriteSessionListener.documentRewriteSessionChanged",
          "source": "TextViewer.java:1188"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.fireDocumentRewriteSessionEvent",
          "source": "BasicStructuredDocument.java:2887"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.internalStartRewriteSession",
          "source": "BasicStructuredDocument.java:2754"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.text.JobSafeStructuredDocument.startRewriteSession",
          "source": "JobSafeStructuredDocument.java:189"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.format.AbstractStructuredFormatProcessor.formatModel",
          "source": "AbstractStructuredFormatProcessor.java:313"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.format.AbstractStructuredFormatProcessor.formatModel",
          "source": "AbstractStructuredFormatProcessor.java:299"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.format.AbstractStructuredFormatProcessor.formatFile",
          "source": "AbstractStructuredFormatProcessor.java:194"
        },
        {
          "method": "org.eclipse.wst.sse.ui.internal.actions.FormatActionDelegate.format",
          "source": "FormatActionDelegate.java:127"
        },
        {
          "method": "org.eclipse.wst.sse.ui.internal.actions.FormatActionDelegate.format",
          "source": "FormatActionDelegate.java:146"
        },
        {
          "method": "org.eclipse.wst.sse.ui.internal.actions.FormatActionDelegate.process",
          "source": "FormatActionDelegate.java:178"
        },
        {
          "method": "org.eclipse.wst.sse.ui.internal.actions.FormatActionDelegate$FormatJob.run",
          "source": "FormatActionDelegate.java:96"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:58"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "178598",
      "date": "2007-03-21T17:55:10+01:00",
      "product": "Web Tools",
      "component": "wst.xml",
      "severity": "normal"
    }
  ],
  "groupId": "178598",
  "bugId": "178598",
  "date": "2007-03-21T17:55:10+01:00",
  "product": "Web Tools",
  "component": "wst.xml",
  "severity": "normal"
}