{
  "comments": [
    "I\u0027ve run into a peculiar problem with CDT 2.1 (SDK).  We have developed our\nown makefile generator for use with Standard CDT projects.  This has worked\njust fine throughout CDT 1.2 and 2.0.x.  Now, I have just upgraded to CDT\n2.1, and I get an exception when my makefile generator tries to\nautomatically remove or create its own make targets.  When it works, it\nshould manage the following targets:\n\nCollins Make Build\nCollins Make Rebuild\nCollins Make Clean\n\nWhenever I press our \"Generate Makefiles and Make Targets\" button, it\nshould remove the previous make targets (by name) if they exist and then\nimmediately create the make target again.\n\nAfter upgrading to CDT 2.1, I often get exceptions when I perform these\noperations.  If I close the project and reopen it, it might work again.\nBut if I shutdown Eclipse and reopen it, then the next time I perform these\noperations I get exceptions.\n\nCan anyone comment on what changed in CDT 2.1 that may have caused this?\n\nThanks,\n\nChad Barnes\nRockwell Collins Inc.\n\n[excerpt from\ncom.rockwellcollins.cdt.managedMake.actions.ProjectBuilderAction.createMakeTarg\nets()]\n.\n.\n.\n[412] if (fTargetManager.findTarget(fContainer, targetName) !\u003d null) {\n[413]\nfTargetManager.removeTarget(fTargetManager.findTarget(fContainer,\ntargetName));  //remove the target by name\n[414] }\n[415] fTargetManager.addTarget(fContainer, targets[i]);  //create the\ntarget again\n.\n.\n.\n\nFirst attempt to generate my make targets:\n\njava.lang.IllegalArgumentException: Attempted to beginRule: R/, does not\nmatch outer scope rule: P/CH47F_Development\n      at org.eclipse.core.internal.runtime.Assert.isLegal(Assert.java:58)\n      at\norg.eclipse.core.internal.jobs.ThreadJob.illegalPush(ThreadJob.java:106)\n      at org.eclipse.core.internal.jobs.ThreadJob.push(ThreadJob.java:200)\n      at\norg.eclipse.core.internal.jobs.ImplicitJobs.begin(ImplicitJobs.java:58)\n      at\norg.eclipse.core.internal.jobs.JobManager.beginRule(JobManager.java:170)\n      at\norg.eclipse.core.internal.resources.WorkManager.checkIn(WorkManager.java:95)\n      at\norg.eclipse.core.internal.resources.Workspace.prepareOperation\n(Workspace.java:1628)\n      at\norg.eclipse.core.internal.resources.File.setContents(File.java:335)\n      at\norg.eclipse.cdt.internal.core.CDescriptor$1.run(CDescriptor.java:341)\n      at\norg.eclipse.core.internal.resources.Workspace.run(Workspace.java:1673)\n      at\norg.eclipse.cdt.internal.core.CDescriptor.save(CDescriptor.java:309)\n      at\norg.eclipse.cdt.internal.core.CDescriptor.saveProjectData(CDescriptor.java:575)\n      at\norg.eclipse.cdt.make.internal.core.ProjectTargets.translateDocumentToCDTProject\n(ProjectTargets.java:282)\n      at\norg.eclipse.cdt.make.internal.core.ProjectTargets.saveTargets\n(ProjectTargets.java:240)\n      at\norg.eclipse.cdt.make.internal.core.MakeTargetManager.writeTargets\n(MakeTargetManager.java:264)\n      at\norg.eclipse.cdt.make.internal.core.MakeTargetManager.removeTarget\n(MakeTargetManager.java:93)\n      at\ncom.rockwellcollins.cdt.managedMake.actions.ProjectBuilderAction.createMakeTarg\nets(ProjectBuilderAction.java:413)\n      at\ncom.rockwellcollins.cdt.managedMake.actions.ProjectBuilderAction.createMakeFile\ns(ProjectBuilderAction.java:320)\n      at\ncom.rockwellcollins.cdt.managedMake.actions.MakefileGenerator.genMake\n(MakefileGenerator.java:54)\n      at\ncom.rockwellcollins.cdt.managedConfig.propertyPages.CMMPropertyPage$4.run\n(CMMPropertyPage.java:562)\n      at\norg.eclipse.jface.operation.ModalContext.runInCurrentThread\n(ModalContext.java:303)\n      at\norg.eclipse.jface.operation.ModalContext.run(ModalContext.java:253)\n      at\norg.eclipse.jface.dialogs.ProgressMonitorDialog.run\n(ProgressMonitorDialog.java:397)\n      at\ncom.rockwellcollins.cdt.managedConfig.propertyPages.CMMPropertyPage.autoGenerat\neMakefiles(CMMPropertyPage.java:559)\n      at\ncom.rockwellcollins.cdt.managedConfig.propertyPages.CMMPropertyPage.performAppl\ny(CMMPropertyPage.java:542)\n.\n.\n.\n\nSecond attempt (immediately following first)\n\njava.lang.IllegalArgumentException: Attempted to beginRule: R/, does not\nmatch outer scope rule: P/CH47F_Development\n      at org.eclipse.core.internal.runtime.Assert.isLegal(Assert.java:58)\n      at\norg.eclipse.core.internal.jobs.ThreadJob.illegalPush(ThreadJob.java:106)\n      at org.eclipse.core.internal.jobs.ThreadJob.push(ThreadJob.java:200)\n      at\norg.eclipse.core.internal.jobs.ImplicitJobs.begin(ImplicitJobs.java:58)\n      at\norg.eclipse.core.internal.jobs.JobManager.beginRule(JobManager.java:170)\n      at\norg.eclipse.core.internal.resources.WorkManager.checkIn(WorkManager.java:95)\n      at\norg.eclipse.core.internal.resources.Workspace.prepareOperation\n(Workspace.java:1628)\n      at\norg.eclipse.core.internal.resources.File.setContents(File.java:335)\n      at\norg.eclipse.cdt.internal.core.CDescriptor$1.run(CDescriptor.java:341)\n      at\norg.eclipse.core.internal.resources.Workspace.run(Workspace.java:1673)\n      at\norg.eclipse.cdt.internal.core.CDescriptor.save(CDescriptor.java:309)\n      at\norg.eclipse.cdt.internal.core.CDescriptor.saveProjectData(CDescriptor.java:575)\n      at\norg.eclipse.cdt.make.internal.core.ProjectTargets.translateDocumentToCDTProject\n(ProjectTargets.java:282)\n      at\norg.eclipse.cdt.make.internal.core.ProjectTargets.saveTargets\n(ProjectTargets.java:240)\n      at\norg.eclipse.cdt.make.internal.core.MakeTargetManager.writeTargets\n(MakeTargetManager.java:264)\n      at\norg.eclipse.cdt.make.internal.core.MakeTargetManager.addTarget\n(MakeTargetManager.java:77)\n      at\ncom.rockwellcollins.cdt.managedMake.actions.ProjectBuilderAction.createMakeTarg\nets(ProjectBuilderAction.java:415)\n      at\ncom.rockwellcollins.cdt.managedMake.actions.ProjectBuilderAction.createMakeFile\ns(ProjectBuilderAction.java:320)\n      at\ncom.rockwellcollins.cdt.managedMake.actions.MakefileGenerator.genMake\n(MakefileGenerator.java:54)\n      at\ncom.rockwellcollins.cdt.managedMake.actions.MakeOnlyAction$1.run\n(MakeOnlyAction.java:46)\n      at\norg.eclipse.jface.operation.ModalContext$ModalContextThread.run\n(ModalContext.java:101)",
    "This does not look like a bug in cdt. When modifying the make targets it will in\nturn save this in the .cdtproject, this save is where the error is coming from.\nIt would look like you have locked the project (a job or workspace modify\noperation) which is conflicting with the write (file.setContents) of the\n.cdtproject file. Maybe your make target creation should be done in another\nthread so not to conflict with this locking.",
    "Thanks David.\n\nIt may be the case that there is a locking conflict, but this did not exist in \nCDT 2.0.2.  My plug-in has not changed to include any additional workspace \noperations during this function.  Can you comment on possible operations added \nto CDT 2.1 that could be interfering with the make target generation that were \nnot in place in CDT 2.0.x?\n\nIf I do need to move my make target creation into another thread (currently in \nan IRunnableWithProgress), any suggestions on the best way to setup that \nthread (Runnable, Job (and what scheduling rule?), etc) to not encounter these \nconflicts?\n\nThanks",
    "Hi David,\n\nI hope that you can help me understand this problem, since the Managed Build \nsystem is seeing something similar.  Let me tell you what I think the error \nmessage and stack trace is saying, and hopefully you can tell me if my \ninterpretation is wrong, or what is going on.\n\n\u003e java.lang.IllegalArgumentException: Attempted to beginRule: R/, does not\nmatch outer scope rule: P/CH47F_Development\n \nThis indicates that a scheduling rule using an IProject (named \nCH47F_Development) is running, and some code attempts to begin a scheduling \nrule using the \"workspace root\".  Is my interpretation correct?\n\nIf you look at the stack trace, the outer rule is being created by CDT code, \nand the inner by Eclipse.resources code.  The outer rule comes from \nCDescriptor.save and specifies that project (that seems correct...):\n\norg.eclipse.core.internal.resources.Workspace.run(Workspace.java:1673)\n      at\norg.eclipse.cdt.internal.core.CDescriptor.save(CDescriptor.java:309)\n      at\norg.eclipse.cdt.internal.core.CDescriptor.saveProjectData(CDescriptor.java:575)\n\nThe inner rule, that causes the exception, is the result of the CDesciptor.save \ncall and is comming from WorkManager.checkIn:\n\norg.eclipse.core.internal.resources.WorkManager.checkIn(WorkManager.java:95)\n      at\norg.eclipse.core.internal.resources.Workspace.prepareOperation\n(Workspace.java:1628)\n      at\norg.eclipse.core.internal.resources.File.setContents(File.java:335)\n      at\n\nWhy would this code use the Workspace root as the scheduling rule?  How does it \ndecide which scheduling rule to use?\n\nThanks,\nLeo\n",
    "Reset the milestone to 2.1.1\nand reassigning to Leo for now.\n\nNote: Alain to follow on it this week 8)\n",
    "I have dug some more in the how this may be happening, and it would appear that\nif the project is managed by a RepositoryProvider it looks like the rule factory\nused by the workspace can conflict with the CDescriptor.save() method as it\nsimply uses the project as the rule but when the file is saved\n(IFile.setContents()) it gets a rule for the workspace (RepositoryProvider\nreturn the Workspace for all). I think using the rule factory for the save\nrunnable will fix this.... I wonder why IResourses are scheduling rules when it\nwould appear that you *have* to obtain a rule from the rule factory... The other\nodd think is that this should have happened in CDT 2.0 as the save code has not\nchanged.  I\u0027ll try a fix and let you know.",
    "Ok, I\u0027ve checked in a change that should fix this, could you give it a try and\nsee if the problem goes away. Thanks\n\n(both cdt_21 and HEAD)\n",
    "Assuming I got the correct packages checked-out and running (run-time \nworkbench reports CDT v2.1.0), it seems to be fixed.  I cannot yet reproduce \nthe problem.  I have tried closing, reopening my project, running the make \ntarget generation while the indexer was going, and anything else I could think \nof.  Seems to be good now.\n\nThanks!\n\nI\u0027ll update if I see it pop-up again.",
    "*** Bug 84124 has been marked as a duplicate of this bug. ***"
  ],
  "commentCreationDates": [
    "2005-01-12T20:05:24+01:00",
    "2005-01-14T14:13:58+01:00",
    "2005-01-14T14:22:59+01:00",
    "2005-01-16T15:14:06+01:00",
    "2005-01-18T16:32:26+01:00",
    "2005-01-18T17:02:08+01:00",
    "2005-01-18T20:16:23+01:00",
    "2005-01-19T13:36:27+01:00",
    "2005-02-01T14:57:08+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.IllegalArgumentException",
      "message": "Attempted to beginRule: R/, does not match outer scope rule: P/CH47F_Development",
      "elements": [
        {
          "method": "org.eclipse.core.internal.runtime.Assert.isLegal",
          "source": "Assert.java:58"
        },
        {
          "method": "org.eclipse.core.internal.jobs.ThreadJob.illegalPush",
          "source": "ThreadJob.java:106"
        },
        {
          "method": "org.eclipse.core.internal.jobs.ThreadJob.push",
          "source": "ThreadJob.java:200"
        },
        {
          "method": "org.eclipse.core.internal.jobs.ImplicitJobs.begin",
          "source": "ImplicitJobs.java:58"
        },
        {
          "method": "org.eclipse.core.internal.jobs.JobManager.beginRule",
          "source": "JobManager.java:170"
        },
        {
          "method": "org.eclipse.core.internal.resources.WorkManager.checkIn",
          "source": "WorkManager.java:95"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.prepareOperation",
          "source": "Workspace.java:1628"
        },
        {
          "method": "org.eclipse.core.internal.resources.File.setContents",
          "source": "File.java:335"
        },
        {
          "method": "org.eclipse.cdt.internal.core.CDescriptor$1.run",
          "source": "CDescriptor.java:341"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1673"
        },
        {
          "method": "org.eclipse.cdt.internal.core.CDescriptor.save",
          "source": "CDescriptor.java:309"
        },
        {
          "method": "org.eclipse.cdt.internal.core.CDescriptor.saveProjectData",
          "source": "CDescriptor.java:575"
        },
        {
          "method": "org.eclipse.cdt.make.internal.core.ProjectTargets.translateDocumentToCDTProject",
          "source": "ProjectTargets.java:282"
        },
        {
          "method": "org.eclipse.cdt.make.internal.core.ProjectTargets.saveTargets",
          "source": "ProjectTargets.java:240"
        },
        {
          "method": "org.eclipse.cdt.make.internal.core.MakeTargetManager.writeTargets",
          "source": "MakeTargetManager.java:264"
        },
        {
          "method": "org.eclipse.cdt.make.internal.core.MakeTargetManager.removeTarget",
          "source": "MakeTargetManager.java:93"
        },
        {
          "method": "com.rockwellcollins.cdt.managedMake.actions.ProjectBuilderAction.createMakeTargets",
          "source": "ProjectBuilderAction.java:413"
        },
        {
          "method": "com.rockwellcollins.cdt.managedMake.actions.ProjectBuilderAction.createMakeFiles",
          "source": "ProjectBuilderAction.java:320"
        },
        {
          "method": "com.rockwellcollins.cdt.managedMake.actions.MakefileGenerator.genMake",
          "source": "MakefileGenerator.java:54"
        },
        {
          "method": "com.rockwellcollins.cdt.managedConfig.propertyPages.CMMPropertyPage$4.run",
          "source": "CMMPropertyPage.java:562"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext.runInCurrentThread",
          "source": "ModalContext.java:303"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext.run",
          "source": "ModalContext.java:253"
        },
        {
          "method": "org.eclipse.jface.dialogs.ProgressMonitorDialog.run",
          "source": "ProgressMonitorDialog.java:397"
        },
        {
          "method": "com.rockwellcollins.cdt.managedConfig.propertyPages.CMMPropertyPage.autoGenerateMakefiles",
          "source": "CMMPropertyPage.java:559"
        },
        {
          "method": "com.rockwellcollins.cdt.managedConfig.propertyPages.CMMPropertyPage.performApply",
          "source": "CMMPropertyPage.java:542"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "82705",
      "date": "2005-01-12T20:05:24+01:00",
      "product": "CDT",
      "component": "cdt-core",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.IllegalArgumentException",
      "message": "Attempted to beginRule: R/, does not match outer scope rule: P/CH47F_Development",
      "elements": [
        {
          "method": "org.eclipse.core.internal.runtime.Assert.isLegal",
          "source": "Assert.java:58"
        },
        {
          "method": "org.eclipse.core.internal.jobs.ThreadJob.illegalPush",
          "source": "ThreadJob.java:106"
        },
        {
          "method": "org.eclipse.core.internal.jobs.ThreadJob.push",
          "source": "ThreadJob.java:200"
        },
        {
          "method": "org.eclipse.core.internal.jobs.ImplicitJobs.begin",
          "source": "ImplicitJobs.java:58"
        },
        {
          "method": "org.eclipse.core.internal.jobs.JobManager.beginRule",
          "source": "JobManager.java:170"
        },
        {
          "method": "org.eclipse.core.internal.resources.WorkManager.checkIn",
          "source": "WorkManager.java:95"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.prepareOperation",
          "source": "Workspace.java:1628"
        },
        {
          "method": "org.eclipse.core.internal.resources.File.setContents",
          "source": "File.java:335"
        },
        {
          "method": "org.eclipse.cdt.internal.core.CDescriptor$1.run",
          "source": "CDescriptor.java:341"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1673"
        },
        {
          "method": "org.eclipse.cdt.internal.core.CDescriptor.save",
          "source": "CDescriptor.java:309"
        },
        {
          "method": "org.eclipse.cdt.internal.core.CDescriptor.saveProjectData",
          "source": "CDescriptor.java:575"
        },
        {
          "method": "org.eclipse.cdt.make.internal.core.ProjectTargets.translateDocumentToCDTProject",
          "source": "ProjectTargets.java:282"
        },
        {
          "method": "org.eclipse.cdt.make.internal.core.ProjectTargets.saveTargets",
          "source": "ProjectTargets.java:240"
        },
        {
          "method": "org.eclipse.cdt.make.internal.core.MakeTargetManager.writeTargets",
          "source": "MakeTargetManager.java:264"
        },
        {
          "method": "org.eclipse.cdt.make.internal.core.MakeTargetManager.addTarget",
          "source": "MakeTargetManager.java:77"
        },
        {
          "method": "com.rockwellcollins.cdt.managedMake.actions.ProjectBuilderAction.createMakeTargets",
          "source": "ProjectBuilderAction.java:415"
        },
        {
          "method": "com.rockwellcollins.cdt.managedMake.actions.ProjectBuilderAction.createMakeFiles",
          "source": "ProjectBuilderAction.java:320"
        },
        {
          "method": "com.rockwellcollins.cdt.managedMake.actions.MakefileGenerator.genMake",
          "source": "MakefileGenerator.java:54"
        },
        {
          "method": "com.rockwellcollins.cdt.managedMake.actions.MakeOnlyAction$1.run",
          "source": "MakeOnlyAction.java:46"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext$ModalContextThread.run",
          "source": "ModalContext.java:101"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "82705",
      "date": "2005-01-12T20:05:24+01:00",
      "product": "CDT",
      "component": "cdt-core",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.IllegalArgumentException",
      "message": "Attempted to beginRule: R/, does not match outer scope rule: P/CH47F_Development   This indicates that a scheduling rule using an IProject (named  CH47F_Development) is running, and some code attempts to begin a scheduling  rule using the \"workspace root\".  Is my interpretation correct?  If you look at the stack trace, the outer rule is being created by CDT code,  and the inner by Eclipse.resources code.  The outer rule comes from  CDescriptor.save and specifies that project (that seems correct...):  org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1673)",
      "elements": [
        {
          "method": "org.eclipse.cdt.internal.core.CDescriptor.save",
          "source": "CDescriptor.java:309"
        },
        {
          "method": "org.eclipse.cdt.internal.core.CDescriptor.saveProjectData",
          "source": "CDescriptor.java:575"
        }
      ],
      "number": 2,
      "commentIndex": 3,
      "bugId": "82705",
      "date": "2005-01-16T15:14:06+01:00",
      "product": "CDT",
      "component": "cdt-core",
      "severity": "normal"
    }
  ],
  "groupId": "82705",
  "bugId": "82705",
  "date": "2005-01-12T20:05:24+01:00",
  "product": "CDT",
  "component": "cdt-core",
  "severity": "normal"
}