{
  "comments": [
    "wtp 1.5.1 9/14 (it looks like I could also recreate this on a 8/10 1.5.1 build but not a wtp 1.5 build)\n\n1. create new xml example project (editing and validating xml files)\n2. make sure outline view is open\n3. open readme.html\n4. make some changes to the file\n5. revert\n6. window-\u003epreferences and try to select/view some preference pages\nnothing will work.  the preference pages will not switch based on selection.  same happens with properties pages.  ui overall appears sluggish.  eventually i get an outofmemoryerror\n\nLog file:\n!SESSION 2006-09-15 00:44:42.296 -----------------------------------------------\neclipse.buildId\u003dM20060912-1730\njava.version\u003d1.5.0_06\njava.vendor\u003dSun Microsystems Inc.\nBootLoader constants: OS\u003dwin32, ARCH\u003dx86, WS\u003dwin32, NL\u003den_US\nCommand-line arguments:  -os win32 -ws win32 -arch x86 -consolelog\n\n!ENTRY org.eclipse.ui 4 4 2006-09-15 00:51:03.254\n!MESSAGE Unhandled event loop exception\n\n!ENTRY org.eclipse.ui 4 0 2006-09-15 00:51:03.324\n!MESSAGE java.lang.OutOfMemoryError: Java heap space\n!STACK 0\njava.lang.RuntimeException: java.lang.OutOfMemoryError: Java heap space\n\tat org.eclipse.wst.sse.core.internal.text.JobSafeStructuredDocument.replaceText(JobSafeStructuredDocument.java:117)\n\tat org.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.set(BasicStructuredDocument.java:2856)\n\tat org.eclipse.core.internal.filebuffers.ResourceTextFileBuffer.handleFileContentChanged(ResourceTextFileBuffer.java:479)\n\tat org.eclipse.core.internal.filebuffers.ResourceFileBuffer.revert(ResourceFileBuffer.java:351)\n\tat org.eclipse.ui.editors.text.TextFileDocumentProvider$1.execute(TextFileDocumentProvider.java:710)\n\tat org.eclipse.ui.editors.text.TextFileDocumentProvider$DocumentProviderOperation.run(TextFileDocumentProvider.java:144)\n\tat org.eclipse.ui.actions.WorkspaceModifyDelegatingOperation.execute(WorkspaceModifyDelegatingOperation.java:68)\n\tat org.eclipse.ui.actions.WorkspaceModifyOperation$1.run(WorkspaceModifyOperation.java:101)\n\tat org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1737)\n\tat org.eclipse.ui.actions.WorkspaceModifyOperation.run(WorkspaceModifyOperation.java:113)\n\tat org.eclipse.ui.internal.editors.text.WorkspaceOperationRunner.run(WorkspaceOperationRunner.java:73)\n\tat org.eclipse.ui.internal.editors.text.WorkspaceOperationRunner.run(WorkspaceOperationRunner.java:63)\n\tat org.eclipse.ui.editors.text.TextFileDocumentProvider.executeOperation(TextFileDocumentProvider.java:460)\n\tat org.eclipse.ui.editors.text.TextFileDocumentProvider.resetDocument(TextFileDocumentProvider.java:728)\n\tat org.eclipse.ui.texteditor.AbstractTextEditor.performRevert(AbstractTextEditor.java:3932)\n\tat org.eclipse.wst.sse.ui.StructuredTextEditor.performRevert(StructuredTextEditor.java:2803)\n\tat org.eclipse.ui.texteditor.AbstractTextEditor.doRevertToSaved(AbstractTextEditor.java:3912)\n\tat org.eclipse.ui.texteditor.StatusTextEditor.doRevertToSaved(StatusTextEditor.java:183)\n\tat org.eclipse.wst.sse.ui.StructuredTextEditor.doRevertToSaved(StructuredTextEditor.java:2092)\n\tat org.eclipse.ui.texteditor.RevertToSavedAction.run(RevertToSavedAction.java:47)\n\tat org.eclipse.jface.action.Action.runWithEvent(Action.java:499)\n\tat org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:539)\n\tat org.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:488)\n\tat org.eclipse.jface.action.ActionContributionItem$5.handleEvent(ActionContributionItem.java:400)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:928)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3348)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2968)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1914)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1878)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:419)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)\n\tat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:95)\n\tat org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:78)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:92)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:68)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:400)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:177)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:585)\n\tat org.eclipse.core.launcher.Main.invokeFramework(Main.java:336)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:280)\n\tat org.eclipse.core.launcher.Main.run(Main.java:977)\n\tat org.eclipse.core.launcher.Main.main(Main.java:952)\nCaused by: java.lang.OutOfMemoryError: Java heap space\n\n!ENTRY org.eclipse.core.jobs 4 2 2006-09-15 00:54:13.938\n!MESSAGE An internal error occurred during: \"Refreshing Outline\".\n!STACK 0\njava.lang.OutOfMemoryError: Java heap space\n\n!ENTRY org.eclipse.ui 4 4 2006-09-15 00:55:47.993\n!MESSAGE Unhandled event loop exception\n\n!ENTRY org.eclipse.ui 4 0 2006-09-15 00:55:48.003\n!MESSAGE Java heap space\n!STACK 0\njava.lang.OutOfMemoryError: Java heap space",
    "I know you\u0027re \"booked\" Nitin but, hoping something might come to mind given my observations. Not sure if you\u0027ve made any changes in this area since 1.5.0, but appears you were last to work in the area. \n\nI could reproduce this in dev. env. by typing some charaters, and then \u0027revert\u0027 file. (using the readme.html as Amy descirbes). \n\nThe \"root\" problem, seems to be that somehow the Display thread\u0027s asynch que is getting hundreds of thousands of \"runnables\" which seem to all come from RefreshStructureJob.\n\n\n\n",
    "Created an attachment (id\u003d50235)\npatch to check for equal nodes, before checking for \"contains\" \n\nNitin and Amy, please review this fix. Using the debugger, I could tell the problem cases were caused by a huge number of refresh requests occuring for the Document node itself (the top most Node), and our \"contains\" method literally checks for containment, not equality, so, all these Document refreshes were being que\u0027d up. The fix might have been made to the \u0027contains\u0027 method, but we actually use it for both directions (does a contain b or does b contain a) so I think we need it to be literally containment. So the fix was to check for equality before containment. \n\nI think this is a correct and proper fix (no matter what), but the puzzling part was I\u0027m not sure why this would have regressed from the 1.5.0 release AND these excessive Document requests seem to only occur for HTML documents. I could not reproduce with JSP or XML or DTD or XSD. So, please consider if there is some *additional* fix we should make (or some other code that might have changed, that caused this behavior only for HTML documnets). In either case, I think this fix is still necessary and sufficient for this case.  Let\u0027s propose PMC review after you\u0027ve reviewed it (I\u0027ll vote for it :) \n\n\n",
    "I was able to see it with xml as well.  Though all I did was rename the readme.html file to readme.xml and then open it in the xml editor.  It still did seem slightly better than the html editor though, but I still saw the problem.\n\nThe patch looks pretty good to me.  I am also at a loss for what may have changed between 1.5 \u0026 1.5.1 to have this regress.",
    "Created an attachment (id\u003d50321)\nupdated patch to fix a logic error\n\nThere\u0027s another bad bug in the core logic of this class, fixed by this new patch (which still has the \"equals\" check, since logically, that\u0027s always the correct thing to do). \n\nThe bug is that in the for loop, in which we are attempting to optimize and not add requests if already covered by another request ... we had the fRequests.add(node) inside the for loop instead of outside of the for loop! This means that if there is a long list of requests, say, a hundred, and none of them are optimized out, then we add the new request 100 times! Just the opposite of what we are trying to do! Geez ... and, I compared this class with the one with R1_5_0 tag and found this is the source of the regression. This was accidently introduced while fixing bug 134221. \n\nGreat thanks to Amy for finding this in time! \n\n",
    "+1\n",
    "+1 for the updated patch, although it reads like the \"fRequests.add(node);\" should now just be a fall-through since it executes regardless as long as there\u0027s no early return.",
    "+1\n",
    "+1",
    "please verify in builds \u003e 2006 09 15 0700 UTC\n",
    "Verified in build R-1.5.1-200609230508.",
    "i also verified in wtp 1.5.1 9/23/06 build\ni\u0027ll go ahead and close it."
  ],
  "commentCreationDates": [
    "2006-09-15T08:51:56+02:00",
    "2006-09-15T09:01:35+02:00",
    "2006-09-15T09:54:54+02:00",
    "2006-09-16T00:59:47+02:00",
    "2006-09-16T04:26:56+02:00",
    "2006-09-16T04:30:35+02:00",
    "2006-09-18T18:51:51+02:00",
    "2006-09-18T20:07:15+02:00",
    "2006-09-18T21:41:57+02:00",
    "2006-09-19T06:52:26+02:00",
    "2006-09-25T21:45:17+02:00",
    "2006-09-28T17:23:17+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.OutOfMemoryError",
      "message": "Java heap space",
      "elements": [
        {
          "method": "org.eclipse.wst.sse.core.internal.text.JobSafeStructuredDocument.replaceText",
          "source": "JobSafeStructuredDocument.java:117"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.set",
          "source": "BasicStructuredDocument.java:2856"
        },
        {
          "method": "org.eclipse.core.internal.filebuffers.ResourceTextFileBuffer.handleFileContentChanged",
          "source": "ResourceTextFileBuffer.java:479"
        },
        {
          "method": "org.eclipse.core.internal.filebuffers.ResourceFileBuffer.revert",
          "source": "ResourceFileBuffer.java:351"
        },
        {
          "method": "org.eclipse.ui.editors.text.TextFileDocumentProvider$1.execute",
          "source": "TextFileDocumentProvider.java:710"
        },
        {
          "method": "org.eclipse.ui.editors.text.TextFileDocumentProvider$DocumentProviderOperation.run",
          "source": "TextFileDocumentProvider.java:144"
        },
        {
          "method": "org.eclipse.ui.actions.WorkspaceModifyDelegatingOperation.execute",
          "source": "WorkspaceModifyDelegatingOperation.java:68"
        },
        {
          "method": "org.eclipse.ui.actions.WorkspaceModifyOperation$1.run",
          "source": "WorkspaceModifyOperation.java:101"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1737"
        },
        {
          "method": "org.eclipse.ui.actions.WorkspaceModifyOperation.run",
          "source": "WorkspaceModifyOperation.java:113"
        },
        {
          "method": "org.eclipse.ui.internal.editors.text.WorkspaceOperationRunner.run",
          "source": "WorkspaceOperationRunner.java:73"
        },
        {
          "method": "org.eclipse.ui.internal.editors.text.WorkspaceOperationRunner.run",
          "source": "WorkspaceOperationRunner.java:63"
        },
        {
          "method": "org.eclipse.ui.editors.text.TextFileDocumentProvider.executeOperation",
          "source": "TextFileDocumentProvider.java:460"
        },
        {
          "method": "org.eclipse.ui.editors.text.TextFileDocumentProvider.resetDocument",
          "source": "TextFileDocumentProvider.java:728"
        },
        {
          "method": "org.eclipse.ui.texteditor.AbstractTextEditor.performRevert",
          "source": "AbstractTextEditor.java:3932"
        },
        {
          "method": "org.eclipse.wst.sse.ui.StructuredTextEditor.performRevert",
          "source": "StructuredTextEditor.java:2803"
        },
        {
          "method": "org.eclipse.ui.texteditor.AbstractTextEditor.doRevertToSaved",
          "source": "AbstractTextEditor.java:3912"
        },
        {
          "method": "org.eclipse.ui.texteditor.StatusTextEditor.doRevertToSaved",
          "source": "StatusTextEditor.java:183"
        },
        {
          "method": "org.eclipse.wst.sse.ui.StructuredTextEditor.doRevertToSaved",
          "source": "StructuredTextEditor.java:2092"
        },
        {
          "method": "org.eclipse.ui.texteditor.RevertToSavedAction.run",
          "source": "RevertToSavedAction.java:47"
        },
        {
          "method": "org.eclipse.jface.action.Action.runWithEvent",
          "source": "Action.java:499"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:539"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$2",
          "source": "ActionContributionItem.java:488"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$5.handleEvent",
          "source": "ActionContributionItem.java:400"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:928"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:3348"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2968"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1914"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1878"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:419"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:95"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:78"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:92"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:68"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:400"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:177"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:585"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:336"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:280"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:977"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:952"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "157427",
      "date": "2006-09-15T08:51:56+02:00",
      "product": "Web Tools",
      "component": "wst.xml",
      "severity": "critical"
    }
  ],
  "groupId": "157427",
  "bugId": "157427",
  "date": "2006-09-15T08:51:56+02:00",
  "product": "Web Tools",
  "component": "wst.xml",
  "severity": "critical"
}