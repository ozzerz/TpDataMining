{
  "comments": [
    "20070304\n\nWe\u0027re creating a forms toolkit like this:\n  fToolkit\u003d new FormToolkit(fColors);\n\nwhich is spec\u0027ed as:\n* Creates a toolkit that will use the provided (shared) colors. The toolkit\n* will \u003cb\u003enot \u003c/b\u003e dispose the provided colors.\n\nand dispose it like this:\nfToolkit.dispose();\nfColors.dispose();\n\nThis results in a NPE from twice disposing colors as fToolkit.dispose disposes the colors even if the spec says it wouldn\u0027t. I believe this bug got introduced just lately.\n\nReproducable steps:\n- open new Java project wizard, enter name and press \u0027Next\u0027\n- on the the second page, press \u0027Cancel\u0027\n\njava.lang.NullPointerException\n\tat org.eclipse.ui.forms.FormColors.dispose(FormColors.java:368)\n\tat org.eclipse.jdt.internal.ui.preferences.ScrolledPageContent.dispose(ScrolledPageContent.java:55)\n\tat org.eclipse.jdt.internal.ui.wizards.buildpaths.newsourcepage.HintTextGroup.handlePostSelectionChange(HintTextGroup.java:235)\n\tat org.eclipse.jdt.internal.ui.wizards.buildpaths.newsourcepage.HintTextGroup.selectionChanged(HintTextGroup.java:216)\n\tat org.eclipse.jface.viewers.StructuredViewer$3.run(StructuredViewer.java:841)\n\tat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n\tat org.eclipse.core.runtime.Platform.run(Platform.java:850)\n\tat org.eclipse.ui.internal.JFaceUtil$1.run(JFaceUtil.java:45)\n\tat org.eclipse.jface.util.SafeRunnable.run(SafeRunnable.java:153)\n\tat org.eclipse.jface.viewers.StructuredViewer.firePostSelectionChanged(StructuredViewer.java:839)\n\tat org.eclipse.jface.viewers.StructuredViewer.handleInvalidSelection(StructuredViewer.java:1103)\n\tat org.eclipse.jface.viewers.StructuredViewer.preservingSelection(StructuredViewer.java:1345)\n\tat org.eclipse.jface.viewers.StructuredViewer.refresh(StructuredViewer.java:1422)\n\tat org.eclipse.jdt.internal.ui.packageview.PackageExplorerContentProvider$4.run(PackageExplorerContentProvider.java:844)\n\tat org.eclipse.jdt.internal.ui.packageview.PackageExplorerContentProvider.runUpdates(PackageExplorerContentProvider.java:167)",
    "Martin, at the moment you have to \"mark\" the colors as being shared in order for the toolkit not to dispose them. The full description is:\n\n\"Creates a toolkit that will use the provided (shared) colors. The toolkit\nwill \u003cb\u003enot \u003c/b\u003e dispose the provided colors.\"\n\nSo the assumption is that you will have called markShared() on the provided colors, in which case it will not dispose. However I think this is easy to miss, and I don\u0027t see any harm in having the FormToolkit constructor take care of this for you.\n\nDejan, should we:\n\n1) Clarify the API, mention the explicit call to markShared()\n2) Take care of this automatically by marking the colors as shared in the constructor?\n",
    "Here is one use case where automatic \u0027markShared()\u0027 would be bad:\n\n1) User extends the colors by overriding some methods\n2) User passes the colors to the toolkit - no sharing\n3) The colors are not disposed when the toolkit is diposed\n\nIn other words, there is a use case where a colors instance is passed in but not shared. It is not as frequent as the one above, but I don\u0027t like the constructor doing things to the colors object it has been passed.\n\nI vote for clarifying the API.",
    "The new description is:\n\n\"Creates a toolkit that will use the provided (shared) colors. The toolkit will dispose the colors if and only if they are \u003cb\u003enot\u003c/b\u003e marked as shared via the \u003ccode\u003emarkShared()\u003c/code\u003e method.\"\n\nMartin,\n\n- If these colors really are shared among multiple toolkits, you should call markShared() before passing them in, and dispose them when no longer needed.\n- If they are only for this toolkit, you can simply remove your dispose call and let the toolkit do it for you (and not mark them shared).\n",
    "Fixed.\n\n(API clarified)",
    "*** Bug 176959 has been marked as a duplicate of this bug. ***"
  ],
  "commentCreationDates": [
    "2007-03-04T15:55:44+01:00",
    "2007-03-05T16:13:02+01:00",
    "2007-03-05T18:38:30+01:00",
    "2007-03-05T19:30:54+01:00",
    "2007-03-05T19:31:17+01:00",
    "2007-03-12T15:59:11+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.ui.forms.FormColors.dispose",
          "source": "FormColors.java:368"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.preferences.ScrolledPageContent.dispose",
          "source": "ScrolledPageContent.java:55"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.wizards.buildpaths.newsourcepage.HintTextGroup.handlePostSelectionChange",
          "source": "HintTextGroup.java:235"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.wizards.buildpaths.newsourcepage.HintTextGroup.selectionChanged",
          "source": "HintTextGroup.java:216"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer$3.run",
          "source": "StructuredViewer.java:841"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:850"
        },
        {
          "method": "org.eclipse.ui.internal.JFaceUtil$1.run",
          "source": "JFaceUtil.java:45"
        },
        {
          "method": "org.eclipse.jface.util.SafeRunnable.run",
          "source": "SafeRunnable.java:153"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.firePostSelectionChanged",
          "source": "StructuredViewer.java:839"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.handleInvalidSelection",
          "source": "StructuredViewer.java:1103"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.preservingSelection",
          "source": "StructuredViewer.java:1345"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.refresh",
          "source": "StructuredViewer.java:1422"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.packageview.PackageExplorerContentProvider$4.run",
          "source": "PackageExplorerContentProvider.java:844"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.packageview.PackageExplorerContentProvider.runUpdates",
          "source": "PackageExplorerContentProvider.java:167"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "176309",
      "date": "2007-03-04T15:55:44+01:00",
      "product": "Platform",
      "component": "User Assistance",
      "severity": "critical"
    }
  ],
  "groupId": "176309",
  "bugId": "176309",
  "date": "2007-03-04T15:55:44+01:00",
  "product": "Platform",
  "component": "User Assistance",
  "severity": "critical"
}