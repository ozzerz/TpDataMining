{
  "comments": [
    "I\u0027m not sure exactly what causes this, it may have to do with the alphabetical order of the projects.  If I select several projects for deletion at once several of the following exceptions are occasionally thrown.\n\n!ENTRY org.eclipse.core.resources 4 2 2006-09-11 15:50:09.357\n!MESSAGE Problems occurred when invoking code from plug-in: \"org.eclipse.core.resources\".\n!STACK 0\njava.lang.NullPointerException\n        at org.eclipse.jst.j2ee.refactor.operations.ProjectRefactorMetadata.computeMetadata(ProjectRefactorMetadata.java\n:98)\n        at org.eclipse.jst.j2ee.refactor.operations.ProjectRefactorMetadata.computeMetadata(ProjectRefactorMetadata.java\n:77)\n        at org.eclipse.jst.j2ee.refactor.listeners.ProjectRefactoringListener.cacheDeletedProjectMetadata(ProjectRefacto\nringListener.java:97)\n        at org.eclipse.jst.j2ee.refactor.listeners.ProjectRefactoringListener.resourceChanged(ProjectRefactoringListener\n.java:84)\n        at org.eclipse.core.internal.events.NotificationManager$2.run(NotificationManager.java:280)\n        at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n        at org.eclipse.core.internal.events.NotificationManager.notify(NotificationManager.java:274)\n        at org.eclipse.core.internal.events.NotificationManager.handleEvent(NotificationManager.java:258)\n        at org.eclipse.core.internal.resources.Workspace.broadcastEvent(Workspace.java:250)\n        at org.eclipse.core.internal.resources.Resource.unprotectedDelete(Resource.java:1642)\n        at org.eclipse.core.internal.resources.Resource.delete(Resource.java:695)\n        at org.eclipse.core.internal.resources.Project.delete(Project.java:337)\n        at org.eclipse.ui.actions.DeleteResourceAction.delete(DeleteResourceAction.java:473)\n        at org.eclipse.ui.actions.DeleteResourceAction.delete(DeleteResourceAction.java:447)\n        at org.eclipse.ui.actions.DeleteResourceAction.access$2(DeleteResourceAction.java:436)\n        at org.eclipse.ui.actions.DeleteResourceAction$4.run(DeleteResourceAction.java:600)\n        at org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1737)\n        at org.eclipse.ui.actions.DeleteResourceAction$3.run(DeleteResourceAction.java:596)\n        at org.eclipse.core.internal.jobs.Worker.run(Worker.java:58)",
    "Hmmm, that is odd; that NPE indicates that the call to ProjectFacetsManager.create(IProject) is returning null, however, it looks like it only returns null if either the project is not accessible or does not have the faceted project nature - the call to ProjectRefactoringListener.cacheDeletedProjectMetadata() is only made if the call to \"ModuleCoreNature.getModuleCoreNature(project) !\u003d null\" passes and this is checking for project accessibility and the module core nature. This is all done during PRE_DELETE processing so I wouldn\u0027t think there should be a change in project accessibility status...\n\nI can only assume that the test project.isNatureEnabled(FacetedProjectNature.NATURE_ID) failed in this case.\n\nJason: do you have any projects with the module core nature but without the faceted project nature? (if I remove the faceted nature, I can repro that NPE - my expectation is that projects with the module core nature will also have the faceted project nature...)",
    "Of course I can\u0027t reproduce this any more.  :)  Though I don\u0027t remember doing anything to delete the facets nature or .settings file, I suppose it is possible that it wasn\u0027t there.  The project I was working with seemed to be messed up because of some earlier exceptions, so I deleted everything in my workspace.  Though this bad state should never happen, it wouldn\u0027t hurt for deete to guard against it, considering many users might do exactly what I did when things start breaking; that is, delete everything and start over.",
    "Agreed - I\u0027m going to lower severity (this just impacts the refactoring job and should not prevent project deletion) and targeting to 2.0",
    "We need this for WTP 1.5.1, Jason can take a look.",
    "I will create a patch",
    "Created an attachment (id\u003d49883)\nPatch for org.eclipse.jst.j2ee\n\nAdds explicit check for faceted project nature as well as null check on IFactedProject",
    "All refactoring/project dependency unit tests pass; tested against repro case of a project that was manually changed to have the module core nature but not have the faceted project nature.",
    "Rob,\n\nCould you attach the patch rather than plugin build? It is not necessary to check for the faceted project nature explicitly. Checking for null return from the create method is always sufficient.",
    "Created an attachment (id\u003d49885)\nPatch for org.eclipse.jst.j2ee\n\nThe actual patch ",
    "I\u0027d like to see this patch modified to not check the faceted project nature directly. The proper api way of doing this is to use ProjectFacetsManager.create() method and to check for null. Checking for the faceted project nature is not only redundant by introduces an unnecessary dependency on internal code.",
    "Created an attachment (id\u003d49886)\nPatch for org.eclipse.jst.j2ee\n\nHad attached the wrong patch initially; yep, good point on just making the ProjectFacetsManager.create() check, this patch includes just null checks based on the return from that method. ",
    "note: the faceted project nature check in ProjectRefactoringListener (what is now a null check on the return from FacetedProjectManager.create()) is not redundant; it is there to ensure that the j2ee refactoring logic no-ops if the faceted project nature is missing from the renamed/deleted project for some reason",
    "+1 looks great. Thanks for the careful reviews and explainations. \n",
    "+1\n",
    "+1",
    "+1 for WTP 1.5.1",
    "Changes committed and released",
    "haven\u0027t seen this happen since this fix went in.",
    "closing."
  ],
  "commentCreationDates": [
    "2006-09-11T21:48:37+02:00",
    "2006-09-11T22:27:09+02:00",
    "2006-09-11T22:42:31+02:00",
    "2006-09-11T23:05:28+02:00",
    "2006-09-11T23:31:50+02:00",
    "2006-09-11T23:54:37+02:00",
    "2006-09-12T00:04:16+02:00",
    "2006-09-12T00:05:50+02:00",
    "2006-09-12T00:08:26+02:00",
    "2006-09-12T00:34:19+02:00",
    "2006-09-12T00:37:32+02:00",
    "2006-09-12T00:53:09+02:00",
    "2006-09-12T01:05:13+02:00",
    "2006-09-12T02:04:15+02:00",
    "2006-09-12T07:19:13+02:00",
    "2006-09-12T16:11:39+02:00",
    "2006-09-12T16:14:08+02:00",
    "2006-09-12T22:22:27+02:00",
    "2006-09-22T16:33:52+02:00",
    "2006-09-22T16:34:03+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.jst.j2ee.refactor.operations.ProjectRefactorMetadata.computeMetadata",
          "source": "ProjectRefactorMetadata.java :98"
        },
        {
          "method": "org.eclipse.jst.j2ee.refactor.operations.ProjectRefactorMetadata.computeMetadata",
          "source": "ProjectRefactorMetadata.java :77"
        },
        {
          "method": "org.eclipse.jst.j2ee.refactor.listeners.ProjectRefactoringListener.cacheDeletedProjectMetadata",
          "source": "ProjectRefacto ringListener.java:97"
        },
        {
          "method": "org.eclipse.jst.j2ee.refactor.listeners.ProjectRefactoringListener.resourceChanged",
          "source": "ProjectRefactoringListener .java:84"
        },
        {
          "method": "org.eclipse.core.internal.events.NotificationManager$2.run",
          "source": "NotificationManager.java:280"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.core.internal.events.NotificationManager.notify",
          "source": "NotificationManager.java:274"
        },
        {
          "method": "org.eclipse.core.internal.events.NotificationManager.handleEvent",
          "source": "NotificationManager.java:258"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.broadcastEvent",
          "source": "Workspace.java:250"
        },
        {
          "method": "org.eclipse.core.internal.resources.Resource.unprotectedDelete",
          "source": "Resource.java:1642"
        },
        {
          "method": "org.eclipse.core.internal.resources.Resource.delete",
          "source": "Resource.java:695"
        },
        {
          "method": "org.eclipse.core.internal.resources.Project.delete",
          "source": "Project.java:337"
        },
        {
          "method": "org.eclipse.ui.actions.DeleteResourceAction.delete",
          "source": "DeleteResourceAction.java:473"
        },
        {
          "method": "org.eclipse.ui.actions.DeleteResourceAction.delete",
          "source": "DeleteResourceAction.java:447"
        },
        {
          "method": "org.eclipse.ui.actions.DeleteResourceAction.access$2",
          "source": "DeleteResourceAction.java:436"
        },
        {
          "method": "org.eclipse.ui.actions.DeleteResourceAction$4.run",
          "source": "DeleteResourceAction.java:600"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1737"
        },
        {
          "method": "org.eclipse.ui.actions.DeleteResourceAction$3.run",
          "source": "DeleteResourceAction.java:596"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:58"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "156930",
      "date": "2006-09-11T21:48:37+02:00",
      "product": "Web Tools",
      "component": "jst.j2ee",
      "severity": "major"
    }
  ],
  "groupId": "156930",
  "bugId": "156930",
  "date": "2006-09-11T21:48:37+02:00",
  "product": "Web Tools",
  "component": "jst.j2ee",
  "severity": "major"
}