{
  "comments": [
    "Found on an IBuild from 714\n\nTo repro:\n1.  Open JSP file\n2.  Right click in JSP file and select Cleanup document\n3.  At the bottom, check the \"convert Line Delimiters to\"\n4.  Click the Mac radio button\n5.  CLick OK out of the Cleanup Document dialog\n\nResults:  error processing dirty regions message comes up and all syntax\ncoloring is lost on JSP.  In log file is the stack trace below\n\nNOTE:  I am on a Windows XP box\n\n!ENTRY org.eclipse.core.runtime 4 2 2005-07-14 09:38:55.906\n!MESSAGE An internal error occurred during: \"Processing Dirty Regions\".\n!STACK 0\njava.lang.ArrayIndexOutOfBoundsException\n\tat java.lang.System.arraycopy(Native Method)\n\tat\norg.eclipse.jst.jsp.core.internal.contenttype.JSPHeadTokenizer.zzRefill(JSPHeadTokenizer.java:339)\n\tat\norg.eclipse.jst.jsp.core.internal.contenttype.JSPHeadTokenizer.primGetNextToken(JSPHeadTokenizer.java:552)\n\tat\norg.eclipse.jst.jsp.core.internal.contenttype.JSPHeadTokenizer.getNextToken(JSPHeadTokenizer.java:260)\n\tat\norg.eclipse.jst.jsp.core.internal.contenttype.JSPResourceEncodingDetector.parseHeader(JSPResourceEncodingDetector.java:383)\n\tat\norg.eclipse.jst.jsp.core.internal.contenttype.JSPResourceEncodingDetector.parseInput(JSPResourceEncodingDetector.java:438)\n\tat\norg.eclipse.jst.jsp.core.internal.contenttype.JSPResourceEncodingDetector.getContentType(JSPResourceEncodingDetector.java:84)\n\tat\norg.eclipse.jst.jsp.core.internal.text.StructuredTextPartitionerForJSP.createStructuredTextPartitioner(StructuredTextPartitionerForJSP.java:242)\n\tat\norg.eclipse.jst.jsp.core.internal.text.StructuredTextPartitionerForJSP.getEmbeddedPartitioner(StructuredTextPartitionerForJSP.java:306)\n\tat\norg.eclipse.jst.jsp.core.internal.text.StructuredTextPartitionerForJSP.setInternalPartition(StructuredTextPartitionerForJSP.java:498)\n\tat\norg.eclipse.jst.jsp.core.internal.text.StructuredTextPartitionerForJSP.isDocumentRegionBasedPartition(StructuredTextPartitionerForJSP.java:438)\n\tat\norg.eclipse.wst.sse.core.internal.text.rules.StructuredTextPartitioner.internalGetPartition(StructuredTextPartitioner.java:550)\n\tat\norg.eclipse.wst.sse.core.internal.text.rules.StructuredTextPartitioner.computePartitioning(StructuredTextPartitioner.java:113)\n\tat\norg.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.computePartitioning(BasicStructuredDocument.java:1059)\n\tat org.eclipse.jface.text.TextUtilities.computePartitioning(TextUtilities.java:426)\n\tat\norg.eclipse.wst.sse.ui.internal.reconcile.DirtyRegionProcessor.computePartitioning(DirtyRegionProcessor.java:153)\n\tat\norg.eclipse.wst.sse.ui.internal.reconcile.StructuredRegionProcessor.process(StructuredRegionProcessor.java:119)\n\tat\norg.eclipse.wst.sse.ui.internal.reconcile.DirtyRegionProcessor.run(DirtyRegionProcessor.java:412)\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:76)",
    "Jill, please attach the .jsp file to this bug.  The file\u0027s size and content\ncould be triggering this.",
    "Well, I must admit that my first couple of tries to repro gave me nothing.  So\nthere\u0027s a strange extra step to this repro:\n--Change the very top radio button (Tag name case for HTML) to \u0027Upper\u0027, then\nchange line endings to Mac.  Then it throws the exception.\n\nAs for the contents of the JSP file, I was just using the default new JSP:\n\n\u003c%@ page language\u003d\"java\" contentType\u003d\"text/html; charset\u003dISO-8859-1\"\n\tpageEncoding\u003d\"ISO-8859-1\"%\u003e\n\u003c!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"\u003e\n\u003chtml\u003e\n\u003chead\u003e\n\u003cmeta http-equiv\u003d\"Content-Type\" content\u003d\"text/html; charset\u003dISO-8859-1\"\u003e\n\u003ctitle\u003eInsert title here\u003c/title\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\n\u003c/body\u003e\n\u003c/html\u003e",
    "Nitin, please investigate. ",
    "Amy ... how about if you see if you can re-produce? Its a little odd that\nJSPHeadTokenizer.zzRefill would ever through an exception. \n",
    "yep, i can reproduce using the steps in comment #2\nsomething is happenning in zzRefill where when the following line is called:\n      System.arraycopy(zzBuffer, zzStartRead,\n                       zzBuffer, 0,\n                       zzEndRead-zzStartRead);\n\nzzEndRead \u003d 1\nzzStartRead \u003d 314\nthus making the length to arraycopy, -313",
    "Reassigning to myself since it\u0027s reproducable.",
    "While this is a bad problem, given this doesn\u0027t \"block use\", any fix at the\ntokenizer level is too risky to make at this point for 0.7 ... so, we\u0027ll attend\nto this bug next release. If you disagree or believe there is something\n\"blocking\" here I am not seeing, please comment. \n\n",
    "resetting priority to be sure this gets addressed in R1,0, if possible. ",
    "David, shouldn\u0027t we just regenerate the head tokenizer with the newer JFlex?",
    "hey Nitin - wanted to check on the current status of this one (just saw an internal report of a similar stack from a version of our product deployed with 1.0.3)\n\nthanks, Rob",
    "(In reply to comment #9)\n\u003e David, shouldn\u0027t we just regenerate the head tokenizer with the newer JFlex?\n\u003e \n\nSure, why not! (for 2.0)",
    "Created an attachment (id\u003d84218)\nJSP file that will generate the exception on 1.5.x but not on 2.0.2/3.0\n\nAnother JSP file which, when imported into 1.5.x, will trigger that exception, disable the org.eclipse.jst.jsp.core.jspsource content describer and cause all further attempts to open a JSP file in the IDE to generate the following:\n\n..\n!ENTRY org.eclipse.wst.sse.core 4 4 2007-10-01 17:02:16.048\n!MESSAGE A structured model client, org.eclipse.wst.xml.core.internal.propagate.PropagatingAdapterImpl@a0d4a3 threw following exception during adapter notification (ADD )\n!STACK 0\njava.lang.NullPointerException\n\tat org.eclipse.jst.jsp.core.internal.document.PageDirectiveAdapterImpl.setCachedContentType(PageDirectiveAdapterImpl.java:458)\n\tat org.eclipse.jst.jsp.core.internal.document.PageDirectiveAdapterImpl.changedContentType(PageDirectiveAdapterImpl.java:299)\n\tat org.eclipse.jst.jsp.core.internal.document.PageDirectiveWatcherImpl.\u003cinit\u003e(PageDirectiveWatcherImpl.java:42)\n\tat org.eclipse.jst.jsp.core.internal.document.PageDirectiveWatcherFactory.createAdapter(PageDirectiveWatcherFactory.java:47)\n\tat org.eclipse.wst.sse.core.internal.provisional.AbstractAdapterFactory.adaptNew(AbstractAdapterFactory.java:120)\n\tat org.eclipse.wst.sse.core.internal.provisional.AbstractAdapterFactory.adapt(AbstractAdapterFactory.java:64)\n\tat org.eclipse.wst.xml.core.internal.propagate.PropagatingAdapterImpl.adaptOnCreate(PropagatingAdapterImpl.java:51)\n\tat org.eclipse.wst.xml.core.internal.propagate.PropagatingAdapterImpl.propagateTo(PropagatingAdapterImpl.java:117)\n\tat org.eclipse.wst.xml.core.internal.propagate.PropagatingAdapterImpl.notifyChanged(PropagatingAdapterImpl.java:110)\n\tat org.eclipse.wst.sse.core.internal.provisional.AbstractNotifier.notify(AbstractNotifier.java:201)\n\tat org.eclipse.wst.xml.core.internal.document.XMLModelNotifierImpl.notify(XMLModelNotifierImpl.java:238)\n\tat org.eclipse.wst.xml.core.internal.document.XMLModelNotifierImpl.notifyDeferred(XMLModelNotifierImpl.java:340)\n\tat org.eclipse.wst.xml.core.internal.document.XMLModelNotifierImpl.endChanging(XMLModelNotifierImpl.java:178)\n\tat org.eclipse.wst.xml.core.internal.document.DOMModelImpl.internalSetNewDocument(DOMModelImpl.java:604)\n\tat org.eclipse.wst.xml.core.internal.document.DOMModelImpl.setStructuredDocument(DOMModelImpl.java:870)\n\tat org.eclipse.wst.sse.core.internal.model.AbstractModelLoader.createModel(AbstractModelLoader.java:127)\n\tat org.eclipse.wst.sse.core.internal.FileBufferModelManager.getModel(FileBufferModelManager.java:593)\n\tat org.eclipse.wst.sse.core.internal.model.ModelManagerImpl._getModelFor(ModelManagerImpl.java:393)\n\tat org.eclipse.wst.sse.core.internal.model.ModelManagerImpl.getModelForEdit(ModelManagerImpl.java:1020)\n\tat org.eclipse.wst.sse.ui.StructuredTextEditor.doSetInput(StructuredTextEditor.java:2161)\n..\n\nThese problems do not occur on either 2.0.2 or 3.0 (just get error problem markers about the inability to find the tag libraries). So, part of this underlying bugzilla may now be fixed."
  ],
  "commentCreationDates": [
    "2005-07-14T18:52:06+02:00",
    "2005-07-14T21:04:06+02:00",
    "2005-07-16T00:09:02+02:00",
    "2005-07-18T08:00:37+02:00",
    "2005-07-20T20:35:42+02:00",
    "2005-07-20T21:36:08+02:00",
    "2005-07-21T02:51:38+02:00",
    "2005-07-25T01:31:45+02:00",
    "2005-10-13T19:38:01+02:00",
    "2006-06-06T10:09:39+02:00",
    "2006-11-03T15:19:36+01:00",
    "2006-11-03T15:44:53+01:00",
    "2007-11-30T19:35:31+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ArrayIndexOutOfBoundsException",
      "elements": [
        {
          "method": "java.lang.System.arraycopy",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.jst.jsp.core.internal.contenttype.JSPHeadTokenizer.zzRefill",
          "source": "JSPHeadTokenizer.java:339"
        },
        {
          "method": "org.eclipse.jst.jsp.core.internal.contenttype.JSPHeadTokenizer.primGetNextToken",
          "source": "JSPHeadTokenizer.java:552"
        },
        {
          "method": "org.eclipse.jst.jsp.core.internal.contenttype.JSPHeadTokenizer.getNextToken",
          "source": "JSPHeadTokenizer.java:260"
        },
        {
          "method": "org.eclipse.jst.jsp.core.internal.contenttype.JSPResourceEncodingDetector.parseHeader",
          "source": "JSPResourceEncodingDetector.java:383"
        },
        {
          "method": "org.eclipse.jst.jsp.core.internal.contenttype.JSPResourceEncodingDetector.parseInput",
          "source": "JSPResourceEncodingDetector.java:438"
        },
        {
          "method": "org.eclipse.jst.jsp.core.internal.contenttype.JSPResourceEncodingDetector.getContentType",
          "source": "JSPResourceEncodingDetector.java:84"
        },
        {
          "method": "org.eclipse.jst.jsp.core.internal.text.StructuredTextPartitionerForJSP.createStructuredTextPartitioner",
          "source": "StructuredTextPartitionerForJSP.java:242"
        },
        {
          "method": "org.eclipse.jst.jsp.core.internal.text.StructuredTextPartitionerForJSP.getEmbeddedPartitioner",
          "source": "StructuredTextPartitionerForJSP.java:306"
        },
        {
          "method": "org.eclipse.jst.jsp.core.internal.text.StructuredTextPartitionerForJSP.setInternalPartition",
          "source": "StructuredTextPartitionerForJSP.java:498"
        },
        {
          "method": "org.eclipse.jst.jsp.core.internal.text.StructuredTextPartitionerForJSP.isDocumentRegionBasedPartition",
          "source": "StructuredTextPartitionerForJSP.java:438"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.text.rules.StructuredTextPartitioner.internalGetPartition",
          "source": "StructuredTextPartitioner.java:550"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.text.rules.StructuredTextPartitioner.computePartitioning",
          "source": "StructuredTextPartitioner.java:113"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.computePartitioning",
          "source": "BasicStructuredDocument.java:1059"
        },
        {
          "method": "org.eclipse.jface.text.TextUtilities.computePartitioning",
          "source": "TextUtilities.java:426"
        },
        {
          "method": "org.eclipse.wst.sse.ui.internal.reconcile.DirtyRegionProcessor.computePartitioning",
          "source": "DirtyRegionProcessor.java:153"
        },
        {
          "method": "org.eclipse.wst.sse.ui.internal.reconcile.StructuredRegionProcessor.process",
          "source": "StructuredRegionProcessor.java:119"
        },
        {
          "method": "org.eclipse.wst.sse.ui.internal.reconcile.DirtyRegionProcessor.run",
          "source": "DirtyRegionProcessor.java:412"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:76"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "103852",
      "date": "2005-07-14T18:52:06+02:00",
      "product": "Web Tools",
      "component": "jst.jsp",
      "severity": "major"
    },
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.jst.jsp.core.internal.document.PageDirectiveAdapterImpl.setCachedContentType",
          "source": "PageDirectiveAdapterImpl.java:458"
        },
        {
          "method": "org.eclipse.jst.jsp.core.internal.document.PageDirectiveAdapterImpl.changedContentType",
          "source": "PageDirectiveAdapterImpl.java:299"
        },
        {
          "method": "org.eclipse.jst.jsp.core.internal.document.PageDirectiveWatcherImpl.\u003cinit\u003e",
          "source": "PageDirectiveWatcherImpl.java:42"
        },
        {
          "method": "org.eclipse.jst.jsp.core.internal.document.PageDirectiveWatcherFactory.createAdapter",
          "source": "PageDirectiveWatcherFactory.java:47"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.provisional.AbstractAdapterFactory.adaptNew",
          "source": "AbstractAdapterFactory.java:120"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.provisional.AbstractAdapterFactory.adapt",
          "source": "AbstractAdapterFactory.java:64"
        },
        {
          "method": "org.eclipse.wst.xml.core.internal.propagate.PropagatingAdapterImpl.adaptOnCreate",
          "source": "PropagatingAdapterImpl.java:51"
        },
        {
          "method": "org.eclipse.wst.xml.core.internal.propagate.PropagatingAdapterImpl.propagateTo",
          "source": "PropagatingAdapterImpl.java:117"
        },
        {
          "method": "org.eclipse.wst.xml.core.internal.propagate.PropagatingAdapterImpl.notifyChanged",
          "source": "PropagatingAdapterImpl.java:110"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.provisional.AbstractNotifier.notify",
          "source": "AbstractNotifier.java:201"
        },
        {
          "method": "org.eclipse.wst.xml.core.internal.document.XMLModelNotifierImpl.notify",
          "source": "XMLModelNotifierImpl.java:238"
        },
        {
          "method": "org.eclipse.wst.xml.core.internal.document.XMLModelNotifierImpl.notifyDeferred",
          "source": "XMLModelNotifierImpl.java:340"
        },
        {
          "method": "org.eclipse.wst.xml.core.internal.document.XMLModelNotifierImpl.endChanging",
          "source": "XMLModelNotifierImpl.java:178"
        },
        {
          "method": "org.eclipse.wst.xml.core.internal.document.DOMModelImpl.internalSetNewDocument",
          "source": "DOMModelImpl.java:604"
        },
        {
          "method": "org.eclipse.wst.xml.core.internal.document.DOMModelImpl.setStructuredDocument",
          "source": "DOMModelImpl.java:870"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.model.AbstractModelLoader.createModel",
          "source": "AbstractModelLoader.java:127"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.FileBufferModelManager.getModel",
          "source": "FileBufferModelManager.java:593"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.model.ModelManagerImpl._getModelFor",
          "source": "ModelManagerImpl.java:393"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.model.ModelManagerImpl.getModelForEdit",
          "source": "ModelManagerImpl.java:1020"
        },
        {
          "method": "org.eclipse.wst.sse.ui.StructuredTextEditor.doSetInput",
          "source": "StructuredTextEditor.java:2161"
        }
      ],
      "number": 1,
      "commentIndex": 12,
      "bugId": "103852",
      "date": "2007-11-30T19:35:31+01:00",
      "product": "Web Tools",
      "component": "jst.jsp",
      "severity": "major"
    }
  ],
  "groupId": "103852",
  "bugId": "103852",
  "date": "2005-07-14T18:52:06+02:00",
  "product": "Web Tools",
  "component": "jst.jsp",
  "severity": "major"
}