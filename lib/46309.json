{
  "comments": [
    "I run Eclispe headless with \n\n/opt/WSAD51/eclipse/jre/bin/java  -cp\n/opt/WSAD51/eclipse/startup.jar:/opt/WSAD51/runtimes/base_v5/java/lib/tools.jar:/opt/WSAD51/runtimes/base_v5/java/jre/lib/ext/mail.jar:/opt/WSAD51/runtimes/base_v5/java/jre/lib/ext/activation.jar\norg.eclipse.core.launcher.Main  -application com.ibm.etools.j2ee.ant.RunAnt \n-data /home/build/wdme/DMWorkspace mail\n\nThe error I get is the following:\nBUILD FAILED\njava.lang.NoClassDefFoundError: com/sun/mail/util/SharedByteArrayInputStream\n        at org.apache.tools.ant.taskdefs.email.MimeMailer.send(MimeMailer.java:98)\n        at org.apache.tools.ant.taskdefs.email.EmailTask.execute(EmailTask.java:510)\n        at org.apache.tools.ant.Task.perform(Task.java:341)\n        at org.apache.tools.ant.Target.execute(Target.java:309)\n        at org.apache.tools.ant.Target.performTasks(Target.java:336)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1339)\n        at org.apache.tools.ant.taskdefs.Ant.execute(Ant.java:397)\n\n\nYour first responce will be you didn\u0027t get the classpath right.\nI understand this. BUT! I a couple different methods of trying to get ANT to\npick up the mail.jar.  I even create a TASKDEF...  what\u0027s weird is that Eclipse\nheadless seems to have a screwed up classpath.\n\nI think there is a bug in the j2ee.ant.RunAnt class that probably adds the\nant.jar to the classpath in the wrong way... Maybe jars get truncated...\n\nAnyway if I run ANT by itself the \u003cmail\u003e task works.\nHere is an example of how to run it so it works:\n /opt/WSAD51/eclipse/jre/bin/java  -cp\n/opt/WSAD51/eclipse/plugins/org.apache.ant_1.5.3/ant.jar:/opt/WSAD51/eclipse/plugins/org.apache.ant_1.5.3/optional.jar:/opt/WSAD51/runtimes/base_v5/java/jre/lib/ext/mail.jar:/opt/WSAD51/runtimes/base_v5/java/jre/lib/ext/activation.jar:/opt/WSAD51/_jvm/jre/lib/xml.jar\norg.apache.tools.ant.Main -f mailbuild.xml",
    "Douglas, I believe you might want to start by talking to the WSAD people.\nEclipse\u0027s Ant entry point is org.eclipse.ant.core.AntRunner. We do not provide\ncom.ibm.etools.j2ee.ant.RunAnt and I have no experience with this implementation.",
    "Need to ensure that test case works with the org.eclipse.ant.core.antRunner \napplication entry point.",
    "I have had reports that it is not possible to use the mail task within \nWSAD...you get the same NoClassDefFoundError. This problem could not be \nreproduced on Eclipse 2.1.*\n\nI cannot reproduce the problem in Eclipse in normal usage or headless.\n\nTest case I used:\n\u003cproject name\u003d\"TEMP\" default\u003d\"***Total***\" basedir\u003d\".\"\u003e\n\t\u003ctarget name\u003d\"***Total***\"\u003e\n\t\u003cmail mailhost\u003d\"PUTYOURHOSTHERE\" subject\u003d\"Test build\"\u003e\n\t  \u003cfrom address\u003d\"Darin_Swanson@us.ibm.com\"/\u003e\n\t  \u003cto address\u003d\"Darin_Swanson@us.ibm.com\"/\u003e\n\t  \u003cmessage\u003eThe nightly build has completed\u003c/message\u003e\n\t\u003c/mail\u003e\n\t\u003c/target\u003e\t\n\u003c/project\u003e\n\nOutput I get for a headless build:\nBuildfile: mailIt.xml\n\n***Total***:\n     [mail] Failed to initialise MIME mail\n     [mail] Sending email: Test build\n     [mail] Sent email with 0 attachments\nBUILD SUCCESSFUL\n\nBUILD SUCCESSFUL\nTotal time: 2 seconds\n\nAnd the mail message is sent successful.\n\nSorry but it would appear that this is a WSAD specific issue.\nMarking as worksforme in Eclipse (tested using 200312110800)",
    "ok, I believe you.. And probably agree with you..  Can you show me your batch\nfile or shell script that you used to run it?\n\nFor instance, how did you add the mail.jar file to your classpath?\n\n\n",
    "Created an attachment (id\u003d7146)\nThe bat file I used for testing\n",
    "So, this confuses me then..\n\nI don\u0027t see Java\u0027s mail.jar anywhere in your classpath.\n\nIs it the preferences of your workspace?\n  Did you add mail.jar to your ANT classpath in your Eclipse preferences?",
    "I neglected to add it (my oversight) but the mail task works fine both headless \nand normal without the mail.jar on the Ant runtime classpath. Well not totally \nfine...without mail.jar on the classpath you get the:\n [mail] Failed to initialise MIME mail\nmessage bug the email message is sent.\n\nBut from what I have been told even with the mail.jar on the Ant runtime \nclasspath in WSAD the mail task does not work (same error you are seeing).\nHave you had success using the mail task in WSAD?",
    "No, that is what\u0027s weird is that it can find the mail task.  But, it tries to\nrun some internal classes which it can\u0027t find.  \nHence why I thought it needs the mail.jar",
    "I suspect that the WSAD Ant integration (built on top of the Eclipse Ant \nintegration) is in some way breaking some of the rules of using the Eclipse Ant \nintegration extension points. This can lead to errors such as yours when \nclasses \"leak\" through to the plugin classloaders and get loaded by the wrong \nclassloader during the Ant build."
  ],
  "commentCreationDates": [
    "2003-11-07T21:58:17+01:00",
    "2003-11-14T17:52:26+01:00",
    "2003-11-20T21:07:32+01:00",
    "2003-12-12T22:31:03+01:00",
    "2003-12-12T22:36:10+01:00",
    "2003-12-12T22:41:41+01:00",
    "2003-12-12T22:56:24+01:00",
    "2003-12-12T23:45:13+01:00",
    "2003-12-15T17:48:34+01:00",
    "2003-12-15T19:14:23+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NoClassDefFoundError",
      "message": "com/sun/mail/util/SharedByteArrayInputStream",
      "elements": [
        {
          "method": "org.apache.tools.ant.taskdefs.email.MimeMailer.send",
          "source": "MimeMailer.java:98"
        },
        {
          "method": "org.apache.tools.ant.taskdefs.email.EmailTask.execute",
          "source": "EmailTask.java:510"
        },
        {
          "method": "org.apache.tools.ant.Task.perform",
          "source": "Task.java:341"
        },
        {
          "method": "org.apache.tools.ant.Target.execute",
          "source": "Target.java:309"
        },
        {
          "method": "org.apache.tools.ant.Target.performTasks",
          "source": "Target.java:336"
        },
        {
          "method": "org.apache.tools.ant.Project.executeTarget",
          "source": "Project.java:1339"
        },
        {
          "method": "org.apache.tools.ant.taskdefs.Ant.execute",
          "source": "Ant.java:397"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "46309",
      "date": "2003-11-07T21:58:17+01:00",
      "product": "Platform",
      "component": "Ant",
      "severity": "major"
    }
  ],
  "groupId": "46309",
  "bugId": "46309",
  "date": "2003-11-07T21:58:17+01:00",
  "product": "Platform",
  "component": "Ant",
  "severity": "major"
}