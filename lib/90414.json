{
  "comments": [
    "Content assist fails when there is a string token beginning with an\nescape sequence *below* the content assist point.\n\nGiven the following class:\n\nclass Test {\n  void foo() {\n    // content assist here fails\n  }\n\n  String X \u003d \"\\n\";\n\n  void bar() {\n    // content assist here succeeds\n  }\n}\n\nWhen triggering content assist inside foo() with Ctrl+Space, Eclipse displays\nthe \"Error Executing Command\" popup (\"The command for the key you pressed\nfailed\"). The stack trace from .log is shown at the end of this report. Doing\nthe same inside bar() produces the expected selection box. \n\nNote that:\n - Moving the declaration of X above foo() in the file makes it succeed in both\n   places.\n - Moving the declaration of X below bar() in the file makes it fail in both\n   places.\n - Adding more escape sequences to X (e.g. \"\\n\\n\") makes it succeed regardless\n   of location.\n - Changing the first character of X to something other than an escape sequence\n   (e.g. \"x\\n\") makes it succeed regardless of location.\n - Adding more characters after the escape sequence (other than more escapes,\n   e.g. \"\\nabc\") has no effect.\n - Changing the context in which the string token is used (e.g. Integer X \u003d\n   Integer.parseInt(\"\\n\");) has no effect.\n - Changing the scope of X such that foo() can\u0027t see it (e.g. putting it inside\n   a static block, or inside bar()) makes it succeed regardless of location.\n\nPlatform(s):\n - Eclipse 3.1M6\n - Java 1.4.2_03-b02\n - Windows XP Pro SP2 and Solaris 8 (Motif)\n\nI checked the same case in 3.1M5a on both platforms, and neither produced this\nbehaviour.\n\nStack Trace from .log:\n!ENTRY org.eclipse.ui 4 4 2005-04-06 18:39:52.968\n!MESSAGE The command for the key you pressed failed\n\n!ENTRY org.eclipse.ui 4 0 2005-04-06 18:39:52.968\n!MESSAGE The command for the key you pressed failed\n!STACK 0\njava.lang.NegativeArraySizeException\n\tat\norg.eclipse.jdt.internal.compiler.parser.Scanner.getCurrentTokenSourceString(Scanner.java:501)\n\tat org.eclipse.jdt.internal.compiler.parser.Parser.consumeToken(Parser.java:6793)\n\tat\norg.eclipse.jdt.internal.codeassist.impl.AssistParser.consumeToken(AssistParser.java:666)\n\tat\norg.eclipse.jdt.internal.codeassist.complete.CompletionParser.consumeToken(CompletionParser.java:2235)\n\tat org.eclipse.jdt.internal.compiler.parser.Parser.parse(Parser.java:8377)\n\tat org.eclipse.jdt.internal.compiler.parser.Parser.parse(Parser.java:8560)\n\tat org.eclipse.jdt.internal.compiler.parser.Parser.parse(Parser.java:8525)\n\tat org.eclipse.jdt.internal.compiler.parser.Parser.dietParse(Parser.java:7343)\n\tat\norg.eclipse.jdt.internal.codeassist.complete.CompletionParser.dietParse(CompletionParser.java:2905)\n\tat\norg.eclipse.jdt.internal.codeassist.CompletionEngine.complete(CompletionEngine.java:1057)\n\tat org.eclipse.jdt.internal.core.Openable.codeComplete(Openable.java:119)\n\tat\norg.eclipse.jdt.internal.core.CompilationUnit.codeComplete(CompilationUnit.java:300)\n\tat\norg.eclipse.jdt.internal.core.CompilationUnit.codeComplete(CompilationUnit.java:293)\n\tat\norg.eclipse.jdt.internal.ui.text.java.JavaCompletionProcessor.internalComputeCompletionProposals(JavaCompletionProcessor.java:335)\n\tat\norg.eclipse.jdt.internal.ui.text.java.JavaCompletionProcessor.computeCompletionProposals(JavaCompletionProcessor.java:313)\n\tat\norg.eclipse.jface.text.contentassist.ContentAssistant.computeCompletionProposals(ContentAssistant.java:1470)\n\tat\norg.eclipse.jface.text.contentassist.CompletionProposalPopup.computeProposals(CompletionProposalPopup.java:250)\n\tat\norg.eclipse.jface.text.contentassist.CompletionProposalPopup.access$7(CompletionProposalPopup.java:247)\n\tat\norg.eclipse.jface.text.contentassist.CompletionProposalPopup$1.run(CompletionProposalPopup.java:206)\n\tat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:69)\n\tat\norg.eclipse.jface.text.contentassist.CompletionProposalPopup.showProposals(CompletionProposalPopup.java:201)\n\tat\norg.eclipse.jface.text.contentassist.ContentAssistant.showPossibleCompletions(ContentAssistant.java:1319)\n\tat\norg.eclipse.jdt.internal.ui.javaeditor.CompilationUnitEditor$AdaptedSourceViewer.doOperation(CompilationUnitEditor.java:183)\n\tat org.eclipse.ui.texteditor.ContentAssistAction$1.run(ContentAssistAction.java:82)\n\tat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:69)\n\tat org.eclipse.ui.texteditor.ContentAssistAction.run(ContentAssistAction.java:80)\n\tat org.eclipse.jface.action.Action.runWithEvent(Action.java:996)\n\tat org.eclipse.ui.commands.ActionHandler.execute(ActionHandler.java:182)\n\tat\norg.eclipse.ui.internal.handlers.LegacyHandlerWrapper.execute(LegacyHandlerWrapper.java:108)\n\tat org.eclipse.core.commands.Command.execute(Command.java:331)\n\tat\norg.eclipse.core.commands.ParameterizedCommand.execute(ParameterizedCommand.java:396)\n\tat\norg.eclipse.ui.internal.keys.WorkbenchKeyboard.executeCommand(WorkbenchKeyboard.java:452)\n\tat org.eclipse.ui.internal.keys.WorkbenchKeyboard.press(WorkbenchKeyboard.java:741)\n\tat\norg.eclipse.ui.internal.keys.WorkbenchKeyboard.processKeyEvent(WorkbenchKeyboard.java:784)\n\tat\norg.eclipse.ui.internal.keys.WorkbenchKeyboard.filterKeySequenceBindings(WorkbenchKeyboard.java:543)\n\tat\norg.eclipse.ui.internal.keys.WorkbenchKeyboard.access$3(WorkbenchKeyboard.java:486)\n\tat\norg.eclipse.ui.internal.keys.WorkbenchKeyboard$KeyDownFilter.handleEvent(WorkbenchKeyboard.java:110)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Display.filterEvent(Display.java:777)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:841)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:866)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:851)\n\tat org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:879)\n\tat org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:875)\n\tat org.eclipse.swt.widgets.Widget.wmChar(Widget.java:1182)\n\tat org.eclipse.swt.widgets.Control.WM_CHAR(Control.java:3126)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3029)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:3466)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:1625)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2525)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1570)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1534)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:306)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:143)\n\tat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:103)\n\tat\norg.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:228)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:344)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:156)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n\tat java.lang.reflect.Method.invoke(Unknown Source)\n\tat org.eclipse.core.launcher.Main.invokeFramework(Main.java:315)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:268)\n\tat org.eclipse.core.launcher.Main.run(Main.java:942)\n\tat org.eclipse.core.launcher.Main.main(Main.java:926)",
    "Seems to be a bug in the scanner.\nI will investigate.",
    "The problem comes from the handling of escape characters in string literal.",
    "*** Bug 91221 has been marked as a duplicate of this bug. ***",
    "With the fix for bug 91221, it will look like it works, but the escape handling\nis boggus as soon as it is using unicodes. Without unicode it should work.\nThe current support is using the unicode support even if there is no unicode.\nThis is boggus and needs to be fixed.",
    "The boggus part is escape characters inside string literal.",
    "For example, the following code doesn\u0027t produce the expected result:\n\npublic class Test {\n  static String C \u003d \"\\u005Cn\";\n  \n  public static void main(String[] args) {\n  \tSystem.out.print(C.length());\n  \tSystem.out.println(C.charAt(0) \u003d\u003d \u0027\\n\u0027);\n  } \t\n}\n\nIt returns:\n1false\n\ninstead of:\n1true",
    "Fixed and released in HEAD.\nRegression tests added in ScannerTest.test027-035.",
    "*** Bug 91780 has been marked as a duplicate of this bug. ***",
    "*** Bug 93877 has been marked as a duplicate of this bug. ***",
    "Verified for 3.1 M7 using build I20050512-2035 + jdt.core HEAD.",
    "*** Bug 96448 has been marked as a duplicate of this bug. ***",
    "*** Bug 101804 has been marked as a duplicate of this bug. ***"
  ],
  "commentCreationDates": [
    "2005-04-06T11:03:20+02:00",
    "2005-04-06T14:36:47+02:00",
    "2005-04-06T17:56:59+02:00",
    "2005-04-13T04:54:16+02:00",
    "2005-04-14T21:00:42+02:00",
    "2005-04-14T21:03:14+02:00",
    "2005-04-14T21:28:38+02:00",
    "2005-04-15T15:49:06+02:00",
    "2005-04-19T12:39:01+02:00",
    "2005-05-06T13:50:25+02:00",
    "2005-05-13T12:47:29+02:00",
    "2005-05-24T20:46:54+02:00",
    "2005-06-28T04:32:53+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NegativeArraySizeException",
      "elements": [
        {
          "method": "org.eclipse.jdt.internal.compiler.parser.Scanner.getCurrentTokenSourceString",
          "source": "Scanner.java:501"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.parser.Parser.consumeToken",
          "source": "Parser.java:6793"
        },
        {
          "method": "org.eclipse.jdt.internal.codeassist.impl.AssistParser.consumeToken",
          "source": "AssistParser.java:666"
        },
        {
          "method": "org.eclipse.jdt.internal.codeassist.complete.CompletionParser.consumeToken",
          "source": "CompletionParser.java:2235"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.parser.Parser.parse",
          "source": "Parser.java:8377"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.parser.Parser.parse",
          "source": "Parser.java:8560"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.parser.Parser.parse",
          "source": "Parser.java:8525"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.parser.Parser.dietParse",
          "source": "Parser.java:7343"
        },
        {
          "method": "org.eclipse.jdt.internal.codeassist.complete.CompletionParser.dietParse",
          "source": "CompletionParser.java:2905"
        },
        {
          "method": "org.eclipse.jdt.internal.codeassist.CompletionEngine.complete",
          "source": "CompletionEngine.java:1057"
        },
        {
          "method": "org.eclipse.jdt.internal.core.Openable.codeComplete",
          "source": "Openable.java:119"
        },
        {
          "method": "org.eclipse.jdt.internal.core.CompilationUnit.codeComplete",
          "source": "CompilationUnit.java:300"
        },
        {
          "method": "org.eclipse.jdt.internal.core.CompilationUnit.codeComplete",
          "source": "CompilationUnit.java:293"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.text.java.JavaCompletionProcessor.internalComputeCompletionProposals",
          "source": "JavaCompletionProcessor.java:335"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.text.java.JavaCompletionProcessor.computeCompletionProposals",
          "source": "JavaCompletionProcessor.java:313"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.ContentAssistant.computeCompletionProposals",
          "source": "ContentAssistant.java:1470"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.CompletionProposalPopup.computeProposals",
          "source": "CompletionProposalPopup.java:250"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.CompletionProposalPopup.access$7",
          "source": "CompletionProposalPopup.java:247"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.CompletionProposalPopup$1.run",
          "source": "CompletionProposalPopup.java:206"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:69"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.CompletionProposalPopup.showProposals",
          "source": "CompletionProposalPopup.java:201"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.ContentAssistant.showPossibleCompletions",
          "source": "ContentAssistant.java:1319"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.javaeditor.CompilationUnitEditor$AdaptedSourceViewer.doOperation",
          "source": "CompilationUnitEditor.java:183"
        },
        {
          "method": "org.eclipse.ui.texteditor.ContentAssistAction$1.run",
          "source": "ContentAssistAction.java:82"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:69"
        },
        {
          "method": "org.eclipse.ui.texteditor.ContentAssistAction.run",
          "source": "ContentAssistAction.java:80"
        },
        {
          "method": "org.eclipse.jface.action.Action.runWithEvent",
          "source": "Action.java:996"
        },
        {
          "method": "org.eclipse.ui.commands.ActionHandler.execute",
          "source": "ActionHandler.java:182"
        },
        {
          "method": "org.eclipse.ui.internal.handlers.LegacyHandlerWrapper.execute",
          "source": "LegacyHandlerWrapper.java:108"
        },
        {
          "method": "org.eclipse.core.commands.Command.execute",
          "source": "Command.java:331"
        },
        {
          "method": "org.eclipse.core.commands.ParameterizedCommand.execute",
          "source": "ParameterizedCommand.java:396"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.executeCommand",
          "source": "WorkbenchKeyboard.java:452"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.press",
          "source": "WorkbenchKeyboard.java:741"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.processKeyEvent",
          "source": "WorkbenchKeyboard.java:784"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.filterKeySequenceBindings",
          "source": "WorkbenchKeyboard.java:543"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.access$3",
          "source": "WorkbenchKeyboard.java:486"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard$KeyDownFilter.handleEvent",
          "source": "WorkbenchKeyboard.java:110"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.filterEvent",
          "source": "Display.java:777"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:841"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:866"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:851"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendKeyEvent",
          "source": "Widget.java:879"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendKeyEvent",
          "source": "Widget.java:875"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.wmChar",
          "source": "Widget.java:1182"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.WM_CHAR",
          "source": "Control.java:3126"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3029"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3466"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessage",
          "source": "OS.java:1625"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2525"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1570"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1534"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:306"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:143"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:103"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:228"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:344"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:156"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:315"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:268"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:942"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:926"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "90414",
      "date": "2005-04-06T11:03:20+02:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    }
  ],
  "groupId": "90414",
  "bugId": "90414",
  "date": "2005-04-06T11:03:20+02:00",
  "product": "JDT",
  "component": "Core",
  "severity": "normal"
}