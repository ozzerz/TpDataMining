{
  "comments": [
    "After reloading my webapp under Tomcat (v5.5), I get the following exception when I try to generate an HTML report.\n\n\"The following items have errors:\n\nReportDesign (id \u003d 1):\n+ Cannot open the connection for the driver: org.eclipse.birt.report.data.oda.jdbc\nCannot load JDBC Driver class: com.mysql.jdbc.Driver \n\nCannot open the connection for the driver: org.eclipse.birt.report.data.oda.jdbc\nCannot load JDBC Driver class: com.mysql.jdbc.Driver  ( 2 time(s) )\ndetail : org.eclipse.birt.report.data.adapter.api.AdapterException: Cannot open the connection for the driver: org.eclipse.birt.report.data.oda.jdbc\nCannot load JDBC Driver class: com.mysql.jdbc.Driver \n at org.eclipse.birt.report.data.adapter.impl.DataRequestSessionImpl.execute(DataRequestSessionImpl.java:435)\n at org.eclipse.birt.report.engine.data.dte.DteDataEngine.doExecuteQuery(DteDataEngine.java:149)\n at org.eclipse.birt.report.engine.data.dte.DteDataEngine.doExecuteQuery(DteDataEngine.java:115)\n at org.eclipse.birt.report.engine.data.dte.AbstractDataEngine.execute(AbstractDataEngine.java:178)\n at org.eclipse.birt.report.engine.executor.ExecutionContext.executeQuery(ExecutionContext.java:1678)\n at org.eclipse.birt.report.engine.executor.QueryItemExecutor.executeQuery(QueryItemExecutor.java:82)\n at org.eclipse.birt.report.engine.executor.TableItemExecutor.execute(TableItemExecutor.java:61)\n at org.eclipse.birt.report.engine.internal.executor.wrap.WrappedReportItemExecutor.execute(WrappedReportItemExecutor.java:45)\n at org.eclipse.birt.report.engine.internal.executor.dup.SuppressDuplicateItemExecutor.execute(SuppressDuplicateItemExecutor.java:42)\n at org.eclipse.birt.report.engine.internal.executor.wrap.WrappedReportItemExecutor.execute(WrappedReportItemExecutor.java:45)\n at org.eclipse.birt.report.engine.internal.executor.l18n.LocalizedReportItemExecutor.execute(LocalizedReportItemExecutor.java:33)\n at org.eclipse.birt.report.engine.layout.html.HTMLPageLM.layoutChildren(HTMLPageLM.java:126)\n at org.eclipse.birt.report.engine.layout.html.HTMLPageLM.layout(HTMLPageLM.java:84)\n at org.eclipse.birt.report.engine.layout.html.HTMLReportLayoutEngine.layout(HTMLReportLayoutEngine.java:90)\n at org.eclipse.birt.report.engine.api.impl.RunAndRenderTask.doRun(RunAndRenderTask.java:148)\n at org.eclipse.birt.report.engine.api.impl.RunAndRenderTask.run(RunAndRenderTask.java:71)\"\n\n\nRestarting Tomcat solves the issue (at least until the next reload...).\n\nTried with both MySQL and HSQLDB, same effect.\n\nNot sure if it matters, but my data source is created using property binding.\n\nCode:\n        final IReportRunnable report \u003d engine.openReportDesign(\n            context.getRealPath(\"WEB-INF/xxx.rptdesign\"));\n        final IRunAndRenderTask task \u003d engine.createRunAndRenderTask(report);\n        HTMLRenderOption options \u003d new HTMLRenderOption();\n        options.setOutputStream(response.getOutputStream());\n        options.setOutputFormat(\"html\");\n        options.setEmbeddable(true);\n        options.setImageHandler(new HTMLServerImageHandler());\n        options.setBaseImageURL(\"http://xxx\");\n        options.setImageDirectory(context.getRealPath(\"xxx\"));\n        options.setSupportedImageFormats(\"JPG;PNG;BMP;SVG\");\n        options.setBaseURL(\"http://xxx\");\n        task.setRenderOption(options);\n\n        task.setParameterValue(\"paramXXX\", new Long(getFrom(request)));\n        task.setParameterValue(\"driver\", \"com.mysql.jdbc.Driver\");\n        task.setParameterValue(\"url\", \"jdbc:mysql://xxx\");\n        task.setParameterValue(\"userName\", \"xxx\");\n        task.setParameterValue(\"password\", \"xxx\");\n\n        task.run();\n\nThanks.",
    "Hi there,\n\nCan you provide the version info of your BIRT?\n\nThanks.\nLin",
    "It\u0027s BIRT 2.2.0.",
    "OK, I\u0027ve already filled out the Version field, so probably that\u0027s not the version info you meant. Here is some more info, let me know if you need anything else:\n\norg.eclipse.birt.api_1.0.0.jar\norg.eclipse.birt.chart.device.extension_2.2.0.v20070530.jar\norg.eclipse.birt.chart.device.svg_2.2.0.v20070613.jar\norg.eclipse.birt.chart.engine_2.2.0.v20070621.jar\norg.eclipse.birt.chart.engine.extension_2.2.0.v20070622.jar\norg.eclipse.birt.chart.reportitem_2.2.0.v20070531.jar\norg.eclipse.birt.core_2.2.0.v20070615.jar\norg.eclipse.birt.data_2.2.0.v200706221.jar\norg.eclipse.birt.report.data.adapter_2.2.0.v20070622.jar\norg.eclipse.birt.report.data.oda.jdbc_2.2.0.v20070615\norg.eclipse.birt.report.data.oda.xml_2.2.0.v20070607.jar\norg.eclipse.birt.report.engine_2.2.0.v20070621.jar\norg.eclipse.birt.report.engine.emitter.html_2.2.0.v20070620.jar\norg.eclipse.birt.report.engine.emitter.pdf_2.2.0.v20070530.jar\norg.eclipse.birt.report.engine.emitter.postscript_2.2.0.v20070530.jar\norg.eclipse.birt.report.engine.emitter.ppt_2.2.0.v20070607.jar\norg.eclipse.birt.report.engine.emitter.prototype.excel_2.2.0.v20070621.jar\norg.eclipse.birt.report.engine.emitter.wpml_2.2.0.v20070620.jar\norg.eclipse.birt.report.engine.fonts_2.2.0.v20070530\norg.eclipse.birt.report.item.crosstab.core_2.2.0.v20070622.jar\norg.eclipse.birt.report.model_2.2.0.v20070619.jar\norg.eclipse.birt.report.model.adapter.oda_2.2.0.v20070530.jar\n\nThe JDBC driver versions were: HSQLDB 1.8.0.7 and MySQL Connector 3.1.11.",
    "Created an attachment (id\u003d74997)\nExample code\n\n",
    "I\u0027m getting the same problem.  I\u0027ve attached sample code which reproduces it.  It isn\u0027t specific to Tomcat or to the database drivers mentioned.  (I am using DB2 drivers.)\n\nThe example code starts the platform, runs a report, then shuts the plaform down.  It then repeats these 3 steps again.  The second pass through fails.\n\nI have noticed that the file org.eclipse.osgi_3.3.0.v20070530.jar stays open after calling Platform.shutdown().  I\u0027m not sure whether this is related or not.\n",
    "In JDBC driver/Sample DB driver, we will create our own version of classloader which extends URLClassLoader to load jdbc driver jar files under /driver directory.\n\nWhen the first time the jar are loaded, the accompany URL will be cached by JRE in static variables in JarFileFactory class. And JRE will always use the cached URL.\n\nThe caching is depending on the hashCode of the URL, and the hashCode of the URL is depending on its URLStreamHandler. When eclipse osgi is start up, a URLStreamHandlerFactory instance will be assigned to URL class so that all its instance will have same kind of URLStreamHandler, that is, class org.eclipse.osgi.framework.internal.core.BundleResourceHandler .\n\nThe implementation of BundleResourceHandler.hashCode(URL) method is however of problem, this leads to the situation that JRE always use same URL to search for resources.\n\nIn a platform start --\u003e shutdown --\u003e restart process, when the platform shutdown, the BundleResourceHandler will be changed, however that kind of change has not reflected to its hashCode, that is, it still has same hashCode. And after the platform restarted and we want to visit resource which should be locate-able using a new URL, JRE will firstly try to use cached URL. That is, even if we have new BundleResourceHandler in new URL, that would not solve the problem because in the cached URL the legacy, out-of-date BundleResourceHandler still exist, and it is used by JRE to locate resource. Because that BundleResourceHandler is out of date and cannot be used to locate any resource, an exception will happen.\n\nAfter bug 198525 is fixed this bug should be automatically resolved as well.\n\n",
    "Is there a temporary workaround I can apply?  e.g. is there some way to clear this cache?\n\nIt\u0027s really annoying having to restart Tomcat every time I redeploy my webapp as I have lots of other webapps deployed so it takes a few minutes to start up.\n\nThanks\n",
    "This caching is implemented by JDK so by now I\u0027ve not found any solution yet. I\u0027ve not seen any workaround so far.I will post all update of this bug to this page.",
    "As the corresponding eclipse OSGI bug is targeting M4, mark this bug as P5.",
    "The bug is automatically fixed when 198525 is fixed. Please note that the fix is done in Eclipse 3.4M2."
  ],
  "commentCreationDates": [
    "2007-07-26T17:09:12+02:00",
    "2007-07-27T08:51:02+02:00",
    "2007-07-27T12:07:37+02:00",
    "2007-07-27T12:16:04+02:00",
    "2007-07-31T07:03:33+02:00",
    "2007-07-31T07:08:40+02:00",
    "2007-08-01T15:37:53+02:00",
    "2007-08-01T23:52:07+02:00",
    "2007-08-02T11:35:42+02:00",
    "2007-08-09T03:46:32+02:00",
    "2007-08-28T08:21:45+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.birt.report.data.adapter.api.AdapterException",
      "message": "Cannot open the connection for the driver: org.eclipse.birt.report.data.oda.jdbc Cannot load JDBC Driver class: com.mysql.jdbc.Driver",
      "elements": [
        {
          "method": "org.eclipse.birt.report.data.adapter.impl.DataRequestSessionImpl.execute",
          "source": "DataRequestSessionImpl.java:435"
        },
        {
          "method": "org.eclipse.birt.report.engine.data.dte.DteDataEngine.doExecuteQuery",
          "source": "DteDataEngine.java:149"
        },
        {
          "method": "org.eclipse.birt.report.engine.data.dte.DteDataEngine.doExecuteQuery",
          "source": "DteDataEngine.java:115"
        },
        {
          "method": "org.eclipse.birt.report.engine.data.dte.AbstractDataEngine.execute",
          "source": "AbstractDataEngine.java:178"
        },
        {
          "method": "org.eclipse.birt.report.engine.executor.ExecutionContext.executeQuery",
          "source": "ExecutionContext.java:1678"
        },
        {
          "method": "org.eclipse.birt.report.engine.executor.QueryItemExecutor.executeQuery",
          "source": "QueryItemExecutor.java:82"
        },
        {
          "method": "org.eclipse.birt.report.engine.executor.TableItemExecutor.execute",
          "source": "TableItemExecutor.java:61"
        },
        {
          "method": "org.eclipse.birt.report.engine.internal.executor.wrap.WrappedReportItemExecutor.execute",
          "source": "WrappedReportItemExecutor.java:45"
        },
        {
          "method": "org.eclipse.birt.report.engine.internal.executor.dup.SuppressDuplicateItemExecutor.execute",
          "source": "SuppressDuplicateItemExecutor.java:42"
        },
        {
          "method": "org.eclipse.birt.report.engine.internal.executor.wrap.WrappedReportItemExecutor.execute",
          "source": "WrappedReportItemExecutor.java:45"
        },
        {
          "method": "org.eclipse.birt.report.engine.internal.executor.l18n.LocalizedReportItemExecutor.execute",
          "source": "LocalizedReportItemExecutor.java:33"
        },
        {
          "method": "org.eclipse.birt.report.engine.layout.html.HTMLPageLM.layoutChildren",
          "source": "HTMLPageLM.java:126"
        },
        {
          "method": "org.eclipse.birt.report.engine.layout.html.HTMLPageLM.layout",
          "source": "HTMLPageLM.java:84"
        },
        {
          "method": "org.eclipse.birt.report.engine.layout.html.HTMLReportLayoutEngine.layout",
          "source": "HTMLReportLayoutEngine.java:90"
        },
        {
          "method": "org.eclipse.birt.report.engine.api.impl.RunAndRenderTask.doRun",
          "source": "RunAndRenderTask.java:148"
        },
        {
          "method": "org.eclipse.birt.report.engine.api.impl.RunAndRenderTask.run",
          "source": "RunAndRenderTask.java:71"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "197978",
      "date": "2007-07-26T17:09:12+02:00",
      "product": "BIRT",
      "component": "Data",
      "severity": "major"
    }
  ],
  "groupId": "197978",
  "bugId": "197978",
  "date": "2007-07-26T17:09:12+02:00",
  "product": "BIRT",
  "component": "Data",
  "severity": "major"
}