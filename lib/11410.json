{
  "comments": [
    "When running the java builder from a headless 0214 workbench, I enable \n(or disable) the java compiler debug support by the following code:\n\nHashtable javaOptions\u003dJavaCore.getOptions();\njavaOptions.put(\"org.eclipse.jdt.core.compiler.debug.sourceFile\", \"do not \ngenerate\"); \njavaOptions.put(\"org.eclipse.jdt.core.compiler.debug.lineNumber\", \"do not \ngenerate\");\njavaOptions.put(\"org.eclipse.jdt.core.compiler.debug.localVariable\", \"do not \ngenerate\");\nJavaCore.setOptions(javaOptions);\n\nWhen I have all three of those options set, I get the following exception in \nthe Java builder.  All three of the options work fine in isolation, but they \nfail when used in combination.\n\njava.lang.ArrayIndexOutOfBoundsException: 1800\n        at org.eclipse.jdt.internal.compiler.ClassFile.addAttributes\n(ClassFile.java:360)\n        at org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.generateCode\n(TypeDeclaration.java:603)\n        at org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.generateCode\n(TypeDeclaration.java:635)\n        at \norg.eclipse.jdt.internal.compiler.ast.CompilationUnitDeclaration.generateCode\n(CompilationUnitDeclaration.java:129)\n        at org.eclipse.jdt.internal.compiler.Compiler.process(Compiler.java:530)\n        at org.eclipse.jdt.internal.compiler.Compiler.compile(Compiler.java:332)\n        at org.eclipse.jdt.internal.core.newbuilder.AbstractImageBuilder.compile\n(AbstractImageBuilder.java:209)\n        at org.eclipse.jdt.internal.core.newbuilder.AbstractImageBuilder.compile\n(AbstractImageBuilder.java:156)\n        at \norg.eclipse.jdt.internal.core.newbuilder.IncrementalImageBuilder.build\n(IncrementalImageBuilder.java:102)\n        at org.eclipse.jdt.internal.core.newbuilder.JavaBuilder.buildDeltas\n(JavaBuilder.java:146)\n        at org.eclipse.jdt.internal.core.newbuilder.JavaBuilder.build\n(JavaBuilder.java:98)\n        at org.eclipse.core.internal.events.BuildManager$2.run\n(BuildManager.java:351)\n        at org.eclipse.core.internal.runtime.InternalPlatform.run\n(InternalPlatform.java:817)\n        at org.eclipse.core.runtime.Platform.run(Platform.java:395)\n        at org.eclipse.core.internal.events.BuildManager.basicBuild\n(BuildManager.java:109)\n        at org.eclipse.core.internal.events.BuildManager.basicBuild\n(BuildManager.java:174)\n        at org.eclipse.core.internal.events.BuildManager.basicBuild\n(BuildManager.java:184)\n        at org.eclipse.core.internal.events.BuildManager$1.run\n(BuildManager.java:133)\n        at org.eclipse.core.internal.runtime.InternalPlatform.run\n(InternalPlatform.java:817)\n        at org.eclipse.core.runtime.Platform.run(Platform.java:395)\n        at org.eclipse.core.internal.events.BuildManager.basicBuild\n(BuildManager.java:147)\n        at org.eclipse.core.internal.events.BuildManager.build\n(BuildManager.java:230)\n        at org.eclipse.core.internal.resources.Project.build(Project.java:105)",
    "Would you have a piece of code that could help us to reproduce the problem?\n",
    "When no attributes are generated, we can get an ArrayIndexOutOfBoundsException.\n// update the number of attributes\ncontents[attributeOffset++] \u003d (byte) (attributeNumber \u003e\u003e 8);\ncontents[attributeOffset] \u003d (byte) attributeNumber;\n\nWe reach these two lines without checking that we have enough spaces to write \ninside this array.\nI suggest:\nif (attributeOffset + 2 \u003e\u003d (contentsLength \u003d contents.length)) {\n\tSystem.arraycopy(\n\t\tcontents,\n\t\t0,\n\t\t(contents \u003d new byte[contentsLength + INCREMENT_SIZE]),\n\t\t0,\n\t\tcontentsLength);\n}\n// update the number of attributes\ncontents[attributeOffset++] \u003d (byte) (attributeNumber \u003e\u003e 8);\ncontents[attributeOffset] \u003d (byte) attributeNumber;\n\nIt would be nice to see if this really fixes the problem. But for that we need a \ntest case.",
    "I don\u0027t have a simple testcase, but I will try the proposed fix, and will let \nyou know.",
    "I do not have a simple testcase.... but I do have a reproducible testcase, and \nafter I applied your fix, the problem went away - so in addition to just \nlooking right, this fix seems correct.\n\nThanks for the prompt response!\n\n(One nit, there was a syntax error in your code snippit - this is what works \nfor me)\n\tint contentsLength \u003d contents.length;\n\tif (attributeOffset + 2 \u003e\u003d contentsLength) {\n\t\tSystem.arraycopy(\n\t\t\tcontents,\n\t\t\t0,\n\t\t\t(contents \u003d new byte[contentsLength + INCREMENT_SIZE]),\n\t\t\t0,\n\t\t\tcontentsLength);\n\t}\t\t\n",
    "Olivier - please apply the fix to HEAD for M4.",
    "Thanks for checking the fix. In fact the code snippet I gave worked on my machine, because I put the \nlocal at the beginning of the method. This will be fixed for M4.",
    "Fixed and released in HEAD.",
    "Olivier - please backport this fix in 1.0 stream as well.",
    "Done.",
    "*** Bug 13852 has been marked as a duplicate of this bug. ***"
  ],
  "commentCreationDates": [
    "2002-03-14T21:22:57+01:00",
    "2002-03-14T21:43:25+01:00",
    "2002-03-14T21:58:11+01:00",
    "2002-03-14T23:43:13+01:00",
    "2002-03-15T20:31:40+01:00",
    "2002-03-15T22:48:50+01:00",
    "2002-03-16T00:15:40+01:00",
    "2002-03-16T00:46:17+01:00",
    "2002-04-16T19:25:11+02:00",
    "2002-04-16T20:07:52+02:00",
    "2002-05-28T13:34:37+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ArrayIndexOutOfBoundsException",
      "message": "1800",
      "elements": [
        {
          "method": "org.eclipse.jdt.internal.compiler.ClassFile.addAttributes",
          "source": "ClassFile.java:360"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.generateCode",
          "source": "TypeDeclaration.java:603"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.generateCode",
          "source": "TypeDeclaration.java:635"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.ast.CompilationUnitDeclaration.generateCode",
          "source": "CompilationUnitDeclaration.java:129"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.Compiler.process",
          "source": "Compiler.java:530"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.Compiler.compile",
          "source": "Compiler.java:332"
        },
        {
          "method": "org.eclipse.jdt.internal.core.newbuilder.AbstractImageBuilder.compile",
          "source": "AbstractImageBuilder.java:209"
        },
        {
          "method": "org.eclipse.jdt.internal.core.newbuilder.AbstractImageBuilder.compile",
          "source": "AbstractImageBuilder.java:156"
        },
        {
          "method": "org.eclipse.jdt.internal.core.newbuilder.IncrementalImageBuilder.build",
          "source": "IncrementalImageBuilder.java:102"
        },
        {
          "method": "org.eclipse.jdt.internal.core.newbuilder.JavaBuilder.buildDeltas",
          "source": "JavaBuilder.java:146"
        },
        {
          "method": "org.eclipse.jdt.internal.core.newbuilder.JavaBuilder.build",
          "source": "JavaBuilder.java:98"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager$2.run",
          "source": "BuildManager.java:351"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:817"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:395"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager.basicBuild",
          "source": "BuildManager.java:109"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager.basicBuild",
          "source": "BuildManager.java:174"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager.basicBuild",
          "source": "BuildManager.java:184"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager$1.run",
          "source": "BuildManager.java:133"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:817"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:395"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager.basicBuild",
          "source": "BuildManager.java:147"
        },
        {
          "method": "org.eclipse.core.internal.events.BuildManager.build",
          "source": "BuildManager.java:230"
        },
        {
          "method": "org.eclipse.core.internal.resources.Project.build",
          "source": "Project.java:105"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "11410",
      "date": "2002-03-14T21:22:57+01:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    }
  ],
  "groupId": "11410",
  "bugId": "11410",
  "date": "2002-03-14T21:22:57+01:00",
  "product": "JDT",
  "component": "Core",
  "severity": "normal"
}