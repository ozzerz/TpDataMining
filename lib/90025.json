{
  "comments": [
    "I\u0027m getting an intermittant ClassCastException when I call resolveType() \non an IType. It only happens occasionally, and I haven\u0027t been able to figure \nout what the cause is; but it seems to be internal to the JDT. I\u0027m using 3.1M5.\n\nI\u0027m going through the AST primarily, because I need information about JDK5 \nannotations; but in order to get the fully qualified type of a method \nargument, I\u0027m getting the name of the type of the parameter, then passing \nthat to resolveType on the IType of the primary type in the ICompilationUnit \nthat I used to build the AST (by passing it to the ASTParser as the source). \nI prefer this to using resolveBindings on the AST because I\u0027ve found that \nthat getting bindings isn\u0027t very reliable if there are any source errors.\n\n\nEssentially my code looks like this:\n\nMethodDeclaration method; // the method I\u0027m looking at\nIType mainType; // the first type in the ICompilationUnit\n...\n// interested in the fourth param, already checked that it exists\nSingleVariableDeclaration param \u003d (SingleVariableDeclaration)params.get(3);\nType t \u003d param.getType();\nString typeName \u003d ((SimpleType)t).getName().getFullyQualifiedName();\nString[][] typeMatches \u003d mainType.resolveType( typeName );\n\n\nThe code that it is looking at looks like this:\n\npublic class Controller extends PageFlowController {\n\n    @Jpf.ExceptionHandler()\n    protected Forward newExceptionHandler1(Exception ex, String actionName,\n            String message, Object form)\n    {\n        getRequest().setAttribute(\"errorMessage\", message);\n        return new Forward(\"success\");\n    }\n}\n\n\nRight before getting the type, I have created the above method and its\nannotations by using an ASTRewrite, and commiting the text edit to the\nICompilationUnit\u0027s buffer. Then I create a new AST, and use it, along with the\nsame ICompilationUnit, to try to resolve the type.\n\nMost of the time this works, but occasionally I get a ClassCastException:\n\n java.lang.ClassCastException: \norg.eclipse.jdt.internal.compiler.ast.QualifiedNameReference at \norg.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.convertAnnotations(SourceTypeConverter.java:559)\n\nat \norg.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.convert(SourceTypeConverter.java:340)\n\nat \norg.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.convert(SourceTypeConverter.java:533)\n\nat \norg.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.convert(SourceTypeConverter.java:161)\n\nat \norg.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.buildCompilationUnit(SourceTypeConverter.java:106)\n\nat \norg.eclipse.jdt.internal.codeassist.SelectionEngine.selectType(SelectionEngine.java:1096)\n\nat org.eclipse.jdt.internal.core.SourceType.resolveType(SourceType.java:819) \nat org.eclipse.jdt.internal.core.SourceType.resolveType(SourceType.java:753) \nat com.bea.wlw.netui.core.util.ClassUtil.resolveType(ClassUtil.java:883) at\n[ ... ]",
    "Could you please try again with M6? I tried to reproduce, but unsuccessfully.\nI will add your test case as test0167 in\norg.eclipse.jdt.core.tests.dom.ASTConverter15Test. You can review this test to\nsee if it reproduces your test case.",
    "(In reply to comment #1)\n\u003e Could you please try again with M6? I tried to reproduce, but unsuccessfully.\n\u003e I will add your test case as test0167 in\n\u003e org.eclipse.jdt.core.tests.dom.ASTConverter15Test. You can review this test to\n\u003e see if it reproduces your test case.\n\nMy team is still on M5, but I will try this on M6 as soon as I can. I also\nwanted to mention that occasionally, instead of the ClassCastException, I get an\nNPE from the same call:\n\njava.lang.NullPointerException\n\tat\norg.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.parseMemberValue(SourceTypeConverter.java:806)\n\tat\norg.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.convertAnnotations(SourceTypeConverter.java:558)\n\tat\norg.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.convert(SourceTypeConverter.java:340)\n\tat\norg.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.convert(SourceTypeConverter.java:533)\n\tat\norg.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.convert(SourceTypeConverter.java:161)\n\tat\norg.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.buildCompilationUnit(SourceTypeConverter.java:106)\n\tat\norg.eclipse.jdt.internal.codeassist.SelectionEngine.selectType(SelectionEngine.java:1096)\n\tat org.eclipse.jdt.internal.core.SourceType.resolveType(SourceType.java:819)\n\tat org.eclipse.jdt.internal.core.SourceType.resolveType(SourceType.java:753)\n\tat com.bea.wlw.netui.core.util.ClassUtil.resolveType(ClassUtil.java:887)\n[...]",
    "If you could attach a test case that I could use to reproduce the problem, it\nwould be great. I could not reproduce the problem using M6 and the test case you\nprovided  so far.",
    "Could you please provide a test case if you want it fixed for M7?",
    "Hi, I\u0027ve been trying to create a smaller testcase (outside of our whole product)\nbut I can\u0027t get it to fail. Also we are stuck on M5 for now because we are\ndependent on webtools, which is in the process of moving to M6. I will try to\nverify that this is either fixed or still broken as soon as we can get onto M6.\nSorry for the slow response.",
    "I just had the excpetion from comment 2 in I20050420, no steps yet.",
    "Any news about a potential test case to solve this issue?",
    "We finally moved our codebase onto M6 last week, and I haven\u0027t seen this happen\nsince then. For now I\u0027m assuming that it has been fixed... (sorry, I\u0027m not sure\nof the appropriate status to use)",
    "I close it as WORKSFORME.\nPlease reopen if you get it again."
  ],
  "commentCreationDates": [
    "2005-04-01T21:20:59+02:00",
    "2005-04-05T04:42:33+02:00",
    "2005-04-05T23:08:10+02:00",
    "2005-04-06T03:45:04+02:00",
    "2005-04-12T21:20:57+02:00",
    "2005-04-20T16:21:23+02:00",
    "2005-04-22T13:03:47+02:00",
    "2005-05-17T19:10:05+02:00",
    "2005-05-17T19:19:57+02:00",
    "2005-05-17T19:21:20+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ClassCastException",
      "message": "org.eclipse.jdt.internal.compiler.ast.QualifiedNameReference",
      "elements": [
        {
          "method": "org.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.convertAnnotations",
          "source": "SourceTypeConverter.java:559"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.convert",
          "source": "SourceTypeConverter.java:340"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.convert",
          "source": "SourceTypeConverter.java:533"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.convert",
          "source": "SourceTypeConverter.java:161"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.buildCompilationUnit",
          "source": "SourceTypeConverter.java:106"
        },
        {
          "method": "org.eclipse.jdt.internal.codeassist.SelectionEngine.selectType",
          "source": "SelectionEngine.java:1096"
        },
        {
          "method": "org.eclipse.jdt.internal.core.SourceType.resolveType",
          "source": "SourceType.java:819"
        },
        {
          "method": "org.eclipse.jdt.internal.core.SourceType.resolveType",
          "source": "SourceType.java:753"
        },
        {
          "method": "com.bea.wlw.netui.core.util.ClassUtil.resolveType",
          "source": "ClassUtil.java:883"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "90025",
      "date": "2005-04-01T21:20:59+02:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.parseMemberValue",
          "source": "SourceTypeConverter.java:806"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.convertAnnotations",
          "source": "SourceTypeConverter.java:558"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.convert",
          "source": "SourceTypeConverter.java:340"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.convert",
          "source": "SourceTypeConverter.java:533"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.convert",
          "source": "SourceTypeConverter.java:161"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.parser.SourceTypeConverter.buildCompilationUnit",
          "source": "SourceTypeConverter.java:106"
        },
        {
          "method": "org.eclipse.jdt.internal.codeassist.SelectionEngine.selectType",
          "source": "SelectionEngine.java:1096"
        },
        {
          "method": "org.eclipse.jdt.internal.core.SourceType.resolveType",
          "source": "SourceType.java:819"
        },
        {
          "method": "org.eclipse.jdt.internal.core.SourceType.resolveType",
          "source": "SourceType.java:753"
        },
        {
          "method": "com.bea.wlw.netui.core.util.ClassUtil.resolveType",
          "source": "ClassUtil.java:887"
        }
      ],
      "number": 1,
      "commentIndex": 2,
      "bugId": "90025",
      "date": "2005-04-05T23:08:10+02:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    }
  ],
  "groupId": "90025",
  "bugId": "90025",
  "date": "2005-04-01T21:20:59+02:00",
  "product": "JDT",
  "component": "Core",
  "severity": "normal"
}