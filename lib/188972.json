{
  "comments": [
    "I set up an Eclipse/WTP installation to test wtp-sdk-S-2.0RC1-200705240736.zip.  After defining a server and a test case involving a web and utility project, I found I could not bring up the \"Add and Remove Projects...\" dialog.  The following error was found in the log as the reason why:\n\n!MESSAGE Unhandled event loop exception\n!STACK 0\njava.util.NoSuchElementException\n\tat java.util.AbstractList$Itr.next(AbstractList.java:427)\n\tat org.eclipse.wst.server.core.internal.ModuleType.getModuleType(ModuleType.java:69)\n\tat org.eclipse.wst.server.core.internal.ServerPlugin.getModuleTypes(ServerPlugin.java:363)\n\tat org.eclipse.wst.server.core.internal.ModuleFactory.getModuleTypes(ModuleFactory.java:71)\n\tat org.eclipse.wst.server.core.ServerUtil.getModules(ServerUtil.java:160)\n\tat org.eclipse.wst.server.ui.internal.view.servers.ModuleSloshAction.perform(ModuleSloshAction.java:70)\n\tat org.eclipse.wst.server.ui.internal.view.servers.AbstractServerAction.run(AbstractServerAction.java:55)\n\tat org.eclipse.jface.action.Action.runWithEvent(Action.java:498)\n\tat org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:545)\n\tat org.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:490)\n\tat org.eclipse.jface.action.ActionContributionItem$5.handleEvent(ActionContributionItem.java:402)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:938)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3673)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3284)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:2389)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:2353)\n\tat org.eclipse.ui.internal.Workbench.access$4(Workbench.java:2219)\n\tat org.eclipse.ui.internal.Workbench$4.run(Workbench.java:466)\n\tat org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:289)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:461)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)\n\tat org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:106)\n\tat org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:153)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:106)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:76)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:363)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:176)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:585)\n\tat org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:497)\n\tat org.eclipse.equinox.launcher.Main.basicRun(Main.java:436)\n\tat org.eclipse.equinox.launcher.Main.run(Main.java:1162)\n\tat org.eclipse.equinox.launcher.Main.main(Main.java:1137)\n\nI created a separate workspace, imported the org.eclipse.wst.server.core plug-in, and started a debug session.  Defined a runtime+server, created a web project, and then duplicated the problem.  In that same session, placing a breakpoint in the getModuleType() and trying again revealed that the moduleTypes static field had size of 26 (instead of the expected 23) and an elementData array sized at 25 elements.  I\u0027m not sure how that would occur without concurrent writing to moduleTypes.\n\nUnfortunately, as you might expect, I\u0027ve been unable to get it to happen again.  I\u0027ll try to gather more clues about what might cause this to happen.",
    "Created an attachment (id\u003d68615)\nProposed patch to make method synchronized\n\nThe attached patch makes the method synchronized to avoid the concurrency issues. See any issues with this, Larry?",
    "My efforts so far to determine how this comes about don\u0027t suggest that this would cause a problem.  No potential deadlocks that I can see.  I\u0027ll still see if I can find out how this occurs just in case there is something to be learned.",
    "Created an attachment (id\u003d68665)\nStack trace showing thread unsafe access to the moduleTypes field\n\nStack trace showing current access by two threads.  This occurred after clicking Finish to create a new Tomcat 5.5 Runtime (and auto-created server) in a new workspace.  The argument for getModuleTypes(IConfigurationElement[]) for both threads appeared to contain the same data.  I don\u0027t see a problem with the patch for this situation.",
    "Patch ready for PMC approval for RC2.",
    "Fix released to RC2.",
    "I\u0027ve not seen any problems with the added sync.  Marking verified.",
    "Closing."
  ],
  "commentCreationDates": [
    "2007-05-24T18:23:59+02:00",
    "2007-05-24T19:08:46+02:00",
    "2007-05-24T19:27:34+02:00",
    "2007-05-24T22:05:15+02:00",
    "2007-05-25T20:56:26+02:00",
    "2007-05-29T18:44:33+02:00",
    "2007-06-11T17:26:06+02:00",
    "2007-06-11T19:24:54+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.util.NoSuchElementException",
      "elements": [
        {
          "method": "java.util.AbstractList$Itr.next",
          "source": "AbstractList.java:427"
        },
        {
          "method": "org.eclipse.wst.server.core.internal.ModuleType.getModuleType",
          "source": "ModuleType.java:69"
        },
        {
          "method": "org.eclipse.wst.server.core.internal.ServerPlugin.getModuleTypes",
          "source": "ServerPlugin.java:363"
        },
        {
          "method": "org.eclipse.wst.server.core.internal.ModuleFactory.getModuleTypes",
          "source": "ModuleFactory.java:71"
        },
        {
          "method": "org.eclipse.wst.server.core.ServerUtil.getModules",
          "source": "ServerUtil.java:160"
        },
        {
          "method": "org.eclipse.wst.server.ui.internal.view.servers.ModuleSloshAction.perform",
          "source": "ModuleSloshAction.java:70"
        },
        {
          "method": "org.eclipse.wst.server.ui.internal.view.servers.AbstractServerAction.run",
          "source": "AbstractServerAction.java:55"
        },
        {
          "method": "org.eclipse.jface.action.Action.runWithEvent",
          "source": "Action.java:498"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:545"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$2",
          "source": "ActionContributionItem.java:490"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$5.handleEvent",
          "source": "ActionContributionItem.java:402"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:938"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:3673"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:3284"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:2389"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:2353"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.access$4",
          "source": "Workbench.java:2219"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$4.run",
          "source": "Workbench.java:466"
        },
        {
          "method": "org.eclipse.core.databinding.observable.Realm.runWithDefault",
          "source": "Realm.java:289"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:461"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "org.eclipse.ui.internal.ide.application.IDEApplication.start",
          "source": "IDEApplication.java:106"
        },
        {
          "method": "org.eclipse.equinox.internal.app.EclipseAppHandle.run",
          "source": "EclipseAppHandle.java:153"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:106"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:76"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:363"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:176"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:585"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.invokeFramework",
          "source": "Main.java:497"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.basicRun",
          "source": "Main.java:436"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.run",
          "source": "Main.java:1162"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.main",
          "source": "Main.java:1137"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "188972",
      "date": "2007-05-24T18:23:59+02:00",
      "product": "Web Tools",
      "component": "wst.server",
      "severity": "normal"
    }
  ],
  "groupId": "188972",
  "bugId": "188972",
  "date": "2007-05-24T18:23:59+02:00",
  "product": "Web Tools",
  "component": "wst.server",
  "severity": "normal"
}