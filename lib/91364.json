{
  "comments": [
    "We are using SWT in our Application and also providing the facility to plugin\nthe application in various IDEs. I have been successfully embedding our UI in\nNetBeans on Windows and Linux (with motif version of SWT). Embedding did not\nwork with other Swing IDEs (I have reported that problem previously).\nRecently we switched from motif to GTK on Linux. After this our plugin has\nstopped working in NetBeans.\nTo debug the problem I used a sample application (taken from one of the bug\nreports) that embedds a SWT widget in JFrame. This application works fine on\nWindows with JDK 1.4 \u0026 1.5. On Linux it works fine with motif and JDK 1.5 (with\n1.4 application crashes).\nWhen I try the same application with GTK, the main UI (JFrame) comes up but SWT\nwidget is not displayed. On adding debug statements I found that the application\nblocks on SWT_AWT.new_Shell() method call. It never returns and I have to kill\nthe process.\nI am using SWT jars from the Eclipse 3.0.1.\n\nI have tried changing the Theam from Bluecurve to Mist as suggested in one of\nthe bug report. But that also did not work.\n\n-Sudhan",
    "Created an attachment (id\u003d19899)\nSample code to reproduce the bug.\n",
    "I just run your test with the latest code from HEAD and I got this exception:\n\nException in thread \"main\" java.lang.NullPointerException\n\tat PR91364$MyPanel.addNotify(PR91364.java:76)\n\tat java.awt.Container.addImpl(Container.java:1052)\n\tat java.awt.Container.add(Container.java:351)\n\tat PR91364.\u003cinit\u003e(PR91364.java:39)\n\tat PR91364.main(PR91364.java:59)\n\nThe exception happens because when addNotify() is called, your display thread\nhas not started yet. If I add this line just after displayThread.start(), the\ncode runs fine without a dead lock.\n\ntry {while (displayThread.getDisplay() \u003d\u003d null) Thread.sleep(100);}\ncatch(Exception e) {}\n\nSo I cannot reproduce your problem, please could confirm that?",
    "Please reopen if you still have this problem.",
    "I can reproduce this bug with SWT 3.1.1 (from /swt-3.1.1-gtk-linux-x86.zip), even with the added wait for display initialization. I actually have this problem with a project of my own.",
    "Reopening.",
    "The code loop in Shell.java, line 1413 ff.:\n\n  Shell.setVisible(boolean) line: 1413\n  SWT_AWT.new_Shell(Display, Canvas) line: 225\n  BugTest$1.run() line: 82\n  RunnableLock.run() line: 35\n  Synchronizer.runAsyncMessages(boolean) line: 123\n  Display.runAsyncMessages(boolean) line: 3038\n  Display.readAndDispatch() line: 2746\n  BugTest$DisplayThread.swtEventLoop() line: 106\n  BugTest$DisplayThread.run() line: 99\n\n(This backtrace looks similiar for my own project.) The code in question looks like this:\n\n  do {\n      OS.g_main_context_iteration (0, false);\n      if (isDisposed ()) break;\n      iconic \u003d minimized || (shell !\u003d null \u0026\u0026 shell.minimized);\n  } while (!mapped \u0026\u0026 !iconic);\n\niconic is of course false. mapped is also false. It should set to true as soon as the X window is mapped. This callback is responsible:\n\n  int /*long*/ shellMapProc (int /*long*/ handle, int /*long*/ arg0, int /*long*/ user_data) {\n      mapped \u003d true;\n      display.dispatchEvents \u003d null;\n      return 0;\n  }\n\nIf I set a breakpoint in that callback, it will never be reached. The callback is initialized in hookEvents() like this:\n\n  OS.g_signal_connect_closure_by_id (shellHandle, display.signalIds [MAP_EVENT], 0, display.shellMapProcClosure, false);\n",
    "What window manager are you using?  It\u0027s only SWT_AWT shells which\nare hung?",
    "I\u0027m using Metacity. I have no other problems. Eclipse works well, for example.",
    "The problem also appears under olvwm, KDE and GNOME.\n",
    "Fixed \u003e 20060118.",
    "(In reply to comment #10)\n\u003e Fixed \u003e 20060118.\n\u003e \nHi,\nWhen I try the same application with GTK, the main UI (JFrame) comes up but SWT\nwidget is not displayed, ie I can\u0027t see the Text component and its text (I only see Swing component). I tried various examples, and the SWT components never show, and no error is returned.\nI tested it on Fedora Core 3 with GTK2, Mandrake 8.1 with GTK2.\nOn SWT 3.1, the SWT_AWT.new_Shell() method never return, so I installed SWT 3.2, the SWT_AWT.new_Shell() method returns, but no widget is displayed.\nAny idea ?\n",
    "The sample code from comment#1 works fine for me on Fedora Core release 5. Try forcing a layout on the shell after adding the text widget (shell.layout(true, true) and variants);",
    "Thanks for your reply,\nI tried with the simple code below, which add an AWT Button and a SWT Button in an AWT Frame :\npublic static void main(String[] args) {\n        java.awt.Frame frame \u003d new java.awt.Frame(\"AWT Frame\");\n        java.awt.Button button \u003d new java.awt.Button(\"AWT Button\");\n        frame.add(button, java.awt.BorderLayout.NORTH);\n        java.awt.Canvas canvas \u003d new java.awt.Canvas();\n        frame.add(canvas, java.awt.BorderLayout.CENTER);\n\n        frame.addNotify();\n       \n        Display display \u003d new Display();\n        Shell shell \u003d SWT_AWT.new_Shell(display, canvas);\n        shell.setLayout(new FillLayout());\n        Button swtButton \u003d new Button(shell, SWT.PUSH);\n        swtButton.setText(\"SWT Button\");\n       \n        frame.setBounds(20, 20, 300, 300);\n        shell.layout();\n        frame.setVisible(true);\n       \n        shell.layout(true, true);\n        while (!shell.isDisposed()) {\n                if (!display.readAndDispatch()) display.sleep();\n        }\n}\n\nSo, I tried with your the shell.layout(true, true) as suggested, but the SWT Button does not appear :(\nI tried with \"xwininfo -children -all\" and I get the following :\n\n0x2000008 \"Content window\": (\"sun-awt-X11-XContentWindow\" \"moulinette-TestSWT_AWT\")  300x300+-4+-20  +20+20\n        2 children:\n        0x200000a \"sun-awt-X11-XButtonPeer\": (\"sun-awt-X11-XButtonPeer\" \"moulinette-TestSWT_AWT\")  290x23+5+25  +25+45\n        0x200000c \"sun-awt-X11-XCanvasPeer\": (\"sun-awt-X11-XCanvasPeer\" \"moulinette-TestSWT_AWT\")  290x247+5+48  +25+68\n           1 child:\n           0x2a0001f \"\": (\"SWT\" \"SWT\")  1x1+0+0  +25+68\n              2 children:\n              0x2a00021 (has no name): ()  290x247+0+0  +25+68\n                 1 child:\n                 0x2a00022 (has no name): ()  290x247+0+0  +25+68\n              0x2a00020 (has no name): ()  1x1+-1+-1  +24+67\n\nSo it seems that the SWT component is created, but I can\u0027t see it.\nI tried to debug the code with Eclipse, and the it seems it comes from the _gtk_widget_realize(widget) method from OS class.\nIt may be a GTK bug ?\nMy GTK version is 2.4.14\n",
    "I was able to reproduce your problem. Please open a new bug report for it since this one is closed already and it is an unrelated problem."
  ],
  "commentCreationDates": [
    "2005-04-14T07:42:38+02:00",
    "2005-04-14T07:46:19+02:00",
    "2005-04-18T22:48:13+02:00",
    "2005-05-04T21:27:37+02:00",
    "2005-12-08T11:28:16+01:00",
    "2005-12-08T14:33:07+01:00",
    "2005-12-09T09:46:33+01:00",
    "2005-12-09T13:49:34+01:00",
    "2005-12-09T22:33:58+01:00",
    "2005-12-26T18:19:15+01:00",
    "2006-01-18T20:46:40+01:00",
    "2006-10-17T14:43:46+02:00",
    "2006-10-19T17:18:37+02:00",
    "2006-10-19T17:49:35+02:00",
    "2006-10-20T17:38:27+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "PR91364$MyPanel.addNotify",
          "source": "PR91364.java:76"
        },
        {
          "method": "java.awt.Container.addImpl",
          "source": "Container.java:1052"
        },
        {
          "method": "java.awt.Container.add",
          "source": "Container.java:351"
        },
        {
          "method": "PR91364.\u003cinit\u003e",
          "source": "PR91364.java:39"
        },
        {
          "method": "PR91364.main",
          "source": "PR91364.java:59"
        }
      ],
      "number": 0,
      "commentIndex": 2,
      "bugId": "91364",
      "date": "2005-04-18T22:48:13+02:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "blocker"
    }
  ],
  "groupId": "91364",
  "bugId": "91364",
  "date": "2005-04-14T07:42:38+02:00",
  "product": "Platform",
  "component": "SWT",
  "severity": "blocker"
}