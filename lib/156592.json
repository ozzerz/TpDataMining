{
  "comments": [
    "In JD, we use TPTP Fast XPath from TPTP 4.2 for XPath filtering.\nIt throws error with run with IBN JRE 1.4.2\njava.lang.LinkageError: JVMCL048:redefine of class Compiled362249384\n(\u0026name\u003d4E9CC7A8). old_cb\u003dA99D70, new_cb\u003dA99C40, (\u0026old_name\u003d4E9CC7A8)\nold_name\u003dCompiled362249384\n\tat java.lang.ClassLoader.defineClass0(Native Method)\n\tat java.lang.ClassLoader.defineClass(ClassLoader.java:808)\n\tat java.lang.ClassLoader.defineClass(ClassLoader.java:708)\n\tat\norg.eclipse.tptp.platform.provisional.fastxpath.compiler.EclipseCompiler$MyClassLoader.defineClass(EclipseCompiler.java:331)\n\tat\norg.eclipse.tptp.platform.provisional.fastxpath.compiler.EclipseCompiler$1.acceptResult(EclipseCompiler.java:119)\n\tat org.eclipse.jdt.internal.compiler.Compiler.compile(Compiler.java:417)\n\tat\norg.eclipse.tptp.platform.provisional.fastxpath.compiler.EclipseCompiler.generateClass(EclipseCompiler.java:131)\n\tat\norg.eclipse.tptp.platform.provisional.jre14.fastxpath.compiler.CompilerHelper.buildCompiledExpression(CompilerHelper.java:150)\n\tat\norg.eclipse.tptp.platform.provisional.jre14.fastxpath.compiler.CompilerHelper.getCompiledExpressionEvaluator(CompilerHelper.java:116)\n\tat\norg.eclipse.tptp.platform.provisional.jre14.fastxpath.FastXPathEngine.compile(FastXPathEngine.java:160)\n\tat\norg.eclipse.tptp.platform.provisional.jre14.fastxpath.FastXPathEngine.compile(FastXPathEngine.java(Inlined\nCompiled Code))\n\tat\norg.eclipse.tptp.platform.provisional.fastxpath.FastXPathAPI.getCompiledExpressionEvaluator(FastXPathAPI.java(Compiled\nCode))\n\tat\norg.eclipse.tptp.platform.provisional.fastxpath.FastXPathAPI.eval(FastXPathAPI.java(Compiled\nCode))\n\tat\norg.eclipse.tptp.platform.provisional.fastxpath.FastXPathAPI.match(FastXPathAPI.java(Compiled\nCode))\n\tat\ncom.ibm.cbeviewer.tools.TPTPFastXPathEngine.matches(TPTPFastXPathEngine.java(Inlined\nCompiled Code))\n\tat com.ibm.cbeviewer.CBERecord.cbeMatchesXPath(CBERecord.java(Inlined Compiled\nCode))\n\tat com.ibm.cbeviewer.CBERecord.isMatching(CBERecord.java(Compiled Code))\n\tat\ncom.ibm.cbeviewer.panels.ReportsTableModel.runXPathInMemory(ReportsTableModel.java:605)\n\tat com.ibm.cbeviewer.panels.ReportsPanel.runXPathInMemory(ReportsPanel.java:1891)\n\tat com.ibm.cbeviewer.MainFrame$42.run(MainFrame.java:1391)\n\tat java.lang.Thread.run(Thread.java:570)\n\nNote : It works with IBM JRE 1.5.0\n\nQA Contact for this bug is: Ajay G. Rengasayee, e-mail:r.ajaygarga@in.ibm.com",
    "Is this problem reproducible in a vanilla TPTP 4.2?",
    "In JD, we use Fast XPath from TPTP 4.2.0.2 from\nhttp://download.torolab.ibm.com/download/TPTP/4.2.0.2/patch/xpathperf3.zip\n",
    "To try workaround the problem without the fix in bug 154894, can you try adjust the value with JVM argument -Xmxcl. -Xmxcl16384 should work around the problem reported here. ",
    "Hi Eugene Chan,\n\nSorry. The work around doesn\u0027t help. And our problem is not OutOfMemory.\nIt same \"java.lang.LinkageError: JVMCL048:redefine of class Compiled362249384\"\n\nSome solution for above problem http://www-128.ibm.com/developerworks/java/library/j-dclp3/index.html.\n\nAnd we need to have the fix in TPTP 4.2.1 and not a work around please.",
    "Does the problem exist in 4.2.1 driver? Can you provide a scenario to reproduce the problem in a vanilla TPTP 4.2.1 driver?",
    "4.2.1 stream is closed as of today so I would suggest to use any existing\nworkaround if available.\nAlso, if a workaround is available then the defect severity should be\ndowngraded to either major or critical.\n\nWhy is your product requiring this fix in 4.2.1 ? Is it building on top of this\nversion ?..\n",
    "Hi,\n\nWe in LTA-JD 4.2, uses Fast XPath from TPTP 4.2.0.2 We use Fast XPath for filtering out the CommonBaseEvent objects with XPath queries. \n\nThe problem is this:\n\nLTA-JD build : LTAJD-4.2.0-200608301423 \nhttp://download.torolab.ibm.com/cgi-bin/LTAJD/4.2.0/generate-downloads.sh\n\nIBM JDK : 1.4.2\n\nScenorio:\nImporing the following log files from the LTA-JD_Scenarios\\DB2-Application-Failure of the LTA-JD 4.2 build\nactivity.log.CBE\nDB2DIAG.log.CBE\nWinSysEventLogs.CBE\nWinAppEventLogs.CBE\n\nChoose the filter /CommonBaseEvent[@severity \u003e \u002740\u0027] and click \"Filter results\"\n\nThe following error is thrown:\njava version \"1.4.2\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.4.2)\nClassic VM (build 1.4.2, J2RE 1.4.2 IBM Windows 32 build cn142-20060421 (SR5) (J\nIT enabled: jitc))\njava.lang.LinkageError: JVMCL048:redefine of class Compiled362249384 (\u0026name\u003d4E9F\n5AC8). old_cb\u003dAD7E90, new_cb\u003dAD7B00, (\u0026old_name\u003d4E9F5AC8) old_name\u003dCompiled36224\n9384\n        at java.lang.ClassLoader.defineClass0(Native Method)\n        at java.lang.ClassLoader.defineClass(ClassLoader.java:808)\n        at java.lang.ClassLoader.defineClass(ClassLoader.java:708)\n        at org.eclipse.tptp.platform.provisional.fastxpath.compiler.EclipseCompi\nler$MyClassLoader.defineClass(EclipseCompiler.java:331)\n        at org.eclipse.tptp.platform.provisional.fastxpath.compiler.EclipseCompi\nler$1.acceptResult(EclipseCompiler.java:119)\n        at org.eclipse.jdt.internal.compiler.Compiler.compile(Compiler.java:417)\n\n        at org.eclipse.tptp.platform.provisional.fastxpath.compiler.EclipseCompi\nler.generateClass(EclipseCompiler.java:131)\n        at org.eclipse.tptp.platform.provisional.jre14.fastxpath.compiler.Compil\nerHelper.buildCompiledExpression(CompilerHelper.java:150)\n        at org.eclipse.tptp.platform.provisional.jre14.fastxpath.compiler.Compil\nerHelper.getCompiledExpressionEvaluator(CompilerHelper.java:116)\n        at org.eclipse.tptp.platform.provisional.jre14.fastxpath.FastXPathEngine\n.compile(FastXPathEngine.java:160)\n        at org.eclipse.tptp.platform.provisional.jre14.fastxpath.FastXPathEngine\n.compile(FastXPathEngine.java:114)\n        at org.eclipse.tptp.platform.provisional.fastxpath.FastXPathAPI.getCompi\nledExpressionEvaluator(FastXPathAPI.java:275)\n        at org.eclipse.tptp.platform.provisional.fastxpath.FastXPathAPI.eval(Fas\ntXPathAPI.java:192)\n        at org.eclipse.tptp.platform.provisional.fastxpath.FastXPathAPI.match(Fa\nstXPathAPI.java:169)\n        at com.ibm.cbeviewer.tools.TPTPFastXPathEngine.matches(Unknown Source)\n        at com.ibm.cbeviewer.CBERecord.cbeMatchesXPath(Unknown Source)\n        at com.ibm.cbeviewer.CBERecord.isMatching(Unknown Source)\n        at com.ibm.cbeviewer.panels.ReportsTableModel.runXPathInMemory(Unknown S\nource)\n        at com.ibm.cbeviewer.panels.ReportsPanel.runXPathInMemory(Unknown Source\n)\n        at com.ibm.cbeviewer.MainFrame$41.run(Unknown Source)\n        at java.lang.Thread.run(Thread.java:570)\n\nThe problem says that it is trying to load a class which compiled and loaded already\n\nNote : It works with IBM JDK 1.5.0.\n\nThe LTA-JD 4,.2 uses fast xpath from TPTP 4.2.0.2 and it throws the error as above. So I have opened a defect against TPTP in bugzilla(10474) with Severity P1 and \"Block\".\n\nAs TPTP 4.2 and JD 4.2 were closed, we need this fix in TPTP 4.2.1 for LTA JD 4.2.1.\n\nNote:  The above problem occurs with TPTP 4.2.1 also( Build id tptp.runtime-TPTP-4.2.1-200609061223)",
    "Why is TPTP 4.3 not acceptable as a fix driver ?",
    "(In reply to comment #8)\n\u003e Why is TPTP 4.3 not acceptable as a fix driver ?\n\u003e \n\nWe are not picking up TPTP 4.3 anytime this year. We are shipping with 4.2.0.2 and will refresh with 4.2.1 next month. This problem needs addressing in both versions if it is found to be valid. TPTP has not advertised that it does not support 1.4.2 .",
    "Problem cannot be reproduced in TPTP 4.2.1 candidate 2 driver [tptp.runtime-TPTP-4.2.1-200609071820A.zip] with following IBM Java 1.4.2\njava version \"1.4.2\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.4.2)\nClassic VM (build 1.4.2, J2RE 1.4.2 IBM Windows 32 build cndev-20040511 (JIT enabled: jitc))\n\n",
    "Chris, unfortunately it is too late for a 4.2.1 fix; the driver is already closed\n\nYou\u0027ll have to work with Christophe to find another solution for getting this fix to the consuming product",
    "Hi,\n\nThe problem still occurs with TPTP 4.2.1 candidate 2 driver [tptp.runtime-TPTP-4.2.1-200609071820A.zip]\n\nYou have tested with IBM JDK 1.4.2(20040511), the oldest one. Sorry I can\u0027t find that IBM JDK 1.4.2(20040511).\n\nI tested using IBM JDK 1.4.2(from GA Release (cn1420-20040626) till the latest build - Service Release 6 (Windows / IA32) (cn142-20060824) (sov)). \nIn all these, it fails throwing the error as mentioned in the defect.\n\nNote: It works with IBM JDK 1.5.0\n\nIt is dependent on the JDK but the problem \n  1. can be avoided by checking whether the class is already compiled / loaded or not\n  2.or atleast the error can be caught\n\nSome solution for above problem\nhttp://www-128.ibm.com/developerworks/java/library/j-dclp3/index.html.\n\nPlease make sure that you test with latest IBM JDK 1.4.2 build.\n\nThanks for your immediate attention\n",
    "Eugene wrote to me:\nHi Ajay\n\nI created a app that  try to reproduce your problem. It loops thru 20000 CBE events with expression  /CommonBaseEvent[@severity \u003e \u002740\u0027], which have the same execution path as your code, ie. \n at org.eclipse.tptp.platform.provisional.fastxpath.compiler.EclipseCompi\nler$MyClassLoader.defineClass(EclipseCompiler.java:331)\n        at org.eclipse.tptp.platform.provisional.fastxpath.compiler.EclipseCompi\nler$1.acceptResult(EclipseCompiler.java:119)\n        at org.eclipse.jdt.internal.compiler.Compiler.compile(Compiler.java:417)\n\n        at org.eclipse.tptp.platform.provisional.fastxpath.compiler.EclipseCompi\nler.generateClass(EclipseCompiler.java:131)\n        at org.eclipse.tptp.platform.provisional.jre14.fastxpath.compiler.Compil\nerHelper.buildCompiledExpression(CompilerHelper.java:150)\n        at org.eclipse.tptp.platform.provisional.jre14.fastxpath.compiler.Compil\nerHelper.getCompiledExpressionEvaluator(CompilerHelper.java:116)\n        at org.eclipse.tptp.platform.provisional.jre14.fastxpath.FastXPathEngine\n.compile(FastXPathEngine.java:160)\n        at org.eclipse.tptp.platform.provisional.jre14.fastxpath.FastXPathEngine\n.compile(FastXPathEngine.java:114)\n        at org.eclipse.tptp.platform.provisional.fastxpath.FastXPathAPI.getCompi\nledExpressionEvaluator(FastXPathAPI.java:275)\n        at org.eclipse.tptp.platform.provisional.fastxpath.FastXPathAPI.eval(Fas\ntXPathAPI.java:192)\n        at org.eclipse.tptp.platform.provisional.fastxpath.FastXPathAPI.match(Fa\nstXPathAPI.java:169)\n\nI tried run with both IBM JVM 1.4.2 update 6 and JVM 1.5 SR1 and I cannot reproduce the problem you reported. I assume the filter function in JD is looping thru all CBE events with the filter selected by user (ie /CommonBaseEvent[@severity \u003e \u002740\u0027] in your case). I tried to simulate that in my test application. Would you please let me know if this assumption is wrong. I would like to understand how are you using the FastXPathAPI.\n\nAlso the documentation you appended in bugzilla deals with class that is loaded more than one time, and the error reported happens before the class is loaded (it\u0027s happening in defineClass()). Also, in this scenario, the class of the only one expression used in filter should be cached and not being generated more than one time. So I do not think it is applicable in this error.\n\nTest file sent through the mail.\nTo run the sample, you will need the following jar files from TPTP\ncom.ibm.icu_3.4.2.jar\nfastxpath.jar\nhexcore.jar\nhexr.jar\nhlcbe101.jar\nhlcore.jar\norg.eclipse.emf.common_2.2.0.v200606271057.jar\norg.eclipse.emf.ecore.xmi_2.2.0.v200606271057.jar\norg.eclipse.emf.ecore_2.2.0.v200606271057.jar\norg.eclipse.jdt.core_3.2.0.v_671.jar\ntlcbe101.jar\ntptp-models.jar\nand a CBE file named cbe.xml in the same folder, then run run.bat",
    "Hi,\n\nI have modified the TestMatch.java to read the cbe.xml fully as it stops at the FormattingException without reading the file fully. Then I combined all the following log files from the LTA-JD_Scenarios\\DB2-Application-Failure of the LTA-JD 4.2 build into cbe.xml\nactivity.log.CBE\nDB2DIAG.log.CBE\nWinSysEventLogs.CBE\nWinAppEventLogs.CBE\n\nand tested TestMatch.java and found it works fine. So I wondering how the same is not working JD !.\nThe real problem is the \"Multi threaded\" environment. So I changed the TestMatch.java to create a thread for each file and do filtering. Then it fails throwing the error. Then I created a method wrapping fastXPathAPI.match(commonBaseEvents[i], expression) and  \"synchronize\" that method and invoked that method. Now it works fine with little overhead of synchronization.\n\nThe defineClass() method of java.util.ClassLoader is \"synchronized / atomic\" or the context switch of threading is not allowed at the native method call?. Some implementation differs in IBM JDK 1.4.2 and IBM JDK 1.5.0 as it works fine with IBM JDK 1.5.0 without any extra synchronization from our code.\n\nThanks for your cooperation and extra efforts.\n",
    "Ajay agreed that this is not a bug in the TPTP code and he is fine with the solution mentioned in Comment #14. PMR 55777,001,866 is opened to track the synchronization requirement on the ClassLoader with the JVM team.",
    "Closing issue."
  ],
  "commentCreationDates": [
    "2006-09-07T21:54:04+02:00",
    "2006-09-07T21:58:34+02:00",
    "2006-09-08T08:51:30+02:00",
    "2006-09-08T15:35:16+02:00",
    "2006-09-08T16:22:18+02:00",
    "2006-09-08T16:32:10+02:00",
    "2006-09-08T16:34:18+02:00",
    "2006-09-10T09:56:33+02:00",
    "2006-09-11T01:35:23+02:00",
    "2006-09-11T14:27:39+02:00",
    "2006-09-11T16:18:30+02:00",
    "2006-09-11T16:51:13+02:00",
    "2006-09-12T06:55:11+02:00",
    "2006-09-13T07:41:43+02:00",
    "2006-09-13T07:44:35+02:00",
    "2006-09-13T15:32:33+02:00",
    "2006-09-15T23:12:47+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.LinkageError",
      "message": "JVMCL048:redefine of class Compiled362249384 (\u0026name\u003d4E9CC7A8). old_cb\u003dA99D70, new_cb\u003dA99C40, (\u0026old_name\u003d4E9CC7A8) old_name\u003dCompiled362249384",
      "elements": [
        {
          "method": "java.lang.ClassLoader.defineClass0",
          "source": "Native Method"
        },
        {
          "method": "java.lang.ClassLoader.defineClass",
          "source": "ClassLoader.java:808"
        },
        {
          "method": "java.lang.ClassLoader.defineClass",
          "source": "ClassLoader.java:708"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.fastxpath.compiler.EclipseCompiler$MyClassLoader.defineClass",
          "source": "EclipseCompiler.java:331"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.fastxpath.compiler.EclipseCompiler$1.acceptResult",
          "source": "EclipseCompiler.java:119"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.Compiler.compile",
          "source": "Compiler.java:417"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.fastxpath.compiler.EclipseCompiler.generateClass",
          "source": "EclipseCompiler.java:131"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.jre14.fastxpath.compiler.CompilerHelper.buildCompiledExpression",
          "source": "CompilerHelper.java:150"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.jre14.fastxpath.compiler.CompilerHelper.getCompiledExpressionEvaluator",
          "source": "CompilerHelper.java:116"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.jre14.fastxpath.FastXPathEngine.compile",
          "source": "FastXPathEngine.java:160"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.jre14.fastxpath.FastXPathEngine.compile",
          "source": "FastXPathEngine.java(Inlined Compiled Code)"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.fastxpath.FastXPathAPI.getCompiledExpressionEvaluator",
          "source": "FastXPathAPI.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.fastxpath.FastXPathAPI.eval",
          "source": "FastXPathAPI.java(Compiled Code)"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.fastxpath.FastXPathAPI.match",
          "source": "FastXPathAPI.java(Compiled Code)"
        },
        {
          "method": "com.ibm.cbeviewer.tools.TPTPFastXPathEngine.matches",
          "source": "TPTPFastXPathEngine.java(Inlined Compiled Code)"
        },
        {
          "method": "com.ibm.cbeviewer.CBERecord.cbeMatchesXPath",
          "source": "CBERecord.java(Inlined Compiled Code)"
        },
        {
          "method": "com.ibm.cbeviewer.CBERecord.isMatching",
          "source": "CBERecord.java(Compiled Code)"
        },
        {
          "method": "com.ibm.cbeviewer.panels.ReportsTableModel.runXPathInMemory",
          "source": "ReportsTableModel.java:605"
        },
        {
          "method": "com.ibm.cbeviewer.panels.ReportsPanel.runXPathInMemory",
          "source": "ReportsPanel.java:1891"
        },
        {
          "method": "com.ibm.cbeviewer.MainFrame$42.run",
          "source": "MainFrame.java:1391"
        },
        {
          "method": "java.lang.Thread.run",
          "source": "Thread.java:570"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "156592",
      "date": "2006-09-07T21:54:04+02:00",
      "product": "TPTP Profiling",
      "component": "Platform.Model",
      "severity": "blocker"
    },
    {
      "exceptionType": "java.lang.LinkageError",
      "message": "JVMCL048:redefine of class Compiled362249384 (\u0026name\u003d4E9F 5AC8). old_cb\u003dAD7E90, new_cb\u003dAD7B00, (\u0026old_name\u003d4E9F5AC8) old_name\u003dCompiled36224 9384",
      "elements": [
        {
          "method": "java.lang.ClassLoader.defineClass0",
          "source": "Native Method"
        },
        {
          "method": "java.lang.ClassLoader.defineClass",
          "source": "ClassLoader.java:808"
        },
        {
          "method": "java.lang.ClassLoader.defineClass",
          "source": "ClassLoader.java:708"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.fastxpath.compiler.EclipseCompiler$MyClassLoader.defineClass",
          "source": "EclipseCompiler.java:331"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.fastxpath.compiler.EclipseCompiler$1.acceptResult",
          "source": "EclipseCompiler.java:119"
        },
        {
          "method": "org.eclipse.jdt.internal.compiler.Compiler.compile",
          "source": "Compiler.java:417"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.fastxpath.compiler.EclipseCompiler.generateClass",
          "source": "EclipseCompiler.java:131"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.jre14.fastxpath.compiler.CompilerHelper.buildCompiledExpression",
          "source": "CompilerHelper.java:150"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.jre14.fastxpath.compiler.CompilerHelper.getCompiledExpressionEvaluator",
          "source": "CompilerHelper.java:116"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.jre14.fastxpath.FastXPathEngine.compile",
          "source": "FastXPathEngine.java:160"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.jre14.fastxpath.FastXPathEngine.compile",
          "source": "FastXPathEngine.java:114"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.fastxpath.FastXPathAPI.getCompiledExpressionEvaluator",
          "source": "FastXPathAPI.java:275"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.fastxpath.FastXPathAPI.eval",
          "source": "Fas tXPathAPI.java:192"
        },
        {
          "method": "org.eclipse.tptp.platform.provisional.fastxpath.FastXPathAPI.match",
          "source": "Fa stXPathAPI.java:169"
        },
        {
          "method": "com.ibm.cbeviewer.tools.TPTPFastXPathEngine.matches",
          "source": "Unknown Source"
        },
        {
          "method": "com.ibm.cbeviewer.CBERecord.cbeMatchesXPath",
          "source": "Unknown Source"
        },
        {
          "method": "com.ibm.cbeviewer.CBERecord.isMatching",
          "source": "Unknown Source"
        },
        {
          "method": "com.ibm.cbeviewer.panels.ReportsTableModel.runXPathInMemory",
          "source": "Unknown S ource"
        },
        {
          "method": "com.ibm.cbeviewer.panels.ReportsPanel.runXPathInMemory",
          "source": "Unknown Source "
        },
        {
          "method": "com.ibm.cbeviewer.MainFrame$41.run",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.Thread.run",
          "source": "Thread.java:570"
        }
      ],
      "number": 1,
      "commentIndex": 7,
      "bugId": "156592",
      "date": "2006-09-10T09:56:33+02:00",
      "product": "TPTP Profiling",
      "component": "Platform.Model",
      "severity": "blocker"
    }
  ],
  "groupId": "156592",
  "bugId": "156592",
  "date": "2006-09-07T21:54:04+02:00",
  "product": "TPTP Profiling",
  "component": "Platform.Model",
  "severity": "blocker"
}