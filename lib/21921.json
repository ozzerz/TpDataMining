{
  "comments": [
    "Build Eclipse 2.0 (last SWT code in HEAD Stream from 25/07)\n\nSetting the TopIndex in the Table widget causes:\na) getTopIndex will return a totally bogus value\nb) if attempt to add a new TableItem a NPE will occurs\n\nHere the testcase:\npublic static void main(String[] args) {\n\tDisplay display \u003d new Display();\n\tShell shell \u003d new Shell(display);\n\tshell.open();\n\t\n\tTable table \u003d new Table (shell, SWT.V_SCROLL); \n\ttable.setBounds(shell.getClientArea());\n\tnew TableItem (table, 0).setText(\"adsf\");\n\tnew TableItem (table, 0).setText(\"qwer\");\n\tnew TableItem (table, 0).setText(\"zxcv\");\n\ttable.setTopIndex(3);\n\tSystem.out.println(\"Table top index (after set it to 3) \u003d \" +\ntable.getTopIndex()); //Bogus top index\n\tnew TableItem (table, 0).setText(\"zxcv\"); //NPE \t\t\n}\n\nHere the output (and stack):\n\nTable top index (after set it to 3) \u003d -25\nException in thread \"main\" java.lang.NullPointerException\n\tat org.eclipse.swt.widgets.Table.paintItems(Table.java:1673)\n\tat org.eclipse.swt.widgets.Table.paint(Table.java:1634)\n\tat org.eclipse.swt.widgets.Table.handleEvents(Table.java:1244)\n\tat\norg.eclipse.swt.widgets.SelectableItemWidget$1.handleEvent(SelectableItemWidget.java:1192)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:77)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:849)\n\tat org.eclipse.swt.widgets.Control.processPaint(Control.java:1471)\n\tat org.eclipse.swt.widgets.Composite.processPaint(Composite.java:482)\n\tat org.eclipse.swt.widgets.Widget.processEvent(Widget.java:541)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:2114)\n\tat org.eclipse.swt.internal.motif.OS.XtDispatchEvent(Native Method)\n\tat org.eclipse.swt.widgets.Control.update(Control.java:2776)\n\tat\norg.eclipse.swt.widgets.SelectableItemWidget.scroll(SelectableItemWidget.java:1569)\n\tat org.eclipse.swt.widgets.Table.scrollVerticalAddingItem(Table.java:2115)\n\tat\norg.eclipse.swt.widgets.SelectableItemWidget.addingItem(SelectableItemWidget.java:86)\n\tat org.eclipse.swt.widgets.Table.addItem(Table.java:138)\n\tat org.eclipse.swt.widgets.TableItem.\u003cinit\u003e(TableItem.java:117)\n\tat org.eclipse.swt.widgets.TableItem.\u003cinit\u003e(TableItem.java:80)\n\tat testcase.TablePR.main(TablePR.java:21)",
    "In fact, setTopIndex will fail when:\n newTopIndex \u003e itemCount AND maxNumberOfVisibleItem \u003e itemCount\n\nThe Fix is to change setTopIndex as follow:\npublic void setTopIndex(int index) {\n\tcheckWidget();\n\tint itemCount \u003d getItemCount();\n\t\n\tif (index \u003c 0 || itemCount \u003d\u003d 0) {\n\t\treturn;\n\t}\t\n\tif (index \u003e\u003d itemCount) {\n\t\tindex \u003d itemCount - 1;\n\t} \n\tsuper.setTopIndex(index, true);\n}\n\nThis code will make setTopIndex work as setTopIndex for Text widget in motif.\nThe way setTopIndex work on windows is bit different.\n\n\n\n\n",
    "\nAnother fix is:\npublic void setTopIndex(int index) {\n\tcheckWidget();\n\tint itemCount \u003d getItemCount();\n\tif (index \u003c 0 || itemCount \u003d\u003d 0) return;\n\tif (index \u003e\u003d itemCount) index \u003d itemCount - 1;\t\t\n\tshowItem(getItem(index));\n}\n\nUsing this code setTopIndex for the emulated Table will behavior as:\nTable for Win/GTK\nList for Win/GTK/Motif\nTest for Motif\n\n",
    "to use showItem is too simple (for not sayint naive).\n\nThis should work:\npublic void setTopIndex(int index) {\n\tcheckWidget();\n\tint itemCount \u003d getItemCount();\n\tint itemCountWhole \u003d getItemCountWhole();\n\tif (index \u003c 0 || itemCount \u003d\u003d 0) return;\n\tif (index \u003e\u003d itemCount) index \u003d itemCount - 1;\t\t\n\tif (itemCount \u003e itemCountWhole ) {\n\t\tif (index + itemCountWhole \u003c itemCount) {\n\t\t\tsuper.setTopIndex(index, true);\n\t\t} else if (index \u003e itemCount - itemCountWhole) {\n\t\t\tsuper.setTopIndex(itemCount - itemCountWhole, true);\n\t\t} else {\n\t\t\tshowItem(getItem(index));\n\t\t}\t\n\t}\n}",
    "Put in the fixes.  Get Grant or SSQ to check them.",
    "Checked, tested and released.  I made one small change...\nfrom:\n     if (index + itemCountWhole \u003c itemCount) \nto:\n     if (index + itemCountWhole \u003c\u003d itemCount)\n"
  ],
  "commentCreationDates": [
    "2002-07-25T22:57:03+02:00",
    "2002-07-26T17:39:20+02:00",
    "2002-07-26T21:01:10+02:00",
    "2002-07-26T22:19:00+02:00",
    "2002-07-30T22:39:48+02:00",
    "2002-08-08T16:57:49+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.swt.widgets.Table.paintItems",
          "source": "Table.java:1673"
        },
        {
          "method": "org.eclipse.swt.widgets.Table.paint",
          "source": "Table.java:1634"
        },
        {
          "method": "org.eclipse.swt.widgets.Table.handleEvents",
          "source": "Table.java:1244"
        },
        {
          "method": "org.eclipse.swt.widgets.SelectableItemWidget$1.handleEvent",
          "source": "SelectableItemWidget.java:1192"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:77"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:849"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.processPaint",
          "source": "Control.java:1471"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.processPaint",
          "source": "Composite.java:482"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.processEvent",
          "source": "Widget.java:541"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:2114"
        },
        {
          "method": "org.eclipse.swt.internal.motif.OS.XtDispatchEvent",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.update",
          "source": "Control.java:2776"
        },
        {
          "method": "org.eclipse.swt.widgets.SelectableItemWidget.scroll",
          "source": "SelectableItemWidget.java:1569"
        },
        {
          "method": "org.eclipse.swt.widgets.Table.scrollVerticalAddingItem",
          "source": "Table.java:2115"
        },
        {
          "method": "org.eclipse.swt.widgets.SelectableItemWidget.addingItem",
          "source": "SelectableItemWidget.java:86"
        },
        {
          "method": "org.eclipse.swt.widgets.Table.addItem",
          "source": "Table.java:138"
        },
        {
          "method": "org.eclipse.swt.widgets.TableItem.\u003cinit\u003e",
          "source": "TableItem.java:117"
        },
        {
          "method": "org.eclipse.swt.widgets.TableItem.\u003cinit\u003e",
          "source": "TableItem.java:80"
        },
        {
          "method": "testcase.TablePR.main",
          "source": "TablePR.java:21"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "21921",
      "date": "2002-07-25T22:57:03+02:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "normal"
    }
  ],
  "groupId": "21921",
  "bugId": "21921",
  "date": "2002-07-25T22:57:03+02:00",
  "product": "Platform",
  "component": "SWT",
  "severity": "normal"
}