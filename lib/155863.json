{
  "comments": [
    "When HL7v2 is running HL7Definition validation, I get \"error\" level messages due to items that have a table ID (hence table is not null) but for which no data is found in the tables - so any populated value returns an error at validation.\n\nHere is a well-formed Pix Consumer message:\nMSH|^~\\\u0026|OTHER_KIOSK|HIMSSSANDIEGO|PAT_IDENTITY_X_REF_MGR_IBM1|HIMSSSANDIEGO|20060731101116.701||QBP^Q23^QBP_Q21|2279317178878075286|P|2.5\nQPD|Q23^Get CorrespondingIDs^HL7|2279317178878075286049193799252|1C6C5718C4223C5\nRCP|I\n\nverifyMessage - level 3 - MSH:1-9-1 - Table value \u0027QBP\u0027 is not valid\nverifyMessage - level 3 - MSH:1-9-1-1 - Table value \u0027QBP\u0027 is not valid\nverifyMessage - level 3 - MSH:1-9-2 - Table value \u0027Q23\u0027 is not valid\nverifyMessage - level 3 - MSH:1-9-2-1 - Table value \u0027Q23\u0027 is not valid\nverifyMessage - level 3 - MSH:1-9-3 - Table value \u0027QBP_Q21\u0027 is not valid\nverifyMessage - level 3 - MSH:1-9-3-1 - Table value \u0027QBP_Q21\u0027 is not valid\nverifyMessage - level 3 - MSH:1-11-1 - Table value \u0027P\u0027 is not valid\nverifyMessage - level 3 - MSH:1-11-1-1 - Table value \u0027P\u0027 is not valid\nverifyMessage - level 3 - MSH:1-12-1 - Table value \u00272.5\u0027 is not valid\nverifyMessage - level 3 - MSH:1-12-1-1 - Table value \u00272.5\u0027 is not valid\nverifyMessage - level 3 - QPD:1-1-3 - Table value \u0027HL7\u0027 is not valid\nverifyMessage - level 3 - QPD:1-1-3-1 - Table value \u0027HL7\u0027 is not valid\nverifyMessage - level 3 - RCP:1-1 - Table value \u0027I\u0027 is not valid\nverifyMessage - level 3 - RCP:1-1-1 - Table value \u0027I\u0027 is not valid\n\nDefinitionValidator.java \u003e validateCell\n\nif (dataType !\u003d null \u0026\u0026 dataType.equals(\"ID\") \u0026\u0026 cell.hasTable() \u0026\u0026 cell.hasContent() \u0026\u0026 !cell.isValidTableCode()) {\n\tevent(cell, ITEM_TYPE_ERROR, hecBadField, \"Table value \u0027\"+cell.getRawContent()+\"\u0027 is not valid\");\n}\n\nThe cell has a tableId and hence Table is not null but size is 0.\n\nIn Cell.java \u003e isValidTableCode():\n  System.out.println(\"Table has \" + table.getItems().size() + \" items.\");\n\nTable has 0 items.\nisValidTableCode \u003d false;\n\nPossiblities:\n1 - tables are not loaded properly (I don\u0027t know what is in the access file?)\n2 - tables with 0 items should only generate a warning as no match is possible\n\nI\u0027m working on a JUNIT.",
    "Here is a JUNIT. Note that this hits 2 issues. The first is the validation errors and the second is that if you never call msg.addMSHFromFields(), hl7Def validation quits producing no errors.\n\n\tpublic final void testTableNullError() throws HL7V2Exception {\n\t\t\n\t\t//set-up        \n\t\tPrivateFormat loadFile \u003d new PrivateFormat(new File(TestConfiguration.STREAM_PATH));\n\t\tMessageManager localFactory \u003d new MessageManager();\n\t\tlocalFactory.setVersionDefinitions(loadFile.load());\n\n\t\t//create message object\n\t\tMessage msg \u003d localFactory.createMessage();\n\t\tmsg.clear();\n\t\tmsg.setDefinitions(localFactory.getVersionDefinitions());\n\t\tmsg.setVersion(VersionDefnList.hv25);\n\t\tmsg.setEvent(\"Q23\");\n\t\tmsg.setMessageType(\"QBP\");\n\t\tmsg.setStructId(\"QBP_Q21\");\n\t\tmsg.addMSHFromFields();     //\u003c\u003c\u003c \u003d not call this and hl7Defs quits w/0 errors!\n\n\t\t//define message\n\t\tSegment segment;\n\t\t\n\t\tsegment \u003d new Segment();\t\t\n\t\tsegment.setCode(\"MSH\");\n\t\tsegment.buildFields();\n\t\tmsg.getSegments().add(segment);\n\t\t\n\t\tsegment \u003d new Segment();\n\t\tsegment.setCode(\"QPD\");\n\t\tsegment.buildFields();\n\t\tsegment.forceField(0).forceComponent(3);\n\t\tmsg.getSegments().add(segment);\n\t\t\n\t\tsegment \u003d new Segment();\n\t\tsegment.setCode(\"RCP\");\n\t\tsegment.buildFields();\n\t\tmsg.getSegments().add(segment);\n\n\t\tmsg.forceElement(\"MSH-1\").setAsString(\"|\");\n\t\tmsg.forceElement(\"MSH-2\").setAsString(\"^~\\\\\u0026\");\n\t\tmsg.forceElement(\"MSH-3-1\").setAsString(\"OTHER_KIOSK\");\n\t\tmsg.forceElement(\"MSH-4-1\").setAsString(\"HIMSSSANDIEGO\");\n\t\tmsg.forceElement(\"MSH-5-1\").setAsString(\"PAT_IDENTITY_X_REF_MGR_IBM1\");\n\t\tmsg.forceElement(\"MSH-6-1\").setAsString(\"IBM\");\t\n\t\tmsg.forceElement(\"MSH-7\").setAsString(HL7V2DateUtilities.format(new Date(), \"yyyymmddhhnnss.zzz\"));\n\t\tmsg.forceElement(\"MSH-11-1\").setAsString(\"P\");\n\t\tmsg.forceElement(\"MSH-12-1\").setAsString(VersionDefnList.display(VersionDefnList.hv25));\n\t\tmsg.forceElement(\"MSH-18\").setAsString(\"ASCII\");\n\n\t\tmsg.forceElement(\"QPD-1-1\").setAsString(\"Q23\");\n\t\tmsg.forceElement(\"QPD-1-2\").setAsString(\"Get Corresponding IDs\");\n\t\tmsg.forceElement(\"QPD-1-3\").setAsString(\"HL7\");\n\t\t\n\t\tmsg.forceElement(\"RCP-1\").setAsString(\"I\");\n\t\t\n\t\t//hl7Defs validate message\n\t\tDefinitionValidator defVal \u003d new DefinitionValidator();\n\t\tdefVal.validate(msg);\n\t\tValidationItemList defItems \u003d defVal.getItems();\n\t\t\n\t\tfor (int i\u003d0; i \u003c defItems.size(); i++) {\n\t\t\tSystem.out.println(\"verifyMessage - level \" + defItems.item(i).getType() + \" - \" + defItems.item(i).getNode().elementName() + \" - \" + defItems.item(i).getMessage());\n\t\t}\n\t\tif (defItems.size() \u003e 0) {\n\t\t\tthrow new HL7V2Exception(\"hl7Defs table error found\",0);\n\t\t}\n\t}",
    "New code in CVS is causing:\n\njava.lang.StringIndexOutOfBoundsException: String index out of range: -2\n\tat java.lang.String.substring(Unknown Source)\n\tat org.eclipse.ohf.hl7v2.core.definitions.model.TableDefn.isValidTableCode(TableDefn.java:72)\n\ngetName: 99zzz or L\nlength: 10\n\nerror code:\nitem.getName().substring(item.getName().length() - 4, 4)\n\nshould be?\nitem.getName().substring(item.getName().length() - 4)\n"
  ],
  "commentCreationDates": [
    "2006-08-31T19:26:32+02:00",
    "2006-08-31T20:41:19+02:00",
    "2006-09-01T23:02:25+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.StringIndexOutOfBoundsException",
      "message": "String index out of range: -2",
      "elements": [
        {
          "method": "java.lang.String.substring",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.ohf.hl7v2.core.definitions.model.TableDefn.isValidTableCode",
          "source": "TableDefn.java:72"
        }
      ],
      "number": 0,
      "commentIndex": 2,
      "bugId": "155863",
      "date": "2006-09-01T23:02:25+02:00",
      "product": "OHF",
      "component": "HL7V2",
      "severity": "normal"
    }
  ],
  "groupId": "155863",
  "bugId": "155863",
  "date": "2006-08-31T19:26:32+02:00",
  "product": "OHF",
  "component": "HL7V2",
  "severity": "normal"
}