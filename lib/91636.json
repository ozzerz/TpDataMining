{
  "comments": [
    "Phil, I\u0027ve seen this error when I run our unit tests in a development workbench, \nbut the (newly) captured logs from the build/test machine makes it even more\nobvious. While doesn\u0027t cause any obvious problems to end-user, I\u0027m sure it must \nhave some less than desirable consequences. Please investigate.",
    "Changing title to be more accurate. \n\nThe indexing job needs a BundleListener (to jsp.core?) bundle. \n[whichever bundle starts the job].\n\nso STOPPED, UNINSTALLED, UNRESOLVED, UPDATED \nwould cause the job to be canceled, or cancel itself. \n\nI\u0027d like this fixed soon, since *might* be source of occasional \nfunny stuff happening during unit tests.\n",
    "I see now from looking at the code, the stuff I said in comment 1 should not be\nnecessary. I see an attempt to share a monitor between search and indexing,\nwhich is \u0027canceled\u0027 when the jsp core plugin\u0027s \u0027stop\u0027 method is called, which\nshould work. Not sure why its not. Below is a partial stack trace that occurs on\nthe build mahine. It shows that during some other tests (encoding) the indexer\nis running *after* the text plugin has stopped. Most unusual. \n\n\neclipse-test:\n     [echo] Running org.eclipse.jst.jsp.tests.encoding.JSPEncodingTestSuite\n     [java] !SESSION 2005-06-27 06:26:11.755\n-----------------------------------------------\n     [java] eclipse.buildId\u003dI20050617-1618\n     [java] java.version\u003d1.4.2_08\n     [java] java.vendor\u003dSun Microsystems Inc.\n     [java] BootLoader constants: OS\u003dlinux, ARCH\u003dx86, WS\u003dgtk, NL\u003den_US\n     [java] Framework arguments:  -application\norg.eclipse.test.coretestapplication\nformatter\u003dorg.apache.tools.ant.taskdefs.optional.junit.XMLJUnitResultFormatter,org.eclipse.jst.jsp.tests.encoding.JSPEncodingTestSuite.xml\n-testPluginName org.eclipse.jst.jsp.tests.encoding -className\norg.eclipse.jst.jsp.tests.encoding.JSPEncodingTestSuite\n     [java] Command-line arguments:  -application\norg.eclipse.test.coretestapplication -dev bin -data\n/home/build-home/test-current-I/eclipse/wst_folder\nformatter\u003dorg.apache.tools.ant.taskdefs.optional.junit.XMLJUnitResultFormatter,org.eclipse.jst.jsp.tests.encoding.JSPEncodingTestSuite.xml\n-testPluginName org.eclipse.jst.jsp.tests.encoding -className\norg.eclipse.jst.jsp.tests.encoding.JSPEncodingTestSuite -os linux -ws gtk -arch\nx86 -consolelog\n\n     [java] !ENTRY org.eclipse.core.runtime 4 2 2005-06-27 06:26:16.900\n     [java] !MESSAGE An internal error occurred during: \"Updating JSP Index\".\n     [java] !STACK 0\n     [java] java.lang.NoClassDefFoundError: org/eclipse/core/filebuffers/FileBuffers\n     [java] \tat\norg.eclipse.wst.sse.ui.internal.StructuredResourceMarkerAnnotationModelFactory.createAnnotationModel(StructuredResourceMarkerAnnotationModelFactory.java:40)\n     [java] \tat\norg.eclipse.core.internal.filebuffers.TextFileBufferManager.createAnnotationModel(TextFileBufferManager.java:292)\n     [java] \tat\norg.eclipse.core.internal.filebuffers.ResourceTextFileBuffer.initializeFileBufferContent(ResourceTextFileBuffer.java:250)\n     [java] \tat\norg.eclipse.core.internal.filebuffers.ResourceFileBuffer.create(ResourceFileBuffer.java:238)\n     [java] \tat\norg.eclipse.core.internal.filebuffers.TextFileBufferManager.connect(TextFileBufferManager.java:99)\n     [java] \tat\norg.eclipse.wst.sse.core.internal.FileBufferModelManager.getModel(FileBufferModelManager.java:508)\n     [java] \tat\norg.eclipse.wst.sse.core.internal.model.ModelManagerImpl._commonGetModel(ModelManagerImpl.java:320)\n     [java] \tat\norg.eclipse.wst.sse.core.internal.model.ModelManagerImpl._commonGetModel(ModelManagerImpl.java:306)\n     [java] \tat\norg.eclipse.wst.sse.core.internal.model.ModelManagerImpl.getModelForRead(ModelManagerImpl.java:1117)\n     [java] \tat\norg.eclipse.jst.jsp.core.internal.java.search.JSPSearchDocument.getJSPTranslation(JSPSearchDocument.java:105)\n     [java] \tat\norg.eclipse.jst.jsp.core.internal.java.search.JSPSearchDocument.getPath(JSPSearchDocument.java:149)\n     [java] \tat\norg.eclipse.jst.jsp.core.internal.java.search.JavaSearchDocumentDelegate.\u003cinit\u003e(JavaSearchDocumentDelegate.java:30)\n     [java] \tat\norg.eclipse.jst.jsp.core.internal.java.search.JSPSearchSupport.createSearchDocument(JSPSearchSupport.java:426)\n     [java] \tat\norg.eclipse.jst.jsp.core.internal.java.search.JSPSearchSupport.addJspFile(JSPSearchSupport.java:320)\n     [java] \tat\norg.eclipse.jst.jsp.core.internal.java.search.JSPIndexManager$ProcessFilesJob.run(JSPIndexManager.java:238)\n     [java] \tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:76)\n\n",
    "I think I see part of the problem. I\u0027m not sure how we have control over which\nmontior is used. Normally, that\u0027s set by JobManager, and we were never canceling\nit.  I\u0027ve made that change, plus put in more \"active shutdown\" code to \n(attempt) to wait to shutdown until the jobs are really finished (e.g. if one is\ncurrently in the middle of a large file, it might be continuing on while other\nplugins are stopped?). \n\n\n\n",
    "released for build. I will monitor its log files to see if the problems are gone. \n",
    "Thest types of stack traces were no longer in tests logs, so I think \nfixed. \n\nThrere new ones though, for taglib controller, which shutsdown right after\nindexer. \n\nI\u0027ll open seperate bug for it. \n",
    "mass closing verified bugs I own"
  ],
  "commentCreationDates": [
    "2005-04-16T05:07:12+02:00",
    "2005-06-27T03:20:06+02:00",
    "2005-06-27T07:29:53+02:00",
    "2005-06-27T08:05:02+02:00",
    "2005-06-27T08:42:10+02:00",
    "2005-06-27T10:25:02+02:00",
    "2005-06-27T18:34:34+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NoClassDefFoundError",
      "message": "org/eclipse/core/filebuffers/FileBuffers      [java]",
      "elements": [
        {
          "method": "org.eclipse.wst.sse.ui.internal.StructuredResourceMarkerAnnotationModelFactory.createAnnotationModel",
          "source": "StructuredResourceMarkerAnnotationModelFactory.java:40"
        }
      ],
      "number": 0,
      "commentIndex": 2,
      "bugId": "91636",
      "date": "2005-06-27T07:29:53+02:00",
      "product": "Web Tools",
      "component": "jst.jsp",
      "severity": "normal"
    }
  ],
  "groupId": "91636",
  "bugId": "91636",
  "date": "2005-04-16T05:07:12+02:00",
  "product": "Web Tools",
  "component": "jst.jsp",
  "severity": "normal"
}