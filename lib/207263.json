{
  "comments": [
    "Created an attachment (id\u003d81029)\n[stack trace as logged to the Error log view]\n\nVersion: 3.4.0\nBuild id: I20071023-0800\n\njava version \"1.5.0\"\nJava(TM) 2 Runtime Environment, Standard Edition (build pwi32dev-20070511 (SR5))\n\nIBM J9 VM (build 2.3, J2RE 1.5.0 IBM J9 2.3 Windows XP x86-32 j9vmwi3223-20070426 (JIT enabled)\n\nContext: start against an existing workspace after installing I20071023-0800.\nWhile in the default Java perspective, activate pull-down menus (window, run, navigate...)\nWhile hovering menus, encountered several NPE\u0027s.\nAttaching stack trace",
    "Also had many NPE\u0027s while working with pop-up menus...\n\n!ENTRY org.eclipse.ui 4 0 2007-10-24 13:57:52.312\n!MESSAGE Unhandled event loop exception\n!STACK 0\njava.lang.NullPointerException\n        at org.eclipse.swt.widgets.Control.WM_MENUSELECT(Control.java:4153)\n        at org.eclipse.swt.widgets.Control.windowProc(Control.java:3724)\n        at org.eclipse.swt.widgets.Canvas.windowProc(Canvas.java:334)\n        at org.eclipse.swt.widgets.Decorations.windowProc(Decorations.java:1555)\n\n        at org.eclipse.swt.widgets.Shell.windowProc(Shell.java:1886)\n        at org.eclipse.swt.widgets.Display.windowProc(Display.java:4423)\n        at org.eclipse.swt.internal.win32.OS.TrackPopupMenu(Native Method)\n        at org.eclipse.swt.widgets.Menu._setVisible(Menu.java:230)\n        at org.eclipse.swt.widgets.Display.runPopups(Display.java:3770)\n        at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3349)\n        at org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:2395)\n        at org.eclipse.ui.internal.Workbench.runUI(Workbench.java:2359)\n        at org.eclipse.ui.internal.Workbench.access$4(Workbench.java:2225)\n        at org.eclipse.ui.internal.Workbench$4.run(Workbench.java:468)\n        at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.ja\nva:288)\n        at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.jav\na:463)\n        at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)\n        at org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEAppli\ncation.java:106)\n        at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandl\ne.java:193)\n        at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runAppli\ncation(EclipseAppLauncher.java:106)\n        at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(Ec\nlipseAppLauncher.java:76)\n        at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.ja\nva:362)\n        at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.ja\nva:175)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.\njava:64)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces\nsorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:615)\n        at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:515)\n        at org.eclipse.equinox.launcher.Main.basicRun(Main.java:455)\n        at org.eclipse.equinox.launcher.Main.run(Main.java:1193)\n        at org.eclipse.equinox.launcher.Main.main(Main.java:1169)\n",
    "*** Bug 207292 has been marked as a duplicate of this bug. ***",
    "Using a new workspace also reproduces this issue.\n1) Start a new workspace using I20071023-0800\n2) Close the welcome page\n3) Go to the Debug popup menu\n4) Go down till Debug as and click on it\n5) The exception should be in the Error log view",
    "Eric, I can\u0027t make this happen.  Paul and/or Bogdan, can you please try to make it happen and find me?  We have been playing with menus lately ...",
    "Steve, have you tried the steps in comment 3 ?\nI can show you tomorrow if you want.",
    "\u003e 5) The exception should be in the Error log view\n\nDon\u0027t trust the Error Log view in I20071023-0800, see bug 207410 ...",
    "Yes, please come and find me and make it happen.",
    "We\u0027ve released a (hopeful) fix by delaying the proxy menu\u003c-\u003ereal menu swap until after the OS is finished with the SWT.Hide event.\n\nPW\n",
    "(In reply to comment #8)\n\u003e We\u0027ve released a (hopeful) fix by delaying the proxy menu\u003c-\u003ereal menu swap\n\u003e until after the OS is finished with the SWT.Hide event.\n\nIt change the problem but did not fix it completely ... backing out change.\n\nPW\n",
    "Fixed \u003e 20071025\n\nThe NPE is gone but there is an issue with Windows.  Setting a submenu requires that the menu item parent (the cascade) be destroyed and recreated in the operating system.  There is no way around this, other than changing the UI code to make use of this by first disposing the old menu then setting the new.  Here is some example code that shows the work around:\n\nimport org.eclipse.swt.*;\nimport org.eclipse.swt.widgets.*;\n\npublic class PR_207263 {\n\tpublic static void main (String [] args) {\n\t\tfinal Display display \u003d new Display ();\n\t\tShell shell \u003d new Shell (display);\n\t\tMenu menu \u003d new Menu (shell, SWT.POP_UP);\n\t\tfinal MenuItem item \u003d new MenuItem (menu, SWT.CASCADE);\n\t\titem.setText (\"Cascade Item\");\n\t\tMenuItem item3 \u003d new MenuItem (menu, SWT.PUSH);\n\t\titem3.setText (\"Another Item\");\n\t\t\n\t\tfinal Menu menu1 \u003d new Menu (shell, SWT.DROP_DOWN);\n\t\tMenuItem item1 \u003d new MenuItem (menu1, SWT.PUSH);\n\t\titem1.setText (\"Old Item\");\n\t\tfinal Menu menu2 \u003d new Menu (shell, SWT.DROP_DOWN);\n\t\tMenuItem item2 \u003d new MenuItem (menu2, SWT.PUSH);\n\t\titem2.setText (\"New Item1\");\n\t\titem.setMenu (menu1);\n\t\tmenu1.addListener (SWT.Hide, new Listener () {\n\t\t\tpublic void handleEvent (Event e) {\n\t\t\t\tmenu1.removeListener (SWT.Hide, this);\n\t\t\t\te.display.asyncExec (new Runnable () {\n\t\t\t\t\tpublic void run () {\n\t\t\t\t\t\t/* Dispose the old menu before setting the new one */\n\t\t\t\t\t\tmenu1.dispose ();\n\t\t\t\t\t\titem.setMenu (menu2);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\t\n\t\tshell.setMenu (menu);\n\t\tshell.pack ();\n\t\tshell.open ();\n\t\twhile (!shell.isDisposed ()) {\n\t\t\tif (!display.readAndDispatch ()) display.sleep ();\n\t\t}\n\t\tdisplay.dispose ();\n\t}\n}\n",
    "(In reply to comment #10)\n\u003e Fixed \u003e 20071025\n\nI\u0027ve updated ActionContributionItem to follow this pattern:\nproxyMenu.dispose();\nitem.setMenu(realMenu);\n\nPW\n",
    "A patch for this bug made against the 3.3.x stream is included in Bug 207744."
  ],
  "commentCreationDates": [
    "2007-10-24T10:22:55+02:00",
    "2007-10-24T14:00:58+02:00",
    "2007-10-24T15:59:39+02:00",
    "2007-10-24T18:38:47+02:00",
    "2007-10-24T23:29:48+02:00",
    "2007-10-25T00:28:57+02:00",
    "2007-10-25T12:19:55+02:00",
    "2007-10-25T15:50:06+02:00",
    "2007-10-25T17:20:12+02:00",
    "2007-10-25T17:46:38+02:00",
    "2007-10-25T21:07:18+02:00",
    "2007-10-25T21:32:39+02:00",
    "2007-12-13T20:55:12+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.swt.widgets.Control.WM_MENUSELECT",
          "source": "Control.java:4153"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3724"
        },
        {
          "method": "org.eclipse.swt.widgets.Canvas.windowProc",
          "source": "Canvas.java:334"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.windowProc",
          "source": "Decorations.java:1555"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.windowProc",
          "source": "Shell.java:1886"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:4423"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.TrackPopupMenu",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.widgets.Menu._setVisible",
          "source": "Menu.java:230"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runPopups",
          "source": "Display.java:3770"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:3349"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:2395"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:2359"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.access$4",
          "source": "Workbench.java:2225"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$4.run",
          "source": "Workbench.java:468"
        },
        {
          "method": "org.eclipse.core.databinding.observable.Realm.runWithDefault",
          "source": "Realm.ja va:288"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.jav a:463"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "org.eclipse.ui.internal.ide.application.IDEApplication.start",
          "source": "IDEAppli cation.java:106"
        },
        {
          "method": "org.eclipse.equinox.internal.app.EclipseAppHandle.run",
          "source": "EclipseAppHandl e.java:193"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:106"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "Ec lipseAppLauncher.java:76"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.ja va:362"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.ja va:175"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl. java:64"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAcces sorImpl.java:43"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:615"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.invokeFramework",
          "source": "Main.java:515"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.basicRun",
          "source": "Main.java:455"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.run",
          "source": "Main.java:1193"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.main",
          "source": "Main.java:1169"
        }
      ],
      "number": 0,
      "commentIndex": 1,
      "bugId": "207263",
      "date": "2007-10-24T14:00:58+02:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "normal"
    }
  ],
  "groupId": "207263",
  "bugId": "207263",
  "date": "2007-10-24T10:22:55+02:00",
  "product": "Platform",
  "component": "SWT",
  "severity": "normal"
}