{
  "comments": [
    "i20040324\n\nAuto-activation as currently provided happens only once during a session. If a\nbundle gets deactivated, it will not be reactivated again.\n\nIn Eclipse 2.1, plugins would be reactivated if necessary.\n\nThe result is that some plugins during shutdown create executable extensions\nprovided by other plugins already deactivated (I know it, it is bad), which\ncauses bad things to happen (because code assumes the plugin is active).\n\nThe question is: should we allow an already deactivated bundle to be reactivated\nduring shutdown? I believe reactivation is useful during normal operation (the\nuser stops a set of bundles to preserve resources, and then decides to use a\nfeature that will trigger the reactivation for those bundles). But what about\nshutdown?",
    "Below is a stack trace I got during shutdown (actually got 8 of these entries).\nIt seems JDT UI has a thread that is stopped when their plugin is shutdown. This\nthread causes executable extensions to be run, and at that time contributors may\nhave been deactivated already, although JDT UI has not been deactivated already.\n\nIt seems that accidental reactivation has always occurred in Eclipse (before\nM8), although since it usually happened silently, nobody bothered. Eclipse\npre-M6 allowed it even for class load-triggered auto-activation. Also, there is\nno reasonable way for people to find out if it is ok to call others\u0027 code before\ndoing it, or to prevent people from doing that. That being said, I would say we\n*need* to keep providing it. \n\nIncreasing severity.\n\n!ENTRY org.eclipse.core.runtime 4 2 Mar 25, 2004 16:44:11.09\n!MESSAGE Problems occurred when invoking code from plug-in:\n\"org.eclipse.core.runtime\".\n!STACK 0\njava.lang.NullPointerException\n\tat org.eclipse.core.internal.runtime.DataArea.getStateLocation(DataArea.java:85)\n\tat\norg.eclipse.core.internal.runtime.InternalPlatform.getStateLocation(InternalPlatform.java:1022)\n\tat org.eclipse.core.runtime.Plugin.getStateLocation(Plugin.java:376)\n\tat\norg.eclipse.pde.internal.core.SourceAttachmentManager.getFileName(SourceAttachmentManager.java:73)\n\tat\norg.eclipse.pde.internal.core.SourceAttachmentManager.initialize(SourceAttachmentManager.java:79)\n\tat\norg.eclipse.pde.internal.core.SourceAttachmentManager.\u003cinit\u003e(SourceAttachmentManager.java:57)\n\tat\norg.eclipse.pde.internal.core.PDECore.getSourceAttachmentManager(PDECore.java:334)\n\tat\norg.eclipse.pde.internal.core.RequiredPluginsClasspathContainer.verifyWithAttachmentManager(RequiredPluginsClasspathContainer.java:54)\n\tat\norg.eclipse.pde.internal.core.RequiredPluginsClasspathContainer.getClasspathEntries(RequiredPluginsClasspathContainer.java:47)\n\tat\norg.eclipse.jdt.internal.core.JavaModelManager.containerPut(JavaModelManager.java:193)\n\tat org.eclipse.jdt.core.JavaCore.setClasspathContainer(JavaCore.java:3317)\n\tat\norg.eclipse.pde.internal.core.ModelEntry.updateClasspathContainer(ModelEntry.java:107)\n\tat\norg.eclipse.pde.internal.core.RequiredPluginsInitializer.initialize(RequiredPluginsInitializer.java:40)\n\tat org.eclipse.jdt.core.JavaCore$1.run(JavaCore.java:1176)\n\tat\norg.eclipse.core.internal.runtime.InternalPlatform.run(InternalPlatform.java:610)\n\tat org.eclipse.core.runtime.Platform.run(Platform.java:521)\n\tat org.eclipse.jdt.core.JavaCore.getClasspathContainer(JavaCore.java:1171)\n\tat\norg.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath(JavaProject.java:1841)\n\tat\norg.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath(JavaProject.java:1764)\n\tat\norg.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath(JavaProject.java:1736)\n\tat\norg.eclipse.jdt.internal.core.DeltaProcessingState.initializeRoots(DeltaProcessingState.java:147)\n\tat\norg.eclipse.jdt.internal.core.JavaModelOperation.run(JavaModelOperation.java:698)\n\tat org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1559)\n\tat org.eclipse.jdt.core.JavaCore.run(JavaCore.java:3196)\n\tat org.eclipse.jdt.core.JavaCore.setClasspathContainer(JavaCore.java:3325)\n\tat\norg.eclipse.jdt.internal.launching.JREContainerInitializer.initialize(JREContainerInitializer.java:51)\n\tat org.eclipse.jdt.core.JavaCore$1.run(JavaCore.java:1176)\n\tat\norg.eclipse.core.internal.runtime.InternalPlatform.run(InternalPlatform.java:610)\n\tat org.eclipse.core.runtime.Platform.run(Platform.java:521)\n\tat org.eclipse.jdt.core.JavaCore.getClasspathContainer(JavaCore.java:1171)\n\tat\norg.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath(JavaProject.java:1841)\n\tat\norg.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath(JavaProject.java:1764)\n\tat\norg.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath(JavaProject.java:1736)\n\tat org.eclipse.jdt.core.JavaCore.setClasspathContainer(JavaCore.java:3316)\n\tat\norg.eclipse.pde.internal.core.ModelEntry.updateClasspathContainer(ModelEntry.java:107)\n\tat\norg.eclipse.pde.internal.core.RequiredPluginsInitializer.initialize(RequiredPluginsInitializer.java:40)\n\tat org.eclipse.jdt.core.JavaCore$1.run(JavaCore.java:1176)\n\tat\norg.eclipse.core.internal.runtime.InternalPlatform.run(InternalPlatform.java:610)\n\tat org.eclipse.core.runtime.Platform.run(Platform.java:521)\n\tat org.eclipse.jdt.core.JavaCore.getClasspathContainer(JavaCore.java:1171)\n\tat\norg.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath(JavaProject.java:1841)\n\tat\norg.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath(JavaProject.java:1764)\n\tat\norg.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath(JavaProject.java:1736)\n\tat\norg.eclipse.jdt.internal.core.search.JavaSearchScope.add(JavaSearchScope.java:78)\n\tat\norg.eclipse.jdt.internal.core.search.JavaWorkspaceScope.initialize(JavaWorkspaceScope.java:79)\n\tat\norg.eclipse.jdt.internal.core.search.JavaSearchScope.\u003cinit\u003e(JavaSearchScope.java:52)\n\tat\norg.eclipse.jdt.internal.core.search.JavaWorkspaceScope.\u003cinit\u003e(JavaWorkspaceScope.java:30)\n\tat\norg.eclipse.jdt.core.search.SearchEngine.createWorkspaceScope(SearchEngine.java:430)\n\tat\norg.eclipse.jdt.internal.corext.util.AllTypesCache.search(AllTypesCache.java:502)\n\tat\norg.eclipse.jdt.internal.corext.util.AllTypesCache$TypeCacher.doSearchTypes(AllTypesCache.java:180)\n\tat\norg.eclipse.jdt.internal.corext.util.AllTypesCache$TypeCacher.run(AllTypesCache.java:149)",
    "Looking at this trace it is actually the fact that Plugin.stop() sets the \nplugin\u0027s bundle field to null that is causing the problem.  We have not seen a \ngood reason to do this.  The bundle object is still valid even though the \nplugin is stopped.\n\nSo changing this is a step in the right direction but is by no means the only \nthing to be done.  We have to review the idea of reauto-activation (we should \nallow it) and look at how the shutdown sequence can be managed to match \nconventional Eclipse expections in the near term but better line up with the \ndynamic nature of OSGi in the longer term.\n",
    "Workaround (as described above) has been released. Unassigning.",
    "As part of the fix for the startup code in eclipseClassLoader, the choice has \nbeen made to allow re-autoactivation of plugins if they are stopped. \nThis does not apply when the fwk is stopping.\n\nFor more details about the implemented solution see bug #58879."
  ],
  "commentCreationDates": [
    "2004-03-24T16:27:23+01:00",
    "2004-03-25T23:16:06+01:00",
    "2004-03-26T02:56:52+01:00",
    "2004-03-26T15:59:11+01:00",
    "2004-04-18T04:11:48+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.core.internal.runtime.DataArea.getStateLocation",
          "source": "DataArea.java:85"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.getStateLocation",
          "source": "InternalPlatform.java:1022"
        },
        {
          "method": "org.eclipse.core.runtime.Plugin.getStateLocation",
          "source": "Plugin.java:376"
        },
        {
          "method": "org.eclipse.pde.internal.core.SourceAttachmentManager.getFileName",
          "source": "SourceAttachmentManager.java:73"
        },
        {
          "method": "org.eclipse.pde.internal.core.SourceAttachmentManager.initialize",
          "source": "SourceAttachmentManager.java:79"
        },
        {
          "method": "org.eclipse.pde.internal.core.SourceAttachmentManager.\u003cinit\u003e",
          "source": "SourceAttachmentManager.java:57"
        },
        {
          "method": "org.eclipse.pde.internal.core.PDECore.getSourceAttachmentManager",
          "source": "PDECore.java:334"
        },
        {
          "method": "org.eclipse.pde.internal.core.RequiredPluginsClasspathContainer.verifyWithAttachmentManager",
          "source": "RequiredPluginsClasspathContainer.java:54"
        },
        {
          "method": "org.eclipse.pde.internal.core.RequiredPluginsClasspathContainer.getClasspathEntries",
          "source": "RequiredPluginsClasspathContainer.java:47"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelManager.containerPut",
          "source": "JavaModelManager.java:193"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore.setClasspathContainer",
          "source": "JavaCore.java:3317"
        },
        {
          "method": "org.eclipse.pde.internal.core.ModelEntry.updateClasspathContainer",
          "source": "ModelEntry.java:107"
        },
        {
          "method": "org.eclipse.pde.internal.core.RequiredPluginsInitializer.initialize",
          "source": "RequiredPluginsInitializer.java:40"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore$1.run",
          "source": "JavaCore.java:1176"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:610"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:521"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore.getClasspathContainer",
          "source": "JavaCore.java:1171"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath",
          "source": "JavaProject.java:1841"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath",
          "source": "JavaProject.java:1764"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath",
          "source": "JavaProject.java:1736"
        },
        {
          "method": "org.eclipse.jdt.internal.core.DeltaProcessingState.initializeRoots",
          "source": "DeltaProcessingState.java:147"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelOperation.run",
          "source": "JavaModelOperation.java:698"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1559"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore.run",
          "source": "JavaCore.java:3196"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore.setClasspathContainer",
          "source": "JavaCore.java:3325"
        },
        {
          "method": "org.eclipse.jdt.internal.launching.JREContainerInitializer.initialize",
          "source": "JREContainerInitializer.java:51"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore$1.run",
          "source": "JavaCore.java:1176"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:610"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:521"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore.getClasspathContainer",
          "source": "JavaCore.java:1171"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath",
          "source": "JavaProject.java:1841"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath",
          "source": "JavaProject.java:1764"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath",
          "source": "JavaProject.java:1736"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore.setClasspathContainer",
          "source": "JavaCore.java:3316"
        },
        {
          "method": "org.eclipse.pde.internal.core.ModelEntry.updateClasspathContainer",
          "source": "ModelEntry.java:107"
        },
        {
          "method": "org.eclipse.pde.internal.core.RequiredPluginsInitializer.initialize",
          "source": "RequiredPluginsInitializer.java:40"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore$1.run",
          "source": "JavaCore.java:1176"
        },
        {
          "method": "org.eclipse.core.internal.runtime.InternalPlatform.run",
          "source": "InternalPlatform.java:610"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:521"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore.getClasspathContainer",
          "source": "JavaCore.java:1171"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath",
          "source": "JavaProject.java:1841"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath",
          "source": "JavaProject.java:1764"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaProject.getResolvedClasspath",
          "source": "JavaProject.java:1736"
        },
        {
          "method": "org.eclipse.jdt.internal.core.search.JavaSearchScope.add",
          "source": "JavaSearchScope.java:78"
        },
        {
          "method": "org.eclipse.jdt.internal.core.search.JavaWorkspaceScope.initialize",
          "source": "JavaWorkspaceScope.java:79"
        },
        {
          "method": "org.eclipse.jdt.internal.core.search.JavaSearchScope.\u003cinit\u003e",
          "source": "JavaSearchScope.java:52"
        },
        {
          "method": "org.eclipse.jdt.internal.core.search.JavaWorkspaceScope.\u003cinit\u003e",
          "source": "JavaWorkspaceScope.java:30"
        },
        {
          "method": "org.eclipse.jdt.core.search.SearchEngine.createWorkspaceScope",
          "source": "SearchEngine.java:430"
        },
        {
          "method": "org.eclipse.jdt.internal.corext.util.AllTypesCache.search",
          "source": "AllTypesCache.java:502"
        },
        {
          "method": "org.eclipse.jdt.internal.corext.util.AllTypesCache$TypeCacher.doSearchTypes",
          "source": "AllTypesCache.java:180"
        },
        {
          "method": "org.eclipse.jdt.internal.corext.util.AllTypesCache$TypeCacher.run",
          "source": "AllTypesCache.java:149"
        }
      ],
      "number": 0,
      "commentIndex": 1,
      "bugId": "55923",
      "date": "2004-03-25T23:16:06+01:00",
      "product": "Equinox",
      "component": "Incubator",
      "severity": "major"
    }
  ],
  "groupId": "55923",
  "bugId": "55923",
  "date": "2004-03-24T16:27:23+01:00",
  "product": "Equinox",
  "component": "Incubator",
  "severity": "major"
}