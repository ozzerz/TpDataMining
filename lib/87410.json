{
  "comments": [
    "What is the expected order for KeyDown coming from Display.addFilter, related \nMenuItem accelerator event and SWT.KeyDown emitted by a widget?\n\nCase 1 - show that MenuItem.setAccelerator and Display.addFilter must not be \nmixed\n\n1. Run snippet below on Windows\n2. Give focus to text widget (left side)\n3. Press CTRL N\n\nResult:\nDisplay KeyDown character  keyCode 262144\nmenuitem accelerator\n\nInterpretation:\nDisplay.addFilter emitted KeyDown for the CTRL keydown.\nMenu item accelerator was fired when the N keydown was pressed.\nDisplay.addFilter never emitted KeyDown for the N.\n\nThis means the menu item accelerator wins over someone trying to use \nDisplay.addFilter to fake accelerators. If no menu item accelerator is set, \nDisplay.addFilter fires the expected 2 keydown events:\nDisplay KeyDown character keyCode 262144\nDisplay KeyDown character keyCode 110\n\n\nCase 2. Show that OLE/ActiveX fires too many Display.addFilter events\n\n1. Run snippet below on Windows\n2. Give focus to Browser widget (left side)\n3. Press key \u0027f\u0027\n\nDisplay KeyDown character f keyCode 102\nDisplay KeyDown character f keyCode 102\nBrowser KeyDown character f keyCode 102\n\nThere should only be one Display KeyDown event. The results are the same even \nif the Browser widget does not handle the TranslateAccelerator callback from \nMSHTML. Veronika: how can we test this on an activeX either than IE?\n\nHere are the stack traces for each of these events:\nDisplay KeyDown character f keyCode 102\njava.lang.Exception: Stack trace\n\tat java.lang.Thread.dumpStack(Thread.java:1064)\n\tat PRBrowser$1.handleEvent(PRBrowser.java:13)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Display.filterEvent(Display.java:777)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:841)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:866)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:851)\n\tat org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:879)\n\tat org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:875)\n\tat org.eclipse.swt.widgets.Widget.wmChar(Widget.java:1181)\n\tat org.eclipse.swt.widgets.Control.WM_CHAR(Control.java:3121)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3024)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:3466)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:1624)\n\tat org.eclipse.swt.ole.win32.OleFrame.getMsgProc(OleFrame.java:214)\n\tat org.eclipse.swt.internal.win32.OS.PeekMessageW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.PeekMessage(OS.java:2071)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2522)\n\tat PRBrowser.main(PRBrowser.java:42)\nDisplay KeyDown character f keyCode 102\njava.lang.Exception: Stack trace\n\tat java.lang.Thread.dumpStack(Thread.java:1064)\n\tat PRBrowser$1.handleEvent(PRBrowser.java:13)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Display.filterEvent(Display.java:777)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:841)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:866)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:851)\n\tat org.eclipse.swt.widgets.Widget.notifyListeners(Widget.java:659)\n\tat org.eclipse.swt.browser.Browser$1.handleEvent(Browser.java:178)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:842)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:866)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:851)\n\tat org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:879)\n\tat org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:875)\n\tat org.eclipse.swt.widgets.Widget.wmChar(Widget.java:1181)\n\tat org.eclipse.swt.widgets.Control.WM_CHAR(Control.java:3121)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3024)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:3466)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:1624)\n\tat org.eclipse.swt.ole.win32.OleFrame.getMsgProc(OleFrame.java:214)\n\tat org.eclipse.swt.internal.win32.OS.PeekMessageW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.PeekMessage(OS.java:2071)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2522)\n\tat PRBrowser.main(PRBrowser.java:42)\nBrowser KeyDown character f keyCode 102\njava.lang.Exception: Stack trace\n\tat java.lang.Thread.dumpStack(Thread.java:1064)\n\tat PRBrowser$3.handleEvent(PRBrowser.java:35)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:842)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:866)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:851)\n\tat org.eclipse.swt.widgets.Widget.notifyListeners(Widget.java:659)\n\tat org.eclipse.swt.browser.Browser$1.handleEvent(Browser.java:178)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:842)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:866)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:851)\n\tat org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:879)\n\tat org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:875)\n\tat org.eclipse.swt.widgets.Widget.wmChar(Widget.java:1181)\n\tat org.eclipse.swt.widgets.Control.WM_CHAR(Control.java:3121)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3024)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:3466)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:1624)\n\tat org.eclipse.swt.ole.win32.OleFrame.getMsgProc(OleFrame.java:214)\n\tat org.eclipse.swt.internal.win32.OS.PeekMessageW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.PeekMessage(OS.java:2071)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2522)\n\tat PRBrowser.main(PRBrowser.java:42)",
    "Snippet:\nimport org.eclipse.swt.*;\nimport org.eclipse.swt.widgets.*;\nimport org.eclipse.swt.layout.*;\nimport org.eclipse.swt.browser.*;\n\npublic class PRBrowser {\n\n\tpublic static void main(String[] args) {\n\t\tDisplay display \u003d new Display();\n\t\tdisplay.addFilter(SWT.KeyDown, new Listener() {\n\t\t\tpublic void handleEvent(Event e) {\n\t\t\t\tSystem.err.println(\"Display KeyDown \ncharacter \"+e.character+\" keyCode \"+e.keyCode);\n\t\t\t\tThread.dumpStack();\n\t\t\t}\n\t\t});\n\n\t\tShell shell \u003d new Shell(display);\n\t\tMenu bar \u003d new Menu(shell, SWT.BAR);\n\t\tMenuItem item \u003d new MenuItem(bar, SWT.CASCADE);\n\t\titem.setAccelerator(SWT.CONTROL | \u0027n\u0027);\n\t\titem.addListener(SWT.Selection, new Listener(){\n\t\t\tpublic void handleEvent(Event e) {\n\t\t\t\tSystem.out.println(\"menuitem accelerator\");\n\t\t\t}\n\t\t});\n\t\titem.setText(\"My Menu\");\n\t\tshell.setMenuBar(bar);\n\t\tshell.setText(\"PRBrowser\");\n\t\tshell.setLayout(new FillLayout());\n\t\tText text \u003d new Text(shell, SWT.NONE);\n\t\tBrowser browser \u003d new Browser(shell, SWT.NONE);\n\t\tbrowser.addListener(SWT.KeyDown,  new Listener() {\n\t\t\tpublic void handleEvent(Event e) {\n\t\t\t\tSystem.err.println(\"Browser KeyDown \ncharacter \"+e.character+\" keyCode \"+e.keyCode);\n\t\t\t\tThread.dumpStack();\n\t\t\t}\n\t\t});\n\t\tbrowser.setText(\"\u003chtml\u003e\u003cbody\u003eHello\u003c/body\u003e\u003c/html\u003e\");\n\t\tshell.open();\n\t\t\n\t\twhile (!shell.isDisposed()) {\n\t\t\tif (!display.readAndDispatch())\n\t\t\t\tdisplay.sleep();\n\t\t}\t\t\n\t}\n}",
    "About Case 2:\nThe extra Display.addFilter keydown event is coming from notifyListeners \ninvoked in the Browser widget for each keydown:\n\n\t\t\t\tcase SWT.KeyDown:\n\t\t\t\tcase SWT.KeyUp: {\n\t\t\t\t\tnotifyListeners(e.type, e);\n\t\t\t\t\tbreak;\n\nSo that could be a problem for every custom widget?",
    "Vikki and SN to understand the problem and fix it.  I thought that we saw this \nonce already when hacking the original \"allow key in embedded controls\" fix.",
    "This is almost certainly fixed.  The order is that accelerators come first, then filters, then key down to a widget.\n\nIn OLE, by definition, the current order is accelerators, OLE control, filters, then key down.  This is the correct way that keys are processed for OLE, but there was some talk of overriding this to let filters and key down run before the OLE control.  It\u0027s not clear that this is even possible.\n\nGrant to verify that the browser part of this bug is fixed and close."
  ],
  "commentCreationDates": [
    "2005-03-08T17:12:23+01:00",
    "2005-03-08T20:24:45+01:00",
    "2005-03-08T20:28:52+01:00",
    "2005-03-30T03:04:40+02:00",
    "2007-06-14T23:58:10+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.Exception",
      "message": "Stack trace",
      "elements": [
        {
          "method": "java.lang.Thread.dumpStack",
          "source": "Thread.java:1064"
        },
        {
          "method": "PRBrowser$1.handleEvent",
          "source": "PRBrowser.java:13"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.filterEvent",
          "source": "Display.java:777"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:841"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:866"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:851"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendKeyEvent",
          "source": "Widget.java:879"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendKeyEvent",
          "source": "Widget.java:875"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.wmChar",
          "source": "Widget.java:1181"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.WM_CHAR",
          "source": "Control.java:3121"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3024"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3466"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessage",
          "source": "OS.java:1624"
        },
        {
          "method": "org.eclipse.swt.ole.win32.OleFrame.getMsgProc",
          "source": "OleFrame.java:214"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.PeekMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.PeekMessage",
          "source": "OS.java:2071"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2522"
        },
        {
          "method": "PRBrowser.main",
          "source": "PRBrowser.java:42"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "87410",
      "date": "2005-03-08T17:12:23+01:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.Exception",
      "message": "Stack trace",
      "elements": [
        {
          "method": "java.lang.Thread.dumpStack",
          "source": "Thread.java:1064"
        },
        {
          "method": "PRBrowser$1.handleEvent",
          "source": "PRBrowser.java:13"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.filterEvent",
          "source": "Display.java:777"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:841"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:866"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:851"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.notifyListeners",
          "source": "Widget.java:659"
        },
        {
          "method": "org.eclipse.swt.browser.Browser$1.handleEvent",
          "source": "Browser.java:178"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:842"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:866"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:851"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendKeyEvent",
          "source": "Widget.java:879"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendKeyEvent",
          "source": "Widget.java:875"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.wmChar",
          "source": "Widget.java:1181"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.WM_CHAR",
          "source": "Control.java:3121"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3024"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3466"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessage",
          "source": "OS.java:1624"
        },
        {
          "method": "org.eclipse.swt.ole.win32.OleFrame.getMsgProc",
          "source": "OleFrame.java:214"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.PeekMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.PeekMessage",
          "source": "OS.java:2071"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2522"
        },
        {
          "method": "PRBrowser.main",
          "source": "PRBrowser.java:42"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "87410",
      "date": "2005-03-08T17:12:23+01:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.Exception",
      "message": "Stack trace",
      "elements": [
        {
          "method": "java.lang.Thread.dumpStack",
          "source": "Thread.java:1064"
        },
        {
          "method": "PRBrowser$3.handleEvent",
          "source": "PRBrowser.java:35"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:842"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:866"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:851"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.notifyListeners",
          "source": "Widget.java:659"
        },
        {
          "method": "org.eclipse.swt.browser.Browser$1.handleEvent",
          "source": "Browser.java:178"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:842"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:866"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:851"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendKeyEvent",
          "source": "Widget.java:879"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendKeyEvent",
          "source": "Widget.java:875"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.wmChar",
          "source": "Widget.java:1181"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.WM_CHAR",
          "source": "Control.java:3121"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3024"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3466"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessage",
          "source": "OS.java:1624"
        },
        {
          "method": "org.eclipse.swt.ole.win32.OleFrame.getMsgProc",
          "source": "OleFrame.java:214"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.PeekMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.PeekMessage",
          "source": "OS.java:2071"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2522"
        },
        {
          "method": "PRBrowser.main",
          "source": "PRBrowser.java:42"
        }
      ],
      "number": 2,
      "commentIndex": 0,
      "bugId": "87410",
      "date": "2005-03-08T17:12:23+01:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "normal"
    }
  ],
  "groupId": "87410",
  "bugId": "87410",
  "date": "2005-03-08T17:12:23+01:00",
  "product": "Platform",
  "component": "SWT",
  "severity": "normal"
}