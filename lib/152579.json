{
  "comments": [
    "When call-graph BCI is applied to classes dynamically generated by Hibernate (e.g. mypackage.MyClass$$BulkBeanByCGLIB$$79bc371b), the instrumented class does not pass the Java verifier and a verification error similar to this one is returned: \"Inconsistent stack height 1 !\u003d 3\"\n\nI reproduced the problem on the following environment:\nWindows XP 32-bit SP2\nSun JDK 1.5.0_04\nHibernate 2.1.7\n\nBelow is the problem report from the user who originally discovered this problem:\n\n-----------------\n\nDear All \n\nI\u0027m trying to profile in standalone mode an application running on a jboss server (3.2.7). \n\nTo use the Java Profiler, I have to call the application with the -agentlib:JPIBootLoader\u003dJPIAgent:server\u003dstandalone;CGProf \n\nparameter. Well, I\u0027ve added this in the JAVA_OPTS configuration on the run.bat in jboss. \n\nThis application is a J2EE app, with EJB 2.1, and classloader share between the webapplication (app.war) and the ejb classloader (app.ear and framework.ear ). \n\nIf I start the application without profile, it works fine, but when I try to start profiling, the profiler works correctly, but mades the application inconsistent - the application in profiling throws the following error on startup: \n\n08:34:52,734 INFO  [ReflectHelper] reflection optimizer disabled for: br.com.net\nservicos.core.bean.sn.SnTipoCobrancaBean, VerifyError: (class: br/com/netservico \ns/core/bean/sn/SnTipoCobrancaBean$$BulkBeanByCGLIB$$f81284bc, method: setPropert\nyValues signature: (Ljava/lang/Object;[Ljava/lang/Object;)V) Inconsistent stack \nheight 1 !\u003d 3\n08:34:52,765 INFO  [ReflectHelper] reflection optimizer disabled for: br.com.net \nservicos.core.bean.cp.CpBaseAcessoBean, VerifyError: (class: br/com/netservicos/\ncore/bean/cp/CpBaseAcessoBean$$BulkBeanByCGLIB$$dd5a3645, method: setPropertyVal \nues signature: (Ljava/lang/Object;[Ljava/lang/Object;)V) Inconsistent stack heig \nht 1 !\u003d 3\n08:34:52,796 INFO  [ReflectHelper] reflection optimizer disabled for: br.com.net \nservicos.core.bean.so.SoConsumidorMatBean, VerifyError: (class: br/com/netservic \nos/core/bean/so/SoConsumidorMatBean$$BulkBeanByCGLIB$$cb7c496c, method: setPrope \nrtyValues signature: (Ljava/lang/Object;[Ljava/lang/Object;)V) Inconsistent stac\nk height 1 !\u003d 3 \n08:34:53,015 ERROR [LazyInitializer] CGLIB Enhancement failed\njava.lang.VerifyError: (class: br/com/netservicos/core/bean/so/SoConsumidorMatBe \nan$$EnhancerByCGLIB$$b017acd2, method: CGLIB$STATICHOOK1 signature: ()V) Inconsi\nstent stack height 1 !\u003d 2 \n\n        at java.lang.Class.getDeclaredMethods0(Native Method) \n       at java.lang.Class.privateGetDeclaredMethods(Class.java:2365)\n       at java.lang.Class.getDeclaredMethod(Class.java :1907) \n       at net.sf.cglib.proxy.Enhancer.getCallbacksSetter(Enhancer.java:558)\n       at net.sf.cglib.proxy.Enhancer.setCallbacksHelper (Enhancer.java:546)\n       at net.sf.cglib.proxy.Enhancer.setThreadCallbacks (Enhancer.java:536)\n       at net.sf.cglib.proxy.Enhancer.createUsingReflection ( Enhancer.java:562)\n       at net.sf.cglib.proxy.Enhancer.firstInstance(Enhancer.java:493)\n       at net.sf.cglib.core.AbstractClassGenerator.create (AbstractClassGenerato\nr.java:220)\n       at net.sf.cglib.proxy.Enhancer.createHelper (Enhancer.java:368) \n       at net.sf.cglib.proxy.Enhancer.create(Enhancer.java:280)\n       at net.sf.cglib.proxy.Enhancer.create (Enhancer.java :597)\n       at net.sf.hibernate.proxy.CGLIBLazyInitializer.getProxyFactory(CGLIBLazy\nInitializer.java:74) \n       at net.sf.hibernate.proxy.CGLIBProxyFactory.postInstantiate(CGLIBProxyFa\nctory.java :36)\n       at net.sf.hibernate.persister.AbstractEntityPersister.\u003cinit\u003e(AbstractEnt\nityPersister.java:817)\n       at net.sf.hibernate.persister.EntityPersister.\u003cinit\u003e(EntityPersister.jav\na:690)\n       at net.sf.hibernate.persister.PersisterFactory.createClassPersister(Pers\nisterFactory.java:42)\n       at net.sf.hibernate.impl.SessionFactoryImpl .\u003cinit\u003e(SessionFactoryImpl.ja\nva:137)\n       at net.sf.hibernate.cfg.Configuration.buildSessionFactory (Configuration.\njava:805)\n       at net.sf.hibernate.jmx.HibernateService.buildSessionFactory(HibernateSe \nrvice.java:163)\n       at net.sf.hibernate.jmx.HibernateService.start (HibernateService.java:130\n)\n       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.\njava:39)\n       at sun.reflect.DelegatingMethodAccessorImpl.invoke (DelegatingMethodAcces\nsorImpl.java:25)\n       at java.lang.reflect.Method.invoke(Method.java:585) \n       at org.jboss.mx.server.ReflectedDispatcher.dispatch(ReflectedDispatcher.\njava:60)\n       at org.jboss.mx.server.Invocation.dispatch (Invocation.java:62)\n       at org.jboss.mx.server.Invocation.dispatch(Invocation.java :54)\n       at org.jboss.mx.server.Invocation.invoke(Invocation.java:82)\n       at org.jboss.mx.server.AbstractMBeanInvoker.invoke (AbstractMBeanInvoker. \njava:198)\n       at org.jboss.mx.server.MBeanServerImpl.invoke (MBeanServerImpl.java:473)\n       at org.jboss.system.ServiceController$ServiceProxy.invoke(ServiceControl\nler.java:911)\n       at $Proxy19.start(Unknown Source)\n       at org.jboss.system.ServiceController.start (ServiceController.java:415)\n       at sun.reflect.GeneratedMethodAccessor5.invoke(Unknown Source)\n       at sun.reflect.DelegatingMethodAccessorImpl.invoke (DelegatingMethodAcces \nsorImpl.java:25)\n       at java.lang.reflect.Method.invoke(Method.java:585)\n       at org.jboss.mx.server.ReflectedDispatcher.dispatch(ReflectedDispatcher. \njava:60)\n       at org.jboss.mx.server.Invocation.dispatch (Invocation.java:62)\n       at org.jboss.mx.server.Invocation.dispatch(Invocation.java:54)\n       at org.jboss.mx.server.Invocation.invoke (Invocation.java :82)\n       at org.jboss.mx.server.AbstractMBeanInvoker.invoke (AbstractMBeanInvoker.\njava:198) \n       at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:473)\n       at org.jboss.mx.util.MBeanProxyExt.invoke (MBeanProxyExt.java:176)\n       at $Proxy4.start(Unknown Source) \n       at org.jboss.deployment.SARDeployer.start (SARDeployer.java:251)\n       at org.jboss.deployment.MainDeployer.start(MainDeployer.java:829)\n       at org.jboss.deployment.MainDeployer.start (MainDeployer.java :821)\n       at org.jboss.deployment.MainDeployer.deploy(MainDeployer.java:641)\n       at org.jboss.deployment.MainDeployer.deploy(MainDeployer.java :604)\n       at sun.reflect.GeneratedMethodAccessor34.invoke(Unknown Source) \n       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces\nsorImpl.java:25)\n       at java.lang.reflect.Method.invoke (Method.java:585)\n       at org.jboss.mx.server.ReflectedDispatcher.dispatch (ReflectedDispatcher.\njava:60) \n       at org.jboss.mx.server.Invocation.dispatch(Invocation.java:62)\n       at org.jboss.mx.server.Invocation.dispatch (Invocation.java:54)\n       at org.jboss.mx.server.Invocation.invoke (Invocation.java:82) \n       at org.jboss.mx.server.AbstractMBeanInvoker.invoke (AbstractMBeanInvoker.\njava:198)\n       at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:473) \n       at org.jboss.mx.util.MBeanProxyExt.invoke (MBeanProxyExt.java:176)\n       at $Proxy8.deploy(Unknown Source) \n       at org.jboss.deployment.scanner.URLDeploymentScanner.deploy(URLDeploymen\ntScanner.java:304) \n       at org.jboss.deployment.scanner.URLDeploymentScanner.scan (URLDeploymentS\ncanner.java:478)\n       at org.jboss.deployment.scanner.AbstractDeploymentScanner$ScannerThread .\ndoScan(AbstractDeploymentScanner.java:201) \n       at org.jboss.deployment.scanner.AbstractDeploymentScanner.startService (A\nbstractDeploymentScanner.java:274) \n       at org.jboss.system.ServiceMBeanSupport.jbossInternalStart (ServiceMBeanS\nupport.java:271)\n       at org.jboss.system.ServiceMBeanSupport.jbossInternalLifecycle(ServiceMB \neanSupport.java:221)\n       at sun.reflect.GeneratedMethodAccessor2.invoke(Unknown Source)\n       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces \nsorImpl.java:25)\n       at java.lang.reflect.Method.invoke (Method.java:585)\n       at org.jboss.mx.server.ReflectedDispatcher.dispatch(ReflectedDispatcher.\njava:60)\n       at org.jboss.mx.server.Invocation.dispatch (Invocation.java:62)\n       at org.jboss.mx.server.Invocation.dispatch (Invocation.java:54)\n       at org.jboss.mx.server.Invocation.invoke (Invocation.java:82)\n       at org.jboss.mx.server.AbstractMBeanInvoker.invoke(AbstractMBeanInvoker.\njava:198) \n       at org.jboss.mx.server.MBeanServerImpl.invoke (MBeanServerImpl.java:473)\n       at org.jboss.system.ServiceController$ServiceProxy.invoke (ServiceControl\nler.java:899)\n       at $Proxy0.start(Unknown Source)\n       at org.jboss.system.ServiceController.start (ServiceController.java:415)\n       at sun.reflect.GeneratedMethodAccessor5.invoke(Unknown Source) \n       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces\nsorImpl.java:25)\n       at java.lang.reflect.Method.invoke(Method.java:585)\n       at org.jboss.mx.server.ReflectedDispatcher.dispatch(ReflectedDispatcher. \njava:60)\n       at org.jboss.mx.server.Invocation.dispatch(Invocation.java:62)\n       at org.jboss.mx.server.Invocation.dispatch(Invocation.java:54)\n       at org.jboss.mx.server.Invocation.invoke(Invocation.java :82)\n       at org.jboss.mx.server.AbstractMBeanInvoker.invoke(AbstractMBeanInvoker. \njava:198)\n       at org.jboss.mx.server.MBeanServerImpl.invoke (MBeanServerImpl.java:473)\n       at org.jboss.mx.util.MBeanProxyExt.invoke (MBeanProxyExt.java:176)\n       at $Proxy4.start(Unknown Source) \n       at org.jboss.deployment.SARDeployer.start(SARDeployer.java:251)\n       at org.jboss.deployment.MainDeployer.start (MainDeployer.java:829)\n       at org.jboss.deployment.MainDeployer.deploy(MainDeployer.java :641)\n       at org.jboss.deployment.MainDeployer.deploy(MainDeployer.java:604)\n       at org.jboss.deployment.MainDeployer.deploy(MainDeployer.java :588)\n       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) \n       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl. \njava:39)\n       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces\nsorImpl.java:25)\n       at java.lang.reflect.Method.invoke (Method.java:585)\n       at org.jboss.mx.server.ReflectedDispatcher.dispatch (ReflectedDispatcher.\njava:60)\n       at org.jboss.mx.server.Invocation.dispatch(Invocation.java:62) \n       at org.jboss.mx.server.Invocation.dispatch (Invocation.java:54)\n       at org.jboss.mx.server.Invocation.invoke ( Invocation.java:82)\n       at org.jboss.mx.server.AbstractMBeanInvoker.invoke(AbstractMBeanInvoker. \njava:198) \n       at org.jboss.mx.server.MBeanServerImpl.invoke (MBeanServerImpl.java:473)\n       at org.jboss.mx.util.MBeanProxyExt.invoke (MBeanProxyExt.java:176)\n       at $Proxy5.deploy(Unknown Source)\n       at org.jboss.system.server.ServerImpl.doStart (ServerImpl.java :407)\n       at org.jboss.system.server.ServerImpl.start(ServerImpl.java:311)\n       at org.jboss.Main.boot (Main.java:191)\n       at org.jboss.Main$1.run (Main.java:480)\n       at java.lang.Thread.run(Thread.java :595) \n08:34:53,031 INFO  [HibernateServiceMBean] Could not build SessionFactory using\nthe MBean classpath - will try again using client classpath: CGLIB Enhancement f \nailed \n\nWhat am I doing wrong? \n\nThanks in advance and best regards \nRafael Mauricio Nami",
    "Short term solution for 4.3i1: exclude Hibernate-generated classes from instrumentation.\n\nLong term solution (timeframe unknown): identify and fix the instrumentation problem.\n",
    "Applied short-term solution: all classes with name containing the text \"CGLIB$$\" are excluded from call-graph instrumentation.\n"
  ],
  "commentCreationDates": [
    "2006-08-02T13:32:54+02:00",
    "2006-08-06T09:02:08+02:00",
    "2006-08-30T10:02:55+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.VerifyError",
      "message": "(class: br/com/netservicos/core/bean/so/SoConsumidorMatBe  an$$EnhancerByCGLIB$$b017acd2, method: CGLIB$STATICHOOK1 signature: ()V) Inconsi stent stack height 1 !\u003d 2",
      "elements": [
        {
          "method": "java.lang.Class.getDeclaredMethods0",
          "source": "Native Method"
        },
        {
          "method": "java.lang.Class.privateGetDeclaredMethods",
          "source": "Class.java:2365"
        },
        {
          "method": "java.lang.Class.getDeclaredMethod",
          "source": "Class.java :1907"
        },
        {
          "method": "net.sf.cglib.proxy.Enhancer.getCallbacksSetter",
          "source": "Enhancer.java:558"
        },
        {
          "method": "net.sf.cglib.proxy.Enhancer.setCallbacksHelper",
          "source": "Enhancer.java:546"
        },
        {
          "method": "net.sf.cglib.proxy.Enhancer.setThreadCallbacks",
          "source": "Enhancer.java:536"
        },
        {
          "method": "net.sf.cglib.proxy.Enhancer.createUsingReflection",
          "source": " Enhancer.java:562"
        },
        {
          "method": "net.sf.cglib.proxy.Enhancer.firstInstance",
          "source": "Enhancer.java:493"
        },
        {
          "method": "net.sf.cglib.core.AbstractClassGenerator.create",
          "source": "AbstractClassGenerato r.java:220"
        },
        {
          "method": "net.sf.cglib.proxy.Enhancer.createHelper",
          "source": "Enhancer.java:368"
        },
        {
          "method": "net.sf.cglib.proxy.Enhancer.create",
          "source": "Enhancer.java:280"
        },
        {
          "method": "net.sf.cglib.proxy.Enhancer.create",
          "source": "Enhancer.java :597"
        },
        {
          "method": "net.sf.hibernate.proxy.CGLIBLazyInitializer.getProxyFactory",
          "source": "CGLIBLazy Initializer.java:74"
        },
        {
          "method": "net.sf.hibernate.proxy.CGLIBProxyFactory.postInstantiate",
          "source": "CGLIBProxyFa ctory.java :36"
        },
        {
          "method": "net.sf.hibernate.persister.AbstractEntityPersister.\u003cinit\u003e",
          "source": "AbstractEnt ityPersister.java:817"
        },
        {
          "method": "net.sf.hibernate.persister.EntityPersister.\u003cinit\u003e",
          "source": "EntityPersister.jav a:690"
        },
        {
          "method": "net.sf.hibernate.persister.PersisterFactory.createClassPersister",
          "source": "Pers isterFactory.java:42"
        },
        {
          "method": "net.sf.hibernate.impl.SessionFactoryImpl.\u003cinit\u003e",
          "source": "SessionFactoryImpl.ja va:137"
        },
        {
          "method": "net.sf.hibernate.cfg.Configuration.buildSessionFactory",
          "source": "Configuration. java:805"
        },
        {
          "method": "net.sf.hibernate.jmx.HibernateService.buildSessionFactory",
          "source": "HibernateSe  rvice.java:163"
        },
        {
          "method": "net.sf.hibernate.jmx.HibernateService.start",
          "source": "HibernateService.java:130 "
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl. java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAcces sorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:585"
        },
        {
          "method": "org.jboss.mx.server.ReflectedDispatcher.dispatch",
          "source": "ReflectedDispatcher. java:60"
        },
        {
          "method": "org.jboss.mx.server.Invocation.dispatch",
          "source": "Invocation.java:62"
        },
        {
          "method": "org.jboss.mx.server.Invocation.dispatch",
          "source": "Invocation.java :54"
        },
        {
          "method": "org.jboss.mx.server.Invocation.invoke",
          "source": "Invocation.java:82"
        },
        {
          "method": "org.jboss.mx.server.AbstractMBeanInvoker.invoke",
          "source": "AbstractMBeanInvoker.  java:198"
        },
        {
          "method": "org.jboss.mx.server.MBeanServerImpl.invoke",
          "source": "MBeanServerImpl.java:473"
        },
        {
          "method": "org.jboss.system.ServiceController$ServiceProxy.invoke",
          "source": "ServiceControl ler.java:911"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "152579",
      "date": "2006-08-02T13:32:54+02:00",
      "product": "TPTP Profiling",
      "component": "Platform.Agents.JVMTI",
      "severity": "normal"
    }
  ],
  "groupId": "152579",
  "bugId": "152579",
  "date": "2006-08-02T13:32:54+02:00",
  "product": "TPTP Profiling",
  "component": "Platform.Agents.JVMTI",
  "severity": "normal"
}