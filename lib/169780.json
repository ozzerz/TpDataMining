{
  "comments": [
    "Reference Post:\nhttp://dev.eclipse.org/newslists/news.eclipse.tools.emf/msg21160.html\n\nI am doing a EMF 2.2.1 porting from EMF 2.0.1.\nThe following test case used to pass in EMF 2.0.1 and is now failing with NullPointerException (full error stack appended at the end of the post.) Tested in Eclipse 3.2\n\npublic void testGetsAndSets() {\n  EAnnotation annotation ;\n  annotation \u003d EcoreFactory.eINSTANCE.createEAnnotation();\n  annotation.setSource(\"XTest\");\n  annotation.getDetails().put(\"TEST\", \"true\");\n\n  // Make always test pass untill fix the NullPointerException\n  assertTrue(true);        \n}\n\nI can see that in EMF 2.2.1 (ecore-2.2.1.jar), getDetails method in EAnnotationImpl class has been changed as follows.\n\n\n@@@EMF 2.0.1 @@@\n  public EMap getDetails(){\n....\n      details \u003d new EcoreEMap EcorePackage.eINSTANCE.getEStringToStringMapEntry(), EStringToStringMapEntryImpl.class, this, EcorePackage.EANNOTATION__DETAILS);\n....\n  }\n\n@@@@EMF 2.2.1 @@@@\ndetails \u003d         new EcoreEMap(EcorePackage.Literals.ESTRING_TO_STRING_MAP_ENTRY, EStringToStringMapEntryImpl.class, this, EcorePackage.EANNOTATION__DETAILS)\n\nIn the debug I can see that in EMF 2.2.1 value of entryEClass (i.e first parameter) is null which is not the case in EMF 2.0.1. This is the reason for the nullpoint exception.\n\nThis should be a initialization issue.\n\nAs a temporary work around I have added the package initialization step at the begining and it made the test pass.\n\nEcorePackage.eINSTANCE.eClass();\n\nStill, I beleave EMF should handle annotation initialisation without package initialisation (EMF 2.0.1 behaviour).\n\nReference Post: http://dev.eclipse.org/newslists/news.eclipse.tools.emf/msg21167.html\n\nError stack:\njava.lang.ExceptionInInitializerError\nat org.eclipse.emf.ecore.EcorePackage$Literals.\u003cclinit\u003e(EcorePackage.java:3466)\nat org.eclipse.emf.ecore.impl.EAnnotationImpl.getDetails(EAnnotationImpl.java:162)\nat com.ascential.xmeta.emf.util.XMetaAttributeAnnotationTest.testGetsAndSets(XMetaAttributeAnnotationTest.java:103)\n\nCaused by: java.lang.NullPointerException\nat org.eclipse.emf.ecore.util.EcoreEMap.newEntry(EcoreEMap.java:152)\nat org.eclipse.emf.common.util.BasicEMap.put(BasicEMap.java:571)\nat org.eclipse.emf.ecore.impl.EPackageImpl.addAnnotation(EPackageImpl.java:1305)\nat org.eclipse.emf.ecore.impl.EcorePackageImpl.createExtendedMetaDataAnnotations(EcorePackageImpl.java:2111)\nat org.eclipse.emf.ecore.impl.EcorePackageImpl.internalBootstrap(EcorePackageImpl.java:482)\nat org.eclipse.emf.ecore.EcorePackage.\u003cclinit\u003e(EcorePackage.java:4479)\n... 20 more",
    "The fix is in CVS.",
    "Fixed in M200701110000."
  ],
  "commentCreationDates": [
    "2007-01-07T10:34:55+01:00",
    "2007-01-09T06:19:19+01:00",
    "2007-01-12T16:30:39+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ExceptionInInitializerError",
      "elements": [
        {
          "method": "org.eclipse.emf.ecore.EcorePackage$Literals.\u003cclinit\u003e",
          "source": "EcorePackage.java:3466"
        },
        {
          "method": "org.eclipse.emf.ecore.impl.EAnnotationImpl.getDetails",
          "source": "EAnnotationImpl.java:162"
        },
        {
          "method": "com.ascential.xmeta.emf.util.XMetaAttributeAnnotationTest.testGetsAndSets",
          "source": "XMetaAttributeAnnotationTest.java:103"
        }
      ],
      "causedBy": {
        "exceptionType": "java.lang.NullPointerException",
        "elements": [
          {
            "method": "org.eclipse.emf.ecore.util.EcoreEMap.newEntry",
            "source": "EcoreEMap.java:152"
          },
          {
            "method": "org.eclipse.emf.common.util.BasicEMap.put",
            "source": "BasicEMap.java:571"
          },
          {
            "method": "org.eclipse.emf.ecore.impl.EPackageImpl.addAnnotation",
            "source": "EPackageImpl.java:1305"
          },
          {
            "method": "org.eclipse.emf.ecore.impl.EcorePackageImpl.createExtendedMetaDataAnnotations",
            "source": "EcorePackageImpl.java:2111"
          },
          {
            "method": "org.eclipse.emf.ecore.impl.EcorePackageImpl.internalBootstrap",
            "source": "EcorePackageImpl.java:482"
          },
          {
            "method": "org.eclipse.emf.ecore.EcorePackage.\u003cclinit\u003e",
            "source": "EcorePackage.java:4479"
          }
        ],
        "number": 0,
        "commentIndex": 0
      },
      "number": 0,
      "commentIndex": 0,
      "bugId": "169780",
      "date": "2007-01-07T10:34:55+01:00",
      "product": "EMF",
      "component": "Core",
      "severity": "minor"
    }
  ],
  "groupId": "169780",
  "bugId": "169780",
  "date": "2007-01-07T10:34:55+01:00",
  "product": "EMF",
  "component": "Core",
  "severity": "minor"
}