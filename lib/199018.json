{
  "comments": [
    "package p;\npublic class Test3 {\n}\n\npackage test;\npublic class Test2 {\n}\n\nOpen Test3 in your Editor and drag the PackageDeclaration p to Test2. The Packagedeclaration is removed from Test2 but not inserted into Test3. The following Stacktrace appears in the log:\nError\nTue Aug 07 10:39:59 CEST 2007\nProblems occurred when invoking code from plug-in: \"org.eclipse.core.commands\".\n\njava.lang.ArrayStoreException: org.eclipse.jdt.internal.core.PackageDeclaration\nat org.eclipse.jdt.internal.core.refactoring.descriptors.JavaRefactoringDescriptorUtil.getJavaElementArray(JavaRefactoringDescriptorUtil.java:291)\nat org.eclipse.jdt.core.refactoring.descriptors.MoveDescriptor.\u003cinit\u003e(MoveDescriptor.java:181)\nat org.eclipse.jdt.internal.corext.refactoring.reorg.ReorgPolicyFactory$MoveSubCuElementsPolicy.createRefactoringDescriptor(ReorgPolicyFactory.java:2101)\nat org.eclipse.jdt.internal.corext.refactoring.reorg.ReorgPolicyFactory$SubCuElementReorgPolicy.getDescriptor(ReorgPolicyFactory.java:3602)\nat org.eclipse.jdt.internal.corext.refactoring.reorg.JavaMoveProcessor$1.getDescriptor(JavaMoveProcessor.java:124)\nat org.eclipse.ltk.core.refactoring.CompositeChange.getDescriptor(CompositeChange.java:483)\nat org.eclipse.ltk.internal.core.refactoring.history.RefactoringHistoryService$RefactoringOperationHistoryListener.historyNotification(RefactoringHistoryService.java:433)\nat org.eclipse.core.commands.operations.DefaultOperationHistory$2.run(DefaultOperationHistory.java:929)\nat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\nat org.eclipse.core.commands.operations.DefaultOperationHistory.notifyListeners(DefaultOperationHistory.java:918)\nat org.eclipse.core.commands.operations.DefaultOperationHistory.notifyAboutToExecute(DefaultOperationHistory.java:941)\nat org.eclipse.core.commands.operations.DefaultOperationHistory.openOperation(DefaultOperationHistory.java:1321)\nat org.eclipse.ltk.internal.core.refactoring.UndoManager2.aboutToPerformChange(UndoManager2.java:139)\nat org.eclipse.ltk.core.refactoring.PerformChangeOperation$1.run(PerformChangeOperation.java:254)\nat org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1797)\nat org.eclipse.ltk.core.refactoring.PerformChangeOperation.executeChange(PerformChangeOperation.java:306)\nat org.eclipse.ltk.internal.ui.refactoring.UIPerformChangeOperation.executeChange(UIPerformChangeOperation.java:109)\nat org.eclipse.ltk.core.refactoring.PerformChangeOperation.run(PerformChangeOperation.java:223)\nat org.eclipse.jdt.internal.ui.refactoring.RefactoringExecutionHelper$Operation.run(RefactoringExecutionHelper.java:101)\nat org.eclipse.jdt.internal.core.BatchOperation.executeOperation(BatchOperation.java:39)\nat org.eclipse.jdt.internal.core.JavaModelOperation.run(JavaModelOperation.java:720)\nat org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1797)\nat org.eclipse.jdt.core.JavaCore.run(JavaCore.java:4466)\nat org.eclipse.jdt.internal.ui.actions.WorkbenchRunnableAdapter.run(WorkbenchRunnableAdapter.java:87)\nat org.eclipse.jface.operation.ModalContext.runInCurrentThread(ModalContext.java:369)\nat org.eclipse.jface.operation.ModalContext.run(ModalContext.java:313)\nat org.eclipse.jface.window.ApplicationWindow$1.run(ApplicationWindow.java:758)\nat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:67)\nat org.eclipse.jface.window.ApplicationWindow.run(ApplicationWindow.java:755)\nat org.eclipse.ui.internal.WorkbenchWindow.run(WorkbenchWindow.java:2451)\nat org.eclipse.jdt.internal.ui.refactoring.RefactoringExecutionHelper.perform(RefactoringExecutionHelper.java:178)\nat org.eclipse.jdt.internal.ui.refactoring.reorg.ReorgMoveStarter.run(ReorgMoveStarter.java:71)\nat org.eclipse.jdt.internal.ui.packageview.SelectionTransferDropAdapter.handleDropMove(SelectionTransferDropAdapter.java:249)\nat org.eclipse.jdt.internal.ui.packageview.SelectionTransferDropAdapter.performDrop(SelectionTransferDropAdapter.java:190)\nat org.eclipse.jdt.internal.ui.dnd.JdtViewerDropAdapter.drop(JdtViewerDropAdapter.java:242)\nat org.eclipse.jface.util.DelegatingDropAdapter$3.run(DelegatingDropAdapter.java:211)\nat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\nat org.eclipse.core.runtime.Platform.run(Platform.java:857)\nat org.eclipse.ui.internal.JFaceUtil$1.run(JFaceUtil.java:46)\nat org.eclipse.jface.util.SafeRunnable.run(SafeRunnable.java:193)\nat org.eclipse.jface.util.DelegatingDropAdapter.drop(DelegatingDropAdapter.java:209)\nat org.eclipse.swt.dnd.DNDListener.handleEvent(DNDListener.java:90)\nat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\nat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:938)\nat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:962)\nat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:947)\nat org.eclipse.swt.widgets.Widget.notifyListeners(Widget.java:706)\nat org.eclipse.swt.dnd.DropTarget.Drop(DropTarget.java:451)\nat org.eclipse.swt.dnd.DropTarget$3.method6(DropTarget.java:253)\nat org.eclipse.swt.internal.ole.win32.COMObject.callback6(COMObject.java:119)\nat org.eclipse.swt.internal.ole.win32.COM.DoDragDrop(Native Method)\nat org.eclipse.swt.dnd.DragSource.drag(DragSource.java:322)\nat org.eclipse.swt.dnd.DragSource.access$0(DragSource.java:282)\nat org.eclipse.swt.dnd.DragSource$1.handleEvent(DragSource.java:166)\nat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\nat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:938)\nat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3708)\nat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3319)\nat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:2389)\nat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:2353)\nat org.eclipse.ui.internal.Workbench.access$4(Workbench.java:2219)\nat org.eclipse.ui.internal.Workbench$4.run(Workbench.java:466)\nat org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:289)\nat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:461)\nat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)\nat org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:106)\nat org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:169)\nat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:106)\nat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:76)\nat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:363)\nat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:176)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\nat java.lang.reflect.Method.invoke(Unknown Source)\nat org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:508)\nat org.eclipse.equinox.launcher.Main.basicRun(Main.java:447)\nat org.eclipse.equinox.launcher.Main.run(Main.java:1173)\nat org.eclipse.equinox.launcher.Main.main(Main.java:1148)",
    "The problem seems to be that IPackageDeclaration is not an IMember which is expected for fMembers.",
    "No exception in 3.3 but the decl is also not added to Test2. This is a pretty useless reorg...\n\nProblem is that the reorg policy is move member, but IPackageDeclaration is not a member...",
    "The reason you don\u0027t see an exception in 3.3 is that descriptors were written without validation and the invalid descriptors only became visible when running using apply script. I would simply remove this case as I can\u0027t see how it would be useful to anyone.",
    "Also for IImportContainer and IImportDeclaration.\n\nJust disable it, should be trivial.",
    "Created an attachment (id\u003d75654)\nfix\n\nAllow to reorg members and import declarations. Reorg import declarations allows to \u0027organize imports\u0027 from hand in the outline view, which might be a useful feature whereas reorg import containers and package declarations has no purpose and will be disabled.",
    "fixed \u003e I20070807-0010",
    "Oops, I should have run the tests...",
    "Created an attachment (id\u003d75663)\nfix\n\nFix the test failures.",
    "fixed \u003e I20070807-0010",
    "start verification...",
    "verified in I20070808-1800\n\nOne glitch: Bug 199374 "
  ],
  "commentCreationDates": [
    "2007-08-07T10:46:47+02:00",
    "2007-08-07T10:52:56+02:00",
    "2007-08-07T11:26:30+02:00",
    "2007-08-07T11:57:36+02:00",
    "2007-08-07T17:17:46+02:00",
    "2007-08-08T12:19:10+02:00",
    "2007-08-08T12:22:40+02:00",
    "2007-08-08T14:50:33+02:00",
    "2007-08-08T14:55:02+02:00",
    "2007-08-08T14:56:01+02:00",
    "2007-08-09T10:20:01+02:00",
    "2007-08-09T10:32:32+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ArrayStoreException",
      "message": "org.eclipse.jdt.internal.core.PackageDeclaration",
      "elements": [
        {
          "method": "org.eclipse.jdt.internal.core.refactoring.descriptors.JavaRefactoringDescriptorUtil.getJavaElementArray",
          "source": "JavaRefactoringDescriptorUtil.java:291"
        },
        {
          "method": "org.eclipse.jdt.core.refactoring.descriptors.MoveDescriptor.\u003cinit\u003e",
          "source": "MoveDescriptor.java:181"
        },
        {
          "method": "org.eclipse.jdt.internal.corext.refactoring.reorg.ReorgPolicyFactory$MoveSubCuElementsPolicy.createRefactoringDescriptor",
          "source": "ReorgPolicyFactory.java:2101"
        },
        {
          "method": "org.eclipse.jdt.internal.corext.refactoring.reorg.ReorgPolicyFactory$SubCuElementReorgPolicy.getDescriptor",
          "source": "ReorgPolicyFactory.java:3602"
        },
        {
          "method": "org.eclipse.jdt.internal.corext.refactoring.reorg.JavaMoveProcessor$1.getDescriptor",
          "source": "JavaMoveProcessor.java:124"
        },
        {
          "method": "org.eclipse.ltk.core.refactoring.CompositeChange.getDescriptor",
          "source": "CompositeChange.java:483"
        },
        {
          "method": "org.eclipse.ltk.internal.core.refactoring.history.RefactoringHistoryService$RefactoringOperationHistoryListener.historyNotification",
          "source": "RefactoringHistoryService.java:433"
        },
        {
          "method": "org.eclipse.core.commands.operations.DefaultOperationHistory$2.run",
          "source": "DefaultOperationHistory.java:929"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.core.commands.operations.DefaultOperationHistory.notifyListeners",
          "source": "DefaultOperationHistory.java:918"
        },
        {
          "method": "org.eclipse.core.commands.operations.DefaultOperationHistory.notifyAboutToExecute",
          "source": "DefaultOperationHistory.java:941"
        },
        {
          "method": "org.eclipse.core.commands.operations.DefaultOperationHistory.openOperation",
          "source": "DefaultOperationHistory.java:1321"
        },
        {
          "method": "org.eclipse.ltk.internal.core.refactoring.UndoManager2.aboutToPerformChange",
          "source": "UndoManager2.java:139"
        },
        {
          "method": "org.eclipse.ltk.core.refactoring.PerformChangeOperation$1.run",
          "source": "PerformChangeOperation.java:254"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1797"
        },
        {
          "method": "org.eclipse.ltk.core.refactoring.PerformChangeOperation.executeChange",
          "source": "PerformChangeOperation.java:306"
        },
        {
          "method": "org.eclipse.ltk.internal.ui.refactoring.UIPerformChangeOperation.executeChange",
          "source": "UIPerformChangeOperation.java:109"
        },
        {
          "method": "org.eclipse.ltk.core.refactoring.PerformChangeOperation.run",
          "source": "PerformChangeOperation.java:223"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.refactoring.RefactoringExecutionHelper$Operation.run",
          "source": "RefactoringExecutionHelper.java:101"
        },
        {
          "method": "org.eclipse.jdt.internal.core.BatchOperation.executeOperation",
          "source": "BatchOperation.java:39"
        },
        {
          "method": "org.eclipse.jdt.internal.core.JavaModelOperation.run",
          "source": "JavaModelOperation.java:720"
        },
        {
          "method": "org.eclipse.core.internal.resources.Workspace.run",
          "source": "Workspace.java:1797"
        },
        {
          "method": "org.eclipse.jdt.core.JavaCore.run",
          "source": "JavaCore.java:4466"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.actions.WorkbenchRunnableAdapter.run",
          "source": "WorkbenchRunnableAdapter.java:87"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext.runInCurrentThread",
          "source": "ModalContext.java:369"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext.run",
          "source": "ModalContext.java:313"
        },
        {
          "method": "org.eclipse.jface.window.ApplicationWindow$1.run",
          "source": "ApplicationWindow.java:758"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:67"
        },
        {
          "method": "org.eclipse.jface.window.ApplicationWindow.run",
          "source": "ApplicationWindow.java:755"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchWindow.run",
          "source": "WorkbenchWindow.java:2451"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.refactoring.RefactoringExecutionHelper.perform",
          "source": "RefactoringExecutionHelper.java:178"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.refactoring.reorg.ReorgMoveStarter.run",
          "source": "ReorgMoveStarter.java:71"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.packageview.SelectionTransferDropAdapter.handleDropMove",
          "source": "SelectionTransferDropAdapter.java:249"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.packageview.SelectionTransferDropAdapter.performDrop",
          "source": "SelectionTransferDropAdapter.java:190"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.dnd.JdtViewerDropAdapter.drop",
          "source": "JdtViewerDropAdapter.java:242"
        },
        {
          "method": "org.eclipse.jface.util.DelegatingDropAdapter$3.run",
          "source": "DelegatingDropAdapter.java:211"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.core.runtime.Platform.run",
          "source": "Platform.java:857"
        },
        {
          "method": "org.eclipse.ui.internal.JFaceUtil$1.run",
          "source": "JFaceUtil.java:46"
        },
        {
          "method": "org.eclipse.jface.util.SafeRunnable.run",
          "source": "SafeRunnable.java:193"
        },
        {
          "method": "org.eclipse.jface.util.DelegatingDropAdapter.drop",
          "source": "DelegatingDropAdapter.java:209"
        },
        {
          "method": "org.eclipse.swt.dnd.DNDListener.handleEvent",
          "source": "DNDListener.java:90"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:938"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:962"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:947"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.notifyListeners",
          "source": "Widget.java:706"
        },
        {
          "method": "org.eclipse.swt.dnd.DropTarget.Drop",
          "source": "DropTarget.java:451"
        },
        {
          "method": "org.eclipse.swt.dnd.DropTarget$3.method6",
          "source": "DropTarget.java:253"
        },
        {
          "method": "org.eclipse.swt.internal.ole.win32.COMObject.callback6",
          "source": "COMObject.java:119"
        },
        {
          "method": "org.eclipse.swt.internal.ole.win32.COM.DoDragDrop",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.dnd.DragSource.drag",
          "source": "DragSource.java:322"
        },
        {
          "method": "org.eclipse.swt.dnd.DragSource.access$0",
          "source": "DragSource.java:282"
        },
        {
          "method": "org.eclipse.swt.dnd.DragSource$1.handleEvent",
          "source": "DragSource.java:166"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:938"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:3708"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:3319"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:2389"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:2353"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.access$4",
          "source": "Workbench.java:2219"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$4.run",
          "source": "Workbench.java:466"
        },
        {
          "method": "org.eclipse.core.databinding.observable.Realm.runWithDefault",
          "source": "Realm.java:289"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:461"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "org.eclipse.ui.internal.ide.application.IDEApplication.start",
          "source": "IDEApplication.java:106"
        },
        {
          "method": "org.eclipse.equinox.internal.app.EclipseAppHandle.run",
          "source": "EclipseAppHandle.java:169"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:106"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:76"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:363"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:176"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.invokeFramework",
          "source": "Main.java:508"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.basicRun",
          "source": "Main.java:447"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.run",
          "source": "Main.java:1173"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.main",
          "source": "Main.java:1148"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "199018",
      "date": "2007-08-07T10:46:47+02:00",
      "product": "JDT",
      "component": "UI",
      "severity": "normal"
    }
  ],
  "groupId": "199018",
  "bugId": "199018",
  "date": "2007-08-07T10:46:47+02:00",
  "product": "JDT",
  "component": "UI",
  "severity": "normal"
}