{
  "comments": [
    "Since Eclipse 3.2M4 (it works unchanged with Eclipse 3.1.1), the DeferredContentProvider does not work as expected in my JFace dialog. Instead, an IllegalThreadStateException occures when a TableViewer\u0027s input is set in method \"createDialogArea\" of my \"TitleAreaDialog\" (see stack trace at the very end of this description).\n\nThe source code that throws this exception is in method \"makeDirty\" in class BackgroundContentProvider. This method is called twice when the input of a TableViewer with a DeferredContentProvider changes (on \"setLimit\" and on \"setFilter\" in method \"inputChanged\").\n\"makeDirty\" starts the sortThread - so when this method is called for the second time, the sortThread has already been started and maybe it has already terminated. In either case, makeDirty waits for the sortThread to die (sortThread.join()) before starting it. But according to the JDK API Specs, it is illegal to start a thread twice! This seems to cause the IllegalThreadStateException! (See code and exception below)\nSo even if I made a mistake somewhere in my code, in my point of view, \"makeDirty\" is not correctly implemented.\n\n\u003ccode\u003e\nprivate void makeDirty() {\n    sortMon.cancel();\n    // make sure the sort thread is not running\n    try {\n        sortThread.join();\n    } catch (InterruptedException e) {\n        Thread.currentThread().interrupt();\n    }\n/* MW: Create a new Thread object here??? */\n    sortThread.start();\n}\n\u003c/code\u003e\n\n\u003cexception\u003e\njava.lang.IllegalThreadStateException\n\tat java.lang.Thread.start(Unknown Source)\n\tat org.eclipse.jface.viewers.deferred.BackgroundContentProvider.makeDirty(BackgroundContentProvider.java:460)\n\tat org.eclipse.jface.viewers.deferred.BackgroundContentProvider.setContents(BackgroundContentProvider.java:490)\n\tat org.eclipse.jface.viewers.deferred.BackgroundContentProvider.access$2(BackgroundContentProvider.java:488)\n\tat org.eclipse.jface.viewers.deferred.BackgroundContentProvider$1.setContents(BackgroundContentProvider.java:110)\n\tat com.dgr.profi.stamm.ui.dialogs.StammdatenSearchDialog$ListConcurrentModel.requestUpdate(StammdatenSearchDialog.java:50)\n\tat org.eclipse.jface.viewers.deferred.BackgroundContentProvider.refresh(BackgroundContentProvider.java:174)\n\tat org.eclipse.jface.viewers.deferred.BackgroundContentProvider.setFilter(BackgroundContentProvider.java:406)\n\tat org.eclipse.jface.viewers.deferred.DeferredContentProvider.inputChanged(DeferredContentProvider.java:149)\n\tat org.eclipse.jface.viewers.ContentViewer.setInput(ContentViewer.java:245)\n\tat org.eclipse.jface.viewers.StructuredViewer.setInput(StructuredViewer.java:1417)\n\tat com.dgr.profi.stamm.ui.dialogs.KundeSearchDialog.createResultArea(KundeSearchDialog.java:196)\n\tat com.dgr.profi.stamm.ui.dialogs.StammdatenSearchDialog.createContentArea(StammdatenSearchDialog.java:98)\n\tat com.dgr.profi.ui.dialogs.RunnableContextDialog.createDialogArea(RunnableContextDialog.java:138)\n\tat org.eclipse.jface.dialogs.TitleAreaDialog.createContents(TitleAreaDialog.java:157)\n\tat org.eclipse.jface.window.Window.create(Window.java:417)\n\tat org.eclipse.jface.dialogs.Dialog.create(Dialog.java:1051)\n\tat org.eclipse.jface.window.Window.open(Window.java:775)\n\tat com.dgr.profi.stamm.internal.ui.ShowKundenSearchDialog.run(ShowKundenSearchDialog.java:38)\n\tat org.eclipse.ui.internal.PluginAction.runWithEvent(PluginAction.java:251)\n...more lines skipped...\n\u003c/exception\u003e",
    "Created an attachment (id\u003d32390)\nPatch for BackgroundContentProvider\n\nThis patch starts a new Thread each time \"makeDirty\" is called (and stops a previously started sortThread).\n(I hope I\u0027ve used the correct revision for this patch)",
    "Mario, thanks a lot for finding this and providing a patch. Unfortunately, the patch seems to be incomplete. Could you try to generate a patch again (using \"Team-\u003eCreate Patch...\")? Thanks!",
    "Created an attachment (id\u003d33454)\nNew patch for BackgroundContentProvider.java\n\nI\u0027ve tried to create a new patch for BackgroundContentProvider.\nHope it works now!",
    "*** Bug 127484 has been marked as a duplicate of this bug. ***",
    "Fix released \u003e20060213. Patrick, please let me know if this works for you.",
    "I just tried it, and it works perfectly. Thanks for taking care of this so quickly.",
    "Created an attachment (id\u003d34688)\nUpdating UI more eagerly\n\nBoris, I am pretty happy with the fix you provided, but there is one thing I noticed: \nThe BackgroundContentProvider tries to work off all changes in the queue before trying to update the UI. This has advantages and disadvantages, of course. The disadvantage in my case is that the initial UI response is rather slow, because there are a couple of small and fast additions to the queue in the beginning, followed by slower and bigger additions towards the end. \n\nThe attached patch changes this behaviour to working off one change from the queue, followed by a UI update. The disadvantage in this case is that there are more (potentially unnecessary) UI updates. So a change like this needs maybe more discussion.\n\nI my case, lowering the priority of thread that delivers the data to the queue circumvents the problem to a great extent, so this is not an urgent issue (but considering this new patch for M6 would be nice).",
    "Patrick, could you please open a new bug for the enhancement request? You may assign it to me and set the target milestone to M6. Also note that there are unresolved issues with BackgroundContentProvider, for example bug 92238.",
    "Verified by Patrick."
  ],
  "commentCreationDates": [
    "2006-01-02T17:15:50+01:00",
    "2006-01-02T17:57:58+01:00",
    "2006-01-19T19:12:01+01:00",
    "2006-01-23T12:09:13+01:00",
    "2006-02-13T17:50:09+01:00",
    "2006-02-13T19:00:31+01:00",
    "2006-02-14T08:27:41+01:00",
    "2006-02-14T16:58:40+01:00",
    "2006-02-14T17:05:04+01:00",
    "2006-02-14T17:05:38+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.IllegalThreadStateException",
      "elements": [
        {
          "method": "java.lang.Thread.start",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.jface.viewers.deferred.BackgroundContentProvider.makeDirty",
          "source": "BackgroundContentProvider.java:460"
        },
        {
          "method": "org.eclipse.jface.viewers.deferred.BackgroundContentProvider.setContents",
          "source": "BackgroundContentProvider.java:490"
        },
        {
          "method": "org.eclipse.jface.viewers.deferred.BackgroundContentProvider.access$2",
          "source": "BackgroundContentProvider.java:488"
        },
        {
          "method": "org.eclipse.jface.viewers.deferred.BackgroundContentProvider$1.setContents",
          "source": "BackgroundContentProvider.java:110"
        },
        {
          "method": "com.dgr.profi.stamm.ui.dialogs.StammdatenSearchDialog$ListConcurrentModel.requestUpdate",
          "source": "StammdatenSearchDialog.java:50"
        },
        {
          "method": "org.eclipse.jface.viewers.deferred.BackgroundContentProvider.refresh",
          "source": "BackgroundContentProvider.java:174"
        },
        {
          "method": "org.eclipse.jface.viewers.deferred.BackgroundContentProvider.setFilter",
          "source": "BackgroundContentProvider.java:406"
        },
        {
          "method": "org.eclipse.jface.viewers.deferred.DeferredContentProvider.inputChanged",
          "source": "DeferredContentProvider.java:149"
        },
        {
          "method": "org.eclipse.jface.viewers.ContentViewer.setInput",
          "source": "ContentViewer.java:245"
        },
        {
          "method": "org.eclipse.jface.viewers.StructuredViewer.setInput",
          "source": "StructuredViewer.java:1417"
        },
        {
          "method": "com.dgr.profi.stamm.ui.dialogs.KundeSearchDialog.createResultArea",
          "source": "KundeSearchDialog.java:196"
        },
        {
          "method": "com.dgr.profi.stamm.ui.dialogs.StammdatenSearchDialog.createContentArea",
          "source": "StammdatenSearchDialog.java:98"
        },
        {
          "method": "com.dgr.profi.ui.dialogs.RunnableContextDialog.createDialogArea",
          "source": "RunnableContextDialog.java:138"
        },
        {
          "method": "org.eclipse.jface.dialogs.TitleAreaDialog.createContents",
          "source": "TitleAreaDialog.java:157"
        },
        {
          "method": "org.eclipse.jface.window.Window.create",
          "source": "Window.java:417"
        },
        {
          "method": "org.eclipse.jface.dialogs.Dialog.create",
          "source": "Dialog.java:1051"
        },
        {
          "method": "org.eclipse.jface.window.Window.open",
          "source": "Window.java:775"
        },
        {
          "method": "com.dgr.profi.stamm.internal.ui.ShowKundenSearchDialog.run",
          "source": "ShowKundenSearchDialog.java:38"
        },
        {
          "method": "org.eclipse.ui.internal.PluginAction.runWithEvent",
          "source": "PluginAction.java:251"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "122457",
      "date": "2006-01-02T17:15:50+01:00",
      "product": "Platform",
      "component": "UI",
      "severity": "major"
    }
  ],
  "groupId": "122457",
  "bugId": "122457",
  "date": "2006-01-02T17:15:50+01:00",
  "product": "Platform",
  "component": "UI",
  "severity": "major"
}