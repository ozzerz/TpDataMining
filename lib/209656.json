{
  "comments": [
    "After working a while with 3 SSH-Terminals under Eclipse-3.4M3, I\u0027m starting to see CPU repeatedly go to 100% in Eclipse and following ClassCastExceptions in the Log.\nI\u0027ve never seen these under Eclipse-3.3 but keep seeing them under 3.4M3.\n\njava.lang.ClassCastException: org.eclipse.ui.actions.ActionFactory$WorkbenchCommandAction cannot be cast to org.eclipse.ui.actions.RetargetAction\n\tat org.eclipse.tm.internal.terminal.view.TerminalView$TerminalMenuHandlerEdit.menuHidden(TerminalView.java:680)\n\tat org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:144)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:947)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:971)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:952)\n\tat org.eclipse.swt.widgets.Control.WM_INITMENUPOPUP(Control.java:4075)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3800)\n\tat org.eclipse.swt.widgets.Canvas.windowProc(Canvas.java:334)\n\tat org.eclipse.swt.widgets.Decorations.windowProc(Decorations.java:1559)\n\tat org.eclipse.swt.widgets.Shell.windowProc(Shell.java:1880)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:4423)\n\tat org.eclipse.swt.internal.win32.OS.TrackPopupMenu(Native Method)\n\tat org.eclipse.swt.widgets.Menu._setVisible(Menu.java:230)\n\tat org.eclipse.swt.widgets.Display.runPopups(Display.java:3770)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3349)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:2395)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:2359)\n\tat org.eclipse.ui.internal.Workbench.access$4(Workbench.java:2225)\n\tat org.eclipse.ui.internal.Workbench$4.run(Workbench.java:468)\n\tat org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:288)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:463)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)\n\tat org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:106)\n\tat org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:193)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:106)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:76)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:362)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:175)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\n\n-----------Enter bugs above this line-----------\nTM 3.0M3 Testing\ninstallation : eclipse-SDK-3.4M3-win32, cdt-5.0.0M3, emf-sdo-xsd-2.4.0M3\n     Download RSE-I20071108-0100: RSE-SDK,tests,discovery,terminal,remotecdt\njava.runtime : Sun 1.5.0_11-b03, mixed mode\nos.name:     : Windows XP 5.1, Service Pack 1\n------------------------------------------------\nsystemtype   : Linux-local / Windows-dstore (Daemon) / Unix-dstore (RExec)\ntargetos1    : Linux RHEL4, Sun 1.5.0_11\ntargetos2    : Windows XP SP1, Sun 1.5.0_11\ntargetos3    : Solaris-sparc 5.9, Sun 1.4.2_05\ntargetuname  : SunOS szg-anar 5.9 Generic_118558-06 sun4u sparc SUNW,Sun-Blade-1500\n------------------------------------------------",
    "This issue is probably related to bug 209662, which would make it a major issue",
    "Created an attachment (id\u003d82838)\nA patch t fix the problem\n\nIt seems that there is quite some code in the TerminalView to deal with redirecting shortcuts from the menu to the terminal. I think most of this code is obsolete, because the terminal does not use StyledText anymore. I also think that bug 189774 is related to the redirection of the keyboard events. Unfortunately, elimination most of the code has strange side effects either on linux or on windows. I tested 4 combinations:\n3.3/3.4M3 and linux-gtk/windows. This is a refactoring that essentially checks if the casts are ok.",
    "Created an attachment (id\u003d82839)\nmylyn/context/zip\n\n",
    "I\u0027ve seen this issue again, and if it\u0027s really the cause for bug 209662 then it\u0027s major because it makes Eclipse-3.4M3 pretty unusable when the Terminal is being used!\n\nI\u0027m wondering how safe this patch is, and if I can include it in 3.0M3 ?\n\nBefore the patch, the menuMgr and actionContributionItem were separately computed during menuAboutToShow() and menuHidden().\n\nWith the patch, the menuHidden() action now re-uses the actionContributionItem that was computed during menuAboutToShow(). Can we know for sure that these calls always happen alternatively with the same menuMgr?\n\nWhat if a hierarchy of submenus is being opened -- we\u0027d get menuAboutToShow() with several different menuMgrs, but upon the first menuHidden() the previous stack would be forgotten... is this OK?\n",
    "Also, apparently in 3.4M3 some actions are of type ActionFactory$WorkbenchCommandAction -- can we know for sure that these do not need to be processed?\n\nI do not think that we need to verify the patched code against Eclipse 3.3.x since the TM 3.0 stream will never be expected to run on 3.3.x (only on 3.4)",
    "Applied the patch and released for 3.0M3.\n\nThe patch is not optimal, and the whole code around AcceleratorDisabler should be removed. This will be done when working on bug 189774: exchange of global action handlers should no longer be necessary, especially when getting rid of the old terminal implementation completely (bug 209818)."
  ],
  "commentCreationDates": [
    "2007-11-13T16:14:27+01:00",
    "2007-11-13T17:16:03+01:00",
    "2007-11-14T05:45:09+01:00",
    "2007-11-14T05:45:14+01:00",
    "2007-11-14T11:57:52+01:00",
    "2007-11-14T12:33:16+01:00",
    "2007-11-14T15:24:23+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ClassCastException",
      "message": "org.eclipse.ui.actions.ActionFactory$WorkbenchCommandAction cannot be cast to org.eclipse.ui.actions.RetargetAction",
      "elements": [
        {
          "method": "org.eclipse.tm.internal.terminal.view.TerminalView$TerminalMenuHandlerEdit.menuHidden",
          "source": "TerminalView.java:680"
        },
        {
          "method": "org.eclipse.swt.widgets.TypedListener.handleEvent",
          "source": "TypedListener.java:144"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:947"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:971"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:952"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.WM_INITMENUPOPUP",
          "source": "Control.java:4075"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3800"
        },
        {
          "method": "org.eclipse.swt.widgets.Canvas.windowProc",
          "source": "Canvas.java:334"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.windowProc",
          "source": "Decorations.java:1559"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.windowProc",
          "source": "Shell.java:1880"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:4423"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.TrackPopupMenu",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.widgets.Menu._setVisible",
          "source": "Menu.java:230"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runPopups",
          "source": "Display.java:3770"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:3349"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:2395"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:2359"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.access$4",
          "source": "Workbench.java:2225"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$4.run",
          "source": "Workbench.java:468"
        },
        {
          "method": "org.eclipse.core.databinding.observable.Realm.runWithDefault",
          "source": "Realm.java:288"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:463"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "org.eclipse.ui.internal.ide.application.IDEApplication.start",
          "source": "IDEApplication.java:106"
        },
        {
          "method": "org.eclipse.equinox.internal.app.EclipseAppHandle.run",
          "source": "EclipseAppHandle.java:193"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:106"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:76"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:362"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:175"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:597"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "209656",
      "date": "2007-11-13T16:14:27+01:00",
      "product": "Target Management",
      "component": "Terminal",
      "severity": "major"
    }
  ],
  "groupId": "209656",
  "bugId": "209656",
  "date": "2007-11-13T16:14:27+01:00",
  "product": "Target Management",
  "component": "Terminal",
  "severity": "major"
}