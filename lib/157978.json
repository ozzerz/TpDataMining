{
  "comments": [
    "There were 5 test errors in the dynamic tests on Linux-GTK with Sun 1.5.0 JVM:\n\ntestActionSets, testActionSetPartAssociations, testViewerContributions, testObjectContribtions, testClass\n\nThey all failed in the DynamicTestCase#doTearDown().\n\n4 of them failed with:\nFailed to execute runnable (java.lang.NullPointerException)\n\norg.eclipse.swt.SWTException: Failed to execute runnable (java.lang.NullPointerException)\nat org.eclipse.swt.SWT.error(SWT.java:3407)\nat org.eclipse.swt.SWT.error(SWT.java:3330)\nat org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:126)\nat org.eclipse.swt.widgets.Display.runAsyncMessages(Display.java:3180)\nat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2882)\nat org.eclipse.ui.tests.harness.util.UITestCase.processEvents(UITestCase.java:222)\nat org.eclipse.ui.tests.dynamicplugins.DynamicTestCase.removeBundle(DynamicTestCase.java:234)\nat org.eclipse.ui.tests.dynamicplugins.DynamicTestCase.doTearDown(DynamicTestCase.java:61)\nat org.eclipse.ui.tests.harness.util.UITestCase.tearDown(UITestCase.java:203)\nat org.eclipse.test.EclipseTestRunner.run(EclipseTestRunner.java:327)\nat org.eclipse.test.EclipseTestRunner.run(EclipseTestRunner.java:201)\nat org.eclipse.test.UITestApplication$3.run(UITestApplication.java:188)\nat org.eclipse.swt.widgets.RunnableLock.run(RunnableLock.java:35)\nat org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:123)\nat org.eclipse.swt.widgets.Display.runAsyncMessages(Display.java:3180)\nat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2882)\nat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1914)\nat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1878)\nat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:419)\nat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)\nat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:95)\nat org.eclipse.test.UITestApplication.runApplication(UITestApplication.java:131)\nat org.eclipse.test.UITestApplication.run(UITestApplication.java:58)\nat org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:78)\nat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:104)\nat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:74)\nat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:348)\nat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:165)\nat org.eclipse.core.launcher.Main.invokeFramework(Main.java:341)\nat org.eclipse.core.launcher.Main.basicRun(Main.java:285)\nat org.eclipse.core.launcher.Main.run(Main.java:987)\nat org.eclipse.core.launcher.Main.main(Main.java:962)\nCaused by: java.lang.NullPointerException\nat org.eclipse.ui.internal.menus.LegacyActionPersistence.convertActionToHandler(LegacyActionPersistence.java:530)\nat org.eclipse.ui.internal.menus.LegacyActionPersistence.readActions(LegacyActionPersistence.java:908)\nat org.eclipse.ui.internal.menus.LegacyActionPersistence.readActionsAndMenus(LegacyActionPersistence.java:974)\nat org.eclipse.ui.internal.menus.LegacyActionPersistence.readActionSets(LegacyActionPersistence.java:1052)\nat org.eclipse.ui.internal.menus.LegacyActionPersistence.read(LegacyActionPersistence.java:838)\nat org.eclipse.ui.internal.services.RegistryPersistence$3.run(RegistryPersistence.java:598)\nat org.eclipse.swt.widgets.RunnableLock.run(RunnableLock.java:35)\nat org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:123)\n... 44 more\n\nThe other one failed with:\n\nFailed to execute runnable (java.lang.NullPointerException)\n\norg.eclipse.swt.SWTException: Failed to execute runnable (java.lang.NullPointerException)\nat org.eclipse.swt.SWT.error(SWT.java:3407)\nat org.eclipse.swt.SWT.error(SWT.java:3330)\nat org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:126)\nat org.eclipse.swt.widgets.Display.runAsyncMessages(Display.java:3180)\nat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2882)\nat org.eclipse.ui.tests.harness.util.UITestCase.processEvents(UITestCase.java:222)\nat org.eclipse.ui.tests.harness.util.UITestCase.doTearDown(UITestCase.java:216)\nat org.eclipse.ui.tests.dynamicplugins.DynamicTestCase.doTearDown(DynamicTestCase.java:59)\nat org.eclipse.ui.tests.harness.util.UITestCase.tearDown(UITestCase.java:203)\n.... many more lines, the same\n\nPW",
    "The tests are (at least for now) on http://fullmoon.ottawa.ibm.com/downloads/drops/I20060920-0010/testresults/html/org.eclipse.ui.tests_linux.gtk.x86_5.0.html\n",
    "This was in the console log:\n     [java] ----- testActionSets\n     [java] testActionSets: setUp...\n     [java] testActionSets: tearDown...\n\n\n     [java] !ENTRY org.eclipse.jdt.core 4 4 2006-09-19 14:47:06.052\n     [java] !MESSAGE Background Indexer Crash Recovery\n     [java] !STACK 0\n     [java] java.lang.OutOfMemoryError: Java heap space\n     [java] Exception in thread \"Java indexing\" java.lang.OutOfMemoryError: Java heap space\n     [java] ----- testActionSetPartAssociations\n     [java] testActionSetPartAssociations: setUp...\n     [java] testActionSetPartAssociations: tearDown...\n\n\nThese tests are being run with 1.5.0_06 which has a known problem.\n\nPW\n",
    "Hmmm, it is a consistent OutOfMemoryError, but it doesn\u0027t actually say PermGen error .... maybe this is just a memory issue with the linux test machine.\n\nStill investigating.\n\nPW\n",
    "As John pointed out, it might also be an eclipse regression where we\u0027re not freeing heap space.\n\nPW\n",
    "(In reply to comment #4)\n\u003e As John pointed out, it might also be an eclipse regression where we\u0027re not\n\u003e freeing heap space.\n\u003e \n\u003e PW\n\nOr instances of TestCase that still hold on to lots of memory.\n",
    "\u003eOr instances of TestCase that still hold on to lots of memory.\nI don\u0027t think JUnit changed in a way from 3.2 to 3.2.1 that could cause this but adding Markus to be sure.",
    "We only had very small changes in JUnit between 3.2 and 3.2.1, and I verified that they can be ruled out as a cause for these problems.",
    "(In reply to comment #6)\n\u003e \u003eOr instances of TestCase that still hold on to lots of memory.\n\u003e I don\u0027t think JUnit changed in a way from 3.2 to 3.2.1 that could cause this\n\u003e but adding Markus to be sure.\n\nI guess I should explain what I meant:  As far as I know, JUnit holds on to the TestCase objects for the duration of all tests to produce the report.  Therefore, any fields in subclasses of TestCase (i.e. UITestCase and its subclasses) should be nulled in tearDown.",
    "First I\u0027d compare with 3.2 or in other words: if you added new (or substantially changed) tests after 3.2 and they cause the potential leak then yes, \u0027null\u0027 it out in 3.2.1, otherwise wait until the real problem has been identified.",
    "Even in 3.3, if I run the tests with 1.5.0_03 they all pass.  If I run them with 1.5.0_06 then I get the OOME:\nException in thread \"State Saver\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Java indexing\" java.lang.OutOfMemoryError: Java heap space\n\n\nKarice, you were going to try the 3.2.1 tests with 1.5.0_06?\n\nLater,\nPW\n",
    "Haven\u0027t reached a conclusive result yet.  Ran the 3.2.1 tests in M20060919-1045 with 1.5.0_06 vm and they all pass.  I am going to try Dani\u0027s suggestion of comparing the 3.2.1 tests against the 3.2 tests and see what I get.",
    "BTW, I20060920-0800 did not have the UI failures.",
    "I assume Releng is using the eclipse.ini which specifies -vmargs -Xmx256m\nwhen running the tests via test.xml - Kim? If not, the UiTestSuite might just have been lucky so far.",
    "Yes, we use the eclipse.ini with the same arguments.",
    "It looks like this error (OOME) which leads to dynamic test failures is also in 3.2.0.  I ran 3.2.0, 1.5.0_06 with the tests from R3_2, and I get a failure 3 tests later, also with:\nException in thread \"Java indexing\" java.lang.OutOfMemoryError: Java heap space\n\nI don\u0027t believe it is a regression on the quality of the current 3.2.1 build (or the I builds).\n\nBut the main cause still needs to be narrowed down, as this is a randomly occurring error on 1.5.0 (although it is more reliable recently).\n\nLater,\nPW\n",
    "Created an attachment (id\u003d50641)\nPrint used Mem numbers\n\nKarice, here\u0027s a patch if you want similar output.\n\nPW\n",
    "You should trigger a garbage collection before printing the used memory.",
    "Paul and I have found if we run the tests (3.2.0 and 3.2.1) with -Xmx256M -Xms40M (the defaults in eclipse.ini) then they all pass.  If we run without these args the testActivityImages test fails.  After printing out memory usage to the console, the mem usage for this test is at 63M.  The OOME happens during this test so it seems the max mem for each test is 64M, rather than 256M. The UI tests uses org.eclipse.test/library.xml to specify some of its test properties, including vmargs, which is set to be an empty string.  The default value the vm uses for max heap size when no properties are specified is 64M.  I suspect if we add the following line to the UiTestSuite in the test.xml file of the ui.tests plug-in\n      \u003cproperty name\u003d\"vmargs\" value\u003d\"-Xmx256M -Xms40M\"/\u003e\nthen the UITestSuite will pass.  \n\nWe should look at doing cleanup of the tests in the 3.3 stream so that we do not have to employ this strategy in that stream, but it seems less desireable to make lots of changes to the tests in the 3.2.1 stream at this point.\n",
    "I talked to Andrew about this.  Since we initiate the tests calling the startup.jar instead of the eclipse executable, the eclipse.ini is not read.  It might be a good idea for us to pass the vmargs to the JUnit tests in the library.xml in the 3.3 stream, instead of just for the performance tests as we do today.",
    "Note that the performance tests vm args are -Xmx256M and -Xms256M, whereas in eclipse.ini they are -Xmx256M -Xms40M ",
    "re comment 18: what\u0027s the memory diff between R3.2 and 3_2_maintenance build? If it is also around 64MB then I my guess in comment 13 probably applies\nre comment 20: the -Xms shouldn\u0027t matter in respect to OOME",
    "The mem diff (at its peak) between the two streams is about 8M.  ",
    "KimM - is releng going to change the vm args in library.xml for the 3.3 stream?",
    "Change released \u003cproperty name\u003d\"vmargs\" value\u003d\" -Xms40m -Xmx256m\"/\u003e in library.xml for JUnit tests in HEAD stream. \n\n\n",
    "KimM or Sonia - should the change to library.xml also be released into the 3.2.x stream?  I suspect when the 3.2.2 builds start this week that these errors will pop up again if this change isn\u0027t made.  ",
    "I will backport."
  ],
  "commentCreationDates": [
    "2006-09-20T15:04:49+02:00",
    "2006-09-20T15:05:37+02:00",
    "2006-09-20T16:46:06+02:00",
    "2006-09-20T16:52:25+02:00",
    "2006-09-20T17:00:22+02:00",
    "2006-09-20T18:00:13+02:00",
    "2006-09-20T18:08:17+02:00",
    "2006-09-20T18:57:59+02:00",
    "2006-09-20T19:07:00+02:00",
    "2006-09-20T20:13:00+02:00",
    "2006-09-20T20:22:18+02:00",
    "2006-09-20T20:39:47+02:00",
    "2006-09-20T20:42:06+02:00",
    "2006-09-20T23:41:28+02:00",
    "2006-09-21T15:32:11+02:00",
    "2006-09-21T16:47:32+02:00",
    "2006-09-21T17:10:29+02:00",
    "2006-09-21T18:19:30+02:00",
    "2006-09-21T20:28:51+02:00",
    "2006-09-21T23:40:52+02:00",
    "2006-09-21T23:47:12+02:00",
    "2006-09-22T10:14:31+02:00",
    "2006-09-22T16:14:23+02:00",
    "2006-09-26T15:47:06+02:00",
    "2006-09-26T20:44:57+02:00",
    "2006-11-07T15:43:57+01:00",
    "2006-11-07T15:57:58+01:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.swt.SWTException",
      "message": "Failed to execute runnable (java.lang.NullPointerException)",
      "elements": [
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3407"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3330"
        },
        {
          "method": "org.eclipse.swt.widgets.Synchronizer.runAsyncMessages",
          "source": "Synchronizer.java:126"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runAsyncMessages",
          "source": "Display.java:3180"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2882"
        },
        {
          "method": "org.eclipse.ui.tests.harness.util.UITestCase.processEvents",
          "source": "UITestCase.java:222"
        },
        {
          "method": "org.eclipse.ui.tests.dynamicplugins.DynamicTestCase.removeBundle",
          "source": "DynamicTestCase.java:234"
        },
        {
          "method": "org.eclipse.ui.tests.dynamicplugins.DynamicTestCase.doTearDown",
          "source": "DynamicTestCase.java:61"
        },
        {
          "method": "org.eclipse.ui.tests.harness.util.UITestCase.tearDown",
          "source": "UITestCase.java:203"
        },
        {
          "method": "org.eclipse.test.EclipseTestRunner.run",
          "source": "EclipseTestRunner.java:327"
        },
        {
          "method": "org.eclipse.test.EclipseTestRunner.run",
          "source": "EclipseTestRunner.java:201"
        },
        {
          "method": "org.eclipse.test.UITestApplication$3.run",
          "source": "UITestApplication.java:188"
        },
        {
          "method": "org.eclipse.swt.widgets.RunnableLock.run",
          "source": "RunnableLock.java:35"
        },
        {
          "method": "org.eclipse.swt.widgets.Synchronizer.runAsyncMessages",
          "source": "Synchronizer.java:123"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runAsyncMessages",
          "source": "Display.java:3180"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2882"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1914"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1878"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:419"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:95"
        },
        {
          "method": "org.eclipse.test.UITestApplication.runApplication",
          "source": "UITestApplication.java:131"
        },
        {
          "method": "org.eclipse.test.UITestApplication.run",
          "source": "UITestApplication.java:58"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:78"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:104"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:74"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:348"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:165"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:341"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:285"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:987"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:962"
        }
      ],
      "causedBy": {
        "exceptionType": "java.lang.NullPointerException",
        "elements": [
          {
            "method": "org.eclipse.ui.internal.menus.LegacyActionPersistence.convertActionToHandler",
            "source": "LegacyActionPersistence.java:530"
          },
          {
            "method": "org.eclipse.ui.internal.menus.LegacyActionPersistence.readActions",
            "source": "LegacyActionPersistence.java:908"
          },
          {
            "method": "org.eclipse.ui.internal.menus.LegacyActionPersistence.readActionsAndMenus",
            "source": "LegacyActionPersistence.java:974"
          },
          {
            "method": "org.eclipse.ui.internal.menus.LegacyActionPersistence.readActionSets",
            "source": "LegacyActionPersistence.java:1052"
          },
          {
            "method": "org.eclipse.ui.internal.menus.LegacyActionPersistence.read",
            "source": "LegacyActionPersistence.java:838"
          },
          {
            "method": "org.eclipse.ui.internal.services.RegistryPersistence$3.run",
            "source": "RegistryPersistence.java:598"
          },
          {
            "method": "org.eclipse.swt.widgets.RunnableLock.run",
            "source": "RunnableLock.java:35"
          },
          {
            "method": "org.eclipse.swt.widgets.Synchronizer.runAsyncMessages",
            "source": "Synchronizer.java:123"
          }
        ],
        "number": 0,
        "commentIndex": 0
      },
      "number": 0,
      "commentIndex": 0,
      "bugId": "157978",
      "date": "2006-09-20T15:04:49+02:00",
      "product": "Platform",
      "component": "UI",
      "severity": "normal"
    },
    {
      "exceptionType": "org.eclipse.swt.SWTException",
      "message": "Failed to execute runnable (java.lang.NullPointerException)",
      "elements": [
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3407"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3330"
        },
        {
          "method": "org.eclipse.swt.widgets.Synchronizer.runAsyncMessages",
          "source": "Synchronizer.java:126"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runAsyncMessages",
          "source": "Display.java:3180"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2882"
        },
        {
          "method": "org.eclipse.ui.tests.harness.util.UITestCase.processEvents",
          "source": "UITestCase.java:222"
        },
        {
          "method": "org.eclipse.ui.tests.harness.util.UITestCase.doTearDown",
          "source": "UITestCase.java:216"
        },
        {
          "method": "org.eclipse.ui.tests.dynamicplugins.DynamicTestCase.doTearDown",
          "source": "DynamicTestCase.java:59"
        },
        {
          "method": "org.eclipse.ui.tests.harness.util.UITestCase.tearDown",
          "source": "UITestCase.java:203"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "157978",
      "date": "2006-09-20T15:04:49+02:00",
      "product": "Platform",
      "component": "UI",
      "severity": "normal"
    }
  ],
  "groupId": "157978",
  "bugId": "157978",
  "date": "2006-09-20T15:04:49+02:00",
  "product": "Platform",
  "component": "UI",
  "severity": "normal"
}