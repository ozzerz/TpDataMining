{
  "comments": [
    "Mylar\u0027s Active Search runs numerous searches for Java elements in the background, some of which cause the following NPE due to trying to get an element from a null document.  \n\nMost of the time this failure is innocuous.  However, it seems that if the corresponding plugin.xml is open for editing bogus compiler errors can result stating that extension points are not valid elements, and it seems that these can not be fixed without a restart.\n\nLet me know if you need more information about search parameters or anything related and I can try to isolate further.\n\njava.lang.NullPointerException\n\tat org.eclipse.pde.internal.core.XMLDefaultHandler.getDocumentElement(XMLDefaultHandler.java:108)\n\tat org.eclipse.pde.internal.core.schema.Schema.load(Schema.java:398)\n\tat org.eclipse.pde.internal.core.schema.Schema.load(Schema.java:373)\n\tat org.eclipse.pde.internal.core.schema.SchemaDescriptor.getSchema(SchemaDescriptor.java:73)\n\tat org.eclipse.pde.internal.core.schema.SchemaRegistry.getSchema(SchemaRegistry.java:54)\n\tat org.eclipse.pde.internal.ui.search.ClassSearchParticipant.searchProject(ClassSearchParticipant.java:169)\n\tat org.eclipse.pde.internal.ui.search.ClassSearchParticipant.search(ClassSearchParticipant.java:124)\n\tat org.eclipse.jdt.internal.ui.search.JavaSearchQuery$2.run(JavaSearchQuery.java:162)\n\tat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n\tat org.eclipse.jdt.internal.ui.search.JavaSearchQuery.run(JavaSearchQuery.java:168)\n\tat org.eclipse.mylar.internal.java.search.AbstractJavaRelationProvider$JavaSearchOperation.run(AbstractJavaRelationProvider.java:299)\n\tat org.eclipse.mylar.internal.java.search.AbstractJavaRelationProvider$JavaSearchJob.run(AbstractJavaRelationProvider.java:280)\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:58)",
    "Mik, it would certainly help if you told us what kind of Java search query you are executing.",
    "Better yet, it would be good if you provided steps to reproduce with query using the Java search page.",
    "Will try to isolate on my end early next week.",
    "Sorry, need to push of until next week.  I\u0027m not sure if it will be reproducible via a Java query because there\u0027s a chance that this error results from the fact that we run multiple Java searches concurrently and let the Jobs sechedule themselves.  I\u0027m actually tempted to have us start queuing those search jobs since it might make sense from a performance point of view anyway.",
    "On the PDE side, we will certainly guard against these (inexplicable) NPEs in XMLDefaultHandler anyway.\n\nI wonder what real effect this unsuccessful parsing of xml file has on your search though.",
    "It has no bad effect on our search, we just don\u0027t get the plugin.xml match.  So to Mylar users this would be invisible, except that every once in a while this has the horrible effect of crashing the PDE schema builder (paragraph 2 of description) and forcing a restart.  Fyi if I recall correctly error messages in the Problems view are along the lines of \"bla is not a valid element of extension\".  We definitely want to stop triggerring this behavior, but it would also be good for PDE to be defensive against it.",
    "Hey JLB, could you please put null checks in XMLDefaultHandler and its clients to fail gracefully?  thanks.",
    "Gracefully fixed - no more NPEs",
    "Do you know what could have caused this?  I\u0027m wondering if there\u0027s anything I should be avoiding on my end (e.g. along the lines of searching on non-existing Java elements, in non-existing files, dirty files, etc).",
    "that is still puzzling, but I think I have an idea.\n\ndid this start to happen recently?",
    "Here is what I think was causing the problem:\n\nAs of M6, the parser used to parse schemas is a singleton for performance reasons.\n\nThis is fine under normal circumstances but if you are running concurrent search jobs, schemas will be loaded/parsed concurrently to figure out which plugin.xml attributes denote Java types.\n\nSo the singleton parser is being accessed by multiple threads resulting in unpredictable/unexpected behaviour.\n\nWe also released code that assigns a parser instance per schema.",
    "Yes, that must be it!  I can confirm that it started happening after the M5 release, I think I first noticed it in an integration week within the last 2 weeks leading up to M6.  \n\nSo does the new code support concurrent searches, or should we change our code to not allow concurrent searches (currently allow up to 5 concurrent searches at a time, which JDT and text are fine with, but I\u0027m wondering if that\u0027s slower overall even though they\u0027re all Job.DECORATE priority).",
    "you should be fine without any changes at your end.",
    "*** Bug 132923 has been marked as a duplicate of this bug. ***",
    "The original exception has gone away, but I am now seeing the following in its place:\n\njava.util.EmptyStackException\n\tat java.util.Stack.peek(Unknown Source)\n\tat java.util.Stack.pop(Unknown Source)\n\tat org.eclipse.pde.internal.core.XMLDefaultHandler.endElement(XMLDefaultHandler.java:57)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.endElement(Unknown Source)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractXMLDocumentParser.emptyElement(Unknown Source)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement(Unknown Source)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown Source)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(Unknown Source)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(Unknown Source)\n\tat com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(Unknown Source)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(Unknown Source)\n\tat javax.xml.parsers.SAXParser.parse(Unknown Source)\n\tat javax.xml.parsers.SAXParser.parse(Unknown Source)\n\tat org.eclipse.pde.internal.core.schema.Schema.load(Schema.java:397)\n\tat org.eclipse.pde.internal.core.schema.Schema.load(Schema.java:373)\n\tat org.eclipse.pde.internal.core.schema.SchemaDescriptor.getSchema(SchemaDescriptor.java:73)\n\tat org.eclipse.pde.internal.core.schema.SchemaRegistry.getSchema(SchemaRegistry.java:54)\n\tat org.eclipse.pde.internal.ui.search.ClassSearchParticipant.searchProject(ClassSearchParticipant.java:179)\n\tat org.eclipse.pde.internal.ui.search.ClassSearchParticipant.search(ClassSearchParticipant.java:134)\n\tat org.eclipse.jdt.internal.ui.search.JavaSearchQuery$2.run(JavaSearchQuery.java:163)\n\tat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n\tat org.eclipse.jdt.internal.ui.search.JavaSearchQuery.run(JavaSearchQuery.java:169)\n\tat org.eclipse.mylar.internal.java.search.AbstractJavaRelationProvider$JavaSearchOperation.run(AbstractJavaRelationProvider.java:299)\n\tat org.eclipse.mylar.internal.java.search.AbstractJavaRelationProvider$JavaSearchJob.run(AbstractJavaRelationProvider.java:280)\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:58)\n"
  ],
  "commentCreationDates": [
    "2006-04-05T16:59:05+02:00",
    "2006-04-07T02:20:59+02:00",
    "2006-04-07T02:49:37+02:00",
    "2006-04-08T01:35:04+02:00",
    "2006-04-13T23:22:55+02:00",
    "2006-04-13T23:26:35+02:00",
    "2006-04-13T23:32:39+02:00",
    "2006-04-20T20:38:47+02:00",
    "2006-04-20T23:04:28+02:00",
    "2006-04-20T23:08:38+02:00",
    "2006-04-20T23:10:27+02:00",
    "2006-04-20T23:31:39+02:00",
    "2006-04-21T02:16:00+02:00",
    "2006-04-21T02:17:53+02:00",
    "2006-04-21T03:42:36+02:00",
    "2006-04-27T02:23:46+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.pde.internal.core.XMLDefaultHandler.getDocumentElement",
          "source": "XMLDefaultHandler.java:108"
        },
        {
          "method": "org.eclipse.pde.internal.core.schema.Schema.load",
          "source": "Schema.java:398"
        },
        {
          "method": "org.eclipse.pde.internal.core.schema.Schema.load",
          "source": "Schema.java:373"
        },
        {
          "method": "org.eclipse.pde.internal.core.schema.SchemaDescriptor.getSchema",
          "source": "SchemaDescriptor.java:73"
        },
        {
          "method": "org.eclipse.pde.internal.core.schema.SchemaRegistry.getSchema",
          "source": "SchemaRegistry.java:54"
        },
        {
          "method": "org.eclipse.pde.internal.ui.search.ClassSearchParticipant.searchProject",
          "source": "ClassSearchParticipant.java:169"
        },
        {
          "method": "org.eclipse.pde.internal.ui.search.ClassSearchParticipant.search",
          "source": "ClassSearchParticipant.java:124"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.search.JavaSearchQuery$2.run",
          "source": "JavaSearchQuery.java:162"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.search.JavaSearchQuery.run",
          "source": "JavaSearchQuery.java:168"
        },
        {
          "method": "org.eclipse.mylar.internal.java.search.AbstractJavaRelationProvider$JavaSearchOperation.run",
          "source": "AbstractJavaRelationProvider.java:299"
        },
        {
          "method": "org.eclipse.mylar.internal.java.search.AbstractJavaRelationProvider$JavaSearchJob.run",
          "source": "AbstractJavaRelationProvider.java:280"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:58"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "135042",
      "date": "2006-04-05T16:59:05+02:00",
      "product": "PDE",
      "component": "UI",
      "severity": "normal"
    },
    {
      "exceptionType": "java.util.EmptyStackException",
      "elements": [
        {
          "method": "java.util.Stack.peek",
          "source": "Unknown Source"
        },
        {
          "method": "java.util.Stack.pop",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.pde.internal.core.XMLDefaultHandler.endElement",
          "source": "XMLDefaultHandler.java:57"
        },
        {
          "method": "com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.endElement",
          "source": "Unknown Source"
        },
        {
          "method": "com.sun.org.apache.xerces.internal.parsers.AbstractXMLDocumentParser.emptyElement",
          "source": "Unknown Source"
        },
        {
          "method": "com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement",
          "source": "Unknown Source"
        },
        {
          "method": "com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch",
          "source": "Unknown Source"
        },
        {
          "method": "com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument",
          "source": "Unknown Source"
        },
        {
          "method": "com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse",
          "source": "Unknown Source"
        },
        {
          "method": "com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse",
          "source": "Unknown Source"
        },
        {
          "method": "com.sun.org.apache.xerces.internal.parsers.XMLParser.parse",
          "source": "Unknown Source"
        },
        {
          "method": "com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse",
          "source": "Unknown Source"
        },
        {
          "method": "javax.xml.parsers.SAXParser.parse",
          "source": "Unknown Source"
        },
        {
          "method": "javax.xml.parsers.SAXParser.parse",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.pde.internal.core.schema.Schema.load",
          "source": "Schema.java:397"
        },
        {
          "method": "org.eclipse.pde.internal.core.schema.Schema.load",
          "source": "Schema.java:373"
        },
        {
          "method": "org.eclipse.pde.internal.core.schema.SchemaDescriptor.getSchema",
          "source": "SchemaDescriptor.java:73"
        },
        {
          "method": "org.eclipse.pde.internal.core.schema.SchemaRegistry.getSchema",
          "source": "SchemaRegistry.java:54"
        },
        {
          "method": "org.eclipse.pde.internal.ui.search.ClassSearchParticipant.searchProject",
          "source": "ClassSearchParticipant.java:179"
        },
        {
          "method": "org.eclipse.pde.internal.ui.search.ClassSearchParticipant.search",
          "source": "ClassSearchParticipant.java:134"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.search.JavaSearchQuery$2.run",
          "source": "JavaSearchQuery.java:163"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.search.JavaSearchQuery.run",
          "source": "JavaSearchQuery.java:169"
        },
        {
          "method": "org.eclipse.mylar.internal.java.search.AbstractJavaRelationProvider$JavaSearchOperation.run",
          "source": "AbstractJavaRelationProvider.java:299"
        },
        {
          "method": "org.eclipse.mylar.internal.java.search.AbstractJavaRelationProvider$JavaSearchJob.run",
          "source": "AbstractJavaRelationProvider.java:280"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:58"
        }
      ],
      "number": 1,
      "commentIndex": 15,
      "bugId": "135042",
      "date": "2006-04-27T02:23:46+02:00",
      "product": "PDE",
      "component": "UI",
      "severity": "normal"
    }
  ],
  "groupId": "135042",
  "bugId": "135042",
  "date": "2006-04-05T16:59:05+02:00",
  "product": "PDE",
  "component": "UI",
  "severity": "normal"
}