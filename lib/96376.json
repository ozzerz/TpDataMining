{
  "comments": [
    "Downloaded 3.1m7 and it worked great.  I used it for several days until I\nmanaged to crash my pc whilst Eclipse was running (not Eclipse\u0027s fault).  Now\nwhenever it loads it says the workspace is in use regardless of whatever\ndirectory I try.\n\nI\u0027ve tried deleting every lock file in the ~/.eclipse directory without joy.\n\nRunning (as far as it will - i.e. up to the impassable dialog) always produces\nthe following log output with the FrameworkEvent.ERROR/IOException repeated for\nhowever many times I try to get through the workspace dialog:\n\n!SESSION 2005-05-21 12:33:34.528\n-----------------------------------------------eclipse.buildId\u003dI20050513-1415\njava.version\u003d1.4.2-gentoo\njava.vendor\u003dSun Microsystems Inc.\nBootLoader constants: OS\u003dlinux, ARCH\u003dx86, WS\u003dgtk, NL\u003den_GB\nCommand-line arguments:  -os linux -ws gtk -arch x86\n\n!ENTRY System Bundle 0 0 2005-05-21 12:33:46.831\n!MESSAGE FrameworkEvent.ERROR\n!STACK 0\njava.io.IOException: Manager is not opened.\n        at org.eclipse.core.runtime.adaptor.FileManager.add(FileManager.java:168)\n        at\norg.eclipse.core.runtime.adaptor.StreamManager.closeOutputStream(StreamManager.java:229)\n        at\norg.eclipse.core.runtime.adaptor.StreamManagerOutputStream.close(StreamManagerOutputStream.java:42)\n        at java.io.FilterOutputStream.close(FilterOutputStream.java:143)\n        at java.io.FilterOutputStream.close(FilterOutputStream.java:143)\n        at\norg.eclipse.core.runtime.adaptor.EclipseAdaptor.saveMetaData(EclipseAdaptor.java:675)\n        at\norg.eclipse.core.runtime.adaptor.EclipseAdaptor.frameworkStop(EclipseAdaptor.java:421)\n        at\norg.eclipse.osgi.framework.internal.core.SystemBundleActivator.stop(SystemBundleActivator.java:64)\n        at\norg.eclipse.osgi.framework.internal.core.BundleContextImpl$3.run(BundleContextImpl.java:1035)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at\norg.eclipse.osgi.framework.internal.core.BundleContextImpl.stop(BundleContextImpl.java:1031)\n        at\norg.eclipse.osgi.framework.internal.core.StartLevelManager.suspendAllBundles(StartLevelManager.java:653)\n        at\norg.eclipse.osgi.framework.internal.core.StartLevelManager.decFWSL(StartLevelManager.java:602)\n        at\norg.eclipse.osgi.framework.internal.core.StartLevelManager.doSetStartLevel(StartLevelManager.java:283)\n        at\norg.eclipse.osgi.framework.internal.core.StartLevelManager.shutdown(StartLevelManager.java:256)\n        at\norg.eclipse.osgi.framework.internal.core.SystemBundle.suspend(SystemBundle.java:190)\n        at\norg.eclipse.osgi.framework.internal.core.Framework.shutdown(Framework.java:537)\n        at\norg.eclipse.osgi.framework.internal.core.SystemBundle$1.run(SystemBundle.java:171)\n        at java.lang.Thread.run(Thread.java:534)",
    "Phil, please investigate.",
    "I don\u0027t see immediately how this state is possible. Can you post the contents of\nyour configuration directory for the org.eclipse.osgi?  i.e.\n\"configuration/org.eclipse.osgi/*\"",
    "charlie@localhost ~ $ ls\n/home/charlie/.eclipse/org.eclipse.platform_3.1.0/configuration/org.eclipse.osgi/\n\nbundles/         .lazy17627.new   .manager/        .state12822.new  .state41213.new\n.lazy12823.new   .lazy41214.new   manifests/       .state17626.new\n\n\n\ncharlie@localhost ~ $ ls\n/home/charlie/.eclipse/org.eclipse.platform_3.1.0/configuration/org.eclipse.osgi/.manager/\n\n.fileTableLock\n\n\n\nI tried deleting that file.  Now Eclipse seems to get past the workspace dialog\nbut instead dies shortly afterwards with this additional exception in the logs:\n\n!ENTRY System Bundle 0 0 2005-05-25 03:44:19.549\n!MESSAGE FrameworkEvent.ERROR\n!STACK 0\njava.io.IOException: Manager is not opened.\n        at org.eclipse.core.runtime.adaptor.FileManager.lookup(FileManager.java:387)\n        at\norg.eclipse.core.runtime.adaptor.EclipseAdaptor.shutdownStateManager(EclipseAdaptor.java:261)\n        at\norg.eclipse.osgi.framework.adaptor.core.AbstractFrameworkAdaptor.frameworkStop(AbstractFrameworkAdaptor.java:272)\n        at\norg.eclipse.core.runtime.adaptor.EclipseAdaptor.frameworkStop(EclipseAdaptor.java:422)\n        at\norg.eclipse.osgi.framework.internal.core.SystemBundleActivator.stop(SystemBundleActivator.java:64)\n        at\norg.eclipse.osgi.framework.internal.core.BundleContextImpl$3.run(BundleContextImpl.java:1035)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at\norg.eclipse.osgi.framework.internal.core.BundleContextImpl.stop(BundleContextImpl.java:1031)\n       at\norg.eclipse.osgi.framework.internal.core.StartLevelManager.suspendAllBundles(StartLevelManager.java:653)\n        at\norg.eclipse.osgi.framework.internal.core.StartLevelManager.decFWSL(StartLevelManager.java:602)\n        at\norg.eclipse.osgi.framework.internal.core.StartLevelManager.doSetStartLevel(StartLevelManager.java:283)\n        at\norg.eclipse.osgi.framework.internal.core.StartLevelManager.shutdown(StartLevelManager.java:256)\n        at\norg.eclipse.osgi.framework.internal.core.SystemBundle.suspend(SystemBundle.java:190)\n        at\norg.eclipse.osgi.framework.internal.core.Framework.shutdown(Framework.java:537)\n        at\norg.eclipse.osgi.framework.internal.core.SystemBundle$1.run(SystemBundle.java:171)\n        at java.lang.Thread.run(Thread.java:534)\n",
    "This seems to be pretty serious and must be understood for 3.1.\nAssigning to Phil.",
    "Created an attachment (id\u003d21714)\ntest patch to log any filemanager open failures\n\nThe only thing that explains these log messages of \"Manager not open\" is if\nfilemanager open() fails. Unfortunately we don\u0027t log this failure - but this\ncan occur if obtaining .fileTableLock fails, creating an instance file fails,\nor reading .fileTable fails (not found is OK).\n\nCharles, can you please replace your eclipse/plugins/org.eclipse.osgi_3.1.0.jar\nwith this attachment (please backup your original version first) and then start\neclipse? Then post back the contents of the logfile.\n\nThis .jar file only modifies EclipseAdaptor.class to log any filemanager open\nfailures.",
    "At a minimum from this bug, we need to log the filemanager (FM) open failure as\nto not be guessing what the problem is. The cause of this bug is unexpected and\nit does illuminates a hole in the EclipseAdaptor (EA). In the normal case, EA\ninitialize will open FM in read/write mode. In the current code, when this fails\nit is ignored and we just go on - however, in a later framework shutdown the\nfilemanager is expected to be open and therefore the \"Manager is not opened\"\nexception is thrown.\n\nHopefully, Charles can obtain a log to explain exactly why FM open() is failing.\nI\u0027m not yet sure the best way to handle FM open() failing in the EA. Retry in\nRead/Only would at least allow us to read an existing configuration, but no\nupdates will be allowed. A framework exit on FM open() failure seems a little\nextreme as there may not be enough information to allow a user to correct the\nproblem.\n\nAgain, FM open() can fail when obtaining .fileTableLock fails, creating an\ninstance file fails, or reading .fileTable fails (not found is OK). \n - If .fileTableLock is a problem, locking is not working as expected (hung\nprocess, OS confused, persistent storage problem, ??). Reopen in read/only may\nallow launch, but the next bug may be my updates never get saved?\n - if creating an instance file fails, persistent store has problems (full,\ncorrupt, ??) or obtaining a lock for this file failed (unexpected locking\nbehavior). Again, read/only may allow launch.\n - if .fileTable read fails (this is a reliable file now), I only see this can\noccur if there is a storage error or a user corrupted the file. This shouldn\u0027t\nbe the issue in this bug as the .manager directory doesn\u0027t contain this file.\nBut, there is a hole in the code here - if this were to occur, a -clean would be\nrequired to rebuild everything and return to normal state. We could assume the\ndata is lost, and start from scratch here (appropriate logging would be good).\n\nThis is what I see now.",
    "Created an attachment (id\u003d21775)\nlog file generated with updated org.eclipse.osgi\n",
    "Well I deleted ~/.eclipse which didn\u0027t work, so I ran \u0027eclipse -vmargs\n-Dosgi.locking\u003dnone\u0027 which did work.\n\nI\u0027ll note I saw \u0027-Dorg.eclipse.osgi.locking\u003dnone\u0027 in another bug report but that\ndidn\u0027t work - only the shortened version, as suggested in the log file, had the\ndesired effect.",
    "The property was renamed during 3.0. See bug 44735 comment 37.\n\nThat does not explain why you started having problems after Eclipse crashed. Do\nyou have your home dir mounted on a network shared drive? Have any client or\nserver settings changed around the time you started seeing this?",
    "\u003e Do you have your home dir mounted on a network shared drive?\n\nNo.\n\n\u003e Have any client or server settings changed around the time you started seeing\nthis?\n\nNo.\n\nNothing else seemed to be affected either, only Eclipse (implying it\u0027s not my\nhardware or some other software that failed).\n\nI using Gentoo though.  That means the machine is constantly being upgraded but\nEclipse itself didn\u0027t change (using the 3.1m7 binary from eclipse.org) nor did\nJava (using Sun\u0027s SDK 1.4.2) and I\u0027m not particularly convinced anything else\ninstalled got upgraded that would have caused such a peculiar problem.",
    "What type of local file system is your home directory based on? If file locking\nworked before, and stopped working out of blue, I am convinced the OS updates\nare the cause.\n\nAs noted by Phil in comment 5 and comment 6, the problem here is that we don\u0027t\ndeal properly with a failure when opening the FileManager. That must be\naddressed. We should abort the startup sequence if something as serious as that\nhappens.",
    "I\u0027ve always been a little confused on this defect that the log messages show the\nfile manager problems, but they were not the cause of the workspace failing to\ncome up. In talk with other developers, I was suspicious that the workbench or\nsomething else was also failing under a similar problem - just no log message to\nshow it. Again, the original log messages just showed that the OSGi framework\nwas ignoring any previous configuration \u0026 reinitializing everything, and then\nfailed when trying to save an updated configuration.\n\nFor Eclipse GM, I feel we should modify EclipseAdaptor to log any FileManager\nopen failures. We should also consider changing the RCP behavior when this\noccurs. Currently we ignore the condition which this bug proves to be\nmisleading. Rafael suggests (see comment 11) that this is a critical error and\nan abort is appropriate - this would force the user to resolve the problem\ninstead of getting the other \"workspace is locked\" misleading message \u0026\u0026 the log\nmessage in this case instructs the user to use -Dosgi.locking\u003dnone.\n\nI don\u0027t think trying to reopen in read/only will help this problem much as it\nwill likely result in a failure later on. \n\nDoes anyone else have any input as I make the change to abort?\n\nI believe the abort is appropriate for (see comment 6) .fileTableLock failure\nand instance file creation failure (no disk space would probably cause a failure\nlater on also).  In the case .fileTable reading fails, I suggest we assume all\ndata is lost and allow the open, just ignoring any previous data OR we abort\nwith a message that instructs the user that deleting any .mananger/.fileTable.*\n files may resolve this problem. I can\u0027t come up with a likely scenario this can\nhappen(outside of the user corrupts the files or a persistent data is\ncorrupted). Any preferences? ",
    "Created an attachment (id\u003d21852)\nPatch to head to log FM.open() exception\n\nAttaching a patch to current head to log FM.open() exceptions. The error is\nstill ignored, but it does provide a log message in the form of:\n!ENTRY org.eclipse.osgi 2005-05-26 14:12:13.353\n!MESSAGE Error reading configuration: An error occurred while locking file\n\"d:\\workspace\\eclipse-head\\.metadata\\.plugins\\org.eclipse.pde.core\\New_configuration\\org.eclipse.osgi\\.manager\\.fileTableLock\":\n\"exception test - PAL\". A common reason is that the file system or Runtime\nEnvironment does not support file locking for that location. Please choose a\ndifferent location, or disable file locking passing \"-Dosgi.locking\u003dnone\" as a\nVM argument.\n!STACK 0\njava.io.IOException: An error occurred while locking file\n\"d:\\workspace\\eclipse-head\\.metadata\\.plugins\\org.eclipse.pde.core\\New_configuration\\org.eclipse.osgi\\.manager\\.fileTableLock\":\n\"exception test - PAL\". A common reason is that the file system or Runtime\nEnvironment does not support file locking for that location. Please choose a\ndifferent location, or disable file locking passing \"-Dosgi.locking\u003dnone\" as a\nVM argument.\n\tat\norg.eclipse.core.runtime.internal.adaptor.Locker_JavaNio.lock(Locker_JavaNio.java:48)\n\n\tat\norg.eclipse.core.runtime.adaptor.FileManager.lock(FileManager.java:357)\n\tat\norg.eclipse.core.runtime.adaptor.FileManager.open(FileManager.java:654)\n\tat\norg.eclipse.core.runtime.adaptor.EclipseAdaptor.initFileManager(EclipseAdaptor.java:761)\n\n\tat\norg.eclipse.core.runtime.adaptor.EclipseAdaptor.initialize(EclipseAdaptor.java:125)\n\n\tat \n.....",
    "Jeff, should we consider logging the error for RC1?  or wait for RC2?\n\nI think the more drastic action of failing early may be too much of a change \nfor 3.1.  Although that is probably the correct thing to do, I caution against \nmaking startup behavioral changes this late for 3.1.  (but logging the \nappropriate message would be good for 3.1)",
    "log for RC2",
    "Regarding comment 11, my home dir is just on a regular ext3 partition.  Nothing\ndrastic changed, only some minor software upgrades which I\u0027m 90% certain were\nthings that would not have affected Eclipse.  (i.e. nothing like Gnome or it\u0027s\nlibraries changed.)\n\nPurely from a users perspective, the nice way for this to have been handled\nwould be an option to override the workspace dialog.  Couldn\u0027t the \u0027Workspace is\nin use\u0027 dialog have an extra option \u0027Use anyway\u0027 or \u0027Delete previous session\u0027? \n(A simplistic comparison being how vim handles attempts to use multiple vims on\na file.)",
    "Created an attachment (id\u003d22048)\nfull patch that aborts framework launch\n\nThis is a complete patch that includes the abort of launch if a Filemanager\nopen fails in the base framework. Note that I also moved all Reliable File\nmessages to the defaultAdaptor message property file and these messages also\nreport the base/reference file in any exception messages.",
    "Released patch fom comment 13 into HEAD for RC2.\n\nLeaving defect open to consider releasing patch from comment 17 later.  Should \na new defect be opened for that?",
    "We will consider the bigger fix in a later release.",
    "Created an attachment (id\u003d24149)\nUpdated patch for 3.1 Gm w/ only framework abort\n\nAdding eRCP patch being used that only aborts startup if filemanager\ninitialization fails. This patch does not include the externalization of\nmessages from ReliableFile contained in the previous patch.  eRCP will go\nforward using this patch on 3.1.",
    "We have been running the the \"only framework abort\" patch in eRCP for several months now. The framework abort code is not required, but we discussed this may be  the appropriate behavior. This is a reminder of this issue as eRCP will drop this code when moving to 3.2."
  ],
  "commentCreationDates": [
    "2005-05-24T00:02:40+02:00",
    "2005-05-24T16:12:42+02:00",
    "2005-05-24T16:23:40+02:00",
    "2005-05-25T04:48:18+02:00",
    "2005-05-25T14:54:28+02:00",
    "2005-05-25T15:38:58+02:00",
    "2005-05-25T16:21:50+02:00",
    "2005-05-25T21:43:50+02:00",
    "2005-05-26T17:18:56+02:00",
    "2005-05-26T17:37:08+02:00",
    "2005-05-26T18:01:45+02:00",
    "2005-05-26T19:11:01+02:00",
    "2005-05-26T20:40:41+02:00",
    "2005-05-26T21:15:54+02:00",
    "2005-05-26T21:57:08+02:00",
    "2005-05-26T23:20:26+02:00",
    "2005-05-26T23:32:54+02:00",
    "2005-05-31T17:15:59+02:00",
    "2005-06-02T19:13:51+02:00",
    "2005-06-09T17:48:45+02:00",
    "2005-06-29T21:24:13+02:00",
    "2005-12-02T16:01:04+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.io.IOException",
      "message": "Manager is not opened.",
      "elements": [
        {
          "method": "org.eclipse.core.runtime.adaptor.FileManager.add",
          "source": "FileManager.java:168"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.StreamManager.closeOutputStream",
          "source": "StreamManager.java:229"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.StreamManagerOutputStream.close",
          "source": "StreamManagerOutputStream.java:42"
        },
        {
          "method": "java.io.FilterOutputStream.close",
          "source": "FilterOutputStream.java:143"
        },
        {
          "method": "java.io.FilterOutputStream.close",
          "source": "FilterOutputStream.java:143"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseAdaptor.saveMetaData",
          "source": "EclipseAdaptor.java:675"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseAdaptor.frameworkStop",
          "source": "EclipseAdaptor.java:421"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.SystemBundleActivator.stop",
          "source": "SystemBundleActivator.java:64"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl$3.run",
          "source": "BundleContextImpl.java:1035"
        },
        {
          "method": "java.security.AccessController.doPrivileged",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl.stop",
          "source": "BundleContextImpl.java:1031"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.suspendAllBundles",
          "source": "StartLevelManager.java:653"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.decFWSL",
          "source": "StartLevelManager.java:602"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.doSetStartLevel",
          "source": "StartLevelManager.java:283"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.shutdown",
          "source": "StartLevelManager.java:256"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.SystemBundle.suspend",
          "source": "SystemBundle.java:190"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Framework.shutdown",
          "source": "Framework.java:537"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.SystemBundle$1.run",
          "source": "SystemBundle.java:171"
        },
        {
          "method": "java.lang.Thread.run",
          "source": "Thread.java:534"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "96376",
      "date": "2005-05-24T00:02:40+02:00",
      "product": "Platform",
      "component": "Runtime",
      "severity": "normal"
    },
    {
      "exceptionType": "java.io.IOException",
      "message": "Manager is not opened.",
      "elements": [
        {
          "method": "org.eclipse.core.runtime.adaptor.FileManager.lookup",
          "source": "FileManager.java:387"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseAdaptor.shutdownStateManager",
          "source": "EclipseAdaptor.java:261"
        },
        {
          "method": "org.eclipse.osgi.framework.adaptor.core.AbstractFrameworkAdaptor.frameworkStop",
          "source": "AbstractFrameworkAdaptor.java:272"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseAdaptor.frameworkStop",
          "source": "EclipseAdaptor.java:422"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.SystemBundleActivator.stop",
          "source": "SystemBundleActivator.java:64"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl$3.run",
          "source": "BundleContextImpl.java:1035"
        },
        {
          "method": "java.security.AccessController.doPrivileged",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.BundleContextImpl.stop",
          "source": "BundleContextImpl.java:1031"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.suspendAllBundles",
          "source": "StartLevelManager.java:653"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.decFWSL",
          "source": "StartLevelManager.java:602"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.doSetStartLevel",
          "source": "StartLevelManager.java:283"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.StartLevelManager.shutdown",
          "source": "StartLevelManager.java:256"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.SystemBundle.suspend",
          "source": "SystemBundle.java:190"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Framework.shutdown",
          "source": "Framework.java:537"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.SystemBundle$1.run",
          "source": "SystemBundle.java:171"
        },
        {
          "method": "java.lang.Thread.run",
          "source": "Thread.java:534"
        }
      ],
      "number": 1,
      "commentIndex": 3,
      "bugId": "96376",
      "date": "2005-05-25T04:48:18+02:00",
      "product": "Platform",
      "component": "Runtime",
      "severity": "normal"
    },
    {
      "exceptionType": "java.io.IOException",
      "message": "An error occurred while locking file \"d:\\workspace\\eclipse-head\\.metadata\\.plugins\\org.eclipse.pde.core\\New_configuration\\org.eclipse.osgi\\.manager\\.fileTableLock\": \"exception test - PAL\". A common reason is that the file system or Runtime Environment does not support file locking for that location. Please choose a different location, or disable file locking passing \"-Dosgi.locking\u003dnone\" as a VM argument.",
      "elements": [
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.Locker_JavaNio.lock",
          "source": "Locker_JavaNio.java:48"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.FileManager.lock",
          "source": "FileManager.java:357"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.FileManager.open",
          "source": "FileManager.java:654"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseAdaptor.initFileManager",
          "source": "EclipseAdaptor.java:761"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseAdaptor.initialize",
          "source": "EclipseAdaptor.java:125"
        }
      ],
      "number": 2,
      "commentIndex": 13,
      "bugId": "96376",
      "date": "2005-05-26T21:15:54+02:00",
      "product": "Platform",
      "component": "Runtime",
      "severity": "normal"
    }
  ],
  "groupId": "96376",
  "bugId": "96376",
  "date": "2005-05-24T00:02:40+02:00",
  "product": "Platform",
  "component": "Runtime",
  "severity": "normal"
}