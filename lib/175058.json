{
  "comments": [
    "I have a plug-in that I am developing and it uses Axis and wss4j (for security).  It seems that if wss4j is invoked, it causes a \"MAC error\" when I attempt to connect to a extssh based cvs repository.  If I try to access a pserver repository, all is well.\n\nIf I access the cvs repository before I use Axis, the repository can be accessed for a minute or so after axis has been used, then the error occurs again.\n\nI was wondering what the problem might be and if there is something that I could do to prevent this error.\n\nThe following is the error given when attempting to access an extssh repository.\n\nError\nWed Feb 21 15:02:56 PST 2007\nCould not connect to :extssh:****: CVS communication error: org.eclipse.team.internal.ccvs.ssh2.CVSSSH2ServerConnection$SSH2IOException: MAC Error\n\norg.eclipse.team.internal.ccvs.ssh2.CVSSSH2ServerConnection$SSH2IOException: MAC Error\nat org.eclipse.team.internal.ccvs.ssh2.CVSSSH2ServerConnection.internalOpen(CVSSSH2ServerConnection.java:193)\nat org.eclipse.team.internal.ccvs.ssh2.CVSSSH2ServerConnection.open(CVSSSH2ServerConnection.java:107)\nat org.eclipse.team.internal.ccvs.core.connection.Connection.open(Connection.java:131)\nat org.eclipse.team.internal.ccvs.core.connection.CVSRepositoryLocation.createConnection(CVSRepositoryLocation.java:539)\nat org.eclipse.team.internal.ccvs.core.connection.CVSRepositoryLocation.openConnection(CVSRepositoryLocation.java:780)\nat org.eclipse.team.internal.ccvs.core.client.Session.open(Session.java:159)\nat org.eclipse.team.internal.ccvs.core.resources.RemoteFolderMemberFetcher.performUpdate(RemoteFolderMemberFetcher.java:97)\nat org.eclipse.team.internal.ccvs.ui.operations.FetchMembersOperation$InternalRemoteFolderMemberFetcher.performUpdate(FetchMembersOperation.java:69)\nat org.eclipse.team.internal.ccvs.core.resources.RemoteFolderMemberFetcher.fetchMembers(RemoteFolderMemberFetcher.java:64)\nat org.eclipse.team.internal.ccvs.core.resources.RemoteFolderMemberFetcher.fetchMembers(RemoteFolderMemberFetcher.java:55)\nat org.eclipse.team.internal.ccvs.ui.operations.FetchMembersOperation.execute(FetchMembersOperation.java:107)\nat org.eclipse.team.internal.ccvs.ui.operations.CVSOperation.run(CVSOperation.java:81)\nat org.eclipse.team.internal.ccvs.ui.model.RemoteFolderElement.fetchDeferredChildren(RemoteFolderElement.java:72)\nat org.eclipse.ui.progress.DeferredTreeContentManager$1.run(DeferredTreeContentManager.java:196)\nat org.eclipse.core.internal.jobs.Worker.run(Worker.java:58)\nCaused by: com.jcraft.jsch.JSchException: Session.connect: java.io.IOException: MAC Error\nat com.jcraft.jsch.Session.connect(Unknown Source)\nat com.jcraft.jsch.Session.connect(Unknown Source)\nat org.eclipse.team.internal.ccvs.ssh2.JSchSession.createSession(JSchSession.java:495)\nat org.eclipse.team.internal.ccvs.ssh2.JSchSession.getSession(JSchSession.java:447)\nat org.eclipse.team.internal.ccvs.ssh2.CVSSSH2ServerConnection.internalOpen(CVSSSH2ServerConnection.java:122)\n... 14 more",
    "JSch makes use of the JCE from the JRE so it is possible that wss4j is changing some JRE setting that is causing JSch to fail. I\u0027ve copied the owner of JSch in case he has any light to shed on this.",
    "I can not guess the reason and it must be bug from JCE.\nWhich J2SE version are you using?\n",
    "Created an attachment (id\u003d59961)\nThis jar will not use JCE to calculate HMAC.\n\nI\u0027m reviewing the code of wss4j and it seems wss4j has used JCE to \ncalculate HMACSHA1.\n\nAttached jsch jar will not use JCE for HMAC calculation.\nMay I ask you to try it, if possible?\n\nAfter backing up plugins/com.jcraft.jsch_0.1.28.jar,\ndelete it and save the attached jar into plugins/com.jcraft.jsch_0.1.32.jar\n",
    "Thank you very much for finding this.  I will check out the plugin by friday and let you know the status.",
    "I just tested this, and I have the same problems with 0.1.32.  Any other ideas?",
    "(In reply to comment #5)\n\u003e I just tested this, and I have the same problems with 0.1.32.  Any other ideas?\n\nNo ideas, because there is no informations about environments(JRE version\nand JCE provider if additionally installed) to reproduce that problem.\n\nI guess that problem must not relate to Eclipse and wss4j, and it\nmust come from the simultaneous usage of JCE instances in jsch and wss4j.\nSo, I had been trying to reproduce such a problem without them\non my environment(Sun\u0027s 1.5.0_06 with default JCE provider), but I had not\nbeen able to.\n",
    "Created an attachment (id\u003d60296)\nThis jar will use blowfish instead of 3des for cipher operations.\n\nIf possible, may I ask you to try above jar to understand where is the problme?\nIt seems wss4j has used 3des and jsch will also choose 3des by the default,\nso the choice of blowfish cipher may change something.\n\n\n ",
    "(In reply to comment #6)\n\n\u003e No ideas, because there is no informations about environments(JRE version\n\u003e and JCE provider if additionally installed) to reproduce that problem.\n\u003e I guess that problem must not relate to Eclipse and wss4j, and it\n\u003e must come from the simultaneous usage of JCE instances in jsch and wss4j.\n\u003e So, I had been trying to reproduce such a problem without them\n\u003e on my environment(Sun\u0027s 1.5.0_06 with default JCE provider), but I had not\n\u003e been able to.\n\nSorry I forgot to give you more information.  I am using Sun\u0027s JRE 1.5.0_10 and\nhave no other JCE providers installed that I know of.  I am running on windows\nXP SP2 if that helps as well.  I also tested this with Sun\u0027s JRE 1.6.0 and have\nthe same problem.\n\nI will test the new jar a bit later today or tommorow first thing.",
    "So, I have tried the new jar file that you provided.  Using the new plugin results in the same error, but only if the web service is run before cvs.  I can\u0027t seem to get the error to occur anymore if cvs is accessed first.",
    "(In reply to comment #9)\n\u003e So, I have tried the new jar file that you provided.  Using the new plugin\n\u003e results in the same error, but only if the web service is run before cvs.  I\n\u003e can\u0027t seem to get the error to occur anymore if cvs is accessed first.\n\nThat means that the start of wss4j will disturb other programs which use JCE.\nHave you written this issue to wss4j developers?\nThey will be able to find the problem sooner than me.\n\nAt a glance for wss4j source code, it seems to me it has mechanism to add\nJCE provider dynamically, even if you wrote you have been using the default\nJCE provider.\n",
    "(In reply to comment #10)\n\u003e (In reply to comment #9)\n\u003e \u003e So, I have tried the new jar file that you provided.  Using the new plugin\n\u003e \u003e results in the same error, but only if the web service is run before cvs.  I\n\u003e \u003e can\u0027t seem to get the error to occur anymore if cvs is accessed first.\n\u003e That means that the start of wss4j will disturb other programs which use JCE.\n\u003e Have you written this issue to wss4j developers?\n\nI have not done this yet, but I will do so right now.  Thanks for looking into this.\n\n\u003e They will be able to find the problem sooner than me.\n\u003e At a glance for wss4j source code, it seems to me it has mechanism to add\n\u003e JCE provider dynamically, even if you wrote you have been using the default\n\u003e JCE provider.\n\n",
    "Created an attachment (id\u003d60352)\nThis jar will specify \"SunJCE\" explicitly in using JCE API.\n\nThe attached jar will specify the JCE provider name \"SunJCE\" in\ngetting JCE instances.  You have thought that you have only used the default\nJCE provider and you may feel it is just a waste of time, \nbut please try it if possible.\n\n",
    "This one works, and trying this is never a waste of time.  I guess that wss4j must be installing a different JCE provider.  I will post another message to the wss4j board that mentions this problem and see if they have a solution.  Do you know of any way to resolve this issue without distributing the new version of jsch?\n\nThanks again for everything.",
    "(In reply to comment #13)\n\u003e This one works, and trying this is never a waste of time.  I guess that wss4j\n\u003e must be installing a different JCE provider.  I will post another message to\n\u003e the wss4j board that mentions this problem and see if they have a solution. \n\nMay I ask you to run following code after running your plug-in?\n\nimport java.security.*;\nimport javax.crypto.*;\n\npublic class foo {\n\tpublic static void main(String[] args) {\n\t\tProvider[] providers\u003dSecurity.getProviders();\n\t\tfor(int i\u003d0; i\u003cproviders.length; i++){\n\t\t\tSystem.out.println(providers[i].getName());\n\t\t}\n\t\ttry {\n\t\t\tString transformation\u003d\"DESede/CBC/NoPadding\";\n\t\t\tSystem.out.println(\"Cipher: \"+Cipher.getInstance(transformation).getProvider());\n\t\t} catch (Exception e) {\n\t\t}\n\t}\n}\n\n\u003e Do you know of any way to resolve this issue without distributing the new version\n\u003e of jsch?\n\nAt present time, I don\u0027t have any plan to change jsch code for this issue.\n\nIMHO, the essence of this problem is that wss4j have loded some JCE provider\nand that provider has not connectly implemnted \n  DESede/CBC/NoPadding\n  Blowfish/CBC/NoPadding\n.\n\nI will hope the improvements on their side.\n",
    "Here is the output from the program.\n\nBefore Web Service is run:\nSUN\nSunRsaSign\nSunJSSE\nSunJCE\nSunJGSS\nSunSASL\nXMLDSig\nSunPCSC\nSunMSCAPI\nCipher:SunJCE version 1.6\n\nAfter Web Service is run:\nSUN\nBC\nSunRsaSign\nSunJSSE\nSunJCE\nSunJGSS\nSunSASL\nXMLDSig\nSunPCSC\nSunMSCAPI\nCipher:BC version 1.28\n\nIt looks like you are correct in thinking that wss4j is installing a different JCE provider.  It looks like I will have to get the wss4j team to look into this further.  Thanks for all of the help.",
    "(In reply to comment #15)\n\u003e After Web Service is run:\n\u003e SUN\n\u003e BC\n\u003e SunRsaSign\n\u003e SunJSSE\n\u003e SunJCE\n\u003e SunJGSS\n\u003e SunSASL\n\u003e XMLDSig\n\u003e SunPCSC\n\u003e SunMSCAPI\n\u003e Cipher:BC version 1.28\n\nI know about \"BC\"(http://www.bouncycastle.org).  It is great software.\nI had used it to port jsch into J2ME(MIDP2.0) and it had worked nice.\nAt that time, I had used its lightweight API.  So, there may exist a problem \nin its JCE binding.\n\nMay I ask you to run following code after enabling your plug-in?\nI guess that wss4j can run on Java5 without BC.\n\nimport java.security.*;\npublic class foo {\n  public static void main(String[] args) {\n    Security.removeProvider(\"BC\");\n  }\n}\n",
    "By removing BC after I execute a web service, it seems to solve the problem, so now I have a good work around. I will need to investigate further whether I can tell wss4j to use the default JCE provider and not BC since it seems that it installs it on every call if it doesn\u0027t exist.  This means that if someone is trying to use jsch at the same time as wss4j, the MAC error still occurs. Thanks for all of the help on this, it is greatly appreciated.  ",
    "(In reply to comment #17)\n\u003e By removing BC after I execute a web service, it seems to solve the problem, so\n\u003e now I have a good work around. I will need to investigate further whether I can\n\u003e tell wss4j to use the default JCE provider and not BC since it seems that it\n\u003e installs it on every call if it doesn\u0027t exist.  This means that if someone is\n\u003e trying to use jsch at the same time as wss4j, the MAC error still occurs.\n\u003e Thanks for all of the help on this, it is greatly appreciated.  \n\nI guess your plug-in has explicitly added a jar for BC to CLASSPATH.\nHow about droping it?   From Eclipse plug-in point of view, we can expect\nJDK 1.4 (and later) on Eclipse SDK 3* and wss4j must be runnable without \nBC there.\n\nIt seems wss4j has check if BC is available, and if it is not available wss4j\nwill ignore it without any errors.\n\n\n",
    "After removing the BC jar, all works fine.  Thanks for everything.",
    "Marking as INVALID as this appears to be a client configuration problem. If my assessment is wrong and there is something that needs to be done in the Eclipse client, please reopen.",
    "Atsuhiko, Shawn: nice detective work :)\n\nMichael: should we add this to a FAQ since others using the default wss4j setup could encounter it? ",
    "(In reply to comment #21)\n\u003e Atsuhiko, Shawn: nice detective work :)\n\u003e Michael: should we add this to a FAQ since others using the default wss4j setup\n\u003e could encounter it? \n\nI have tried JCE Provider by BC 1.36(latest version) and there is not \na probelm.  I can not get the formal BC 1.28, but I hardly believe that\nit has a problem.  Shawn, how do you get a jar for BC?  Did you compile it\nfrom the source code?  How about the possibility that jar is customized\n(stripped) version to run only wss4j?\n",
    "I am in favour of adding this to the FAQ but I would ask one of the parties involved in the discussion to do so since this is not my area of expertise. Alternately, if someone could add a comment to this bug that gave a concise one or two paragraph description of the problem and the solution, I would be happy to put it on the wiki. Here\u0027s a link to the wiki:\n\nhttp://wiki.eclipse.org/index.php/CVS_FAQ",
    "The jar that I had in my classpath was bcprov-jdk1.3-128.jar.  I had got this jar from some sample code that I was following to build my application.  So, to answer your question, it wasn\u0027t compiled from source by me, and it could have possibly been stripped just for the purpose of running the web services.",
    "Shawn: please provide Michael with a concise paragraph or two on how to notice and address this problem (i.e. some \"MAC error\" in Error Log) with enough of a description that a developer\u0027s Google search for it would find the entry.  "
  ],
  "commentCreationDates": [
    "2007-02-21T23:15:30+01:00",
    "2007-02-27T16:03:06+01:00",
    "2007-02-28T10:14:27+01:00",
    "2007-02-28T11:23:22+01:00",
    "2007-03-01T04:28:05+01:00",
    "2007-03-05T23:54:44+01:00",
    "2007-03-06T00:53:54+01:00",
    "2007-03-06T01:04:19+01:00",
    "2007-03-06T01:08:56+01:00",
    "2007-03-06T03:56:52+01:00",
    "2007-03-06T07:56:33+01:00",
    "2007-03-06T16:39:54+01:00",
    "2007-03-07T03:20:35+01:00",
    "2007-03-07T04:24:22+01:00",
    "2007-03-07T05:46:29+01:00",
    "2007-03-07T21:36:42+01:00",
    "2007-03-08T06:57:17+01:00",
    "2007-03-08T17:02:52+01:00",
    "2007-03-09T05:34:21+01:00",
    "2007-03-09T17:29:36+01:00",
    "2007-03-12T16:28:25+01:00",
    "2007-03-16T02:05:47+01:00",
    "2007-03-16T03:41:36+01:00",
    "2007-03-16T13:18:35+01:00",
    "2007-03-16T21:16:29+01:00",
    "2007-03-19T04:08:33+01:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.team.internal.ccvs.ssh2.CVSSSH2ServerConnection$SSH2IOException",
      "message": "MAC Error",
      "elements": [
        {
          "method": "org.eclipse.team.internal.ccvs.ssh2.CVSSSH2ServerConnection.internalOpen",
          "source": "CVSSSH2ServerConnection.java:193"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ssh2.CVSSSH2ServerConnection.open",
          "source": "CVSSSH2ServerConnection.java:107"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.connection.Connection.open",
          "source": "Connection.java:131"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.connection.CVSRepositoryLocation.createConnection",
          "source": "CVSRepositoryLocation.java:539"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.connection.CVSRepositoryLocation.openConnection",
          "source": "CVSRepositoryLocation.java:780"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.client.Session.open",
          "source": "Session.java:159"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.resources.RemoteFolderMemberFetcher.performUpdate",
          "source": "RemoteFolderMemberFetcher.java:97"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ui.operations.FetchMembersOperation$InternalRemoteFolderMemberFetcher.performUpdate",
          "source": "FetchMembersOperation.java:69"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.resources.RemoteFolderMemberFetcher.fetchMembers",
          "source": "RemoteFolderMemberFetcher.java:64"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.core.resources.RemoteFolderMemberFetcher.fetchMembers",
          "source": "RemoteFolderMemberFetcher.java:55"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ui.operations.FetchMembersOperation.execute",
          "source": "FetchMembersOperation.java:107"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ui.operations.CVSOperation.run",
          "source": "CVSOperation.java:81"
        },
        {
          "method": "org.eclipse.team.internal.ccvs.ui.model.RemoteFolderElement.fetchDeferredChildren",
          "source": "RemoteFolderElement.java:72"
        },
        {
          "method": "org.eclipse.ui.progress.DeferredTreeContentManager$1.run",
          "source": "DeferredTreeContentManager.java:196"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:58"
        }
      ],
      "causedBy": {
        "exceptionType": "java.io.IOException",
        "message": "MAC Error",
        "elements": [
          {
            "method": "com.jcraft.jsch.Session.connect",
            "source": "Unknown Source"
          },
          {
            "method": "com.jcraft.jsch.Session.connect",
            "source": "Unknown Source"
          },
          {
            "method": "org.eclipse.team.internal.ccvs.ssh2.JSchSession.createSession",
            "source": "JSchSession.java:495"
          },
          {
            "method": "org.eclipse.team.internal.ccvs.ssh2.JSchSession.getSession",
            "source": "JSchSession.java:447"
          },
          {
            "method": "org.eclipse.team.internal.ccvs.ssh2.CVSSSH2ServerConnection.internalOpen",
            "source": "CVSSSH2ServerConnection.java:122"
          }
        ],
        "number": 0,
        "commentIndex": 0
      },
      "number": 0,
      "commentIndex": 0,
      "bugId": "175058",
      "date": "2007-02-21T23:15:30+01:00",
      "product": "Platform",
      "component": "CVS",
      "severity": "normal"
    }
  ],
  "groupId": "175058",
  "bugId": "175058",
  "date": "2007-02-21T23:15:30+01:00",
  "product": "Platform",
  "component": "CVS",
  "severity": "normal"
}