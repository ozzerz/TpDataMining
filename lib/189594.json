{
  "comments": [
    "Build ID: 3.3M7\n\nSteps To Reproduce:\n1. Create a diagram mapping which accepts shortcuts to its own domain model elements\n2. Generate, start, create diagram instance, and create a node. Save. Load shortcut view of this node from the domain model file being edited currently. \n3. Now delete the initial node, an exception is thrown and the view is not marked invalid with an X as expected\n\nThe Exception is SemanticRefreshFailed\njava.lang.ClassCastException: de.uka.ipd.sdq.pcm.repository.impl.RepositoryImpl cannot be cast to de.uka.ipd.sdq.pcm.repository.Interface\n\tat de.uka.ipd.sdq.pcm.gmf.repository.part.PalladioComponentModelDiagramUpdater.getInterfaceSignatureList_7101SemanticChildren(PalladioComponentModelDiagramUpdater.java:78)\n\tat de.uka.ipd.sdq.pcm.gmf.repository.edit.policies.InterfaceSignatureListCanonicalEditPolicy.getSemanticChildrenList(InterfaceSignatureListCanonicalEditPolicy.java:42)\n\tat org.eclipse.gmf.runtime.diagram.ui.editpolicies.CanonicalEditPolicy.refreshSemanticChildren(CanonicalEditPolicy.java:1088)\n\tat org.eclipse.gmf.runtime.diagram.ui.editpolicies.CanonicalEditPolicy.refreshSemantic(CanonicalEditPolicy.java:980)\n\tat org.eclipse.gmf.runtime.diagram.ui.editpolicies.CanonicalEditPolicy.refresh(CanonicalEditPolicy.java:962)\n\tat org.eclipse.gmf.runtime.diagram.ui.editpolicies.CanonicalEditPolicy.refreshOnActivate(CanonicalEditPolicy.java:662)\n\tat org.eclipse.gmf.runtime.diagram.ui.editpolicies.CanonicalEditPolicy.activate(CanonicalEditPolicy.java:652)\n\tat org.eclipse.gef.editparts.AbstractEditPart.activateEditPolicies(AbstractEditPart.java:165)\n\tat org.eclipse.gef.editparts.AbstractEditPart.activate(AbstractEditPart.java:148)\n\nwhere Repository is my root diagram domain element and interface the eclass of the node which i shortcutted. I also had problems like this before comming from resolveSemanticElement() which returns the parent element in case the child element is deleted which I did not expect. Btw. is this expected behaviour of resolveSemanticElement()?\n\nMore information:",
    "I just relized that the description is incomple. The linked node probabily must have a compartment showing child elements to trigger the bug. In my case I was linking an Interface EClass which contained its signatures in a compartment",
    "Can you please post here generated PalladioComponentModelDiagramUpdater.getInterfaceSignatureList_7101SemanticChildren method and highlight line 78 in it? \n",
    "Sure,\n\nit is \n\t/**\n\t * @generated\n\t */\n\tpublic static List getInterfaceSignatureList_7101SemanticChildren(View view) {\n\t\tInterface modelElement \u003d (Interface) view.getElement();\n\t\tList result \u003d new LinkedList();\n\t\tfor (Iterator it \u003d modelElement.getSignatures__Interface().iterator(); it\n\t\t\t\t.hasNext();) {\n\t\t\tSignature childElement \u003d (Signature) it.next();\n\t\t\tint visualID \u003d PalladioComponentModelVisualIDRegistry\n\t\t\t\t\t.getNodeVisualID(view, childElement);\n\t\t\tif (visualID \u003d\u003d SignatureEditPart.VISUAL_ID) {\n\t\t\t\tresult.add(new PalladioComponentModelNodeDescriptor(\n\t\t\t\t\t\tchildElement, visualID));\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\nwith the first line of the method being line 78",
    "So obviously view.getElement() returns a Repository object instead of an Interface object when the interface gets deleted. I would expect it to return null, why is it returning its former parent?",
    "Answer to Comment #4 - current implementation of this method:\n\npublic EObject getElement() {\n   if (!isSetElement()) {\n      EObject container \u003d eContainer();\n      if (container instanceof View) {\n         View view \u003d (View) container;\n         element \u003d view.getElement();\n      }\n   }\n......\n}\n\nSo, if element is not set for ViewImpl then element of the parent view will be returned.\n\nNow I can reproduce this problem with the Ecore diagram example - I\u0027ll try to find workaround for it.",
    "The problem fixed, but in general situation you should remove all necessary views associated with this domain model element on deleting original view.",
    "Thanks for the fix. Do I have to do it manually or will it be supported by the generated code eventually? The deletion of the view can be derived from the models...",
    "In the generic case it\u0027s not clear where to get View instances/corresponding DiagramEditors to delete elements from (user could use same EditingDomain for several diagrams?).\n\nCurrently generated code search for the existing shortcuts to this element and remove these shortcuts on element deletion (should cover your situation ;-)).\n"
  ],
  "commentCreationDates": [
    "2007-05-29T09:16:54+02:00",
    "2007-05-29T09:20:23+02:00",
    "2007-05-29T10:28:18+02:00",
    "2007-05-29T14:11:37+02:00",
    "2007-05-29T14:13:53+02:00",
    "2007-05-29T16:54:40+02:00",
    "2007-05-30T16:49:01+02:00",
    "2007-05-30T20:38:56+02:00",
    "2007-05-31T15:47:06+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ClassCastException",
      "message": "de.uka.ipd.sdq.pcm.repository.impl.RepositoryImpl cannot be cast to de.uka.ipd.sdq.pcm.repository.Interface",
      "elements": [
        {
          "method": "de.uka.ipd.sdq.pcm.gmf.repository.part.PalladioComponentModelDiagramUpdater.getInterfaceSignatureList_7101SemanticChildren",
          "source": "PalladioComponentModelDiagramUpdater.java:78"
        },
        {
          "method": "de.uka.ipd.sdq.pcm.gmf.repository.edit.policies.InterfaceSignatureListCanonicalEditPolicy.getSemanticChildrenList",
          "source": "InterfaceSignatureListCanonicalEditPolicy.java:42"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.editpolicies.CanonicalEditPolicy.refreshSemanticChildren",
          "source": "CanonicalEditPolicy.java:1088"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.editpolicies.CanonicalEditPolicy.refreshSemantic",
          "source": "CanonicalEditPolicy.java:980"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.editpolicies.CanonicalEditPolicy.refresh",
          "source": "CanonicalEditPolicy.java:962"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.editpolicies.CanonicalEditPolicy.refreshOnActivate",
          "source": "CanonicalEditPolicy.java:662"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.editpolicies.CanonicalEditPolicy.activate",
          "source": "CanonicalEditPolicy.java:652"
        },
        {
          "method": "org.eclipse.gef.editparts.AbstractEditPart.activateEditPolicies",
          "source": "AbstractEditPart.java:165"
        },
        {
          "method": "org.eclipse.gef.editparts.AbstractEditPart.activate",
          "source": "AbstractEditPart.java:148"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "189594",
      "date": "2007-05-29T09:16:54+02:00",
      "product": "GMF",
      "component": "Generation",
      "severity": "normal"
    }
  ],
  "groupId": "189594",
  "bugId": "189594",
  "date": "2007-05-29T09:16:54+02:00",
  "product": "GMF",
  "component": "Generation",
  "severity": "normal"
}