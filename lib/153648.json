{
  "comments": [
    "We use a tool which hooks a ProgressMonitorDialog.run() action with fork set\nto true into the Apply button of a project level preference page. In Eclipse \n3.1, the code runs fine. In Eclipse 3.2.1, we get:\n\norg.eclipse.swt.SWTException: Invalid thread access\n                at org.eclipse.swt.SWT.error(SWT.java:3374)\n                at org.eclipse.swt.SWT.error(SWT.java:3297)\n                at org.eclipse.swt.SWT.error(SWT.java:3268)\n                at org.eclipse.swt.widgets.Widget.error(Widget.java:435)\n                at org.eclipse.swt.widgets.Shell.\u003cinit\u003e(Shell.java:271)\n                at org.eclipse.swt.widgets.Shell.\u003cinit\u003e(Shell.java:357)\n                at org.eclipse.jface.window.Window.createShell(Window.java:482)\n                at org.eclipse.jface.window.Window.create(Window.java:425)\n                at org.eclipse.jface.dialogs.Dialog.create(Dialog.java:1124)\n                at org.eclipse.jface.window.Window.open(Window.java:785)\n                at org.eclipse.jface.dialogs.ProgressMonitorDialog.open(ProgressMonitorDialog.java:640)\n                at org.eclipse.jface.dialogs.ProgressMonitorDialog.aboutToRun(ProgressMonitorDialog.java:551)\n                at org.eclipse.jface.dialogs.ProgressMonitorDialog.run(ProgressMonitorDialog.java:476)",
    "Can you attach the full log please? This is not enough to see who is invoking this code.",
    "Here\u0027s the entire stack trace:\n\norg.eclipse.swt.SWTException: Invalid thread access\n\tat org.eclipse.swt.SWT.error(SWT.java:3374)\n\tat org.eclipse.swt.SWT.error(SWT.java:3297)\n\tat org.eclipse.swt.SWT.error(SWT.java:3268)\n\tat org.eclipse.swt.widgets.Widget.error(Widget.java:435)\n\tat org.eclipse.swt.widgets.Shell.\u003cinit\u003e(Shell.java:271)\n\tat org.eclipse.swt.widgets.Shell.\u003cinit\u003e(Shell.java:357)\n\tat org.eclipse.jface.window.Window.createShell(Window.java:482)\n\tat org.eclipse.jface.window.Window.create(Window.java:425)\n\tat org.eclipse.jface.dialogs.Dialog.create(Dialog.java:1124)\n\tat org.eclipse.jface.window.Window.open(Window.java:785)\n\tat org.eclipse.jface.dialogs.ProgressMonitorDialog.open(ProgressMonitorDialog.java:640)\n\tat org.eclipse.jface.dialogs.ProgressMonitorDialog.aboutToRun(ProgressMonitorDialog.java:551)\n\tat org.eclipse.jface.dialogs.ProgressMonitorDialog.run(ProgressMonitorDialog.java:476)\n\tat com.ibm.sdwb.cmvc.client.eclipse.team.ui.actions.SyncAction.performAction(SyncAction.java:195)\n\tat com.ibm.sdwb.cmvc.client.eclipse.team.ui.actions.SyncAction$1.run(SyncAction.java:109)\n\tat org.eclipse.jface.operation.ModalContext$ModalContextThread.run(ModalContext.java:113)\n",
    "It looks like com.ibm.sdwb.cmvc.client.eclipse.team.ui.actions.SyncAction.performAction is being called from outside of the main Thread which should not happen. Is this in a component I can look at or if not can you make up an example?\n\nAdding Susan and Boris as they are the only ones who touched this in 3.2 (it seems)",
    "Created an attachment (id\u003d48278)\nTest example\n\nHere is a plug-in that does as you describe - I run a runnable forked that updates the progress monitor.\n\nPlease modify my example or attach your own to demonstrate the problem.",
    "The example is very similar to the actual code that I have.",
    "My code runs without an exception. I can\u0027t proceed on this until I have an example that shows the problem.\n\nDoes your code access any widgets at any time?",
    "My changes during 3.2 added exception handling while running the event loop.  Prior to those changes, an exception during ModalContextThread.block() would cause the event loop to exit, which would cause symptoms such as the calling wizard not closing.  (See bug #78222).  So I would expect code that already had errors in 3.1 might have different side effects (logged exceptions instead of UI lock), but I would expect to see the stack trace coming from the event loop in the block() call.  So I don\u0027t think those changes would cause this problem, but I\u0027ll watch this bug as it evolves...",
    "Tod,\n\nI modified your example and can now reproduce the problem using this testcase. Basically, there are two ProgressMonitorDialogs involved. The first IRunnableWithProgress executed inside the ProgressMonitorDialog spawns another ProgressMonitorDialog and attempts to execute another IRunnableWithProgress. I will attach the modified testcase shortly.",
    "Created an attachment (id\u003d48312)\nModified Test example\n\n",
    "This is expected behaviour. Below is the stack trace from 3.1.2 for your example which is the same as you are seeing.\n\nWhen you fork a process you will not be in the UI Thread and so you will get this  error if you run it. As you are calling from the UI Thread if you fork it is guaranteed to not run in it.\n\nFrom IRunnableContext.\n\n/**\n     * Runs the given \u003ccode\u003eIRunnableWithProgress\u003c/code\u003e in this context.\n     * For example, if this is a \u003ccode\u003eProgressMonitorDialog\u003c/code\u003e then the runnable\n     * is run using this dialog\u0027s progress monitor.\n     *\n     * @param fork \u003ccode\u003etrue\u003c/code\u003e if the runnable should be run in a separate thread,\n     *  and \u003ccode\u003efalse\u003c/code\u003e to run in the same thread\n     * @param cancelable \u003ccode\u003etrue\u003c/code\u003e to enable the cancelation, and\n     *  \u003ccode\u003efalse\u003c/code\u003e to make the operation uncancellable\n     * @param runnable the runnable to run\n     *\n     * @exception InvocationTargetException wraps any exception or error which occurs \n     *  while running the runnable\n     * @exception InterruptedException propagated by the context if the runnable \n     *  acknowledges cancelation by throwing this exception.  This should not be thrown\n     *  if cancelable is \u003ccode\u003efalse\u003c/code\u003e.\n\nCaused by: org.eclipse.swt.SWTException: Invalid thread access\n\tat org.eclipse.swt.SWT.error(SWT.java:2942)\n\tat org.eclipse.swt.SWT.error(SWT.java:2865)\n\tat org.eclipse.swt.SWT.error(SWT.java:2836)\n\tat org.eclipse.swt.widgets.Widget.error(Widget.java:395)\n\tat org.eclipse.swt.widgets.Widget.checkWidget(Widget.java:298)\n\tat org.eclipse.swt.widgets.Control.getShell(Control.java:998)\n\tat Bug153648Test$1.run(Bug153648Test.java:41)\n\tat org.eclipse.jface.operation.ModalContext$ModalContextThread.run(ModalContext.java:113)\n"
  ],
  "commentCreationDates": [
    "2006-08-11T22:22:27+02:00",
    "2006-08-14T16:38:45+02:00",
    "2006-08-18T15:43:46+02:00",
    "2006-08-21T14:12:01+02:00",
    "2006-08-21T15:39:34+02:00",
    "2006-08-21T15:44:57+02:00",
    "2006-08-21T16:50:21+02:00",
    "2006-08-21T17:40:08+02:00",
    "2006-08-21T19:36:35+02:00",
    "2006-08-21T19:37:57+02:00",
    "2006-08-21T21:43:07+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.swt.SWTException",
      "message": "Invalid thread access",
      "elements": [
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3374"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3297"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3268"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.error",
          "source": "Widget.java:435"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.\u003cinit\u003e",
          "source": "Shell.java:271"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.\u003cinit\u003e",
          "source": "Shell.java:357"
        },
        {
          "method": "org.eclipse.jface.window.Window.createShell",
          "source": "Window.java:482"
        },
        {
          "method": "org.eclipse.jface.window.Window.create",
          "source": "Window.java:425"
        },
        {
          "method": "org.eclipse.jface.dialogs.Dialog.create",
          "source": "Dialog.java:1124"
        },
        {
          "method": "org.eclipse.jface.window.Window.open",
          "source": "Window.java:785"
        },
        {
          "method": "org.eclipse.jface.dialogs.ProgressMonitorDialog.open",
          "source": "ProgressMonitorDialog.java:640"
        },
        {
          "method": "org.eclipse.jface.dialogs.ProgressMonitorDialog.aboutToRun",
          "source": "ProgressMonitorDialog.java:551"
        },
        {
          "method": "org.eclipse.jface.dialogs.ProgressMonitorDialog.run",
          "source": "ProgressMonitorDialog.java:476"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "153648",
      "date": "2006-08-11T22:22:27+02:00",
      "product": "Platform",
      "component": "UI",
      "severity": "major"
    },
    {
      "exceptionType": "org.eclipse.swt.SWTException",
      "message": "Invalid thread access",
      "elements": [
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3374"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3297"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:3268"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.error",
          "source": "Widget.java:435"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.\u003cinit\u003e",
          "source": "Shell.java:271"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.\u003cinit\u003e",
          "source": "Shell.java:357"
        },
        {
          "method": "org.eclipse.jface.window.Window.createShell",
          "source": "Window.java:482"
        },
        {
          "method": "org.eclipse.jface.window.Window.create",
          "source": "Window.java:425"
        },
        {
          "method": "org.eclipse.jface.dialogs.Dialog.create",
          "source": "Dialog.java:1124"
        },
        {
          "method": "org.eclipse.jface.window.Window.open",
          "source": "Window.java:785"
        },
        {
          "method": "org.eclipse.jface.dialogs.ProgressMonitorDialog.open",
          "source": "ProgressMonitorDialog.java:640"
        },
        {
          "method": "org.eclipse.jface.dialogs.ProgressMonitorDialog.aboutToRun",
          "source": "ProgressMonitorDialog.java:551"
        },
        {
          "method": "org.eclipse.jface.dialogs.ProgressMonitorDialog.run",
          "source": "ProgressMonitorDialog.java:476"
        },
        {
          "method": "com.ibm.sdwb.cmvc.client.eclipse.team.ui.actions.SyncAction.performAction",
          "source": "SyncAction.java:195"
        },
        {
          "method": "com.ibm.sdwb.cmvc.client.eclipse.team.ui.actions.SyncAction$1.run",
          "source": "SyncAction.java:109"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext$ModalContextThread.run",
          "source": "ModalContext.java:113"
        }
      ],
      "number": 1,
      "commentIndex": 2,
      "bugId": "153648",
      "date": "2006-08-18T15:43:46+02:00",
      "product": "Platform",
      "component": "UI",
      "severity": "major"
    },
    {
      "exceptionType": "org.eclipse.swt.SWTException",
      "message": "Invalid thread access",
      "elements": [
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:2942"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:2865"
        },
        {
          "method": "org.eclipse.swt.SWT.error",
          "source": "SWT.java:2836"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.error",
          "source": "Widget.java:395"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.checkWidget",
          "source": "Widget.java:298"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.getShell",
          "source": "Control.java:998"
        },
        {
          "method": "Bug153648Test$1.run",
          "source": "Bug153648Test.java:41"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext$ModalContextThread.run",
          "source": "ModalContext.java:113"
        }
      ],
      "number": 2,
      "commentIndex": 10,
      "bugId": "153648",
      "date": "2006-08-21T21:43:07+02:00",
      "product": "Platform",
      "component": "UI",
      "severity": "major"
    }
  ],
  "groupId": "153648",
  "bugId": "153648",
  "date": "2006-08-11T22:22:27+02:00",
  "product": "Platform",
  "component": "UI",
  "severity": "major"
}