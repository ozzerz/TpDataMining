{
  "comments": [
    "There seems to be a major problem with the CMP bean wizard in 1.5RC5 and 1.5RC6-200606202329: I try to add an entity bean and use the use case \"Define new attributes\". \nAfter clicking \"next\" the \"CMP attributes\" page comes up, but clicking on the\n\"Add\" button does not add a new table row, so that I cannot use the wizard in\nfact (Finish-Button is always disabled). \n\nI created an EJB project with JBoss 4 runtime and JDK 1.4, XDoclet 1.2.3 facet is actived. \nThe wizard page shows an error message \"Entity bean has no attributes\" which is perfectly correct. \nNo error in the log file.\n\nPressing \"Enter\" in the \"Table\" combobox gives this error message in the log:\n\n!ENTRY org.eclipse.ui 4 4 2006-06-21 09:16:18.749\n!MESSAGE Unhandled event loop exception\n\n!ENTRY org.eclipse.ui 4 0 2006-06-21 09:16:18.749\n!MESSAGE -1\n!STACK 0\njava.lang.ArrayIndexOutOfBoundsException: -1\n\tat java.util.ArrayList.get(Unknown Source)\n\tat org.eclipse.jst.j2ee.ejb.annotation.ui.internal.cmp.wizards.ChooseTableWizardPage$1.widgetDefaultSelected(ChooseTableWizardPage.java:135)\n\tat org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:97)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:928)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3348)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2968)\n\tat org.eclipse.jface.window.Window.runEventLoop(Window.java:820)\n\tat org.eclipse.jface.window.Window.open(Window.java:796)\n\tat org.eclipse.ui.internal.navigator.wizards.WizardShortcutAction.run(WizardShortcutAction.java:94)\n\tat org.eclipse.jface.action.Action.runWithEvent(Action.java:499)\n\tat org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:539)\n\tat org.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:488)\n\tat org.eclipse.jface.action.ActionContributionItem$5.handleEvent(ActionContributionItem.java:400)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:928)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3348)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2968)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1914)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1878)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:419)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)\n\tat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:95)\n\tat org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:78)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:92)\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:68)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:400)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:177)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n\tat java.lang.reflect.Method.invoke(Unknown Source)\n\tat org.eclipse.core.launcher.Main.invokeFramework(Main.java:336)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:280)\n\tat org.eclipse.core.launcher.Main.run(Main.java:977)\n\tat org.eclipse.core.launcher.Main.main(Main.java:952)",
    "This is a regression bug the use caes for \"define new attributes\" fails because the model getProperty returns default property for attributes, but does not set it so attributes are lost as they are added.\n\nthe patch is attached.  Changes are localized, tested and safe.  I vote +1 for 1.5\n\nOther changes to improve the usability (see bug: 126152) of the CMP wizard will be scheduled for 1.5.1 (i.e. add dimensions for VARCHARs etc.)  Currently these can be edited in the source annotations.\n\n",
    "Created an attachment (id\u003d44981)\nFix add attribute patch\n\n",
    "Raising priority to P2",
    "(From update of attachment 44981)\n### Eclipse Workspace Patch 1.0\n#P org.eclipse.jst.j2ee.ejb.annotations.ui\nIndex: src/org/eclipse/jst/j2ee/ejb/annotation/ui/internal/cmp/wizards/CMPUtils.java\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\nRCS file: /cvsroot/webtools/jst/components/ejb/plugins/org.eclipse.jst.j2ee.ejb.annotations.ui/src/org/eclipse/jst/j2ee/ejb/annotation/ui/internal/cmp/wizards/CMPUtils.java,v\nretrieving revision 1.2\ndiff -u -r1.2 CMPUtils.java\n--- src/org/eclipse/jst/j2ee/ejb/annotation/ui/internal/cmp/wizards/CMPUtils.java\t6 Dec 2005 19:19:01 -0000\t1.2\n+++ src/org/eclipse/jst/j2ee/ejb/annotation/ui/internal/cmp/wizards/CMPUtils.java\t21 Jun 2006 09:44:31 -0000\n@@ -144,9 +144,20 @@\n \t\tcase Types.VARBINARY:\n \t\t\treturn \"java.lang.Object\";\n \t\tcase Types.VARCHAR:\n-\t\t\treturn \"java.lang.String\";\n+\t\treturn \"java.lang.String\";\n \n \t\t}\n \t\treturn \"java.lang.String\";\n \t}\n+\t\n+\tpublic static int getSqlTypeFromJDBC(int jdbcType)\n+\t{\n+\t\tfor (int i \u003d 0; i \u003c sqlTypes.length; i++) {\n+\t\t\tString sqlType \u003d sqlTypes[i];\n+\t\t\tif(sqlType.equals(jdbcTypes[jdbcType]))\n+\t\t\t\treturn i;\n+\t\t}\n+\t\treturn -1;\n+\t}\n+\t\n }\nIndex: src/org/eclipse/jst/j2ee/ejb/annotation/ui/internal/cmp/wizards/ChooseTableWizardPage.java\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\nRCS file: /cvsroot/webtools/jst/components/ejb/plugins/org.eclipse.jst.j2ee.ejb.annotations.ui/src/org/eclipse/jst/j2ee/ejb/annotation/ui/internal/cmp/wizards/ChooseTableWizardPage.java,v\nretrieving revision 1.6\ndiff -u -r1.6 ChooseTableWizardPage.java\n--- src/org/eclipse/jst/j2ee/ejb/annotation/ui/internal/cmp/wizards/ChooseTableWizardPage.java\t28 May 2006 08:06:03 -0000\t1.6\n+++ src/org/eclipse/jst/j2ee/ejb/annotation/ui/internal/cmp/wizards/ChooseTableWizardPage.java\t21 Jun 2006 09:44:31 -0000\n@@ -58,16 +58,23 @@\n \n public class ChooseTableWizardPage extends DataModelWizardPage {\n \n-\tprotected final Image fChecked \u003d EjbAnnotationsUiPlugin.getDefault().getImageDescriptor(\"icons/checked.gif\").createImage();// Util.createImage(\"icons/checked.gif\",getClass());\n-\tprotected final Image fUnchecked \u003d EjbAnnotationsUiPlugin.getDefault().getImageDescriptor(\"icons/unchecked.gif\").createImage();// Util.createImage(\"icons/unchecked.gif\",\n+\tprotected final Image fChecked \u003d EjbAnnotationsUiPlugin.getDefault().getImageDescriptor(\"icons/checked.gif\").createImage();\n+\n+\tprotected final Image fUnchecked \u003d EjbAnnotationsUiPlugin.getDefault().getImageDescriptor(\"icons/unchecked.gif\")\n+\t\t\t.createImage();\n \n \tprivate String[] sqlTypes \u003d CMPUtils.sqlTypes;\n \n \tprivate Combo catalogButton;\n+\n \tprivate Table attributeTable;\n+\n \tprivate TableViewer attributeTableViewer;\n+\n \tprivate Button add;\n+\n \tprivate Button remove;\n+\n \tprivate ArrayList tableList \u003d new ArrayList();\n \n \tpublic void dispose() {\n@@ -93,7 +100,11 @@\n \t}\n \n \tprotected List getAttributes() {\n-\t\treturn (List) this.getDataModel().getProperty(IContainerManagedEntityBeanDataModelProperties.ATTRIBUTES);\n+\t\tList attr \u003d (List) this.getDataModel().getProperty(IContainerManagedEntityBeanDataModelProperties.ATTRIBUTES);\n+\t\tif (!this.getDataModel().isPropertySet(IContainerManagedEntityBeanDataModelProperties.ATTRIBUTES)) {\n+\t\t\tthis.getDataModel().setProperty(IContainerManagedEntityBeanDataModelProperties.ATTRIBUTES, attr);\n+\t\t}\n+\t\treturn attr;\n \t}\n \n \tprotected Composite createTopLevelComposite(Composite parent) {\n@@ -132,11 +143,13 @@\n \t\tcatalogButton.setLayoutData(new GridData(GridData.FILL_HORIZONTAL | GridData.GRAB_VERTICAL));\n \t\tcatalogButton.addSelectionListener(new SelectionListener() {\n \t\t\tpublic void widgetDefaultSelected(org.eclipse.swt.events.SelectionEvent e) {\n-\t\t\t\tfillTableWith((String) tableList.get(catalogButton.getSelectionIndex()));\n-\t\t\t\tattributeTable.removeAll();\n-\t\t\t\tattributeTable.setData(getAttributes());\n-\t\t\t\tattributeTableViewer.setInput(getAttributes());\n-\t\t\t\tattributeTableViewer.refresh();\n+\t\t\t\tif (tableList.size() \u003e\u003d 1 \u0026\u0026 catalogButton.getSelectionIndex() !\u003d -1) {\n+\t\t\t\t\tfillTableWith((String) tableList.get(catalogButton.getSelectionIndex()));\n+\t\t\t\t\tattributeTable.removeAll();\n+\t\t\t\t\tattributeTable.setData(getAttributes());\n+\t\t\t\t\tattributeTableViewer.setInput(getAttributes());\n+\t\t\t\t\tattributeTableViewer.refresh();\n+\t\t\t\t}\n \t\t\t}\n \n \t\t\tpublic void widgetSelected(org.eclipse.swt.events.SelectionEvent e) {\n@@ -257,7 +270,8 @@\n \n \t\t} catch (Throwable ex) {\n \t\t\tex.printStackTrace();\n-\t\t\tMessageDialog.openError(this.getShell(), IEJBAnnotationConstants.CANNOT_CONNECT, IEJBAnnotationConstants.CHECK_PROPERTIES);\n+\t\t\tMessageDialog.openError(this.getShell(), IEJBAnnotationConstants.CANNOT_CONNECT,\n+\t\t\t\t\tIEJBAnnotationConstants.CHECK_PROPERTIES);\n \t\t} finally {\n \t\t\tif (connection !\u003d null)\n \t\t\t\ttry {\n@@ -387,7 +401,7 @@\n \t\t\tpublic void widgetSelected(SelectionEvent e) {\n \t\t\t\tTableItem ti \u003d attributeTable.getSelection()[0];\n \t\t\t\tCMPAttributeDelegate attributeDelegate \u003d (CMPAttributeDelegate) ti.getData();\n-\t\t\t\tgetAttributes().remove(attributeDelegate.getName());\n+\t\t\t\tgetAttributes().remove(attributeDelegate);\n \t\t\t\tChooseTableWizardPage.this.validatePage();\n \t\t\t\tattributeTableViewer.refresh();\n \t\t\t\tremove.setEnabled(false);\n@@ -428,7 +442,8 @@\n \t\tif (sources !\u003d null \u0026\u0026 sources.length \u003e\u003d 1) {\n \t\t\tJavaTypeCompletionProcessor fFieldTypeCompletionProcessor \u003d new JavaTypeCompletionProcessor(false, false);\n \t\t\tfFieldTypeCompletionProcessor.setPackageFragment(sources[0].getPackageFragment(\"\"));\n-\t\t\tControlContentAssistHelper.createTextContentAssistant(((Text) textEditor3.getControl()), fFieldTypeCompletionProcessor);\n+\t\t\tControlContentAssistHelper.createTextContentAssistant(((Text) textEditor3.getControl()),\n+\t\t\t\t\tfFieldTypeCompletionProcessor);\n \t\t}\n \t\teditors[2] \u003d textEditor3;\n \n@@ -606,13 +621,15 @@\n \t\t\t\tbreak;\n \t\t\tcase 3:\n \t\t\t\tfieldMapping.setJdbcType(CMPUtils.jdbcTypes[((Integer) value).intValue()]);\n+\t\t\t\tint sqli \u003d CMPUtils.getSqlTypeFromJDBC(((Integer) value).intValue());\n+\t\t\t\tif (sqli \u003e\u003d 0) {\n+\t\t\t\t\tfieldMapping.setSqlType(sqlTypes[sqli]);\n+\t\t\t\t\ttItem.getParent().redraw();\n+\t\t\t\t}\n \t\t\t\tbreak;\n \t\t\tcase 4:\n \t\t\t\tString sqlType \u003d sqlTypes[((Integer) value).intValue()];\n-\t\t\t\t//Ugly fix - if the sql type is used to create/alter a table need some size\n-\t\t\t\tif(\"VARCHAR\".equals(sqlType))\n-\t\t\t\t\tsqlType +\u003d \"(255)\";\n-\t\t\t\tfieldMapping.setSqlType(sqlTypes[((Integer) value).intValue()]);\n+\t\t\t\tfieldMapping.setSqlType(sqlType);\n \t\t\t\tbreak;\n \t\t\tcase 5:\n \t\t\t\tboolean readValue \u003d ((Boolean) value).booleanValue();\n",
    "Just and additional note, the problem effectively renders the add/remove buttons useless.  This means 50% of the CMP wizard fucntionality is not available (for the define top down use case where developer defines the attributes).\n\n-The exception due to missing check that is added.\n-Build and tested with RC5a target",
    "+1 If any one other than a subproject lead had proposed this patch, I would have requeted a better attached patch -- I can not tell, exactly, what is supposed to be in the patch, and I know applying the first one (which is not marked as obsolete) does not match what was committed to HEAD. And, I would have requested some \"intependent\" review (should you get Chuck or John L. to sanity check it for you?). \n\nAt the same time, if this is important to Naci and he vouches for it ... well ... it is his project :) \n\n",
    "Oh, and BTW, is this really \"critical\"? Crash, loss of data? Or just \"major\", loss of function. I\u0027m still ok with it, but would like severity to be accurate. ",
    "I would appreciate it if Naci could call in and explain the patch.",
    "@David: It was me who marked it \"critical\" (because in an earlier version the wizard worked), so change it to any severity you feel more comfortable with ;-). \n\nFrom users view: The wizard for entity beans does not work at all (at least for the use case \"Define new attributes\"), so it is at least a major loss of feature. It does not crash, it is just impossible to enter db fields and thus the \"Finish\" button will not be enabled. \nI think this is the main approach to create an entity bean, the other use case will be used in less than 50%.\n\nIt would be sad (or even embarrassing) if a WTP major release would contain a totally non-functional wizard, wouldn\u0027t it ;-) ?",
    "+1 for WTP 1.5 RC6 condionally pending closer inspection by Chuck and John.",
    "+1 1.5, conditional on chuck\u0027s read-thru not raising any concerns\n",
    "I applied this patch, and tested the CMP wizard.. I was able to add new attributes, edit the attributes etc.... The patch performed well.\n\n",
    "Released for WTP 1.5 RC6 062206 driver.",
    "Verified against RC6, works fine now. Thanks for fixing it !"
  ],
  "commentCreationDates": [
    "2006-06-21T09:13:59+02:00",
    "2006-06-21T11:21:10+02:00",
    "2006-06-21T11:21:59+02:00",
    "2006-06-21T11:23:39+02:00",
    "2006-06-21T11:42:57+02:00",
    "2006-06-21T16:47:12+02:00",
    "2006-06-21T20:26:00+02:00",
    "2006-06-21T20:56:17+02:00",
    "2006-06-21T21:20:51+02:00",
    "2006-06-22T09:23:31+02:00",
    "2006-06-22T20:33:08+02:00",
    "2006-06-22T20:34:18+02:00",
    "2006-06-22T21:54:01+02:00",
    "2006-06-22T22:47:18+02:00",
    "2006-06-26T10:48:49+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ArrayIndexOutOfBoundsException",
      "message": "-1",
      "elements": [
        {
          "method": "java.util.ArrayList.get",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.jst.j2ee.ejb.annotation.ui.internal.cmp.wizards.ChooseTableWizardPage$1.widgetDefaultSelected",
          "source": "ChooseTableWizardPage.java:135"
        },
        {
          "method": "org.eclipse.swt.widgets.TypedListener.handleEvent",
          "source": "TypedListener.java:97"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:928"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:3348"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2968"
        },
        {
          "method": "org.eclipse.jface.window.Window.runEventLoop",
          "source": "Window.java:820"
        },
        {
          "method": "org.eclipse.jface.window.Window.open",
          "source": "Window.java:796"
        },
        {
          "method": "org.eclipse.ui.internal.navigator.wizards.WizardShortcutAction.run",
          "source": "WizardShortcutAction.java:94"
        },
        {
          "method": "org.eclipse.jface.action.Action.runWithEvent",
          "source": "Action.java:499"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:539"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$2",
          "source": "ActionContributionItem.java:488"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$5.handleEvent",
          "source": "ActionContributionItem.java:400"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:928"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:3348"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2968"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1914"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1878"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:419"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:95"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:78"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:92"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:68"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:400"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:177"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:336"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:280"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:977"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:952"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "147991",
      "date": "2006-06-21T09:13:59+02:00",
      "product": "Web Tools",
      "component": "jst.ejb",
      "severity": "critical"
    }
  ],
  "groupId": "147991",
  "bugId": "147991",
  "date": "2006-06-21T09:13:59+02:00",
  "product": "Web Tools",
  "component": "jst.ejb",
  "severity": "critical"
}