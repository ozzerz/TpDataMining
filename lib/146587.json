{
  "comments": [
    "Create a model.\nDrag the model onto a class diagram.\nCreate a comment for the model.\nRemove the comment from the diagram.\nSelect the comment in the project explorer and use Visualize/Add to Current Diagram.\n\njava.lang.NullPointerException\n  at java.util.Hashtable.get(Unknown Source)\n  at org.eclipse.gmf.runtime.diagram.ui.providers.internal.DefaultProvider.getRelevantConnections(DefaultProvider.java:497)\n  at org.eclipse.gmf.runtime.diagram.ui.providers.internal.DefaultProvider.build_graph(DefaultProvider.java:582)\n  at org.eclipse.gmf.runtime.diagram.ui.providers.internal.DefaultProvider.layoutEditParts(DefaultProvider.java:153)\n  at org.eclipse.gmf.runtime.diagram.ui.services.layout.AbstractLayoutEditPartProvider.layoutLayoutNodes(AbstractLayoutEditPartProvider.java:56)\n  at org.eclipse.gmf.runtime.diagram.ui.internal.services.layout.LayoutNodesOperation.execute(LayoutNodesOperation.java:74)\n  at org.eclipse.gmf.runtime.common.core.service.ExecutionStrategy$1.execute(ExecutionStrategy.java:75)\n  at org.eclipse.gmf.runtime.common.core.service.Service.execute(Service.java:601)\n  at org.eclipse.gmf.runtime.diagram.ui.services.layout.LayoutService.execute(LayoutService.java:64)\n  at org.eclipse.gmf.runtime.diagram.ui.services.layout.LayoutService.layoutLayoutNodes(LayoutService.java:272)\n  at org.eclipse.gmf.runtime.diagram.ui.editpolicies.ContainerEditPolicy.layoutNodes(ContainerEditPolicy.java:332)\n  at org.eclipse.gmf.runtime.diagram.ui.editpolicies.ContainerEditPolicy.getArrangeCommand(ContainerEditPolicy.java:305)\n  at org.eclipse.gmf.runtime.diagram.ui.editpolicies.ContainerEditPolicy.getCommand(ContainerEditPolicy.java:437)\n  at com.ibm.xtools.presentation.internal.editpolicies.ContainerEditPolicy.getCommand(ContainerEditPolicy.java:193)\n  at org.eclipse.gef.editparts.AbstractEditPart.getCommand(AbstractEditPart.java:473)\n  at org.eclipse.gmf.runtime.diagram.ui.editparts.GraphicalEditPart.access$1(GraphicalEditPart.java:1)\n  at org.eclipse.gmf.runtime.diagram.ui.editparts.GraphicalEditPart$1.run(GraphicalEditPart.java:412)\n  at org.eclipse.gmf.runtime.emf.core.internal.domain.MSLTransactionalEditingDomain.runExclusive(MSLTransactionalEditingDomain.java:181)\n  at org.eclipse.gmf.runtime.emf.core.internal.domain.MSLEditingDomain.runExclusive(MSLEditingDomain.java:2202)\n  at org.eclipse.gmf.runtime.diagram.ui.editparts.GraphicalEditPart.getCommand(GraphicalEditPart.java:407)\n  at org.eclipse.gmf.runtime.diagram.ui.commands.DeferredLayoutCommand.doExecuteWithResult(DeferredLayoutCommand.java:148)\n  at org.eclipse.gmf.runtime.emf.commands.core.command.AbstractTransactionalCommand.doExecute(AbstractTransactionalCommand.java:245)\n  at org.eclipse.emf.workspace.AbstractEMFOperation.execute(AbstractEMFOperation.java:123)\n  at org.eclipse.gmf.runtime.diagram.ui.commands.EtoolsProxyCommand.execute(EtoolsProxyCommand.java:64)\n  at org.eclipse.gef.commands.CompoundCommand.execute(CompoundCommand.java:107)\n  at xxxxxxxxxxxxxxx.AddToCurrentDiagramActionDelegate.doRun(AddToCurrentDiagramActionDelegate.java:62)\n  at org.eclipse.gmf.runtime.common.ui.action.AbstractActionDelegate.run(AbstractActionDelegate.java:391)\n  at org.eclipse.gmf.runtime.emf.ui.action.AbstractModelActionDelegate.access$0(AbstractModelActionDelegate.java:1)\n  at org.eclipse.gmf.runtime.emf.ui.action.AbstractModelActionDelegate$2.doExecute(AbstractModelActionDelegate.java:92)\n  at org.eclipse.emf.workspace.AbstractEMFOperation.execute(AbstractEMFOperation.java:123)\n  at org.eclipse.core.commands.operations.DefaultOperationHistory.execute(DefaultOperationHistory.java:509)\n  at org.eclipse.gmf.runtime.emf.ui.action.AbstractModelActionDelegate.run(AbstractModelActionDelegate.java:98)\n  at org.eclipse.gmf.runtime.common.ui.action.ActionManager$1.run(ActionManager.java:225)\n  at org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:67)\n  at org.eclipse.gmf.runtime.common.ui.action.ActionManager.run(ActionManager.java:223)\n  at org.eclipse.gmf.runtime.common.ui.action.AbstractActionDelegate.run(AbstractActionDelegate.java:233)\n  at org.eclipse.ui.internal.PluginAction.runWithEvent(PluginAction.java:254)\n  at org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:539)\n  at org.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:488)\n  at org.eclipse.jface.action.ActionContributionItem$5.handleEvent(ActionContributionItem.java:400)\n  at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n  at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:928)\n  at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3348)\n  at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2968)\n  at org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1914)\n  at org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1878)\n  at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:419)\n  at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:143)\n  at org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:95)\n  at org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:78)\n  at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:92)\n  at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:68)\n  at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:400)\n  at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:177)\n  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n  at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n  at java.lang.reflect.Method.invoke(Unknown Source)\n  at org.eclipse.core.launcher.Main.invokeFramework(Main.java:336)\n  at org.eclipse.core.launcher.Main.basicRun(Main.java:280)\n  at org.eclipse.core.launcher.Main.run(Main.java:977)\n  at org.eclipse.core.launcher.Main.main(Main.java:952)",
    "Looks like a corrupt diagram.  Is the reference collection that the comment is stored in updated when it is deleted?",
    "Who said anything about deleting?",
    "This is due to a corrupt diagram in the client domain.  There is a connection which doesn\u0027t have a target which precipitates the NPE.  GMF doesn\u0027t support connections which don\u0027t have a source or a target.\n\nI suspect that in the client code, when the comment is deleted, the reference connection editpart isn\u0027t being deleted as well or there is a certain condition where it is not being updated.",
    "I\u0027ll investigate this further in the client code to see if there\u0027s any opportunity to provide for this in GMF...",
    "I\u0027ll investigate this further in the client code to see if there\u0027s any opportunity to provide for this in GMF...",
    "Re-opened for now.  Found a case where the semantic element wasn\u0027t implied from a reference collection.",
    "Discovered a more generic GMF scenario:\n- Shapes are added to the diagram in a compound command that have connections to already existing shapes on the diagram.\n- A DeferredLayoutCommand command is also executed inside the compound command before the transaction is committed.\n- The shapes are refreshed inside the DeferredLayoutCommand to ensure their positions are updated and all appropriate edit parts for connections are refreshed.\n- The newly added shape gets it\u0027s source connections updated, but the connection who attached to the preexisting shape doesn\u0027t have it\u0027s target anchors update since the target shape isn\u0027t refreshed.\n\nSeems to be only a problem when the pre-existing shape is the target of the connection?  Still not completely clear on what\u0027s going on...",
    "Now I\u0027m clear... The DefaultProvider is only querying using the getTarget api.  I believe the fix for this needs to be in the DeferredLayoutCommand.  All existing shapes on the diagram need to be refreshed potentially.  Or alternatively, parse through the newly added edges and ensure that the ends are refreshed.  Normally this is done through the notifications on postCommit.  Since the DeferredLayoutCommand is executed before then, we need to manually refresh the EditPart world prior to the postCommit events are received so that the layout algorithm can have the right inputs.",
    "Created an attachment (id\u003d44200)\nPatch to DeferredLayoutCommand to ensure existing shapes are refreshed\n\nPatch for DeferredLayoutCommand that will send a REQ_REFRESH request to the layout container instead of manually instrumenting the code.  The returned command ensures that shapes in the container but aren\u0027t part of the immediate layout will be refreshed as well so that connection EP\u0027s will have the source or target refreshed accordingly.  \n\n+1 for RC5 ",
    "CC\u0027d Fred for approval...",
    "+1",
    "Some performance data:\nWithout patch fix (refresh phase only):\n- 500 elements added to empty diagram - 5598 ms\n- 500 elements added to diagram with 500 elements - 7541 ms\n\nWith patch fix (refresh phase only): \n- 500 elements added to empty diagram - 7501 ms\n- 500 elements added to diagram with 500 elements - 9644 ms\n\n2 second degredation in performance with the fix (for 500 elements).  This degredation makes sense since now more elements are being refreshed then was previously.    ",
    "Yikes... That\u0027s almost a 30% performance regression... Anyway we can fix this more efficiently?",
    "(In reply to comment #12)\n\u003e Some performance data:\n\u003e Without patch fix (refresh phase only):\n\u003e - 500 elements added to empty diagram - 5598 ms\n\u003e - 500 elements added to diagram with 500 elements - 7541 ms\n\u003e With patch fix (refresh phase only): \n\u003e - 500 elements added to empty diagram - 7501 ms\n\u003e - 500 elements added to diagram with 500 elements - 9644 ms\n\u003e 2 second degredation in performance with the fix (for 500 elements).  This\n\u003e degredation makes sense since now more elements are being refreshed then was\n\u003e previously.    \n\nthis is 33% drop, but still we need to consider how long was the over all operation. If the drop in the over all operation was small then this could be acceptable.\n\n",
    "(In reply to comment #13)\n\u003e Yikes... That\u0027s almost a 30% performance regression... Anyway we can fix this\n\u003e more efficiently?\n\nThose numbers are slightly mis-leading since they only measure the refresh phase of the layout command not the overall execution.  I\u0027ll include the layout # as well and the degredation should be well below 30%.. stand-by...\n",
    "I have a more performant solution now that cuts the time differential in half. \nHowever, there is still some degredation since additional shapes need to be\nrefreshed (unavoidable).  Note: this is specific to the DeferredLayoutCommand.\n",
    "Committed solution which only refreshed those additional shapes which didn\u0027t exist in the layout collection instead of redundantly refreshing all shapes.",
    "Tested OK with org.eclipse.gmf.runtime.diagram.ui_1.0.0.v20060616-1200."
  ],
  "commentCreationDates": [
    "2006-06-12T16:51:37+02:00",
    "2006-06-12T17:45:04+02:00",
    "2006-06-12T17:58:21+02:00",
    "2006-06-12T19:29:32+02:00",
    "2006-06-12T20:06:06+02:00",
    "2006-06-12T21:09:41+02:00",
    "2006-06-12T21:10:25+02:00",
    "2006-06-12T21:31:08+02:00",
    "2006-06-12T21:47:40+02:00",
    "2006-06-12T23:03:37+02:00",
    "2006-06-12T23:04:17+02:00",
    "2006-06-13T03:00:30+02:00",
    "2006-06-13T19:36:02+02:00",
    "2006-06-13T19:50:57+02:00",
    "2006-06-13T19:58:06+02:00",
    "2006-06-13T19:59:55+02:00",
    "2006-06-13T21:04:12+02:00",
    "2006-06-13T22:19:02+02:00",
    "2006-06-30T19:01:45+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "java.util.Hashtable.get",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.providers.internal.DefaultProvider.getRelevantConnections",
          "source": "DefaultProvider.java:497"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.providers.internal.DefaultProvider.build_graph",
          "source": "DefaultProvider.java:582"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.providers.internal.DefaultProvider.layoutEditParts",
          "source": "DefaultProvider.java:153"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.services.layout.AbstractLayoutEditPartProvider.layoutLayoutNodes",
          "source": "AbstractLayoutEditPartProvider.java:56"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.internal.services.layout.LayoutNodesOperation.execute",
          "source": "LayoutNodesOperation.java:74"
        },
        {
          "method": "org.eclipse.gmf.runtime.common.core.service.ExecutionStrategy$1.execute",
          "source": "ExecutionStrategy.java:75"
        },
        {
          "method": "org.eclipse.gmf.runtime.common.core.service.Service.execute",
          "source": "Service.java:601"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.services.layout.LayoutService.execute",
          "source": "LayoutService.java:64"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.services.layout.LayoutService.layoutLayoutNodes",
          "source": "LayoutService.java:272"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.editpolicies.ContainerEditPolicy.layoutNodes",
          "source": "ContainerEditPolicy.java:332"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.editpolicies.ContainerEditPolicy.getArrangeCommand",
          "source": "ContainerEditPolicy.java:305"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.editpolicies.ContainerEditPolicy.getCommand",
          "source": "ContainerEditPolicy.java:437"
        },
        {
          "method": "com.ibm.xtools.presentation.internal.editpolicies.ContainerEditPolicy.getCommand",
          "source": "ContainerEditPolicy.java:193"
        },
        {
          "method": "org.eclipse.gef.editparts.AbstractEditPart.getCommand",
          "source": "AbstractEditPart.java:473"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.editparts.GraphicalEditPart.access$1",
          "source": "GraphicalEditPart.java:1"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.editparts.GraphicalEditPart$1.run",
          "source": "GraphicalEditPart.java:412"
        },
        {
          "method": "org.eclipse.gmf.runtime.emf.core.internal.domain.MSLTransactionalEditingDomain.runExclusive",
          "source": "MSLTransactionalEditingDomain.java:181"
        },
        {
          "method": "org.eclipse.gmf.runtime.emf.core.internal.domain.MSLEditingDomain.runExclusive",
          "source": "MSLEditingDomain.java:2202"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.editparts.GraphicalEditPart.getCommand",
          "source": "GraphicalEditPart.java:407"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.commands.DeferredLayoutCommand.doExecuteWithResult",
          "source": "DeferredLayoutCommand.java:148"
        },
        {
          "method": "org.eclipse.gmf.runtime.emf.commands.core.command.AbstractTransactionalCommand.doExecute",
          "source": "AbstractTransactionalCommand.java:245"
        },
        {
          "method": "org.eclipse.emf.workspace.AbstractEMFOperation.execute",
          "source": "AbstractEMFOperation.java:123"
        },
        {
          "method": "org.eclipse.gmf.runtime.diagram.ui.commands.EtoolsProxyCommand.execute",
          "source": "EtoolsProxyCommand.java:64"
        },
        {
          "method": "org.eclipse.gef.commands.CompoundCommand.execute",
          "source": "CompoundCommand.java:107"
        },
        {
          "method": "xxxxxxxxxxxxxxx.AddToCurrentDiagramActionDelegate.doRun",
          "source": "AddToCurrentDiagramActionDelegate.java:62"
        },
        {
          "method": "org.eclipse.gmf.runtime.common.ui.action.AbstractActionDelegate.run",
          "source": "AbstractActionDelegate.java:391"
        },
        {
          "method": "org.eclipse.gmf.runtime.emf.ui.action.AbstractModelActionDelegate.access$0",
          "source": "AbstractModelActionDelegate.java:1"
        },
        {
          "method": "org.eclipse.gmf.runtime.emf.ui.action.AbstractModelActionDelegate$2.doExecute",
          "source": "AbstractModelActionDelegate.java:92"
        },
        {
          "method": "org.eclipse.emf.workspace.AbstractEMFOperation.execute",
          "source": "AbstractEMFOperation.java:123"
        },
        {
          "method": "org.eclipse.core.commands.operations.DefaultOperationHistory.execute",
          "source": "DefaultOperationHistory.java:509"
        },
        {
          "method": "org.eclipse.gmf.runtime.emf.ui.action.AbstractModelActionDelegate.run",
          "source": "AbstractModelActionDelegate.java:98"
        },
        {
          "method": "org.eclipse.gmf.runtime.common.ui.action.ActionManager$1.run",
          "source": "ActionManager.java:225"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:67"
        },
        {
          "method": "org.eclipse.gmf.runtime.common.ui.action.ActionManager.run",
          "source": "ActionManager.java:223"
        },
        {
          "method": "org.eclipse.gmf.runtime.common.ui.action.AbstractActionDelegate.run",
          "source": "AbstractActionDelegate.java:233"
        },
        {
          "method": "org.eclipse.ui.internal.PluginAction.runWithEvent",
          "source": "PluginAction.java:254"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:539"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$2",
          "source": "ActionContributionItem.java:488"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$5.handleEvent",
          "source": "ActionContributionItem.java:400"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:928"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:3348"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2968"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1914"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1878"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:419"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:143"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:95"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:78"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:92"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:68"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:400"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:177"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:336"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:280"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:977"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:952"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "146587",
      "date": "2006-06-12T16:51:37+02:00",
      "product": "GMF",
      "component": "Runtime Diagram",
      "severity": "major"
    }
  ],
  "groupId": "146587",
  "bugId": "146587",
  "date": "2006-06-12T16:51:37+02:00",
  "product": "GMF",
  "component": "Runtime Diagram",
  "severity": "major"
}