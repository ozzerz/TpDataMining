{
  "comments": [
    "Build ID: I20070525-1350\nWST/JST Build ID: 2.0-200706260303\n\nSteps To Reproduce:\n1. Open Eclipse for new workspace, open Java perspective, and create Dynamic Web Project, reject opening J2EE perspective (to be exact, you need any perspective without Project Explorer).\n2. Open web.xml in XML Editor\n3. Try Ctrl+Space and make sure that content assist works.\n4. Make some small changes and save the modified file.\n5. Close the editor and reopen it.\n6. Try Ctrl+Space and make sure that content assist fails.\nCheck log and find exception\njava.lang.IllegalStateException: problem getting model\n\tat org.eclipse.wst.xml.ui.internal.contentassist.AbstractContentAssistProcessor.computeCompletionProposals(AbstractContentAssistProcessor.java:1324)\n\tat org.eclipse.wst.xml.ui.internal.contentassist.XMLContentAssistProcessor.computeCompletionProposals(XMLContentAssistProcessor.java:120)\n\tat org.eclipse.wst.sse.ui.internal.contentassist.CompoundContentAssistProcessor.computeCompletionProposals(CompoundContentAssistProcessor.java:290)\n\tat org.eclipse.jface.text.contentassist.ContentAssistant.computeCompletionProposals(ContentAssistant.java:1758)\n\tat org.eclipse.jface.text.contentassist.CompletionProposalPopup.computeProposals(CompletionProposalPopup.java:478)\n\tat org.eclipse.jface.text.contentassist.CompletionProposalPopup.access$16(CompletionProposalPopup.java:475)\n\tat org.eclipse.jface.text.contentassist.CompletionProposalPopup$2.run(CompletionProposalPopup.java:410)\n\tat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:67)\n\tat org.eclipse.jface.text.contentassist.CompletionProposalPopup.showProposals(CompletionProposalPopup.java:404)\n\tat org.eclipse.jface.text.contentassist.ContentAssistant.showPossibleCompletions(ContentAssistant.java:1587)\n\nSometimes, one cycle of Edit,Save,Close,Open is not sufficient to reproduce the failure. If Project Explorer view is available (or has been available since Eclipse start before the test), the failure is not reproduced.\n\nFor faces-config.xml, bug can be reproduced in the same way, but with somewhat lower probability. To make probability higher, open faces-config.xml in XML Editor (not Faces Config Editor) and close Eclipse so that on reopening Eclipse you will have faces-config.xml already open in XML Editor. After that repeat steps 3-6.\n\nMore information:",
    "Viacheslav, please retry this with 2.0.1 and reopen if it continues to be a problem.",
    "I have tested the issue in Eclipse Build id: M20070921-1145,\nWST/JST Build id: 2.0.1-20070926042742. Bug is reproduced.",
    "Two problems are actually at work here.  The first is a fault in the SSE ModelManager\u0027s file buffer integration where a call to getExistingModel* doesn\u0027t increment the use count of the underlying file buffer.  This allows the file buffer to be disposed when the editor closes even though the structured model is still referencing the structured document.  When the editor is reopened, it gets a difference document from the newly created file buffer instead of reusing what\u0027s in the structured model still in memory because getExistingModel* incremented the count.  The second fault is the JSF AppConfigValidator never releasing its hold on the model for the faces-config.xml or web.xml file.  I found a get without a release at runtime:\n\nThread [Worker-6] (Suspended (breakpoint at line 402 in ModelManagerImpl))\t\n\tModelManagerImpl._incrCount(ModelManagerImpl$SharedObject, ModelManagerImpl$ReadEditType) line: 402\t\n\tModelManagerImpl.getExistingModelForRead(Object) line: 985\t\n\tFacesRendererFactory$MyRenderer(EMF2DOMSSERenderer).initializeXMLModel(IFile, boolean) line: 379\t\n\tFacesRendererFactory$MyRenderer(EMF2DOMSSERenderer).loadDocument(InputStream, Map) line: 433\t\n\tFacesRendererFactory$MyRenderer(EMF2DOMRenderer).doLoad(InputStream, Map) line: 62\t\n\tFacesConfigResourceImpl(TranslatorResourceImpl).basicDoLoad(InputStream, Map) line: 144\t\n\tFacesConfigResourceImpl(CompatibilityXMIResourceImpl).doLoad(InputStream, Map) line: 175\t\n\tFacesConfigResourceImpl(ResourceImpl).load(InputStream, Map\u003c?,?\u003e) line: 1354\t\n\tFacesConfigResourceImpl(TranslatorResourceImpl).load(Map) line: 393\t\n\tProjectResourceSetEditImpl(ResourceSetImpl).demandLoad(Resource) line: 256\t\n\tProjectResourceSetEditImpl(ProjectResourceSetImpl).demandLoad(Resource) line: 143\t\n\tProjectResourceSetEditImpl(ResourceSetImpl).demandLoadHelper(Resource) line: 271\t\n\tProjectResourceSetEditImpl(ProjectResourceSetImpl).getResource(URI, boolean) line: 390\t\n\tWorkbenchResourceHelper.getOrCreateResource(URI, ResourceSet) line: 384\t\n\tJavaArtifactEditModel(EditModel).getResource(URI) line: 684\t\n\tJavaArtifactEditModel(ArtifactEditModel).getResource(URI) line: 174\t\n\tFacesConfigArtifactEdit.getDeploymentDescriptorResource() line: 167\t\n\tFacesConfigArtifactEdit.getDeploymentDescriptorRoot() line: 149\t\n\tFacesConfigArtifactEdit.getFacesConfig() line: 133\t\n\tAppConfigValidator.validateFile(IFile, IReporter) line: 148\t\n\tAppConfigValidator.validate(IValidationContext, IReporter) line: 100\t\n\tAppConfigValidator.validateInJob(IValidationContext, IReporter) line: 69\t\n\tValidatorJob.run(IProgressMonitor) line: 75\t\n\tWorker.run() line: 55\t\n",
    "Created an attachment (id\u003d81575)\nproposed patch\n\n",
    "Fixed in 2.0.2 and 3.0m3.",
    "Opened bug 207974 for the stack trace in comment 3."
  ],
  "commentCreationDates": [
    "2007-10-08T16:06:06+02:00",
    "2007-10-08T17:39:42+02:00",
    "2007-10-09T14:52:27+02:00",
    "2007-10-30T13:26:23+01:00",
    "2007-10-30T13:38:09+01:00",
    "2007-10-30T14:03:31+01:00",
    "2007-11-05T18:31:06+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.IllegalStateException",
      "message": "problem getting model",
      "elements": [
        {
          "method": "org.eclipse.wst.xml.ui.internal.contentassist.AbstractContentAssistProcessor.computeCompletionProposals",
          "source": "AbstractContentAssistProcessor.java:1324"
        },
        {
          "method": "org.eclipse.wst.xml.ui.internal.contentassist.XMLContentAssistProcessor.computeCompletionProposals",
          "source": "XMLContentAssistProcessor.java:120"
        },
        {
          "method": "org.eclipse.wst.sse.ui.internal.contentassist.CompoundContentAssistProcessor.computeCompletionProposals",
          "source": "CompoundContentAssistProcessor.java:290"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.ContentAssistant.computeCompletionProposals",
          "source": "ContentAssistant.java:1758"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.CompletionProposalPopup.computeProposals",
          "source": "CompletionProposalPopup.java:478"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.CompletionProposalPopup.access$16",
          "source": "CompletionProposalPopup.java:475"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.CompletionProposalPopup$2.run",
          "source": "CompletionProposalPopup.java:410"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:67"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.CompletionProposalPopup.showProposals",
          "source": "CompletionProposalPopup.java:404"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.ContentAssistant.showPossibleCompletions",
          "source": "ContentAssistant.java:1587"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "205733",
      "date": "2007-10-08T16:06:06+02:00",
      "product": "Web Tools",
      "component": "wst.xml",
      "severity": "normal"
    }
  ],
  "groupId": "205733",
  "bugId": "205733",
  "date": "2007-10-08T16:06:06+02:00",
  "product": "Web Tools",
  "component": "wst.xml",
  "severity": "normal"
}