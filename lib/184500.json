{
  "comments": [
    "Early in my work term when I was working on content assist, I created the method IScope.find(String name, boolean prefixLookup).  This method is now used in only two files: CPPSemantics and CPPClassSpecializationScope.  I just recently realized that both uses of the method are wrong, as ?find? considers base classes, parent scopes, using directives, etc?  What is really needed in these two files is a method similar to IScope.getBinding(IASTName name, boolean resolve), which only considers bindings directly in the scope, but can also return multiple bindings without resolving ambiguities.",
    "Created an attachment (id\u003d65248)\nproposed patch\n\nReplaces IScope.find(String name, boolean prefixLookup) with IScope.getBindings(String name, boolean resolve, boolean prefixLookup).",
    "Oops, the first parameter for the new method is an IASTName, not a String.",
    "Patch applied. Thanks, Bryan.",
    "The changes to CPPSemantics.lookup(...) cause ClassCastExceptions for non-template code, seen during parsing firefox:\n\njava.lang.ClassCastException: org.eclipse.cdt.internal.core.pdom.dom.cpp.PDOMCPPMethod\n\tat org.eclipse.cdt.internal.core.dom.parser.cpp.CPPSemantics.checkForAmbiguity(CPPSemantics.java:1339)\n\tat org.eclipse.cdt.internal.core.dom.parser.cpp.CPPSemantics.lookupInParents(CPPSemantics.java:1240)\n\tat org.eclipse.cdt.internal.core.dom.parser.cpp.CPPSemantics.lookup(CPPSemantics.java:1109)\n\tat org.eclipse.cdt.internal.core.dom.parser.cpp.CPPSemantics.resolveBinding(CPPSemantics.java:617)\n\tat org.eclipse.cdt.internal.core.dom.parser.cpp.CPPVisitor.resolveBinding(CPPVisitor.java:987)\n\tat org.eclipse.cdt.internal.core.dom.parser.cpp.CPPVisitor.createBinding(CPPVisitor.java:191)\n\tat org.eclipse.cdt.internal.core.dom.parser.cpp.CPPASTName.resolveBinding(CPPASTName.java:73)\n\tat org.eclipse.cdt.internal.core.pdom.PDOMWriter.addSymbols(PDOMWriter.java:139)\n\tat org.eclipse.cdt.internal.core.pdom.indexer.PDOMIndexerTask.parseTU(PDOMIndexerTask.java:276)\n\tat org.eclipse.cdt.internal.core.pdom.indexer.PDOMIndexerTask.parseTUs(PDOMIndexerTask.java:195)\n\tat org.eclipse.cdt.internal.core.pdom.indexer.fast.PDOMFastIndexerTask.run(PDOMFastIndexerTask.java:91)\n\tat org.eclipse.cdt.internal.core.pdom.indexer.PDOMRebuildTask.run(PDOMRebuildTask.java:75)\n\tat org.eclipse.cdt.internal.core.pdom.PDOMIndexerJob.run(PDOMIndexerJob.java:89)\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:58)",
    "Fixed by adding ICPPInternalFunction to PDOMCPPFunction. Didn\u0027t seem to hurt the numbers any.",
    "(In reply to comment #5)\n\u003e Fixed by adding ICPPInternalFunction to PDOMCPPFunction. Didn\u0027t seem to hurt\n\u003e the numbers any.\n\nDoug, PDOMBindings really should not implement any of the ICPPInternalXXX interfaces. At several places this is used to work around methods that cannot be called for PDOMBindings.\n\nThe change actually breaks two testcases: testConstIntPtrParameterInDefinitionAST() and testConstIntRefParameterInDefinitionAST().\n\nI try to come up with a better fix.",
    "I have checked in a rather simple fix and cleaned up other potential problems with calling ((ICPPInternalFunction) func).isStatic(false). Testcases are passing and the ClassCastException is fixed.\n\nThanks Bryan for cleaning up both the usage and implementation of IScope.find(...)!",
    "Thanks, Markus. I had a bad feeling I was doing something I wasn\u0027t supposed to."
  ],
  "commentCreationDates": [
    "2007-04-27T20:32:09+02:00",
    "2007-04-27T20:34:53+02:00",
    "2007-04-27T20:36:14+02:00",
    "2007-05-03T16:43:32+02:00",
    "2007-05-03T20:22:32+02:00",
    "2007-05-03T22:03:24+02:00",
    "2007-05-04T09:01:13+02:00",
    "2007-05-04T10:04:51+02:00",
    "2007-05-04T14:26:42+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ClassCastException",
      "message": "org.eclipse.cdt.internal.core.pdom.dom.cpp.PDOMCPPMethod",
      "elements": [
        {
          "method": "org.eclipse.cdt.internal.core.dom.parser.cpp.CPPSemantics.checkForAmbiguity",
          "source": "CPPSemantics.java:1339"
        },
        {
          "method": "org.eclipse.cdt.internal.core.dom.parser.cpp.CPPSemantics.lookupInParents",
          "source": "CPPSemantics.java:1240"
        },
        {
          "method": "org.eclipse.cdt.internal.core.dom.parser.cpp.CPPSemantics.lookup",
          "source": "CPPSemantics.java:1109"
        },
        {
          "method": "org.eclipse.cdt.internal.core.dom.parser.cpp.CPPSemantics.resolveBinding",
          "source": "CPPSemantics.java:617"
        },
        {
          "method": "org.eclipse.cdt.internal.core.dom.parser.cpp.CPPVisitor.resolveBinding",
          "source": "CPPVisitor.java:987"
        },
        {
          "method": "org.eclipse.cdt.internal.core.dom.parser.cpp.CPPVisitor.createBinding",
          "source": "CPPVisitor.java:191"
        },
        {
          "method": "org.eclipse.cdt.internal.core.dom.parser.cpp.CPPASTName.resolveBinding",
          "source": "CPPASTName.java:73"
        },
        {
          "method": "org.eclipse.cdt.internal.core.pdom.PDOMWriter.addSymbols",
          "source": "PDOMWriter.java:139"
        },
        {
          "method": "org.eclipse.cdt.internal.core.pdom.indexer.PDOMIndexerTask.parseTU",
          "source": "PDOMIndexerTask.java:276"
        },
        {
          "method": "org.eclipse.cdt.internal.core.pdom.indexer.PDOMIndexerTask.parseTUs",
          "source": "PDOMIndexerTask.java:195"
        },
        {
          "method": "org.eclipse.cdt.internal.core.pdom.indexer.fast.PDOMFastIndexerTask.run",
          "source": "PDOMFastIndexerTask.java:91"
        },
        {
          "method": "org.eclipse.cdt.internal.core.pdom.indexer.PDOMRebuildTask.run",
          "source": "PDOMRebuildTask.java:75"
        },
        {
          "method": "org.eclipse.cdt.internal.core.pdom.PDOMIndexerJob.run",
          "source": "PDOMIndexerJob.java:89"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:58"
        }
      ],
      "number": 0,
      "commentIndex": 4,
      "bugId": "184500",
      "date": "2007-05-03T20:22:32+02:00",
      "product": "CDT",
      "component": "cdt-core",
      "severity": "normal"
    }
  ],
  "groupId": "184500",
  "bugId": "184500",
  "date": "2007-04-27T20:32:09+02:00",
  "product": "CDT",
  "component": "cdt-core",
  "severity": "normal"
}