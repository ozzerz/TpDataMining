{
  "comments": [
    "Build ID: M20060921-0945\n\nSteps To Reproduce:\n1. Run Eclipse M20060921-0945 (3.2.1)\n2. Remove the databinding of Eclipse 3.2.1 and replace it with Databinding R3_3 checked out from CVS.\n3. Run the snippet UpdateListStrategyBug:\n\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport org.eclipse.core.databinding.DataBindingContext;\nimport org.eclipse.core.databinding.observable.Realm;\nimport org.eclipse.core.databinding.observable.list.WritableList;\nimport org.eclipse.jface.databinding.swt.SWTObservables;\nimport org.eclipse.swt.widgets.Display;\n\n\n/**\n * Demonstrates the following bug in databinding R3_3: if two lists are bound via\n * WritableList descendants then a org.eclipse.core.databinding.BindingException\n * occurs because during the bindList() call (in ListBinding.doUpdate()) an attempt\n * is made to assign a list type to a list element type.\n */\npublic class UpdateListStrategyBug {\n    private static Display display \u003d new Display();\n    private static Realm realm \u003d SWTObservables.getRealm(display);\n    \n    public static void main(String[] args) {\n        List\u003cPoint\u003e list1 \u003d new ArrayList\u003cPoint\u003e();\n        list1.add(new Point(1.,1.));\n        PointListObservable obsList1 \u003d new PointListObservable(list1);\n        \n        List\u003cPoint\u003e list2 \u003d new ArrayList\u003cPoint\u003e();\n        list2.add(new Point(2.,2.));\n        PointListObservable obsList2 \u003d new PointListObservable(list2);\n        \n        DataBindingContext ctx \u003d new DataBindingContext(realm);\n        ctx.bindList(obsList1, obsList2, null, null);\n        System.out.println(list1.get(0));\n    }\n\n    private static class PointListObservable extends WritableList {\n        protected PointListObservable(List\u003cPoint\u003e wrappedList) {\n            super(realm, wrappedList, wrappedList.getClass());\n        }\n    }\n\n    private static class Point {\n        private double x;\n        private double y;\n        \n        \n        @Override\n        public String toString() {\n            return \"(\"+x+\", \"+y+\")\";\n        }\n\n        public Point() {\n            this(0., 0.);\n        }\n\n        public Point(double x, double y) {\n            super();\n            this.x \u003d x;\n            this.y \u003d y;\n        }\n        \n        public double getX() {\n            return x;\n        }\n        \n        public void setX(double x) {\n            this.x \u003d x;\n        }\n        \n        public double getY() {\n            return y;\n        }\n        \n        public void setY(double y) {\n            this.y \u003d y;\n        }\n    }\n}\n\n\n\nMore information:\nError should also occur on Eclipse 3.3 but I could not reproduce it because I got NoClassDefFoundError: org/eclipse/core/runtime/ISafeRunnable after adding  databinding, swt and jface libraries to the build path :(",
    "You also need to add org.eclipse.equinox.common to the classpath.",
    "I have added some libraries to run the enclosed snippet in Eclipse 3.3:\n\nJRE\norg.eclipse.core.databinding_1.0.0.I20070606-0010.jar\norg.eclipse.core.databinding.beans_1.0.0.I20070606-0010.jar\norg.eclipse.jface.databinding_1.1.0.I20070606-0010.jar\norg.eclipse.swt.gtk.linux.x86_3.3.0.v3346.jar\norg.eclipse.equinox.common_3.3.0.v20070426.jar\norg.eclipse.osgi_3.3.0.v20070530.jar\n\nThe bug also occurs with Eclipse 3.3.\n",
    "Changed version to 3.3.",
    "Investigate for 3.3.1",
    "Peter, is this the exception that you\u0027re seeing?\n\norg.eclipse.core.databinding.BindingException: UpdateListStrategyBug$Point is not assignable to java.util.ArrayList\n\tat org.eclipse.core.internal.databinding.conversion.IdentityConverter.convert(IdentityConverter.java:71)\n\tat org.eclipse.core.databinding.UpdateListStrategy.convert(UpdateListStrategy.java:144)\n\tat org.eclipse.core.databinding.ListBinding$5.run(ListBinding.java:166)\n\tat org.eclipse.core.databinding.observable.Realm$1.run(Realm.java:144)\n\tat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n\tat org.eclipse.core.databinding.observable.Realm.safeRun(Realm.java:148)\n\tat org.eclipse.core.databinding.observable.Realm.exec(Realm.java:166)\n\tat org.eclipse.core.databinding.ListBinding.doUpdate(ListBinding.java:145)\n\tat org.eclipse.core.databinding.ListBinding.access$2(ListBinding.java:138)\n\tat org.eclipse.core.databinding.ListBinding$3.run(ListBinding.java:109)\n\tat org.eclipse.core.databinding.observable.Realm$1.run(Realm.java:144)\n\tat org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n\tat org.eclipse.core.databinding.observable.Realm.safeRun(Realm.java:148)\n\tat org.eclipse.core.databinding.observable.Realm.exec(Realm.java:166)\n\tat org.eclipse.core.databinding.ListBinding.updateModelToTarget(ListBinding.java:104)\n\tat org.eclipse.core.databinding.ListBinding.postInit(ListBinding.java:95)\n\tat org.eclipse.core.databinding.Binding.init(Binding.java:55)\n\tat org.eclipse.core.databinding.DataBindingContext.bindList(DataBindingContext.java:194)\n\tat UpdateListStrategyBug.main(UpdateListStrategyBug.java:33)\nUnhandled exception: UpdateListStrategyBug$Point is not assignable to java.util.ArrayList\nException in thread \"main\" java.lang.IndexOutOfBoundsException: Index: 0, Size: 0\n\tat java.util.ArrayList.RangeCheck(ArrayList.java:546)\n\tat java.util.ArrayList.get(ArrayList.java:321)\n\tat UpdateListStrategyBug.main(UpdateListStrategyBug.java:34)\n\nIf so this is an issue with the test, not data binding.  (I tested this on 3.3, not 3.2.1.)  The issue is in the subclass of WritableList.\n\nprivate static class PointListObservable extends WritableList {\n        protected PointListObservable(List\u003cPoint\u003e wrappedList) {\n            super(realm, wrappedList, wrappedList.getClass());    // \u003c\u003c\u003c\u003c\n        }\n    }\n\nThe \"elementType\" is the type of the objects contained in the list.  This is currently returning ArrayList.class which can\u0027t be converted to by IdentityConverter.  By changing this value to Point.class the following is printed to the console without the exception.\n\n\"(2.0, 2.0)\"\n\nResolving as INVALID.  If I am misunderstanding something feel free to reopen.\n\nINALID \u003e 20070815."
  ],
  "commentCreationDates": [
    "2007-08-06T15:20:28+02:00",
    "2007-08-07T05:23:28+02:00",
    "2007-08-08T09:30:02+02:00",
    "2007-08-14T13:31:35+02:00",
    "2007-08-15T20:47:01+02:00",
    "2007-08-16T03:25:45+02:00"
  ],
  "traces": [
    {
      "exceptionType": "org.eclipse.core.databinding.BindingException",
      "message": "UpdateListStrategyBug$Point is not assignable to java.util.ArrayList",
      "elements": [
        {
          "method": "org.eclipse.core.internal.databinding.conversion.IdentityConverter.convert",
          "source": "IdentityConverter.java:71"
        },
        {
          "method": "org.eclipse.core.databinding.UpdateListStrategy.convert",
          "source": "UpdateListStrategy.java:144"
        },
        {
          "method": "org.eclipse.core.databinding.ListBinding$5.run",
          "source": "ListBinding.java:166"
        },
        {
          "method": "org.eclipse.core.databinding.observable.Realm$1.run",
          "source": "Realm.java:144"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.core.databinding.observable.Realm.safeRun",
          "source": "Realm.java:148"
        },
        {
          "method": "org.eclipse.core.databinding.observable.Realm.exec",
          "source": "Realm.java:166"
        },
        {
          "method": "org.eclipse.core.databinding.ListBinding.doUpdate",
          "source": "ListBinding.java:145"
        },
        {
          "method": "org.eclipse.core.databinding.ListBinding.access$2",
          "source": "ListBinding.java:138"
        },
        {
          "method": "org.eclipse.core.databinding.ListBinding$3.run",
          "source": "ListBinding.java:109"
        },
        {
          "method": "org.eclipse.core.databinding.observable.Realm$1.run",
          "source": "Realm.java:144"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.core.databinding.observable.Realm.safeRun",
          "source": "Realm.java:148"
        },
        {
          "method": "org.eclipse.core.databinding.observable.Realm.exec",
          "source": "Realm.java:166"
        },
        {
          "method": "org.eclipse.core.databinding.ListBinding.updateModelToTarget",
          "source": "ListBinding.java:104"
        },
        {
          "method": "org.eclipse.core.databinding.ListBinding.postInit",
          "source": "ListBinding.java:95"
        },
        {
          "method": "org.eclipse.core.databinding.Binding.init",
          "source": "Binding.java:55"
        },
        {
          "method": "org.eclipse.core.databinding.DataBindingContext.bindList",
          "source": "DataBindingContext.java:194"
        },
        {
          "method": "UpdateListStrategyBug.main",
          "source": "UpdateListStrategyBug.java:33"
        }
      ],
      "number": 0,
      "commentIndex": 5,
      "bugId": "198931",
      "date": "2007-08-16T03:25:45+02:00",
      "product": "Platform",
      "component": "UI",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.IndexOutOfBoundsException",
      "message": "Index: 0, Size: 0",
      "elements": [
        {
          "method": "java.util.ArrayList.RangeCheck",
          "source": "ArrayList.java:546"
        },
        {
          "method": "java.util.ArrayList.get",
          "source": "ArrayList.java:321"
        },
        {
          "method": "UpdateListStrategyBug.main",
          "source": "UpdateListStrategyBug.java:34"
        }
      ],
      "number": 1,
      "commentIndex": 5,
      "bugId": "198931",
      "date": "2007-08-16T03:25:45+02:00",
      "product": "Platform",
      "component": "UI",
      "severity": "normal"
    }
  ],
  "groupId": "198931",
  "bugId": "198931",
  "date": "2007-08-06T15:20:28+02:00",
  "product": "Platform",
  "component": "UI",
  "severity": "normal"
}