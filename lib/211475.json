{
  "comments": [
    "Build ID: N/A\n\nSteps To Reproduce:\n1. I am running on Pentium 4 3.0 Ghz, 2 CPU and using Birt Runtime 2.2.1.1\n2. I am trying to run same report in several thread simultaneously (to test concurrent access performance), sharing same IReportRunnable and IReportEngine between them. It is claimed in several places that IReportRunnable and IReportEngine are thread-safe.\n\n3. I am getting 2 variations of exceptions on some of the threads, sometimes even all threads succeed.\n\n1)  First exception i get more often when running 10 threads simultaneously:\n\njava.lang.NullPointerException\n\tat org.eclipse.birt.report.engine.api.impl.EngineTask$ParameterVisitor.visit(EngineTask.java:947)\n\tat org.eclipse.birt.report.engine.api.impl.EngineTask$ParameterVisitor.visit(EngineTask.java:941)\n\tat org.eclipse.birt.report.engine.api.impl.EngineTask.usingParameterValues(EngineTask.java:1042)\n\tat org.eclipse.birt.report.engine.api.impl.EngineTask.doValidateParameters(EngineTask.java:482)\n\tat org.eclipse.birt.report.engine.api.impl.RunAndRenderTask.doRun(RunAndRenderTask.java:79)\n\tat org.eclipse.birt.report.engine.api.impl.RunAndRenderTask.run(RunAndRenderTask.java:68)\n\tat BugTest$ThreadTestUnit.run(BugTest.java:98)org.eclipse.birt.report.engine.api.impl.EngineTask$ParameterVisitor.visit(EngineTask.java:941)\n\tat org.eclipse.birt.report.engine.api.impl.EngineTask.usingParameterValues(EngineTask.java:1042)\n\tat org.eclipse.birt.report.engine.api.impl.EngineTask.doValidateParameters(EngineTask.java:482)\n\tat org.eclipse.birt.report.engine.api.impl.RunAndRenderTask.doRun(RunAndRenderTask.java:79)\n\tat org.eclipse.birt.report.engine.api.impl.RunAndRenderTask.run(RunAndRenderTask.java:68)\n\tat BugTest$ThreadTestUnit.run(BugTest.java:98)\n\n2) Second exception i get more often when i run 2 threads simultaneously:\n\njava.lang.NullPointerException\n\tat org.eclipse.birt.report.engine.api.impl.ScriptedDesignVisitor.visitCell(ScriptedDesignVisitor.java:613)\n\tat org.eclipse.birt.report.model.api.DesignVisitor$Forwarder.visitCell(DesignVisitor.java:1077)\n\tat org.eclipse.birt.report.model.elements.Cell.apply(Cell.java:81)\n\tat org.eclipse.birt.report.model.api.DesignVisitor.apply(DesignVisitor.java:123)\n\tat org.eclipse.birt.report.engine.api.impl.ScriptedDesignVisitor.visitRow(ScriptedDesignVisitor.java:603)\n\tat org.eclipse.birt.report.model.api.DesignVisitor$Forwarder.visitRow(DesignVisitor.java:1101)\n\tat org.eclipse.birt.report.model.elements.TableRow.apply(TableRow.java:75)\n\tat org.eclipse.birt.report.model.api.DesignVisitor.apply(DesignVisitor.java:123)\n\tat org.eclipse.birt.report.engine.api.impl.ScriptedDesignVisitor.visitTable(ScriptedDesignVisitor.java:558)\n\tat org.eclipse.birt.report.model.api.DesignVisitor$Forwarder.visitTable(DesignVisitor.java:1053)\n\tat org.eclipse.birt.report.model.elements.TableItem.apply(TableItem.java:80)\n\tat org.eclipse.birt.report.model.api.DesignVisitor.apply(DesignVisitor.java:123)\n\tat org.eclipse.birt.report.engine.api.impl.ScriptedDesignVisitor.visitReportDesign(ScriptedDesignVisitor.java:354)\n\tat org.eclipse.birt.report.model.api.DesignVisitor$Forwarder.visitReportDesign(DesignVisitor.java:1175)\n\tat org.eclipse.birt.report.model.elements.ReportDesign.apply(ReportDesign.java:89)\n\tat org.eclipse.birt.report.model.api.DesignVisitor.apply(DesignVisitor.java:123)\n\tat org.eclipse.birt.report.engine.api.impl.EngineTask.prepareDesign(EngineTask.java:1197)\n\tat org.eclipse.birt.report.engine.api.impl.RunAndRenderTask.doRun(RunAndRenderTask.java:83)\n\tat org.eclipse.birt.report.engine.api.impl.RunAndRenderTask.run(RunAndRenderTask.java:68)\n\tat BugTest$ThreadTestUnit.run(BugTest.java:98)\n\n4) I will list source code for test below, but can\u0027t attach the report design. Hope it will reproduce on any design though. \n\nMore information:\nCode for test case (composed from various tutorials on BIRT all over the net):\n\nimport org.eclipse.birt.report.engine.api.IReportEngine;\nimport org.eclipse.birt.report.engine.api.EngineConfig;\nimport org.eclipse.birt.report.engine.api.IReportEngineFactory;\nimport org.eclipse.birt.report.engine.api.IRunAndRenderTask;\nimport org.eclipse.birt.report.engine.api.HTMLRenderContext;\nimport org.eclipse.birt.report.engine.api.EngineConstants;\nimport org.eclipse.birt.report.engine.api.HTMLRenderOption;\nimport org.eclipse.birt.report.engine.api.IReportRunnable;\nimport org.eclipse.birt.core.framework.Platform;\n\nimport java.util.logging.Level;\nimport java.util.concurrent.BlockingQueue;\nimport java.util.concurrent.ArrayBlockingQueue;\nimport java.util.concurrent.ThreadPoolExecutor;\nimport java.util.concurrent.TimeUnit;\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.io.ByteArrayOutputStream;\n\npublic class BugTest {\n\n    private IReportEngine engine;\n    private IReportRunnable design;\n\n    public BugTest(IReportEngine engine, IReportRunnable design) {\n        this.engine \u003d engine;\n        this.design \u003d design;\n    }\n\n    public void runTest(int unitCount, int threadCount) {\n        BlockingQueue\u003cRunnable\u003e queue \u003d new ArrayBlockingQueue\u003cRunnable\u003e(unitCount);\n\n        ArrayList\u003cThreadTestUnit\u003e units \u003d new ArrayList\u003cThreadTestUnit\u003e(unitCount);\n        for (int i \u003d 0; i \u003c unitCount; i++) {\n            ThreadTestUnit unit \u003d new ThreadTestUnit();\n            units.add(unit);\n        }\n\n        ThreadPoolExecutor executor \u003d new ThreadPoolExecutor(threadCount, threadCount, Integer.MAX_VALUE, TimeUnit.SECONDS, queue);\n\n        for (ThreadTestUnit unit : units) {\n            executor.execute(unit);\n        }\n\n        executor.shutdown();\n        try {\n            executor.awaitTermination(Long.MAX_VALUE, TimeUnit.SECONDS);\n        } catch (InterruptedException e1) {\n            throw new RuntimeException(e1);\n        }\n    }\n\n\n    public static void main(String[] args) {\n\n        String birtRuntimeDir \u003d \"F:/birt-runtime-2_2_1_1/ReportEngine\";\n        String logDir \u003d \"f:/temp\";\n        String reportSrc \u003d \"F:/birt/new_report_2.rptdesign\";\n\n        IReportEngine engine;\n        IReportRunnable design;\n\n        try {\n            EngineConfig config \u003d new EngineConfig();\n            config.setEngineHome(birtRuntimeDir);\n            config.setLogConfig(logDir, Level.FINE);\n            Platform.startup(config);\n            IReportEngineFactory factory \u003d (IReportEngineFactory) Platform\n                    .createFactoryObject(IReportEngineFactory.EXTENSION_REPORT_ENGINE_FACTORY);\n            engine \u003d factory.createReportEngine(config);\n            engine.changeLogLevel(Level.WARNING);\n            design \u003d engine.openReportDesign(reportSrc);\n        } catch (Exception e) {\n            throw new RuntimeException(e);\n        }\n\n        new BugTest(engine, design).runTest(2, 2);\n\n        engine.shutdown();\n        Platform.shutdown();\n    }\n\n    private class ThreadTestUnit implements Runnable {\n\n        public void run() {\n            try {\n                IRunAndRenderTask task \u003d engine.createRunAndRenderTask(design);\n                HTMLRenderContext renderContext \u003d new HTMLRenderContext();\n                renderContext.setImageDirectory(\"image\");\n                HashMap contextMap \u003d new HashMap();\n                contextMap.put( EngineConstants.APPCONTEXT_HTML_RENDER_CONTEXT, renderContext );\n                task.setAppContext( contextMap );\n                HTMLRenderOption options \u003d new HTMLRenderOption();\n                ByteArrayOutputStream str \u003d new ByteArrayOutputStream();\n                options.setOutputStream(str);\n                options.setOutputFormat(\"html\");\n                task.setRenderOption(options);\n                task.run();\n                task.close();\n            } catch (Exception e) {\n                throw new RuntimeException(e);\n            }\n        }\n    }\n}",
    "Note, that thread count/unit count can be changed in code below by providing different values to BugTest.runTest(). In attached example the call is made for 2 report calculation attempts served by 2 threads.",
    "Null object is returned from getSlotHandle().\nReassign to Model for further investigation.",
    "Build 2.2.1.1 had this issue. However, it has been fixed in 2.3 head and 2.2.2 branch. Please use latest build. Thanks.",
    "reopen this bug since it is still reproducible with higher number of threads.\n\nplease see #211980 ",
    "please see #211980. Got another NPE from Data codes. Reassign to fix",
    "schedule to 2.2.2 along with 211980."
  ],
  "commentCreationDates": [
    "2007-11-29T17:36:21+01:00",
    "2007-11-29T17:40:52+01:00",
    "2007-12-03T07:33:50+01:00",
    "2007-12-04T06:30:19+01:00",
    "2007-12-12T22:41:36+01:00",
    "2007-12-14T06:20:55+01:00",
    "2007-12-14T20:23:26+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.birt.report.engine.api.impl.EngineTask$ParameterVisitor.visit",
          "source": "EngineTask.java:947"
        },
        {
          "method": "org.eclipse.birt.report.engine.api.impl.EngineTask$ParameterVisitor.visit",
          "source": "EngineTask.java:941"
        },
        {
          "method": "org.eclipse.birt.report.engine.api.impl.EngineTask.usingParameterValues",
          "source": "EngineTask.java:1042"
        },
        {
          "method": "org.eclipse.birt.report.engine.api.impl.EngineTask.doValidateParameters",
          "source": "EngineTask.java:482"
        },
        {
          "method": "org.eclipse.birt.report.engine.api.impl.RunAndRenderTask.doRun",
          "source": "RunAndRenderTask.java:79"
        },
        {
          "method": "org.eclipse.birt.report.engine.api.impl.RunAndRenderTask.run",
          "source": "RunAndRenderTask.java:68"
        },
        {
          "method": "BugTest$ThreadTestUnit.run",
          "source": "BugTest.java:98"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "211475",
      "date": "2007-11-29T17:36:21+01:00",
      "product": "BIRT",
      "component": "Data",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.birt.report.engine.api.impl.ScriptedDesignVisitor.visitCell",
          "source": "ScriptedDesignVisitor.java:613"
        },
        {
          "method": "org.eclipse.birt.report.model.api.DesignVisitor$Forwarder.visitCell",
          "source": "DesignVisitor.java:1077"
        },
        {
          "method": "org.eclipse.birt.report.model.elements.Cell.apply",
          "source": "Cell.java:81"
        },
        {
          "method": "org.eclipse.birt.report.model.api.DesignVisitor.apply",
          "source": "DesignVisitor.java:123"
        },
        {
          "method": "org.eclipse.birt.report.engine.api.impl.ScriptedDesignVisitor.visitRow",
          "source": "ScriptedDesignVisitor.java:603"
        },
        {
          "method": "org.eclipse.birt.report.model.api.DesignVisitor$Forwarder.visitRow",
          "source": "DesignVisitor.java:1101"
        },
        {
          "method": "org.eclipse.birt.report.model.elements.TableRow.apply",
          "source": "TableRow.java:75"
        },
        {
          "method": "org.eclipse.birt.report.model.api.DesignVisitor.apply",
          "source": "DesignVisitor.java:123"
        },
        {
          "method": "org.eclipse.birt.report.engine.api.impl.ScriptedDesignVisitor.visitTable",
          "source": "ScriptedDesignVisitor.java:558"
        },
        {
          "method": "org.eclipse.birt.report.model.api.DesignVisitor$Forwarder.visitTable",
          "source": "DesignVisitor.java:1053"
        },
        {
          "method": "org.eclipse.birt.report.model.elements.TableItem.apply",
          "source": "TableItem.java:80"
        },
        {
          "method": "org.eclipse.birt.report.model.api.DesignVisitor.apply",
          "source": "DesignVisitor.java:123"
        },
        {
          "method": "org.eclipse.birt.report.engine.api.impl.ScriptedDesignVisitor.visitReportDesign",
          "source": "ScriptedDesignVisitor.java:354"
        },
        {
          "method": "org.eclipse.birt.report.model.api.DesignVisitor$Forwarder.visitReportDesign",
          "source": "DesignVisitor.java:1175"
        },
        {
          "method": "org.eclipse.birt.report.model.elements.ReportDesign.apply",
          "source": "ReportDesign.java:89"
        },
        {
          "method": "org.eclipse.birt.report.model.api.DesignVisitor.apply",
          "source": "DesignVisitor.java:123"
        },
        {
          "method": "org.eclipse.birt.report.engine.api.impl.EngineTask.prepareDesign",
          "source": "EngineTask.java:1197"
        },
        {
          "method": "org.eclipse.birt.report.engine.api.impl.RunAndRenderTask.doRun",
          "source": "RunAndRenderTask.java:83"
        },
        {
          "method": "org.eclipse.birt.report.engine.api.impl.RunAndRenderTask.run",
          "source": "RunAndRenderTask.java:68"
        },
        {
          "method": "BugTest$ThreadTestUnit.run",
          "source": "BugTest.java:98"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "211475",
      "date": "2007-11-29T17:36:21+01:00",
      "product": "BIRT",
      "component": "Data",
      "severity": "normal"
    }
  ],
  "groupId": "211475",
  "bugId": "211475",
  "date": "2007-11-29T17:36:21+01:00",
  "product": "BIRT",
  "component": "Data",
  "severity": "normal"
}