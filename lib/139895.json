{
  "comments": [
    "While editing a JSP document, suddenly typing letters no longer advances the cursor position. This causes all words to be inserted in \"reverse\", i.e. typing \"width\" is displayed as \"htdiw\" in the editor.\nAt this point the error log contains a number of exceptions. It starts with a \"Program error: invalid structured document event\" which has no stacktrace. It gets followed by a NullPointerException with the stacktrace:\njava.lang.RuntimeException: java.lang.NullPointerException\nat org.eclipse.wst.sse.core.internal.text.JobSafeStructuredDocument.replaceText(JobSafeStructuredDocument.java:113)\nat org.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.replaceText(BasicStructuredDocument.java:2363)\nat org.eclipse.wst.sse.ui.internal.StructuredDocumentToTextAdapter.replaceTextRange(StructuredDocumentToTextAdapter.java:1187)\nat org.eclipse.swt.custom.StyledText.modifyContent(StyledText.java:5793)\nat org.eclipse.swt.custom.StyledText.sendKeyEvent(StyledText.java:6518)\nat org.eclipse.swt.custom.StyledText.doContent(StyledText.java:2111)\nat org.eclipse.swt.custom.StyledText.handleKey(StyledText.java:5068)\nat org.eclipse.swt.custom.StyledText.handleKeyDown(StyledText.java:5094)\nat org.eclipse.swt.custom.StyledText$7.handleEvent(StyledText.java:4833)\nat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\nat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1070)\nat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1094)\nat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1079)\nat org.eclipse.swt.widgets.Widget.sendIMKeyEvent(Widget.java:1156)\nat org.eclipse.swt.widgets.Control.gtk_commit(Control.java:1958)\nat org.eclipse.swt.widgets.Widget.windowProc(Widget.java:1409)\nat org.eclipse.swt.widgets.Display.windowProc(Display.java:3787)\nat org.eclipse.swt.internal.gtk.OS._gtk_im_context_filter_keypress(Native Method)\nat org.eclipse.swt.internal.gtk.OS.gtk_im_context_filter_keypress(OS.java:4792)\nat org.eclipse.swt.widgets.Control.filterKey(Control.java:1525)\nat org.eclipse.swt.widgets.Control.gtk_key_press_event(Control.java:2063)\nat org.eclipse.swt.widgets.Composite.gtk_key_press_event(Composite.java:611)\nat org.eclipse.swt.widgets.Widget.windowProc(Widget.java:1419)\nat org.eclipse.swt.widgets.Display.windowProc(Display.java:3787)\nat org.eclipse.swt.internal.gtk.OS._gtk_main_do_event(Native Method)\nat org.eclipse.swt.internal.gtk.OS.gtk_main_do_event(OS.java:5242)\nat org.eclipse.swt.widgets.Display.eventProc(Display.java:1128)\nat org.eclipse.swt.internal.gtk.OS._g_main_context_iteration(Native Method)\nat org.eclipse.swt.internal.gtk.OS.g_main_context_iteration(OS.java:1424)\nat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2833)\nat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1914)\nat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1878)\nat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:419)\nat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:143)\nat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:95)\nat org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:78)\nat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:92)\nat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:68)\nat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:400)\nat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:177)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\nat java.lang.reflect.Method.invoke(Method.java:585)\nat org.eclipse.core.launcher.Main.invokeFramework(Main.java:336)\nat org.eclipse.core.launcher.Main.basicRun(Main.java:280)\nat org.eclipse.core.launcher.Main.run(Main.java:977)\nat org.eclipse.core.launcher.Main.main(Main.java:952)\nCaused by: java.lang.NullPointerException\nat org.eclipse.jface.text.DefaultPositionUpdater.update(DefaultPositionUpdater.java:227)\nat org.eclipse.wst.sse.core.internal.text.GenericPositionManager.updatePositions(GenericPositionManager.java:395)\nat org.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.updateDocumentData(BasicStructuredDocument.java:2645)\nat org.eclipse.jst.jsp.core.internal.parser.JSPReParser.reparse(JSPReParser.java:141)\nat org.eclipse.wst.sse.core.internal.text.StructuredDocumentReParser.reparse(StructuredDocumentReParser.java:1284)\nat org.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.updateModel(BasicStructuredDocument.java:2657)\nat org.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.internalReplaceText(BasicStructuredDocument.java:1899)\nat org.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.replaceText(BasicStructuredDocument.java:2367)\nat org.eclipse.wst.sse.core.internal.text.JobSafeStructuredDocument.access$0(JobSafeStructuredDocument.java:1)\nat org.eclipse.wst.sse.core.internal.text.JobSafeStructuredDocument$1.run(JobSafeStructuredDocument.java:95)\nat org.eclipse.wst.sse.ui.EditorExecutionContext.execute(EditorExecutionContext.java:42)\nat org.eclipse.wst.sse.core.internal.text.JobSafeStructuredDocument.replaceText(JobSafeStructuredDocument.java:105)\n... 47 more\n\nwhich is then followed by an \"Unhandled event loop exception\" again without a stacktrace. This threesome of events then occurs for every keypress.\nThe only way to \"fix\" the behaviour is to close the editor view and re-open the document.\nI have tried to reproduce this behaviour but have not yet found a way.. It does occur very often though while editing JSP with \u003c%\u003d %\u003e and \u003c% %\u003e constructs.",
    "I remember we had an issue with backwards typing in the past.  The fix was in JSPSourceParser#parseNodes() (at the very end of the method):\n\nif (currentNode !\u003d null) {\n\tfireNodeParsed(currentNode);\n\tcurrentNode.setPrevious(lastNode);\n}\n\nwas changed to:\nif (currentNode !\u003d null) {\n\ttry {\n\t\tfireNodeParsed(currentNode);\n\t}\n\tcatch (Exception e) {\n\t\tLogger.log(Logger.ERROR, e.getMessage());\n\t}\n\tcurrentNode.setPrevious(lastNode);\n}\n\nThis fix did not seem to get ported into WTP.  Is this the correct fix?  I\u0027m not sure because this fix is in JSPSourceParser and the stacktrace in this bug seems to indicate JSPReParser.",
    "Actually, this looks like a duplicate of bug 139895\n\n*** This bug has been marked as a duplicate of 136308 ***",
    "(In reply to comment #1)\n\u003e ... \n\u003e This fix did not seem to get ported into WTP.  Is this the correct fix?  \n\u003e \n\nAmy the \"other\" fix should still be there in a slightly different form (I think we changed the exact location of the try/catch block to better cover all cases). \n\nI think problem is slightly different. I\u0027ll look at code. \n\n\n",
    "This is part of a mass update to close out all stale WTP defects already verified by the reporter but awaiting closure by the assignee.  If you feel this defect was closed inappropriately, please reopen.\n\nThanks, John Lanuti"
  ],
  "commentCreationDates": [
    "2006-05-03T11:15:09+02:00",
    "2006-05-03T18:27:08+02:00",
    "2006-05-04T19:03:21+02:00",
    "2006-05-04T19:12:09+02:00",
    "2006-11-28T20:39:03+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.wst.sse.core.internal.text.JobSafeStructuredDocument.replaceText",
          "source": "JobSafeStructuredDocument.java:113"
        },
        {
          "method": "org.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.replaceText",
          "source": "BasicStructuredDocument.java:2363"
        },
        {
          "method": "org.eclipse.wst.sse.ui.internal.StructuredDocumentToTextAdapter.replaceTextRange",
          "source": "StructuredDocumentToTextAdapter.java:1187"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.modifyContent",
          "source": "StyledText.java:5793"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.sendKeyEvent",
          "source": "StyledText.java:6518"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.doContent",
          "source": "StyledText.java:2111"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.handleKey",
          "source": "StyledText.java:5068"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.handleKeyDown",
          "source": "StyledText.java:5094"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText$7.handleEvent",
          "source": "StyledText.java:4833"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:1070"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:1094"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:1079"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendIMKeyEvent",
          "source": "Widget.java:1156"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.gtk_commit",
          "source": "Control.java:1958"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.windowProc",
          "source": "Widget.java:1409"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3787"
        },
        {
          "method": "org.eclipse.swt.internal.gtk.OS._gtk_im_context_filter_keypress",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.gtk.OS.gtk_im_context_filter_keypress",
          "source": "OS.java:4792"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.filterKey",
          "source": "Control.java:1525"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.gtk_key_press_event",
          "source": "Control.java:2063"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.gtk_key_press_event",
          "source": "Composite.java:611"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.windowProc",
          "source": "Widget.java:1419"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3787"
        },
        {
          "method": "org.eclipse.swt.internal.gtk.OS._gtk_main_do_event",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.gtk.OS.gtk_main_do_event",
          "source": "OS.java:5242"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.eventProc",
          "source": "Display.java:1128"
        },
        {
          "method": "org.eclipse.swt.internal.gtk.OS._g_main_context_iteration",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.gtk.OS.g_main_context_iteration",
          "source": "OS.java:1424"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2833"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1914"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1878"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:419"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:143"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:95"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:78"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:92"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:68"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:400"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:177"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:585"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:336"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:280"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:977"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:952"
        }
      ],
      "causedBy": {
        "exceptionType": "java.lang.NullPointerException",
        "elements": [
          {
            "method": "org.eclipse.jface.text.DefaultPositionUpdater.update",
            "source": "DefaultPositionUpdater.java:227"
          },
          {
            "method": "org.eclipse.wst.sse.core.internal.text.GenericPositionManager.updatePositions",
            "source": "GenericPositionManager.java:395"
          },
          {
            "method": "org.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.updateDocumentData",
            "source": "BasicStructuredDocument.java:2645"
          },
          {
            "method": "org.eclipse.jst.jsp.core.internal.parser.JSPReParser.reparse",
            "source": "JSPReParser.java:141"
          },
          {
            "method": "org.eclipse.wst.sse.core.internal.text.StructuredDocumentReParser.reparse",
            "source": "StructuredDocumentReParser.java:1284"
          },
          {
            "method": "org.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.updateModel",
            "source": "BasicStructuredDocument.java:2657"
          },
          {
            "method": "org.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.internalReplaceText",
            "source": "BasicStructuredDocument.java:1899"
          },
          {
            "method": "org.eclipse.wst.sse.core.internal.text.BasicStructuredDocument.replaceText",
            "source": "BasicStructuredDocument.java:2367"
          },
          {
            "method": "org.eclipse.wst.sse.core.internal.text.JobSafeStructuredDocument.access$0",
            "source": "JobSafeStructuredDocument.java:1"
          },
          {
            "method": "org.eclipse.wst.sse.core.internal.text.JobSafeStructuredDocument$1.run",
            "source": "JobSafeStructuredDocument.java:95"
          },
          {
            "method": "org.eclipse.wst.sse.ui.EditorExecutionContext.execute",
            "source": "EditorExecutionContext.java:42"
          },
          {
            "method": "org.eclipse.wst.sse.core.internal.text.JobSafeStructuredDocument.replaceText",
            "source": "JobSafeStructuredDocument.java:105"
          }
        ],
        "number": 0,
        "commentIndex": 0
      },
      "number": 0,
      "commentIndex": 0,
      "bugId": "139895",
      "duplicateId": "136308",
      "date": "2006-05-03T11:15:09+02:00",
      "product": "Web Tools",
      "component": "jst.jsp",
      "severity": "normal"
    }
  ],
  "groupId": "136308",
  "bugId": "139895",
  "duplicateId": "136308",
  "date": "2006-05-03T11:15:09+02:00",
  "product": "Web Tools",
  "component": "jst.jsp",
  "severity": "normal"
}