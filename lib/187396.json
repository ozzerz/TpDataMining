{
  "comments": [
    "Doing some testing for bug 132450. Found an apparent problem with org.eclipse.jdt.core_3.3.0.v_745.jar and/or org.eclipse.jdt.core_3.3.0.v_755.jar when trying to install via UM.\n\nSteps to reproduce:\n\n1. download Platform Runtime Binary 3.3.0M7 from http://fullmoon.torolab.ibm.com/downloads/drops/S-3.3M7-200705031400/linPlatform.php#EclipseSDK\n\n2. unpack, use clean workspace. Here\u0027s my script:\n\n#!/bin/bash\nrm -fr /tmp/workspace-clean eclipse\ntar xzf eclipse-platform-3.3M7-linux-gtk.tar.gz\n./eclipse/eclipse -vm /opt/sun-java2-5.0/bin/java -data /tmp/workspace-clean -consolelog \u0026\n\n3. log console errors to file (see attached files)\n\n4. launch Eclipse. Dispose Welcome screen (click the X).\n\n5. Help \u003e Software Updates \u003e Find and install...\n6. Search for new features to install \u003e Next\n7. [x] Europa Discovery Site (or you can add the staging site -- either one fails: http://download.eclipse.org/releases/europa/staging/site.xml)\n8. select main Eclipse.org mirror (bottom of the list)\n9. expand twisty \u0027Europa Discovery Site\u0027 (or staging site)\n10. expand twisty \u0027Java Development\u0027 *** WAIT up to 5 seconds if using staging site ***\n11. [x] Eclipse Plug-in Development Environment 3.3.0\n12. click \u0027Select Required\u0027 *** WAIT up to 90 seconds if using staging site *** \n13. click Next, accept licenses, Next \u003e Finish\n14. Update operation has failed [OK]\n\n!SESSION 2007-05-16 16:40:35.070 -----------------------------------------------\neclipse.buildId\u003dI20070503-1400\njava.version\u003d1.5.0_09\njava.vendor\u003dSun Microsystems Inc.\nBootLoader constants: OS\u003dlinux, ARCH\u003dx86, WS\u003dgtk, NL\u003den_US\nFramework arguments:  -startup /home/nickb/eclipse/m7clean/eclipse/plugins/org.eclipse.equinox.launcher_1.0.0.v20070502.jar\nCommand-line arguments:  -os linux -ws gtk -arch x86 -startup /home/nickb/eclipse/m7clean/eclipse/plugins/org.eclipse.equinox.launcher_1.0.0.v20070502.jar -data /tmp/workspace-clean -consolelog\n\n!ENTRY org.eclipse.update.core 4 0 2007-05-16 16:46:14.400\n!MESSAGE Error retrieving \"plugins/org.eclipse.jdt.core_3.3.0.v_745.jar\". [error in opening zip file]\n!STACK 0\njava.util.zip.ZipException: error in opening zip file\n        at java.util.zip.ZipFile.open(Native Method)\n        at java.util.zip.ZipFile.\u003cinit\u003e(ZipFile.java:203)\n        at java.util.jar.JarFile.\u003cinit\u003e(JarFile.java:132)\n        at java.util.jar.JarFile.\u003cinit\u003e(JarFile.java:112)\n        at org.eclipse.update.internal.jarprocessor.JarProcessor.processJar(JarProcessor.java:301)\n        at org.eclipse.update.internal.core.FeaturePackagedContentProvider.retrieveLocalJar(FeaturePackagedContentProvider.java:256)\n        at org.eclipse.update.internal.core.FeaturePackagedContentProvider.getPluginEntryArchiveReferences(FeaturePackagedContentProvider.java:179)\n        at org.eclipse.update.internal.operations.UpdateUtils.downloadFeatureContent(UpdateUtils.java:628)\n        at org.eclipse.update.internal.ui.wizards.InstallWizard2.download(InstallWizard2.java:426)\n        at org.eclipse.update.internal.ui.wizards.InstallWizard2.access$3(InstallWizard2.java:397)\n        at org.eclipse.update.internal.ui.wizards.InstallWizard2$3.run(InstallWizard2.java:350)\n        at org.eclipse.core.internal.jobs.Worker.run(Worker.java:55)\n\n!ENTRY org.eclipse.core.runtime 8 1 2007-05-16 16:46:31.893\n!MESSAGE\n\nI\u0027ve tried this with IBM JDK 5.0 and Sun JDK 5.0, with both staging and current Europa sites. The long timeouts are due to 404s and missing digests, I believe. Makes a helluva difference. ;-)",
    "Created an attachment (id\u003d67525)\nconsole logs\n\nfirst pass: using IBM JDK 5.0, attempt to install GMF + all dependencies (which includes PDE and JDT).\nsecond pass: try just PDE + JDT\nthird pass: try PDE + JDT from staging site\nfourth pass: try PDE + JDT from staging site, with Sun JDK 5.0",
    "(In reply to comment #0)\n\u003e 12. click \u0027Select Required\u0027 *** WAIT up to 90 seconds if using staging site *** \n\nCorrection: this took 35-45 seconds. The 90 second delay was when I tried to \u0027Select Required\u0027 on GMF (lots more features to process). ",
    "We don\u0027t build the jar.\nThe same jar provided with the SDK works fine.\nMoving to Platform/Releng.\nWas the jar file properly transferred to the update site?",
    "(In reply to comment #3)\n\u003e The same jar provided with the SDK works fine.\n\nConfirmed, starting from the SDK instead of the Platform Binary works great. \n\nI have to assume the problem\u0027s with the Update site, then. If the file\u0027s there, it\u0027s corrupt (pack200 problem?). If it\u0027s missing, there\u0027s a problem in the Europa-matic files or somewhere upstream between \u0027build the zips\u0027 and \u0027build the UM site\u0027.",
    "This looks similar to bug 179270 which has bug 178884 as the root cause.\n\nI don\u0027t think using org.eclipse.jdt.core_3.3.0.v_745.jar  is a valid test.  This jar is from M6 and the jar processor issues in bug 178884 were not fixed for M6.\nHowerver, the org.eclipse.jdt.core_3.3.0.v_755 from M7 should not have this problem because I remember using a new update core in our builder right before we released the milestone.  Apparently there is now a problem.\n\nAndrew, was a Sun and IBM JDK 5.0 tested as part of the verification for bug 178884?  I know the original bug had problems with 1.6 JDKs on Linux.\n\n",
    "Nope, it\u0027s a problem with the europa build scripts.  Sorry Andrew for the false alarm.  \n\nIn my update site\nkmoir@node1:/home/data/httpd/download.eclipse.org/eclipse/updates/3.3milestones/plugins\u003e pwd\n/home/data/httpd/download.eclipse.org/eclipse/updates/3.3milestones/plugins\nkmoir@node1:/home/data/httpd/download.eclipse.org/eclipse/updates/3.3milestones/plugins\u003e ls -ld  org.eclipse.jdt.core_3.3.0.v_755.jar*\n-rw-r--r-- 1 sdimitro eclipseadmin 4121211 2007-05-04 15:30 org.eclipse.jdt.core_3.3.0.v_755.jar\n-rw-r--r-- 1 sdimitro eclipseadmin 1459396 2007-05-04 15:30 org.eclipse.jdt.core_3.3.0.v_755.jar.pack.gz\n\nIn the europa staging site\nkmoir@node1:/home/data/httpd/download.eclipse.org/releases/europa/staging/plugins\u003e pwd\n/home/data/httpd/download.eclipse.org/releases/europa/staging/plugins\nkmoir@node1:/home/data/httpd/download.eclipse.org/releases/europa/staging/plugins\u003e ls -ld  org.eclipse.jdt.core_3.3.0.v_755.jar*\n-rw-rw-r--+ 1 bfreeman callistoadmin 4121211 2007-05-16 21:41 org.eclipse.jdt.core_3.3.0.v_755.jar\n-rw-rw-r--+ 1 bfreeman callistoadmin       0 2007-05-16 21:41 org.eclipse.jdt.core_3.3.0.v_755.jar.pack.gz\n\nNote that the packed jar has a size of zero on the Europa staging site.  Obviously something is happening in the packing phase of the Europa build that is causing issues.  Moving the cross project and cc\u0027ing Bjorn.\n\nBjorn, what version of the jar processor are you using in your build?",
    "On a related note, Andrew will release this fix for RC1\n\nProtect against JarProcessor exceptions\nbug 187580\n\n",
    "(In reply to comment #6)\n\u003e Nope, it\u0027s a problem with the europa build scripts.  \n\u003e Bjorn, what version of the jar processor are you using in your build?\n\nI am using the eclipse 3.3M7 distro and all its included jars. I just re-ran the build and am getting three zero-sized packed jars:\n:~/downloads/releases/europa/staging\u003e ls -l plugins/ | grep \" 0 2007\"\n-rw-rw-r--+ 1 bfreeman callistoadmin        0 2007-05-19 18:30 org.eclipse.birt.report.engine_2.2.0.v20070518.jar.pack.gz\n-rw-rw-r--+ 1 bfreeman callistoadmin        0 2007-05-19 18:32 org.eclipse.jdt.core_3.3.0.v_755.jar.pack.gz\n-rw-rw-r--+ 1 bfreeman callistoadmin        0 2007-05-19 18:29 org.eclipse.pde.core_3.3.0.v20070501-0010.jar.pack.gz\nI removed all three so that the downloads and installs will work, but I\u0027m not sure what to try next. Kim?",
    "I forgot to put this \"delete empty gz files\" into the build scripts so when the build re-ran it regenerated the empty files. I have not put the delete into the Europa-matic and am re-running the build.",
    "On 21-May-2007 morning, the bug is on the staging site again.\nUnfortunately, anybody starting off with the Platform and requiring EMF will fall into this due to bug #106804 not yet being complete (EMF Runtime still needs JDT).\n\nIf I read Bjorn\u0027s comment right, having the zero-length files is expected ?\n\nI guess what we are waiting for now, is for Bjorn to manually fix the staging site and then promote it to release such that we can check there.",
    "(In reply to comment #10)\n\u003e If I read Bjorn\u0027s comment right, having the zero-length files is expected ?\n\nNo. The zero length files are clearer a bug in the jarPackager. I can\u0027t think of case where a valid non-zero-length jar should be Pack 200\u0027d into a zero-length file.\n\n\u003e I guess what we are waiting for now, is for Bjorn to manually fix the staging\n\u003e site and then promote it to release such that we can check there.\n\nThe Europa-matic build automatically deletes zero-length files during each build now. See the \"copy to staging\" action in the build results (http://dash.eclipse.org/~bfreeman/europa/copy%20to%20staging-copy%20to%20staging-log.html). You should not be seeing zero-length files in the staging area at this time. (For example, as of this comment, there are no zero-length files in the staging area: \n/home/data/httpd/download.eclipse.org/releases/europa/staging\u003e ls -lR | grep \" 0 2007\"\n/home/data/httpd/download.eclipse.org/releases/europa/staging\u003e\n\nHowever I have experienced file caching delays in synchronizing the download servers at times. If (a) you are experiencing zero-length files from the main eclipse.org servers and (b) there is no active Europa build, then please wait 20 minutes and try again. If you\u0027re still seeing zero-length files, then there is a problem in the Europa-matic.\n",
    "Bjorn, do you have the output from the packing step output to a file?\n\nFor instance, we run our packing process  - note the error log.  \n\u003c!--pack200--\u003e\n\t   \u003cjava jar\u003d\"${eclipse.home}/plugins/org.eclipse.equinox.launcher.jar\"\n\t         fork\u003d\"true\"\n\t\t     timeout\u003d\"10800000\"\n\t\t     jvm\u003d\"${java15-home}/bin/java\"\n\t\t     failonerror\u003d\"true\"\n\t\t     maxmemory\u003d\"768m\"\n\t\t     error\u003d\"${buildDirectory}/errorlog.txt\"\n\t\t     dir\u003d\"${buildDirectory}\"\n\t\t     output\u003d\"${buildDirectory}/jarprocessorlog.txt\"\u003e\n\t\t\t\u003cjvmarg value\u003d\"-Dorg.eclipse.update.jarprocessor.pack200\u003d${eclipse.build.configs}/../../extras\" /\u003e\n\t\t\t\u003carg line\u003d\"-consolelog -application org.eclipse.update.core.siteOptimizer\" /\u003e\n\t\t\t\u003carg line\u003d\"-jarProcessor -verbose -outputDir ${buildLabel} -processAll -pack ${repack} ${packtmp}/${archiveName}\" /\u003e\n\t\t\u003c/java\u003e\n\nAlso, how much memory are you allocating to the process - are you running out of memory?\n\nI\u0027m moving this bug to platform update as you said it is probably an issue with the jar processor.",
    "When I download the jars from http://download.eclipse.org/releases/europa/staging/plugins that correspond to the 0-length pack.gz files, all three of them fail to verify.  Note the failures are on .class files, and therefore are unlikely to be caused by a problem in the jarProcessor.  The 0-length files are likely caused by this.\n\nAre these jars the input to the Europa-matic process? If so, the sources of those jars should be checked to see if they were ok coming out of their builds, or maybe they were corrupted in a copy somehow.\n\njarsigner -verify org.eclipse.pde.core_3.3.0.v20070501-0010.jar\njarsigner: java.lang.SecurityException: SHA1 digest error for org/eclipse/pde/in\nternal/core/exports/ProductExportOperation.class\n\njarsigner -verify org.eclipse.birt.report.engine_2.2.0.v20070518.jar\njarsigner: java.lang.SecurityException: SHA1 digest error for org/eclipse/birt/r\neport/engine/css/engine/value/AbstractValueFactory.class\n\njarsigner -verify org.eclipse.jdt.core_3.3.0.v_755.jar\njarsigner: java.lang.SecurityException: SHA1 digest error for org/eclipse/jdt/co\nre/dom/Javadoc.class",
    "(In reply to comment #13)\n\u003e Are these jars the input to the Europa-matic process? \n\nYes, they are.",
    "(In reply to comment #12)\n\u003e Bjorn, do you have the output from the packing step output to a file?\n\nThe output of the pack200 command is in the Europa-matic log:\nhttp://dash.eclipse.org/~bfreeman/europa/pack200-pack200-log.html\n\n\u003e Also, how much memory are you allocating to the process - are you running out\n\u003e of memory?\n\nHere\u0027s my command line. I\u0027m using 1Gb of memory.\n        \u003cjava\n            classname\u003d\"org.eclipse.equinox.launcher.Main\"\n            taskname\u003d\"createPack200s\"\n            fork\u003d\"true\"\n            jvm\u003d\"${java15-home}/bin/java\"\n            failonerror\u003d\"true\"\n            resultProperty\u003d\"createPack200Result\"\n            maxmemory\u003d\"1024m\"\n            dir\u003d\"${buildDirectory}\"\u003e\n            \u003cclasspath\u003e\n                \u003cfileset dir\u003d\"${eclipse.home}/plugins\"\u003e\n                    \u003cinclude name\u003d\"org.eclipse.equinox.launcher_*.jar\" /\u003e\n                \u003c/fileset\u003e\n            \u003c/classpath\u003e\n            \u003cjvmarg value\u003d\"-Dosgi.locking\u003dnone\" /\u003e\n            \u003carg\n                line\u003d\"-application org.eclipse.update.core.siteOptimizer\" /\u003e\n            \u003carg\n                line\u003d\"-jarProcessor -verbose -outputDir ${updateSite} -pack ${updateSite}\" /\u003e\n        \u003c/java\u003e\n\nThis is in /cvsroot/callisto/org.eclipse.europa.tools/build-home/createPack200s.xml\n",
    "New problem, probably related? See bug 188375.",
    "Bjorn, \n\nRegarding comment #8, \nAre the jars correctly copied to the Europa build site before they the jar processor step runs?  \n\nLooking at my update site on eclipse.org .. the pde core jar.pack.gz file your reference is there...\n\nkmoir@node1:/home/data/httpd/download.eclipse.org/eclipse/updates/3.3milestones/plugins\u003e ls -l org.eclipse.pde.core_3.3.0.v20070501-0010.jar.pack.gz\n-rw-r--r-- 1 sdimitro eclipseadmin 279144 2007-05-04 15:30 org.eclipse.pde.core_3.3.0.v20070501-0010.jar.pack.gz\n\n\n",
    "(In reply to comment #17)\n\u003e Are the jars correctly copied to the Europa build site before they the jar\n\u003e processor step runs?  \n\nKim, I\u0027m not sure what you\u0027re asking. The Europa build loads the jar files using:\n[update: org.eclipse.platform] Command-line arguments: -clean -application org.eclipse.update.core.standaloneUpdate -data /home/data/users/bfreeman/europa/org.eclipse.europa.tools/build-home/buildworkspace -debug -consolelog -command mirror -featureId org.eclipse.platform -version 3.3.0.v20070516-_19REikF-XqdF6ODRccO -from http://download.eclipse.org/eclipse/updates/3.3milestones/site.xml -to /home/data/users/bfreeman/europa/staging -ignoreMissingPlugins true\n\nSee http://dash.eclipse.org/~bfreeman/europa/Platform-org.eclipse.platform-log.html\n\nI assumed the org.eclipse.update.core.standaloneUpdate application copied the jar files correctly.\n",
    "What I\u0027m asking is to check for the state of the jars in the Europa build after you run org.eclipse.update.core.standaloneUpdate application to copy the jars but before you run the siteOptimizer.  Do the jars referenced in comment #8 have the same size as in the local site?\n\n",
    "(In reply to comment #19)\n\u003e What I\u0027m asking is to check for the state of the jars in the Europa build after\n\u003e you run org.eclipse.update.core.standaloneUpdate application to copy the jars\n\u003e but before you run the siteOptimizer.  Do the jars referenced in comment #8\n\u003e have the same size as in the local site?\n\nThe two jars that are ending as zero length (and thus being deleted by my build hack) at this time are:\neuropa/staging/plugins/org.eclipse.jdt.core_3.3.0.v_763.jar.pack.gz\neuropa/staging/plugins/org.eclipse.birt.report.engine_2.2.0.v20070518.jar.pack.gz\n\nThe affected BIRT jar on the BIRT update site is:\nbfreeman@build:~/downloads/birt/update-site/plugins\u003e ls -l *engine_2.2.0.v20070518*\n-rw-rw-r-- 1 slee common 1711313 2007-05-18 05:55 org.eclipse.birt.report.engine_2.2.0.v20070518.jar\n-rw-rw-r-- 1 slee common  501111 2007-05-17 17:55 org.eclipse.birt.report.engine_2.2.0.v20070518.jar.pack.gz\nAnd on the Europa build result site, after mirroring it is:\nbfreeman@build:~/europa/staging/plugins\u003e !ls\nls -l *engine_2.2.0.v20070518*\n-rw-r----- 1 bfreeman common 1711282 2007-05-28 10:02 org.eclipse.birt.report.engine_2.2.0.v20070518.jar\n\nSo, no, the jars are not the same size after the org.eclipse.update.core.standaloneUpdate is run.\n\nOther jars, such as org.eclipse.birt.chart.runtime_2.2.0.v20070227.jar are exactly the same size pre- and post- standalongUpdate.\n",
    "Created an attachment (id\u003d68972)\nscreen shot w/ UM complaining about JDT jar\n\nStarting with 3.3RC2 platform runtime binary, try to install JET and OCL + all upstream deps (including JDT). Attached image shows error. ",
    "(In reply to comment #21)\nsee also bug 192983",
    "see https://bugs.eclipse.org/bugs/show_bug.cgi?id\u003d192983 comment #7\nbug 192983 really sounds like a dup of this bug",
    "Bjorn, are the any logs associated with the operation in comment #20\n\nMoving to update for comment, I don\u0027t know why the standalone update operation would change the jar file size.",
    "(In reply to comment #24)\nPack200 Log: http://dash.eclipse.org/~bfreeman/europa/pack200-pack200-log.html\nMy fix Log: http://dash.eclipse.org/~bfreeman/europa/createDigests-createDigests-log.html (see the end of the page)\n\n\u003e Moving to update for comment, I don\u0027t know why the standalone update operation\n\u003e would change the jar file size.\n\nI don\u0027t either, but that\u0027s what it appears to do.\n",
    "(In reply to comment #24)\n\u003e I don\u0027t know why the standalone update operation\n\u003e would change the jar file size.\n\nMight be completely wrong here, but I ran into a scenario recently where the code I was using to unpack and rejar existing jars as UM jars was only including FILES but not FOLDERS. I can\u0027t recall if the filesize was affected by this, however. Anyway, might be worth comparing the zip contents to see if both the before and after versions contain zipped folders as well as the files.  `unzip -t`/`unzip -l` or Beyond Compare work great for this.",
    "Bjorn, please try removing the manual copy of the jdt.core jar from the Europa build.  I have just released the latest build to Europa which has a new jdt.core jar where all class files have a valid signature."
  ],
  "commentCreationDates": [
    "2007-05-16T22:51:14+02:00",
    "2007-05-16T22:55:12+02:00",
    "2007-05-16T23:00:06+02:00",
    "2007-05-16T23:10:49+02:00",
    "2007-05-17T00:37:18+02:00",
    "2007-05-17T17:08:29+02:00",
    "2007-05-17T17:31:21+02:00",
    "2007-05-17T20:30:24+02:00",
    "2007-05-20T00:44:12+02:00",
    "2007-05-20T21:12:01+02:00",
    "2007-05-21T13:35:10+02:00",
    "2007-05-22T05:58:08+02:00",
    "2007-05-22T13:23:00+02:00",
    "2007-05-22T16:47:52+02:00",
    "2007-05-22T17:50:43+02:00",
    "2007-05-22T17:57:55+02:00",
    "2007-05-22T18:36:42+02:00",
    "2007-05-24T23:31:20+02:00",
    "2007-05-24T23:46:01+02:00",
    "2007-05-25T00:29:53+02:00",
    "2007-05-28T18:20:49+02:00",
    "2007-05-28T23:42:20+02:00",
    "2007-06-17T20:29:19+02:00",
    "2007-06-18T07:21:31+02:00",
    "2007-06-18T16:05:09+02:00",
    "2007-06-18T16:14:56+02:00",
    "2007-06-18T18:51:38+02:00",
    "2007-06-22T16:02:38+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.util.zip.ZipException",
      "message": "error in opening zip file",
      "elements": [
        {
          "method": "java.util.zip.ZipFile.open",
          "source": "Native Method"
        },
        {
          "method": "java.util.zip.ZipFile.\u003cinit\u003e",
          "source": "ZipFile.java:203"
        },
        {
          "method": "java.util.jar.JarFile.\u003cinit\u003e",
          "source": "JarFile.java:132"
        },
        {
          "method": "java.util.jar.JarFile.\u003cinit\u003e",
          "source": "JarFile.java:112"
        },
        {
          "method": "org.eclipse.update.internal.jarprocessor.JarProcessor.processJar",
          "source": "JarProcessor.java:301"
        },
        {
          "method": "org.eclipse.update.internal.core.FeaturePackagedContentProvider.retrieveLocalJar",
          "source": "FeaturePackagedContentProvider.java:256"
        },
        {
          "method": "org.eclipse.update.internal.core.FeaturePackagedContentProvider.getPluginEntryArchiveReferences",
          "source": "FeaturePackagedContentProvider.java:179"
        },
        {
          "method": "org.eclipse.update.internal.operations.UpdateUtils.downloadFeatureContent",
          "source": "UpdateUtils.java:628"
        },
        {
          "method": "org.eclipse.update.internal.ui.wizards.InstallWizard2.download",
          "source": "InstallWizard2.java:426"
        },
        {
          "method": "org.eclipse.update.internal.ui.wizards.InstallWizard2.access$3",
          "source": "InstallWizard2.java:397"
        },
        {
          "method": "org.eclipse.update.internal.ui.wizards.InstallWizard2$3.run",
          "source": "InstallWizard2.java:350"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:55"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "187396",
      "date": "2007-05-16T22:51:14+02:00",
      "product": "Platform",
      "component": "Update",
      "severity": "normal"
    }
  ],
  "groupId": "187396",
  "bugId": "187396",
  "date": "2007-05-16T22:51:14+02:00",
  "product": "Platform",
  "component": "Update",
  "severity": "normal"
}