{
  "comments": [
    "I am using AspectJ load time weaving with Spring 2.0 RC1 to inject my entities, and I am getting the following exception:\n\njava.lang.ClassCastException: org.aspectj.apache.bcel.classfile.Signature$TypeVariableSignature\n\tat org.aspectj.weaver.UnresolvedType.forGenericTypeSignature(UnresolvedType.java:348)\n\tat org.aspectj.weaver.bcel.BcelWorld.addSourceObjectType(BcelWorld.java:385)\n\tat org.aspectj.weaver.loadtime.ClassLoaderWeavingAdaptor.accept(ClassLoaderWeavingAdaptor.java:492)\n\tat org.aspectj.weaver.tools.WeavingAdaptor.shouldWeave(WeavingAdaptor.java:230)\n\tat org.aspectj.weaver.tools.WeavingAdaptor.weaveClass(WeavingAdaptor.java:210)\n\tat org.aspectj.weaver.loadtime.Aj.preProcess(Aj.java:65)\n\tat org.aspectj.weaver.loadtime.ClassPreProcessorAgentAdapter.transform(ClassPreProcessorAgentAdapter.java:55)\n\tat sun.instrument.TransformerManager.transform(TransformerManager.java:122)\n\tat sun.instrument.InstrumentationImpl.transform(InstrumentationImpl.java:155)\n\tat java.lang.ClassLoader.defineClass1(Native Method)\n\n.\n.\n.\n\nHaving examined the call stack under the debugger, this seems to happening when the weaver is attempting to determine whether a particular class should be weaved. The exception is thrown in the following method, at the cast highlighted below.\n\n\n    public static UnresolvedType forGenericTypeSignature(String sig,String declaredGenericSig) {\n    \tUnresolvedType ret \u003d UnresolvedType.forSignature(sig);\n    \tret.typeKind\u003dTypeKind.GENERIC;\n    \t\n    \tClassSignature csig \u003d new GenericSignatureParser().parseAsClassSignature(declaredGenericSig);\n    \t\n    \tSignature.FormalTypeParameter[] ftps \u003d csig.formalTypeParameters;\n    \tret.typeVariables \u003d new TypeVariable[ftps.length];\n    \tfor (int i \u003d 0; i \u003c ftps.length; i++) {\n\t\t\tSignature.FormalTypeParameter parameter \u003d ftps[i];\n\t\t\tSignature.ClassTypeSignature cts \u003d (Signature.ClassTypeSignature)parameter.classBound; // EXCEPTION HERE!\n\t\t\tret.typeVariables[i]\u003dnew TypeVariable(ftps[i].identifier,UnresolvedType.forSignature(cts.outerType.identifier+\";\"));\n\t\t}\n    \tret.signatureErasure \u003d sig;\n    \tret.signature \u003d ret.signatureErasure;\n    \treturn ret;\n    }\n\n\nThe class in question (which is not one that requires weaving), has the following signature:\n\npublic class HibernateEntityDAO\u003cinterfaceT extends SecurityEntity, concreteT extends interfaceT\u003e extends HibernateDaoSupport\n        implements EntityDAO\u003cinterfaceT\u003e\n \nThe exception is happening because the parameter.classBound member is not of type Signature.ClassTypeSignature, but an instance of Signature.TypeVariableSignature.\n\nThe loop variable i is 1, and parameter.identifier is ?concreteT?, so it looks like it\u0027s the signature of the second type parameter (concreteT) that is tripping up the weaver.",
    "Created an attachment (id\u003d45187)\nDebugger Screenshot\n\n",
    "thanks for the clear bug report - I\u0027ve recreated it, added a testcase and committed the fix into CVS.  waiting on build...",
    "fix available in latest AspectJ dev builds."
  ],
  "commentCreationDates": [
    "2006-06-23T18:29:03+02:00",
    "2006-06-23T18:34:46+02:00",
    "2006-07-06T14:09:41+02:00",
    "2006-07-19T15:47:31+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ClassCastException",
      "message": "org.aspectj.apache.bcel.classfile.Signature$TypeVariableSignature",
      "elements": [
        {
          "method": "org.aspectj.weaver.UnresolvedType.forGenericTypeSignature",
          "source": "UnresolvedType.java:348"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWorld.addSourceObjectType",
          "source": "BcelWorld.java:385"
        },
        {
          "method": "org.aspectj.weaver.loadtime.ClassLoaderWeavingAdaptor.accept",
          "source": "ClassLoaderWeavingAdaptor.java:492"
        },
        {
          "method": "org.aspectj.weaver.tools.WeavingAdaptor.shouldWeave",
          "source": "WeavingAdaptor.java:230"
        },
        {
          "method": "org.aspectj.weaver.tools.WeavingAdaptor.weaveClass",
          "source": "WeavingAdaptor.java:210"
        },
        {
          "method": "org.aspectj.weaver.loadtime.Aj.preProcess",
          "source": "Aj.java:65"
        },
        {
          "method": "org.aspectj.weaver.loadtime.ClassPreProcessorAgentAdapter.transform",
          "source": "ClassPreProcessorAgentAdapter.java:55"
        },
        {
          "method": "sun.instrument.TransformerManager.transform",
          "source": "TransformerManager.java:122"
        },
        {
          "method": "sun.instrument.InstrumentationImpl.transform",
          "source": "InstrumentationImpl.java:155"
        },
        {
          "method": "java.lang.ClassLoader.defineClass1",
          "source": "Native Method"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "148409",
      "date": "2006-06-23T18:29:03+02:00",
      "product": "AspectJ",
      "component": "LTWeaving",
      "severity": "normal"
    }
  ],
  "groupId": "148409",
  "bugId": "148409",
  "date": "2006-06-23T18:29:03+02:00",
  "product": "AspectJ",
  "component": "LTWeaving",
  "severity": "normal"
}