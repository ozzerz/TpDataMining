{
  "comments": [
    "Hi folks,\nDue to some requirements, I had to write a simple eclipse starter\napplication, which sets some properties,sets the desired locale/language\nand then simply calls org.eclipse.core.launcher.Main.main().\n\n    Locale loc \u003d new Locale(\"kk\", \"KZ\");  \n    System.setProperty(\"osgi.install.area\", \"C:\\\\temp\\\\ACC\");\n    System.setProperty(\"osgi.configuration.area\", \"C:\\\\temp\\\\ACC\\\\Configuration\");\n    System.setProperty(\"osgi.noShutdown\", \"true\");\n    System.setProperty(\"acc.user\", \"custom\");\n    System.setProperty(\"acc.password\", \"custom\");\n    \n    Main.main(\"\");\n    \n    System.out.println(\"testing restart\");\n    \n    Main.main(\"\");\n\n\nThis works, but it is impossible todo this twice to restart the\napplication, it leads to an error\n\njava.lang.Error: factory already defined\n    at java.net.URL.setURLStreamHandlerFactory(URL.java:1074)\n    at\norg.eclipse.osgi.framework.internal.core.Framework.initialize(Framework.java:185)\n    at\norg.eclipse.osgi.framework.internal.core.Framework.\u003cinit\u003e(Framework.java:104)\n    at\norg.eclipse.osgi.framework.internal.core.OSGi.createFramework(OSGi.java:90)\n    at org.eclipse.osgi.framework.internal.core.OSGi.\u003cinit\u003e(OSGi.java:31)\n    at\norg.eclipse.core.runtime.adaptor.EclipseStarter.startup(EclipseStarter.java:270)\n    at\norg.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:157)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n    at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n    at java.lang.reflect.Method.invoke(Method.java:585)\n    at org.eclipse.core.launcher.Main.invokeFramework(Main.java:330)\n    at org.eclipse.core.launcher.Main.basicRun(Main.java:274)\n    at org.eclipse.core.launcher.Main.run(Main.java:977)\n    at org.eclipse.core.launcher.Main.main(Main.java:952)\n    at org.eclipse.core.launcher.Main.main(Main.java:931)\n    at com.orga.opsc.gold.acc.ACCLoginDialog.main(ACCLoginDialog.java:28)",
    "This is normal because java does not support url handlers to be removed nor does it support having the \nhandler being reset.\nThe only thing for this to work would be to catch the exception and ignore it if a given property is set.\n\nI\u0027m not sure if we want to do that for 3.1.",
    "is there a concrete proposal for how to fix this?",
    "We could wrap the setURLHandlerFactory in a try / catch block like shown below,\nhowever I\u0027m not sure if we won\u0027t shock further.\n\nMichael, have you tried modifying the code to ignore the exception to see if you\ncan start eclipse again?\n\ntry {\n  URL.setURLStreamHandlerFactory(new StreamHandlerFactory(systemBundle.context,\nadaptor));\n} catch (Error e) {\nif (\"false\".equals(System.getProperties().get(PROPERTY_IGNORE_URLHANDLER_ERROR))\n  throw e;\n}",
    "The URLStreamHandlerFactory installed is provided by a previous run of the\nframework. Running main again, we would end up loading the framework with a\ndifferent classloader. So we would actually have two distinct (isolated)\nframework instances in memory at the same time (one of them only reachable\nthrough URL resolution). I would be surprised if this can be made to work\nwithout considerable changes to the framework.",
    "(In reply to comment #3)\n\u003e Michael, have you tried modifying the code to ignore the exception to see if you\n\u003e can start eclipse again?\n\u003e \nNo,\nBut I fear that this would break many other things and and it is not so\nimportant  the moment. \nIs there a more \"official\" way to (re)start eclipse like System.exec(\"java ....\") ? ",
    "Note there are other places in the Java class libraries and in Eclipse that use\nthe \"set only once\" pattern used by URL.setStreamHandlerFactory(). \nSystem.setSecurityManager also comes to mind.  This was attempted in the past,\nand the protocol for restarting the VM from the native launcher on exit code 1\nwas added as the only clean way to address this.  Using exit code \"1\" is the\nrecommended way of achieving a restart.",
    "Sorry, I should have said exit code 23, not exit code 1.  See\nIPlatformRunanble.EXIT_RESTART",
    "We are not planning to do this."
  ],
  "commentCreationDates": [
    "2005-05-23T10:04:07+02:00",
    "2005-05-23T20:11:45+02:00",
    "2005-05-24T18:55:44+02:00",
    "2005-05-24T19:19:36+02:00",
    "2005-05-24T19:24:11+02:00",
    "2005-05-24T19:46:21+02:00",
    "2005-05-24T19:55:50+02:00",
    "2005-05-24T19:57:02+02:00",
    "2005-06-17T22:13:21+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.Error",
      "message": "factory already defined",
      "elements": [
        {
          "method": "java.net.URL.setURLStreamHandlerFactory",
          "source": "URL.java:1074"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Framework.initialize",
          "source": "Framework.java:185"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.Framework.\u003cinit\u003e",
          "source": "Framework.java:104"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.OSGi.createFramework",
          "source": "OSGi.java:90"
        },
        {
          "method": "org.eclipse.osgi.framework.internal.core.OSGi.\u003cinit\u003e",
          "source": "OSGi.java:31"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.startup",
          "source": "EclipseStarter.java:270"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:157"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:585"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:330"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:274"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:977"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:952"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:931"
        },
        {
          "method": "com.orga.opsc.gold.acc.ACCLoginDialog.main",
          "source": "ACCLoginDialog.java:28"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "96272",
      "date": "2005-05-23T10:04:07+02:00",
      "product": "Platform",
      "component": "Runtime",
      "severity": "normal"
    }
  ],
  "groupId": "96272",
  "bugId": "96272",
  "date": "2005-05-23T10:04:07+02:00",
  "product": "Platform",
  "component": "Runtime",
  "severity": "normal"
}