{
  "comments": [
    "My apologies if this isn\u0027t the correct product/component for this bug, but I\u0027m\nhaving problems with a security provider that I\u0027m dynamically adding when the\ncode is running in a plug-in environment. I noticed that this issue popped up in\nthe newsgroup but no solutions were posted. I\u0027m running Eclipse 3.1 M4 on\nWindows XP.\n\nI created a sample plug-in project and modified the run() method to the following:\n\npublic void run(IAction action) {\n  try {\n    BouncyCastleProvider provider \u003d new BouncyCastleProvider();\n    Security.addProvider(provider);\n    Cipher.getInstance(\"RSA\", \"BC\");\n    System.out.println(\"It worked.\");\n  } catch (Throwable e) {\n    e.printStackTrace();\n  }\n}\n\nWhen running under 1.4.2_06, I get the following exception:\n\njava.lang.SecurityException: The provider BC may not be signed by a trusted party\n\tat javax.crypto.SunJCE_b.a(DashoA6275)\n\tat javax.crypto.Cipher.a(DashoA6275)\n\tat javax.crypto.Cipher.getInstance(DashoA6275)\n\tat z2.actions.SampleAction.run(SampleAction.java:42)\n\tat org.eclipse.ui.internal.PluginAction.runWithEvent(PluginAction.java:244)\n\tat org.eclipse.ui.internal.WWinPluginAction.runWithEvent(WWinPluginAction.java:220)\n\tat\norg.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:555)\n\tat\norg.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:505)\n\tat\norg.eclipse.jface.action.ActionContributionItem$7.handleEvent(ActionContributionItem.java:460)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:833)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:2803)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2448)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1569)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1540)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:285)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:144)\n\tat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:102)\n\tat\norg.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:220)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:273)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:129)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:185)\n\tat org.eclipse.core.launcher.Main.run(Main.java:710)\n\tat org.eclipse.core.launcher.Main.main(Main.java:694)\n\nIf I switch to 1.5.0, I get this exception:\n\njava.lang.SecurityException: JCE cannot authenticate the provider BC\n\tat javax.crypto.Cipher.getInstance(DashoA12275)\n\tat javax.crypto.Cipher.getInstance(DashoA12275)\n\tat z2.actions.SampleAction.run(SampleAction.java:42)\n\tat org.eclipse.ui.internal.PluginAction.runWithEvent(PluginAction.java:244)\n\tat org.eclipse.ui.internal.WWinPluginAction.runWithEvent(WWinPluginAction.java:220)\n\tat\norg.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:555)\n\tat\norg.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:505)\n\tat\norg.eclipse.jface.action.ActionContributionItem$7.handleEvent(ActionContributionItem.java:460)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:833)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:2803)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2448)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1569)\n\tat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1540)\n\tat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:285)\n\tat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:144)\n\tat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:102)\n\tat\norg.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:220)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:273)\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:129)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:585)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:185)\n\tat org.eclipse.core.launcher.Main.run(Main.java:710)\n\tat org.eclipse.core.launcher.Main.main(Main.java:694)\nCaused by: java.util.jar.JarException: Class is on the bootclasspath\n\tat javax.crypto.SunJCE_d.a(DashoA12275)\n\tat javax.crypto.SunJCE_b.b(DashoA12275)\n\tat javax.crypto.SunJCE_b.a(DashoA12275)\n\t... 27 more\n\nIf I copy the code in the run() method above and move it to a standard Java\nproject with a public static void main() method, everything works fine. So, it\nseems to me to be a problem with class loaders or something like that. I have\ndiscovered one workaround:\n\n1. Copy the Bouncy Castle file (bcprov-jdk14-126.jar) to the jre\\lib\\ext folder.\n2. Add the VM argument -Dosgi.parentClassloader\u003dext to the run configuration.\nNote that setting it to app also works, but setting it to boot or fwk does not.\n\nIf I only do one of these steps, it doesn\u0027t work - I have to do them both. As\nmentioned before, when running as a normal Java program, this workaround isn\u0027t\nnecessary. I\u0027ve also tried adding the following line at the beginning of the\nrun() method, but it doesn\u0027t make any difference:\n\nThread.currentThread().setContextClassLoader(SampleAction.class.getClassLoader());\n\nI\u0027m hoping a solution exists that doesn\u0027t require users of my plug-in to run\nEclipse with a custom shortcut or to make a change to their installed JRE -\nsomething the workaround above would entail.",
    "Moving to PDE for comment.\n\nJDT fixed a similar problem for launching standard Java apps (see bug 38370). \nThe problem was that we had explicitly placed a jar on the bootpath that \nshould not have been specified.",
    "I have also run across this problem during plugin development.  It seems there\nare two workarounds:\n - add \"osgi.parentClassloader\u003dext\" to config.ini\n - add \"-Dosgi.parentClassloader\u003dext\" to the launch command\nIt does not seem reasonable to ask the user to make these changes to their\nsystem in order to use a plug-in.  \n\nBasically, this prevents plugins from using the JCE for secure communications. \nReally a show-stopper for us :(",
    "would being able to set the parent classloader for your plugin (to ext) solve \nthe problem?  That is, is it only your plugin that needs to load these classes?\n\nTom/Pascal, another usecase for the header we discussed the other day.",
    "This bug has the right people cc\u0027d on it, but it\u0027s in the wrong component.",
    "John, have you worked around your problem? \nBuddy loading maybe able to help you there.",
    "This seems to be a generic problem:\n\nhttp://forum.java.sun.com/thread.jspa?threadID\u003d661317\n\nNote the comment:\n\"The jar file containing the JCE provider has to be signed by someone recognised by Sun. BC\u0027s jar is signed by BC using a certificate signed by Sun. By un-jaring the BC jar and adding the contents to your own jar you have lost the BC signature.\"\n\nOn the subject of the \"ext\" directory: As far as I understand, putting class files in the \"ext\" directory allows them to bypass security checks - they are deemed to be \"trusted\" by a standard classloader.\n\nYou could try to distribute the signed jar containing the security provider as a separate JAR (don\u0027t include it your JARed plugin, or try using your plugin as non-JARed) and modify the classpath to include this JAR file.\n\nIf you can, let us know if this works.\n",
    "This was fixed in 3.1 M7 in bug 89904.\n\nThe issue was Class.getCodeSource was always returning null.  Now we return always return a valid code source.  This allows the VM to test the provider jar to see if it is signed.\n\n*** This bug has been marked as a duplicate of 89904 ***"
  ],
  "commentCreationDates": [
    "2005-01-29T07:36:06+01:00",
    "2005-01-31T15:14:43+01:00",
    "2005-03-23T03:26:36+01:00",
    "2005-03-23T03:44:28+01:00",
    "2006-09-18T06:44:58+02:00",
    "2006-09-18T15:46:33+02:00",
    "2006-09-18T16:21:42+02:00",
    "2006-09-18T16:51:17+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.SecurityException",
      "message": "The provider BC may not be signed by a trusted party",
      "elements": [
        {
          "method": "javax.crypto.SunJCE_b.a",
          "source": "DashoA6275"
        },
        {
          "method": "javax.crypto.Cipher.a",
          "source": "DashoA6275"
        },
        {
          "method": "javax.crypto.Cipher.getInstance",
          "source": "DashoA6275"
        },
        {
          "method": "z2.actions.SampleAction.run",
          "source": "SampleAction.java:42"
        },
        {
          "method": "org.eclipse.ui.internal.PluginAction.runWithEvent",
          "source": "PluginAction.java:244"
        },
        {
          "method": "org.eclipse.ui.internal.WWinPluginAction.runWithEvent",
          "source": "WWinPluginAction.java:220"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:555"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$2",
          "source": "ActionContributionItem.java:505"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$7.handleEvent",
          "source": "ActionContributionItem.java:460"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:833"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:2803"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2448"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1569"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1540"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:285"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:144"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:102"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:220"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:273"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:129"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:324"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:185"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:710"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:694"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "83981",
      "duplicateId": "89904",
      "date": "2005-01-29T07:36:06+01:00",
      "product": "Equinox",
      "component": "Framework",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.SecurityException",
      "message": "JCE cannot authenticate the provider BC",
      "elements": [
        {
          "method": "javax.crypto.Cipher.getInstance",
          "source": "DashoA12275"
        },
        {
          "method": "javax.crypto.Cipher.getInstance",
          "source": "DashoA12275"
        },
        {
          "method": "z2.actions.SampleAction.run",
          "source": "SampleAction.java:42"
        },
        {
          "method": "org.eclipse.ui.internal.PluginAction.runWithEvent",
          "source": "PluginAction.java:244"
        },
        {
          "method": "org.eclipse.ui.internal.WWinPluginAction.runWithEvent",
          "source": "WWinPluginAction.java:220"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:555"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$2",
          "source": "ActionContributionItem.java:505"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$7.handleEvent",
          "source": "ActionContributionItem.java:460"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:82"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:833"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:2803"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2448"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1569"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1540"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:285"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:144"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:102"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:220"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:273"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:129"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:585"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:185"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:710"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:694"
        }
      ],
      "causedBy": {
        "exceptionType": "java.util.jar.JarException",
        "message": "Class is on the bootclasspath",
        "elements": [
          {
            "method": "javax.crypto.SunJCE_d.a",
            "source": "DashoA12275"
          },
          {
            "method": "javax.crypto.SunJCE_b.b",
            "source": "DashoA12275"
          },
          {
            "method": "javax.crypto.SunJCE_b.a",
            "source": "DashoA12275"
          }
        ],
        "number": 0,
        "commentIndex": 0
      },
      "number": 1,
      "commentIndex": 0,
      "bugId": "83981",
      "duplicateId": "89904",
      "date": "2005-01-29T07:36:06+01:00",
      "product": "Equinox",
      "component": "Framework",
      "severity": "normal"
    }
  ],
  "groupId": "89904",
  "bugId": "83981",
  "duplicateId": "89904",
  "date": "2005-01-29T07:36:06+01:00",
  "product": "Equinox",
  "component": "Framework",
  "severity": "normal"
}