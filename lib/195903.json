{
  "comments": [
    "When generating an entity from a table with automatic id generation for the primary key ID, the generated entity lacks the @GeneratedValue(strategy\u003dGenerationType.IDENTITY) annotation.\nThe result of this is that the id returned to the persisted entity is not updated (via a select last_insert_id()) and defaults to 0.  Any use of this id by a child entity (via a foreign key mapping) will fail.\n\nWorkaround:\nAfter generation, manually add @GeneratedValue annotation to all parent entities.\n\ncode:\npublic static void main(String[] args) {\n\t\tem.getTransaction().begin();\n\t\taSite \u003d dao.createSite(\"aSite\");\n\t\tem.getTransaction().commit();\n\t\tSystem.out.println(\"Site id: \" + aSite.getId());\n}\n\nDAO.java\n\tpublic Site createSite(String name) {\n\t\tSite aSite \u003d new Site();\n\t\taSite.setName(name);\n\t\tem.persist(aSite);\t\t\n\t\treturn aSite;\t\t\n\t}\n\n\nSchema:\ncreate table job (ID integer(19) AUTO_INCREMENT,PRIMARY KEY (ID));\n\nGenerated Entity:\n@Entity\npublic class Site implements Serializable {\n\t@Id\n\tprivate int id;\n\tprivate String name;\n\t.....\n\nshould be:\n\n@Entity\npublic class Site implements Serializable {\n\t@Id @GeneratedValue(strategy\u003dGenerationType.IDENTITY)\n\tprivate int id;\n\tprivate String name;\n\t.....\n\nor we will get the following:\n\n[TopLink Fine]: Connection(8140933)--INSERT INTO SITE (ID) VALUES (?)\n\tbind \u003d\u003e [0]\nSite id: 0\n\nand an SQL error for any child of [Site] like Site\u003c-Job where the fk is 0 instead of the generated Site id:\n\nInternal Exception: com.mysql.jdbc.exceptions.MySQLIntegrityConstraintViolationException: Cannot add or update a child row: a foreign key constraint fails (`jpa/job`, CONSTRAINT `fk_site_job_id` FOREIGN KEY (`job_site`) REFERENCES `site` (`ID`))Error Code: 1452\nCall:INSERT INTO JOB (ID, job_site) VALUES (?, ?)\n\tbind \u003d\u003e [0, 0]\nQuery:InsertObjectQuery(com.ejb4.business.entity.Job@134ce4a)\n\tat oracle.toplink.essentials.exceptions.DatabaseException.sqlException(DatabaseException.java:295)\n\nWith the @GeneratedValue annotation (see ch4 p.88 of Pro EJB 3 JPA book by Mike Keith) we get back a populated ID field on the persisted Site:\n[TopLink Fine]: Connection(3299256)--INSERT INTO SITE (NAME) VALUES (?)\n\tbind \u003d\u003e [aSite]\n[TopLink Fine]: Connection(3299256)--SELECT LAST_INSERT_ID()\nSite id: 45\n\nWindowsXPSP2\nDali 0.5.0.20060621 \nThis may be an underlying essentials generation problem if dali defers annotation generation to toplink - which i understant it does not."
  ],
  "commentCreationDates": [
    "2007-07-09T22:58:10+02:00"
  ],
  "traces": [
    {
      "exceptionType": "com.mysql.jdbc.exceptions.MySQLIntegrityConstraintViolationException",
      "message": "Cannot add or update a child row: a foreign key constraint fails (`jpa/job`, CONSTRAINT `fk_site_job_id` FOREIGN KEY (`job_site`) REFERENCES `site` (`ID`))Error Code: 1452 Call:INSERT INTO JOB (ID, job_site) VALUES (?, ?)  bind \u003d\u003e [0, 0] Query:InsertObjectQuery(com.ejb4.business.entity.Job@134ce4a)",
      "elements": [
        {
          "method": "oracle.toplink.essentials.exceptions.DatabaseException.sqlException",
          "source": "DatabaseException.java:295"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "195903",
      "date": "2007-07-09T22:58:10+02:00",
      "product": "Dali JPA Tools",
      "component": "General",
      "severity": "enhancement"
    }
  ],
  "groupId": "195903",
  "bugId": "195903",
  "date": "2007-07-09T22:58:10+02:00",
  "product": "Dali JPA Tools",
  "component": "General",
  "severity": "enhancement"
}