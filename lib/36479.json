{
  "comments": [
    "Tried to rename a class which was moved to a new package and is used by the \nproject and it\u0027s seperated JUnit project. I tested the other class moved to the \nsame project. Its rename action also fails. Outside the package I can rename \nproperly. I will try to do renaming by adding a new class and erase the old \none. If I learn something new, I will report back.\n\nThanks for the greate IDE.\n\nMartin\n\n\u003c-- Log snippet --\u003e\n\n!SESSION Apr 15, 2003 09:36:33.843 ---------------------------------------------\njava.version\u003d1.4.1_02\njava.vendor\u003dSun Microsystems Inc.\nBootLoader constants: OS\u003dwin32, ARCH\u003dx86, WS\u003dwin32, NL\u003dde_DE\nCommand-line arguments: -os win32 -ws win32 -arch x86 -mx256m -ms64m -install \nfile:C:/eclipse/\n!ENTRY org.eclipse.jdt.ui 4 10001 Apr 15, 2003 09:36:33.843\n!MESSAGE Internal Error\n!STACK 0\njava.lang.reflect.InvocationTargetException\n\tat org.eclipse.jface.operation.ModalContext.runInCurrentThread\n(ModalContext.java:313)\n\tat org.eclipse.jface.operation.ModalContext.run(ModalContext.java:252)\n\tat org.eclipse.jdt.internal.ui.refactoring.RefactoringWizardDialog2.run\n(RefactoringWizardDialog2.java:266)\n\tat \norg.eclipse.jdt.internal.ui.refactoring.PerformRefactoringUtil.performRefactorin\ng(PerformRefactoringUtil.java:53)\n\tat \norg.eclipse.jdt.internal.ui.refactoring.RefactoringWizard.performFinish\n(RefactoringWizard.java:363)\n\tat \norg.eclipse.jdt.internal.ui.refactoring.UserInputWizardPage.performFinish\n(UserInputWizardPage.java:119)\n\tat \norg.eclipse.jdt.internal.ui.refactoring.RefactoringWizard.performFinish\n(RefactoringWizard.java:426)\n\tat \norg.eclipse.jdt.internal.ui.refactoring.RefactoringWizardDialog2.okPressed\n(RefactoringWizardDialog2.java:383)\n\tat org.eclipse.jface.dialogs.Dialog.buttonPressed(Dialog.java:256)\n\tat org.eclipse.jface.dialogs.Dialog$1.widgetSelected(Dialog.java:423)\n\tat org.eclipse.swt.widgets.TypedListener.handleEvent\n(TypedListener.java:89)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:81)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:840)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:1838)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:1545)\n\tat org.eclipse.jface.window.Window.runEventLoop(Window.java:583)\n\tat org.eclipse.jface.window.Window.open(Window.java:563)\n\tat \norg.eclipse.jdt.internal.ui.refactoring.actions.RefactoringStarter.activate\n(RefactoringStarter.java:70)\n\tat \norg.eclipse.jdt.internal.ui.refactoring.RefactoringSupport$AbstractRenameSupport\n.rename(RefactoringSupport.java:168)\n\tat org.eclipse.jdt.ui.refactoring.RenameSupport.openDialog\n(RenameSupport.java:98)\n\tat \norg.eclipse.jdt.internal.ui.refactoring.actions.RenameJavaElementAction.run\n(RenameJavaElementAction.java:147)\n\tat \norg.eclipse.jdt.internal.ui.refactoring.actions.RenameJavaElementAction.run\n(RenameJavaElementAction.java:76)\n\tat org.eclipse.jdt.ui.actions.RenameAction.run(RenameAction.java:116)\n\tat org.eclipse.jdt.ui.actions.SelectionDispatchAction.dispatchRun\n(SelectionDispatchAction.java:191)\n\tat org.eclipse.jdt.ui.actions.SelectionDispatchAction.run\n(SelectionDispatchAction.java:169)\n\tat org.eclipse.jface.action.Action.runWithEvent(Action.java:842)\n\tat org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection\n(ActionContributionItem.java:456)\n\tat org.eclipse.jface.action.ActionContributionItem.handleWidgetEvent\n(ActionContributionItem.java:403)\n\tat org.eclipse.jface.action.ActionContributionItem.access$0\n(ActionContributionItem.java:397)\n\tat \norg.eclipse.jface.action.ActionContributionItem$ActionListener.handleEvent\n(ActionContributionItem.java:72)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:81)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:840)\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:1838)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:1545)\n\tat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1402)\n\tat org.eclipse.ui.internal.Workbench.run(Workbench.java:1385)\n\tat org.eclipse.core.internal.boot.InternalBootLoader.run\n(InternalBootLoader.java:845)\n\tat org.eclipse.core.boot.BootLoader.run(BootLoader.java:461)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.eclipse.core.launcher.Main.basicRun(Main.java:291)\n\tat org.eclipse.core.launcher.Main.run(Main.java:747)\n\tat org.eclipse.core.launcher.Main.main(Main.java:583)\nCaused by: java.lang.ClassCastException\n\tat \norg.eclipse.jdt.internal.core.search.matching.TypeReferencePattern.matchReportRe\nference(TypeReferencePattern.java:230)\n\tat \norg.eclipse.jdt.internal.core.search.matching.TypeReferencePattern.matchReportRe\nference(TypeReferencePattern.java:205)\n\tat \norg.eclipse.jdt.internal.core.search.matching.MatchLocator2.reportReference\n(MatchLocator2.java:1310)\n\tat \norg.eclipse.jdt.internal.core.search.matching.MatchingNodeSet.reportMatching\n(MatchingNodeSet.java:240)\n\tat \norg.eclipse.jdt.internal.core.search.matching.MatchingNodeSet.reportMatching\n(MatchingNodeSet.java:448)\n\tat \norg.eclipse.jdt.internal.core.search.matching.MatchingNodeSet.reportMatching\n(MatchingNodeSet.java:346)\n\tat org.eclipse.jdt.internal.core.search.matching.MatchLocator2.process\n(MatchLocator2.java:978)\n\tat \norg.eclipse.jdt.internal.core.search.matching.MatchLocator2.locateMatches\n(MatchLocator2.java:677)\n\tat \norg.eclipse.jdt.internal.core.search.matching.MatchLocator2.locateMatches\n(MatchLocator2.java:635)\n\tat \norg.eclipse.jdt.internal.core.search.matching.MatchLocator2.locateMatches\n(MatchLocator2.java:851)\n\tat org.eclipse.jdt.core.search.SearchEngine.search\n(SearchEngine.java:471)\n\tat \norg.eclipse.jdt.internal.corext.refactoring.RefactoringSearchEngine.search\n(RefactoringSearchEngine.java:139)\n\tat \norg.eclipse.jdt.internal.corext.refactoring.RefactoringSearchEngine.search\n(RefactoringSearchEngine.java:106)\n\tat \norg.eclipse.jdt.internal.corext.refactoring.RefactoringSearchEngine.search\n(RefactoringSearchEngine.java:101)\n\tat \norg.eclipse.jdt.internal.corext.refactoring.rename.RenameTypeRefactoring.getRefe\nrences(RenameTypeRefactoring.java:507)\n\tat \norg.eclipse.jdt.internal.corext.refactoring.rename.RenameTypeRefactoring.checkIn\nput(RenameTypeRefactoring.java:368)\n\tat org.eclipse.jdt.internal.ui.refactoring.CheckConditionsOperation.run\n(CheckConditionsOperation.java:65)\n\tat org.eclipse.jdt.internal.ui.refactoring.CreateChangeOperation.run\n(CreateChangeOperation.java:100)\n\tat org.eclipse.jdt.internal.ui.refactoring.PerformChangeOperation.run\n(PerformChangeOperation.java:138)\n\tat org.eclipse.jface.operation.ModalContext.runInCurrentThread\n(ModalContext.java:302)\n\t... 44 more",
    "Please provide reproduceable steps for further investigation",
    "After solving some errors in other classes which occured during movement, I can \nrename all classes. Therefor I changed the severity to normal because It didn\u0027t \ngave me a big headache.\n\nThanks again,\n\nMartin",
    "Well I don\u0027t know how to reproduce it. Maybe it helps to describe what I have \ndone.\n\nProjects:\nnormal - Containing code.\nnormal.test - Containing JUnit tests, uses exactly the same package structure \nas normal.\n\nClass:\nCache - Implements a guarded cache.\nCache.Key - Implements a simple Key class to hide that from callers\nAspect - Particular Aspect of database informations using the Cache (was \nextracted from their for better reuse).\n\nTestClasses:\nTestCache\nTestCacheKey\nTestAspect\n\nFirst of all after extracting the Cache from Aspect I rerun the test suite, \neverything fine.\nThen after realising that Cache.Key (private class of cache) is used by Aspect \nand TestAspect I decided to create package *.cache and move the Cache class to \nit. The TestCache and TestCacheKey were also moved to a package *.cache within \nthe test project.\nProblem was Cache.Key is package level so I excluded it from Cache class and \ntried to rename it in order to introduce other Key types. That was when the \nerror occured.\n\nI think that the problem may be caused by a non-exsisting Cache.Key class but \neveryone referred to it. And then trying to rename a class Key had blown up the \nscene. Renaming Cache class also produced the same error footprint.  \n\nSolution:\nCreated a new Class with the new key name. Deleting the Key class, and moving \nits content to the new class, correcting all the bad references allowed\nme to rename the class Cache.\n\nI will try to reproduce the error again to ease your work.",
    "looks like a problem in org.eclipse.jdt.internal.core.search.matching.\nTypeReferencePattern - moving to jcore\n",
    "Got the cause:\n\nHaving the following situation will cause the problem.\n\nSame project:\n\npackage pack1:\n  class A\npackage pack1.sub:\n  class B\n  class C\n\nAdding a cast to a method of class A:\n  ((B.C)new Object()).hashCode();\nThen trying to rename B or C will fail producing the error and either B nor C \ncan be renamed but deleted.\n\nSharper Version:\n  as above but without C (only having A and B)\nagain add a cast of B to A like:\n  (NonExsisting.B);\nAgain rename of B, will fail.\n\nOther more weird try:\n  Add ((Unknown.Key)new Object()).hashCode(); to a class of any package.\n  Even if the class does not import Key or the package of Key or any other\nclass from its package, renaming Key will fail.\n  But only adding lines like Unknown.Key a; will do nothing. So it seams to\ndoing a cast and using a method of the casted instance will cause an error\nwhile renaming a class named the same like the non exsisting inherited class of \nan non-exsisting class.\n\nHope that helped.\n\n\nMartin\n\n",
    "Thanks for the test cases Martin. \n\nFixed TypeReferencePattern.matchReportReference(QualifiedNameReference, ...) to \ncheck for the case of a ProblemBinding.\nMade the same change to DeclarationOfReferencedTypesPattern.matchReportReference\n(AstNode, ...) and PackageReferencePattern.matchLevel and matchReportReference.\n\nAdded regression test JavaSearchTests.testTypeReferenceWithProblem()",
    "*** Bug 41821 has been marked as a duplicate of this bug. ***",
    "Verified."
  ],
  "commentCreationDates": [
    "2003-04-15T08:46:49+02:00",
    "2003-04-15T09:13:17+02:00",
    "2003-04-15T09:29:55+02:00",
    "2003-04-15T09:45:34+02:00",
    "2003-04-15T09:57:23+02:00",
    "2003-04-15T10:02:05+02:00",
    "2003-07-15T17:22:51+02:00",
    "2003-08-21T20:43:17+02:00",
    "2003-08-28T10:43:42+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.reflect.InvocationTargetException",
      "elements": [
        {
          "method": "org.eclipse.jface.operation.ModalContext.runInCurrentThread",
          "source": "ModalContext.java:313"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext.run",
          "source": "ModalContext.java:252"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.refactoring.RefactoringWizardDialog2.run",
          "source": "RefactoringWizardDialog2.java:266"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.refactoring.PerformRefactoringUtil.performRefactoring",
          "source": "PerformRefactoringUtil.java:53"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.refactoring.RefactoringWizard.performFinish",
          "source": "RefactoringWizard.java:363"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.refactoring.UserInputWizardPage.performFinish",
          "source": "UserInputWizardPage.java:119"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.refactoring.RefactoringWizard.performFinish",
          "source": "RefactoringWizard.java:426"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.refactoring.RefactoringWizardDialog2.okPressed",
          "source": "RefactoringWizardDialog2.java:383"
        },
        {
          "method": "org.eclipse.jface.dialogs.Dialog.buttonPressed",
          "source": "Dialog.java:256"
        },
        {
          "method": "org.eclipse.jface.dialogs.Dialog$1.widgetSelected",
          "source": "Dialog.java:423"
        },
        {
          "method": "org.eclipse.swt.widgets.TypedListener.handleEvent",
          "source": "TypedListener.java:89"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:81"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:840"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:1838"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:1545"
        },
        {
          "method": "org.eclipse.jface.window.Window.runEventLoop",
          "source": "Window.java:583"
        },
        {
          "method": "org.eclipse.jface.window.Window.open",
          "source": "Window.java:563"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.refactoring.actions.RefactoringStarter.activate",
          "source": "RefactoringStarter.java:70"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.refactoring.RefactoringSupport$AbstractRenameSupport.rename",
          "source": "RefactoringSupport.java:168"
        },
        {
          "method": "org.eclipse.jdt.ui.refactoring.RenameSupport.openDialog",
          "source": "RenameSupport.java:98"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.refactoring.actions.RenameJavaElementAction.run",
          "source": "RenameJavaElementAction.java:147"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.refactoring.actions.RenameJavaElementAction.run",
          "source": "RenameJavaElementAction.java:76"
        },
        {
          "method": "org.eclipse.jdt.ui.actions.RenameAction.run",
          "source": "RenameAction.java:116"
        },
        {
          "method": "org.eclipse.jdt.ui.actions.SelectionDispatchAction.dispatchRun",
          "source": "SelectionDispatchAction.java:191"
        },
        {
          "method": "org.eclipse.jdt.ui.actions.SelectionDispatchAction.run",
          "source": "SelectionDispatchAction.java:169"
        },
        {
          "method": "org.eclipse.jface.action.Action.runWithEvent",
          "source": "Action.java:842"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:456"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetEvent",
          "source": "ActionContributionItem.java:403"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$0",
          "source": "ActionContributionItem.java:397"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$ActionListener.handleEvent",
          "source": "ActionContributionItem.java:72"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:81"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:840"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:1838"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:1545"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1402"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.run",
          "source": "Workbench.java:1385"
        },
        {
          "method": "org.eclipse.core.internal.boot.InternalBootLoader.run",
          "source": "InternalBootLoader.java:845"
        },
        {
          "method": "org.eclipse.core.boot.BootLoader.run",
          "source": "BootLoader.java:461"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:324"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:291"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:747"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:583"
        }
      ],
      "causedBy": {
        "exceptionType": "java.lang.ClassCastException",
        "elements": [
          {
            "method": "org.eclipse.jdt.internal.core.search.matching.TypeReferencePattern.matchReportReference",
            "source": "TypeReferencePattern.java:230"
          },
          {
            "method": "org.eclipse.jdt.internal.core.search.matching.TypeReferencePattern.matchReportReference",
            "source": "TypeReferencePattern.java:205"
          },
          {
            "method": "org.eclipse.jdt.internal.core.search.matching.MatchLocator2.reportReference",
            "source": "MatchLocator2.java:1310"
          },
          {
            "method": "org.eclipse.jdt.internal.core.search.matching.MatchingNodeSet.reportMatching",
            "source": "MatchingNodeSet.java:240"
          },
          {
            "method": "org.eclipse.jdt.internal.core.search.matching.MatchingNodeSet.reportMatching",
            "source": "MatchingNodeSet.java:448"
          },
          {
            "method": "org.eclipse.jdt.internal.core.search.matching.MatchingNodeSet.reportMatching",
            "source": "MatchingNodeSet.java:346"
          },
          {
            "method": "org.eclipse.jdt.internal.core.search.matching.MatchLocator2.process",
            "source": "MatchLocator2.java:978"
          },
          {
            "method": "org.eclipse.jdt.internal.core.search.matching.MatchLocator2.locateMatches",
            "source": "MatchLocator2.java:677"
          },
          {
            "method": "org.eclipse.jdt.internal.core.search.matching.MatchLocator2.locateMatches",
            "source": "MatchLocator2.java:635"
          },
          {
            "method": "org.eclipse.jdt.internal.core.search.matching.MatchLocator2.locateMatches",
            "source": "MatchLocator2.java:851"
          },
          {
            "method": "org.eclipse.jdt.core.search.SearchEngine.search",
            "source": "SearchEngine.java:471"
          },
          {
            "method": "org.eclipse.jdt.internal.corext.refactoring.RefactoringSearchEngine.search",
            "source": "RefactoringSearchEngine.java:139"
          },
          {
            "method": "org.eclipse.jdt.internal.corext.refactoring.RefactoringSearchEngine.search",
            "source": "RefactoringSearchEngine.java:106"
          },
          {
            "method": "org.eclipse.jdt.internal.corext.refactoring.RefactoringSearchEngine.search",
            "source": "RefactoringSearchEngine.java:101"
          },
          {
            "method": "org.eclipse.jdt.internal.corext.refactoring.rename.RenameTypeRefactoring.getReferences",
            "source": "RenameTypeRefactoring.java:507"
          },
          {
            "method": "org.eclipse.jdt.internal.corext.refactoring.rename.RenameTypeRefactoring.checkInput",
            "source": "RenameTypeRefactoring.java:368"
          },
          {
            "method": "org.eclipse.jdt.internal.ui.refactoring.CheckConditionsOperation.run",
            "source": "CheckConditionsOperation.java:65"
          },
          {
            "method": "org.eclipse.jdt.internal.ui.refactoring.CreateChangeOperation.run",
            "source": "CreateChangeOperation.java:100"
          },
          {
            "method": "org.eclipse.jdt.internal.ui.refactoring.PerformChangeOperation.run",
            "source": "PerformChangeOperation.java:138"
          },
          {
            "method": "org.eclipse.jface.operation.ModalContext.runInCurrentThread",
            "source": "ModalContext.java:302"
          }
        ],
        "number": 0,
        "commentIndex": 0
      },
      "number": 0,
      "commentIndex": 0,
      "bugId": "36479",
      "date": "2003-04-15T08:46:49+02:00",
      "product": "JDT",
      "component": "Core",
      "severity": "normal"
    }
  ],
  "groupId": "36479",
  "bugId": "36479",
  "date": "2003-04-15T08:46:49+02:00",
  "product": "JDT",
  "component": "Core",
  "severity": "normal"
}