{
  "comments": [
    "public aspect OuterAspect {\n\n  private pointcut isSetter() : execution(void set*(..));\n\n  public static aspect InnerAspect pertarget(isSetter()) {\n\n  }\n\n}\n\n\njava.lang.IllegalStateException\nat org.aspectj.apache.bcel.classfile.GenericSignatureParser.parseFieldTypeSignature(GenericSignatureParser.java:163)\nat org.aspectj.apache.bcel.classfile.GenericSignatureParser.parseTypeArgument(GenericSignatureParser.java:253)\nat org.aspectj.apache.bcel.classfile.GenericSignatureParser.maybeParseTypeArguments(GenericSignatureParser.java:261)\nat org.aspectj.apache.bcel.classfile.GenericSignatureParser.parseClassTypeSignature(GenericSignatureParser.java:208)\nat org.aspectj.apache.bcel.classfile.GenericSignatureParser.parseAsClassSignature(GenericSignatureParser.java:56)\nat org.aspectj.apache.bcel.classfile.Signature.asClassSignature(Signature.java:315)\nat org.aspectj.apache.bcel.classfile.JavaClass.getGenericClassTypeSignature(JavaClass.java:973)\nat org.aspectj.weaver.bcel.BcelObjectType.initializeFromJavaclass(BcelObjectType.java:164)\nat org.aspectj.weaver.bcel.BcelObjectType.\u003cinit\u003e(BcelObjectType.java:131)\nat org.aspectj.weaver.bcel.BcelWorld.buildBcelDelegate(BcelWorld.java:337)\nat org.aspectj.weaver.bcel.BcelWorld.addSourceObjectType(BcelWorld.java:395)\nat org.aspectj.weaver.bcel.BcelWeaver.addIfAspect(BcelWeaver.java:263)\nat org.aspectj.weaver.bcel.BcelWeaver.addAspectsFromDirectory(BcelWeaver.java:255)\nat org.aspectj.weaver.bcel.BcelWeaver.addLibraryJarFile(BcelWeaver.java:205)\nat org.aspectj.ajdt.internal.core.builder.AjBuildManager.initBcelWorld(AjBuildManager.java:698)\nat org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild(AjBuildManager.java:223)\nat org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild(AjBuildManager.java:199)\nat org.aspectj.ajdt.internal.core.builder.AjBuildManager.incrementalBuild(AjBuildManager.java:170)\nat org.aspectj.ajde.internal.CompilerAdapter.compile(CompilerAdapter.java:117)\nat org.aspectj.ajde.internal.AspectJBuildManager$CompilerThread.run(AspectJBuildManager.java:191)\n\nIllegalStateException thrown: Expecting [,L, or T, but found Pjava while unpacking Ljava/util/AbstractSet\u003cPjava/util/Map$Entry\u003cTK;TV;\u003e;\u003e;",
    "Are you on 1.5.2 or a dev build of 1.5.3?\n\nI tried just compiling the aspect you included, worked fine.  Given that the signature it has trouble with is \n\n\"Ljava/util/AbstractSet\u003cPjava/util/Map$Entry\u003cTK;TV;\u003e;\u003e;\"\n\nsomething else must be involved - since your aspect doesn\u0027t use collection classes.  How are you compiling that aspect? Are you weaving rt.jar?",
    "I can\u0027t reproduce it anymore.  I\u0027m using AspectJ 1.5.2 with AJDT 1.4 on Eclipse 3.2.  I was not trying to weave into rt.jar.  I\u0027ll reopen this bug if I come across it again and can make a reproducible test case for you.",
    "Created an attachment (id\u003d49854)\nTestcase: Ant driven\n\nThis small project demonstrate the BCEL exception for this bug. The project assumes a lib directory with the AspectJ jars (I used aspectj-DEVELOPMENT-20060907092616.jar for this).",
    "I\u0027ve added a test case that demonstrates this bug.",
    "thanks for the testcase - I\u0027ve been able to work out how the rogue signature is getting into the class output during the first compilation.",
    "I stripped down the testcase to the bare minimum.\n\nBasically you need to have some type that implements/extends a generic type, eg.\n\nFoo extends List\u003cSet\u003cString\u003e\u003e\n\n(and the generic reference has to be nested, can\u0027t be List\u003cString\u003e - needs to be more complex).\n\nThat type must be affected by a declare parents to cause the signature to change, this will result in a broken signature on disk (so assume declare parents: Foo implements Serializable):\n\nLjava/util/List\u003cPjava/util/Set\u003cLjava/lang/String;\u003e;\u003e;\n\n(see the rogue P)\n\nthen that has to be used in a subsequent weave and the weaver will blow up when unpacking it.  The fix is trivial ;)\n\nTest and fix checked in - the fix is likely to address any/all related bugs that  suffer this same illegal state exception.",
    "fix available in AJ dev builds.",
    "Still getting this problem, but only from AJDT - it seems to work perfectly well in Ant/AspectJ.\n\nI\u0027ll attach a Team Project Set file with two projects that generate this failure. Sorry for the moderate download size. (Depends on Subclipse for Subversion access).\n\nThe stack trace is a little different from Eclipse as well, here is a copy:\njava.lang.IllegalStateException\nat org.aspectj.apache.bcel.classfile.GenericSignatureParser.parseFieldTypeSignature(GenericSignatureParser.java:163)\nat org.aspectj.apache.bcel.classfile.GenericSignatureParser.parseTypeArgument(GenericSignatureParser.java:253)\nat org.aspectj.apache.bcel.classfile.GenericSignatureParser.maybeParseTypeArguments(GenericSignatureParser.java:261)\nat org.aspectj.apache.bcel.classfile.GenericSignatureParser.pars ... teException thrown: Expecting [,L, or T, but found Pjava while unpacking Ljava/lang/ThreadLocal\u003cPjava/util/Set\u003cLdash/obtain/provider/ObtainLookup;\u003e;\u003e;",
    "Created an attachment (id\u003d50611)\nTeam Project Set file for failing case\n\nThis Team Project Set file points to two Eclipse projects that demonstrate the failure in AJDT.",
    "i dont believe AJDT has been upgraded with the most recent AspectJ build... hence it is still failing...",
    "The latest 1.4 and 1.5 AJDT dev builds now contain this fix."
  ],
  "commentCreationDates": [
    "2006-08-15T03:28:08+02:00",
    "2006-08-15T09:08:43+02:00",
    "2006-08-15T09:17:20+02:00",
    "2006-09-11T19:37:26+02:00",
    "2006-09-11T19:40:10+02:00",
    "2006-09-13T18:41:33+02:00",
    "2006-09-14T12:40:33+02:00",
    "2006-09-14T15:26:12+02:00",
    "2006-09-21T01:12:19+02:00",
    "2006-09-21T01:14:44+02:00",
    "2006-09-21T09:15:15+02:00",
    "2006-09-21T17:02:02+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.IllegalStateException",
      "elements": [
        {
          "method": "org.aspectj.apache.bcel.classfile.GenericSignatureParser.parseFieldTypeSignature",
          "source": "GenericSignatureParser.java:163"
        },
        {
          "method": "org.aspectj.apache.bcel.classfile.GenericSignatureParser.parseTypeArgument",
          "source": "GenericSignatureParser.java:253"
        },
        {
          "method": "org.aspectj.apache.bcel.classfile.GenericSignatureParser.maybeParseTypeArguments",
          "source": "GenericSignatureParser.java:261"
        },
        {
          "method": "org.aspectj.apache.bcel.classfile.GenericSignatureParser.parseClassTypeSignature",
          "source": "GenericSignatureParser.java:208"
        },
        {
          "method": "org.aspectj.apache.bcel.classfile.GenericSignatureParser.parseAsClassSignature",
          "source": "GenericSignatureParser.java:56"
        },
        {
          "method": "org.aspectj.apache.bcel.classfile.Signature.asClassSignature",
          "source": "Signature.java:315"
        },
        {
          "method": "org.aspectj.apache.bcel.classfile.JavaClass.getGenericClassTypeSignature",
          "source": "JavaClass.java:973"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelObjectType.initializeFromJavaclass",
          "source": "BcelObjectType.java:164"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelObjectType.\u003cinit\u003e",
          "source": "BcelObjectType.java:131"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWorld.buildBcelDelegate",
          "source": "BcelWorld.java:337"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWorld.addSourceObjectType",
          "source": "BcelWorld.java:395"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.addIfAspect",
          "source": "BcelWeaver.java:263"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.addAspectsFromDirectory",
          "source": "BcelWeaver.java:255"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.addLibraryJarFile",
          "source": "BcelWeaver.java:205"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.initBcelWorld",
          "source": "AjBuildManager.java:698"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild",
          "source": "AjBuildManager.java:223"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild",
          "source": "AjBuildManager.java:199"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.incrementalBuild",
          "source": "AjBuildManager.java:170"
        },
        {
          "method": "org.aspectj.ajde.internal.CompilerAdapter.compile",
          "source": "CompilerAdapter.java:117"
        },
        {
          "method": "org.aspectj.ajde.internal.AspectJBuildManager$CompilerThread.run",
          "source": "AspectJBuildManager.java:191"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "153845",
      "date": "2006-08-15T03:28:08+02:00",
      "product": "AspectJ",
      "component": "Compiler",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.IllegalStateException",
      "elements": [
        {
          "method": "org.aspectj.apache.bcel.classfile.GenericSignatureParser.parseFieldTypeSignature",
          "source": "GenericSignatureParser.java:163"
        },
        {
          "method": "org.aspectj.apache.bcel.classfile.GenericSignatureParser.parseTypeArgument",
          "source": "GenericSignatureParser.java:253"
        },
        {
          "method": "org.aspectj.apache.bcel.classfile.GenericSignatureParser.maybeParseTypeArguments",
          "source": "GenericSignatureParser.java:261"
        }
      ],
      "number": 1,
      "commentIndex": 8,
      "bugId": "153845",
      "date": "2006-09-21T01:12:19+02:00",
      "product": "AspectJ",
      "component": "Compiler",
      "severity": "normal"
    }
  ],
  "groupId": "153845",
  "bugId": "153845",
  "date": "2006-08-15T03:28:08+02:00",
  "product": "AspectJ",
  "component": "Compiler",
  "severity": "normal"
}