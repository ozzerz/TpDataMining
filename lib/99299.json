{
  "comments": [
    "WIN32 - SWT 3.1M4 and 3.1RC1\n\nResizing a composite with a StyledText contained within will ocassionally result\nin the following crash:\n(line # might be off as I\u0027ve added debugging printlns).\n\njava.lang.StringIndexOutOfBoundsException: String index out of range: -927\n     at java.lang.String.\u003cinit\u003e(Unknown Source)\n     at org.eclipse.swt.custom.DefaultContent.getLine(DefaultContent.java:599)\n     at\norg.eclipse.swt.custom.StyledText$ContentWidthCache.calculate(StyledText.java:1219)\n     at org.eclipse.swt.custom.StyledText.computeSize(StyledText.java:2102)\n     at org.eclipse.swt.layout.GridData.computeSize(GridData.java:450)\n     at org.eclipse.swt.layout.GridLayout.layout(GridLayout.java:197)\n     at org.eclipse.swt.layout.GridLayout.computeSize(GridLayout.java:155)\n     at org.eclipse.swt.widgets.Composite.computeSize(Composite.java:207)\n     at org.eclipse.swt.layout.FillLayout.computeSize(FillLayout.java:110)\n     at org.eclipse.swt.widgets.Composite.computeSize(Composite.java:207)\n     at org.eclipse.swt.widgets.Control.computeSize(Control.java:382)\n\nQuick observation:\n\nThe \u0027gap\u0027 length in DefaultContent is positive when calculated by \u0027gapEnd -\ngapStart\u0027, but\nlines[2][1] has been set negative in moveAndResizeGap() which is called on\ninsert()s and delete()s.\n\n344: lines[gapLine][1] \u003d lines[gapLine][1] - oldSize;\n\ngetLine is using this negative value to construct a String.\n\n482: int length \u003d lines[index][1];\n\nwhich is the called from the StyledText$ContentWidthCache.calculate() call\nduring a resize.\n\nAttached is a testcase that appends some lines of text to a styledText and\nmanually calls getLine(2), and crashes in a similar manner.\n\nException in thread \"main\" java.lang.StringIndexOutOfBoundsException: String\nindex out of range: -33673\n  at java.lang.String.\u003cinit\u003e(Unknown Source)\n  at org.eclipse.swt.custom.DefaultContent.getLine(DefaultContent.java:489)\n  at STC.appendLine(STC.java:61)\n  at STC.main(STC.java:44)",
    "Created an attachment (id\u003d22778)\ntestcase\n",
    "FH, is this a candidate for RC3?",
    "I don\u0027t think we should fix this for 3.1.\n",
    "Really?  An SIOOBE?",
    "How rude!\n",
    "I also receive the following stacktrace with 3.2M2 when using the scrollbar on \na StyledText widget. Looks to be the same getLine problem. (This is a really \nbad bug that comes up a lot for me).\n\njava.lang.StringIndexOutOfBoundsException: String index out of range: -427\n\tat java.lang.String.\u003cinit\u003e(Unknown Source)\n\tat org.eclipse.swt.custom.DefaultContent.getLine\n(DefaultContent.java:487)\n\tat org.eclipse.swt.custom.StyledText$ContentWidthCache.calculate\n(StyledText.java:1251)\n\tat org.eclipse.swt.custom.StyledText.calculateTopIndex\n(StyledText.java:2002)\n\tat org.eclipse.swt.custom.StyledText.setVerticalScrollOffset\n(StyledText.java:7701)\n\tat org.eclipse.swt.custom.StyledText.handleVerticalScroll\n(StyledText.java:5443)\n\tat org.eclipse.swt.custom.StyledText$8.handleEvent(StyledText.java:4874)\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:884)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:908)\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:893)\n\tat org.eclipse.swt.widgets.ScrollBar.wmScrollChild(ScrollBar.java:902)\n\tat org.eclipse.swt.widgets.Scrollable.wmScroll(Scrollable.java:394)\n\tat org.eclipse.swt.widgets.Scrollable.WM_VSCROLL(Scrollable.java:341)\n\tat org.eclipse.swt.widgets.Control.windowProc(Control.java:3137)\n\tat org.eclipse.swt.widgets.Display.windowProc(Display.java:3854)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)\n\tat org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:1693)\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2839)\n\tat sancho.view.MainWindow.\u003cinit\u003e(MainWindow.java:186)",
    "FH, any idea about this one?  Seems bad.",
    "With latest CVS (swt 3230) I receive the following different stacktrace.  Any chance this will be looked at for 3.2?\n\n\nException in thread \"main\" java.lang.ArrayIndexOutOfBoundsException\n\tat java.lang.System.arraycopy(Native Method)\n\tat java.lang.AbstractStringBuilder.append(Unknown Source)\n\tat java.lang.StringBuffer.append(Unknown Source)\n\tat org.eclipse.swt.custom.DefaultContent.getLine(DefaultContent.java:493)\n\tat org.eclipse.swt.custom.StyledTextRenderer.getHeight(StyledTextRenderer.java:496)\n\tat org.eclipse.swt.custom.StyledText.setScrollBars(StyledText.java:7350)\n\tat org.eclipse.swt.custom.StyledText.resetCache(StyledText.java:6307)\n\tat org.eclipse.swt.custom.StyledText.handleTextChanged(StyledText.java:5292)\n\tat org.eclipse.swt.custom.StyledText$6.textChanged(StyledText.java:4785)\n\tat org.eclipse.swt.custom.StyledTextListener.handleEvent(StyledTextListener.java:66)\n\tat org.eclipse.swt.custom.DefaultContent.sendTextEvent(DefaultContent.java:794)\n\tat org.eclipse.swt.custom.DefaultContent.replaceTextRange(DefaultContent.java:787)\n\tat org.eclipse.swt.custom.StyledText.modifyContent(StyledText.java:5763)\n\tat org.eclipse.swt.custom.StyledText.replaceTextRange(StyledText.java:6278)\n\tat STC.appendLine(STC.java:53)\n\tat STC.main(STC.java:46)",
    "FH, still a problem?",
    "Yes, it is still a problem. \n\nThis part of the code is pretty complicated and I never touch it, I had the fix once but I decided not to release cause I was afraid of breaking eclipse. BTW, this doesn\u0027t happen on Eclipse.\n",
    "It was really hard to find this one. The testcase would only show the bug in the 16th iteration when the line count is over one thousand and the char count over hundred thousand. The problem actualy happens in the 2nd iteration.\n\nSimple test case:\ns.setText(\"abc\\r\");\ns.append(\"\\ndef\");\nAt this point lineCount \u003d\u003d 3, it should be 2, the text really is:\nline0: \"abc\\r\\n\"\nline1: \"def\"\n\nOr,\ns.setText(\"abc\\rX\\ndef\");\ns.replaceTextRange(4, 1, \"\");\nAt this point lineCount 3, it should be 2. The result text is same as the first case.\n\n\nStill, I don\u0027t have a elegant fix for it."
  ],
  "commentCreationDates": [
    "2005-06-10T05:43:44+02:00",
    "2005-06-10T05:45:59+02:00",
    "2005-06-15T19:44:27+02:00",
    "2005-06-15T19:59:34+02:00",
    "2005-06-15T20:03:53+02:00",
    "2005-06-15T20:36:00+02:00",
    "2005-10-15T18:47:26+02:00",
    "2005-10-24T20:39:20+02:00",
    "2006-04-13T19:49:54+02:00",
    "2006-04-13T19:56:22+02:00",
    "2006-04-13T21:02:01+02:00",
    "2006-04-18T20:26:52+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.StringIndexOutOfBoundsException",
      "message": "String index out of range: -927",
      "elements": [
        {
          "method": "java.lang.String.\u003cinit\u003e",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.swt.custom.DefaultContent.getLine",
          "source": "DefaultContent.java:599"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText$ContentWidthCache.calculate",
          "source": "StyledText.java:1219"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.computeSize",
          "source": "StyledText.java:2102"
        },
        {
          "method": "org.eclipse.swt.layout.GridData.computeSize",
          "source": "GridData.java:450"
        },
        {
          "method": "org.eclipse.swt.layout.GridLayout.layout",
          "source": "GridLayout.java:197"
        },
        {
          "method": "org.eclipse.swt.layout.GridLayout.computeSize",
          "source": "GridLayout.java:155"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.computeSize",
          "source": "Composite.java:207"
        },
        {
          "method": "org.eclipse.swt.layout.FillLayout.computeSize",
          "source": "FillLayout.java:110"
        },
        {
          "method": "org.eclipse.swt.widgets.Composite.computeSize",
          "source": "Composite.java:207"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.computeSize",
          "source": "Control.java:382"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "99299",
      "date": "2005-06-10T05:43:44+02:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.StringIndexOutOfBoundsException",
      "message": "String index out of range: -33673",
      "elements": [
        {
          "method": "java.lang.String.\u003cinit\u003e",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.swt.custom.DefaultContent.getLine",
          "source": "DefaultContent.java:489"
        },
        {
          "method": "STC.appendLine",
          "source": "STC.java:61"
        },
        {
          "method": "STC.main",
          "source": "STC.java:44"
        }
      ],
      "number": 1,
      "commentIndex": 0,
      "bugId": "99299",
      "date": "2005-06-10T05:43:44+02:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.StringIndexOutOfBoundsException",
      "message": "String index out of range: -427",
      "elements": [
        {
          "method": "java.lang.String.\u003cinit\u003e",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.swt.custom.DefaultContent.getLine",
          "source": "DefaultContent.java:487"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText$ContentWidthCache.calculate",
          "source": "StyledText.java:1251"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.calculateTopIndex",
          "source": "StyledText.java:2002"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.setVerticalScrollOffset",
          "source": "StyledText.java:7701"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.handleVerticalScroll",
          "source": "StyledText.java:5443"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText$8.handleEvent",
          "source": "StyledText.java:4874"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:884"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:908"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:893"
        },
        {
          "method": "org.eclipse.swt.widgets.ScrollBar.wmScrollChild",
          "source": "ScrollBar.java:902"
        },
        {
          "method": "org.eclipse.swt.widgets.Scrollable.wmScroll",
          "source": "Scrollable.java:394"
        },
        {
          "method": "org.eclipse.swt.widgets.Scrollable.WM_VSCROLL",
          "source": "Scrollable.java:341"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3137"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3854"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessage",
          "source": "OS.java:1693"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2839"
        },
        {
          "method": "sancho.view.MainWindow.\u003cinit\u003e",
          "source": "MainWindow.java:186"
        }
      ],
      "number": 2,
      "commentIndex": 6,
      "bugId": "99299",
      "date": "2005-10-15T18:47:26+02:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.ArrayIndexOutOfBoundsException",
      "elements": [
        {
          "method": "java.lang.System.arraycopy",
          "source": "Native Method"
        },
        {
          "method": "java.lang.AbstractStringBuilder.append",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.StringBuffer.append",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.swt.custom.DefaultContent.getLine",
          "source": "DefaultContent.java:493"
        },
        {
          "method": "org.eclipse.swt.custom.StyledTextRenderer.getHeight",
          "source": "StyledTextRenderer.java:496"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.setScrollBars",
          "source": "StyledText.java:7350"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.resetCache",
          "source": "StyledText.java:6307"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.handleTextChanged",
          "source": "StyledText.java:5292"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText$6.textChanged",
          "source": "StyledText.java:4785"
        },
        {
          "method": "org.eclipse.swt.custom.StyledTextListener.handleEvent",
          "source": "StyledTextListener.java:66"
        },
        {
          "method": "org.eclipse.swt.custom.DefaultContent.sendTextEvent",
          "source": "DefaultContent.java:794"
        },
        {
          "method": "org.eclipse.swt.custom.DefaultContent.replaceTextRange",
          "source": "DefaultContent.java:787"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.modifyContent",
          "source": "StyledText.java:5763"
        },
        {
          "method": "org.eclipse.swt.custom.StyledText.replaceTextRange",
          "source": "StyledText.java:6278"
        },
        {
          "method": "STC.appendLine",
          "source": "STC.java:53"
        },
        {
          "method": "STC.main",
          "source": "STC.java:46"
        }
      ],
      "number": 3,
      "commentIndex": 8,
      "bugId": "99299",
      "date": "2006-04-13T19:49:54+02:00",
      "product": "Platform",
      "component": "SWT",
      "severity": "normal"
    }
  ],
  "groupId": "99299",
  "bugId": "99299",
  "date": "2005-06-10T05:43:44+02:00",
  "product": "Platform",
  "component": "SWT",
  "severity": "normal"
}