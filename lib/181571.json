{
  "comments": [
    "Allocation Details tab in Object Allocations view is empty. No call sites data is displayed or collected if \u0027Track object allocation sites\u0027 is checked in launch config.\n\nReproduced on latest builds on clean workspace when profiling Java App or External Java App.",
    "Ruslan, \n  I did not test the Obj Alloc call sites on Linux \u0026 WIndows since the Heap instrumentation was crashing. This was a usage that was not a part of the testing. I will test this again with the fix that Asaf put in for the Heap instrumentation crash.\nMeanwhile, can you take a look at this to see if there any issues on the Client side?\n",
    "Marius,\n  The Model is logging a class cast exception while loading the XMLObjAlloc objects. I know this worked before. Below is the stack that is produced by the exception.\n\nTo reproduce this: \nProfile an Eclipse WOrkbench on Windows 32 using the Java 5.0+ Profiling\" (JVMTI) and select the Memory Analysis Allocation.\n\njava.lang.ClassCastException: org.eclipse.hyades.models.trace.impl.TRCClassImpl cannot be cast to org.eclipse.hyades.models.trace.TRCArrayClass\n\tat org.eclipse.hyades.loaders.trace.XMLobjAllocLoader.updateTheClass(XMLobjAllocLoader.java:314)\n\tat org.eclipse.hyades.loaders.trace.XMLobjAllocLoader.processHF(XMLobjAllocLoader.java:244)\n\tat org.eclipse.hyades.loaders.trace.TraceXMLFragmentLoader.processHF_EF(TraceXMLFragmentLoader.java:493)\n\tat org.eclipse.hyades.loaders.trace.TraceXMLFragmentLoader.dispatchProcessMode(TraceXMLFragmentLoader.java:440)\n\tat org.eclipse.hyades.loaders.trace.XMLobjAllocLoader.createTRCObject(XMLobjAllocLoader.java:297)\n\tat org.eclipse.hyades.loaders.trace.XMLobjAllocLoader.addYourselfInContext(XMLobjAllocLoader.java:98)\n\tat org.eclipse.hyades.loaders.util.XMLLoader.endElement(XMLLoader.java:315)\n\tat org.eclipse.hyades.loaders.util.SAXFragmentHandler$RegularHandler.endElement(SAXFragmentHandler.java:175)\n\tat org.apache.xerces.parsers.AbstractSAXParser.endElement(Unknown Source)\n\tat or\n\ng.apache.xerces.parsers.AbstractXMLDocumentParser.emptyElement(Unknown Source)\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(Unknown Source)\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown Source)\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n\tat org.apache.xerces.parsers.XMLParser.parse(Unknown Source)\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\n\tat org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.parse(Unknown Source)\n\tat org.apache.xerces.jaxp.SAXParserImpl.parse(Unknown Source)\n\tat org.eclipse.hyades.loaders.util.SAXFragmentHandler.parse(SAXFragmentHandler.java:128)\n\tat org.eclipse.hyades.loaders.util.SAXFragmentHandler$1.run(SAXFragmentHandler.java:65)\n\nThread[TCPDataFlusher,8,main] - java.lang.ClassCastException: org.eclipse.hyades.models.trace.impl.TRCClassImpl cannot be cast to org.eclipse.hyades.models.trace.TRCArrayClass\n\tat org.eclipse.hyades.loaders.trace.XMLobjAllocLoader.updateTheClass(XMLobjAllocLoader.java:314)\n\tat org.eclipse.hyades.loaders.trace.XMLobjAllocLoader.processHF(XMLobjAllocLoader.java:244)\n\tat org.eclipse.hyades.loaders.trace.TraceXMLFragmentLoader.processHF_EF(TraceXMLFragmentLoader.java:493)\n\tat org.eclipse.hyades.loaders.trace.TraceXMLFragmentLoader.dispatchProcessMode(TraceXMLFragmentLoader.java:440)\n\tat org.eclipse.hyades.loaders.trace.XMLobjAllocLoader.createTRCObject(XMLobjAllocLoader.java:297)\n\tat org.eclipse.hyades.loaders.trace.XMLobjAllocLoader.addYourselfInContext(XMLobjAllocLoader.java:98)\n\tat org.eclipse.hyades.loaders.util.XMLLoader.endElement(XMLLoader.java:315)\n\tat org.eclipse.hyades.loaders.util.SAXFragmentHandler$RegularHandler.endElement(SAXFragmentHandler.java:175)\n\tat org.apache.xerces.parsers.AbstractSAXParser.endElement(Unknown Source)\n\tat org.apache.xerces.parsers.AbstractXMLDocumentParser.emptyElement(Unknown Source)\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(Unknown Source)\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown Source)\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n\tat org.apache.xerces.parsers.XMLParser.parse(Unknown Source)\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\n\tat org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.parse(Unknown Source)\n\tat org.apache.xerces.jaxp.SAXParserImpl.parse(Unknown Source)\n\tat org.eclipse.hyades.loaders.util.SAXFragmentHandler.parse(SAXFragmentHandler.java:128)\n\tat org.eclipse.hyades.loaders.util.SAXFragmentHandler$1.run(SAXFragmentHandler.java:65)\n\n",
    "in org.eclipse.tptp.platform.jvmti.client I found that following constant was used incorrectly in code related to \u0027alloc sites\u0027 option in launch configuration:\n ITILaunchConfigurationConstants.OPTION_ALLOC_SITE\n\nI replaced it by following (used in other places):\n ITILaunchConfigurationConstants.ATTR_EXEC_OBJ_ALLOC_SITE\n\nWith second constant Object Allocation details are collected and displayed correctly.\nI have checked in the fix in CVS HEAD.\n",
    "Ruslan - did you check to see if the Exception I called out in COmment #2 is still there?\n\n",
    "I did not reproduce ClassCastException before and after fix for this bug.\nI used latest for that time build all.in.one-TPTP-4.4.0-200704060100.\n\nOn which build have you reproduced exception?\n",
    "Ruslan, I reproduced the defect with the April 9 build. \nTo reproduce the bug on windows do - eclipse \u003e\u003econsole.txt\nAfter you do Heap instrumentation you will see entries for the class cast exception in the console.txt",
    "Created an attachment (id\u003d63896)\nProposed fix\n\nMarius,\n\nI found that in XMLclassDefLoader.createTRCType() array type is detected as:\n    if (name.charAt(0) \u003d\u003d \u0027[\u0027)\n\nwhich does not detect actual types: typename[] and causes cast excepton.\n\nSo I propose fix:\n    if (name.indexOf(\u0027[\u0027) \u003e\u003d 0)\nwhich avoids class cast exception.\n\nIs it OK? Can you please review and apply this fix?\n",
    "(In reply to comment #7)\n\u003e which does not detect actual types: typename[] and causes cast excepton.\n\u003e \n\nThe classDef name attribute is using JNI signature format which always expects the array class name with \"[\" prefix.\n\nYou should use \"[LFullyQuallifiedClassName;\" instead of \"FullyQuallifiedClassName[]\" in the name attribute.\n",
    "(In reply to comment #8)\n\u003e (In reply to comment #7)\n\u003e \u003e which does not detect actual types: typename[] and causes cast excepton.\n\u003e \u003e \n\u003e The classDef name attribute is using JNI signature format which always expects\n\u003e the array class name with \"[\" prefix.\n\u003e You should use \"[LFullyQuallifiedClassName;\" instead of\n\u003e \"FullyQuallifiedClassName[]\" in the name attribute.\n\nSeparate bug submitted: https://bugs.eclipse.org/bugs/show_bug.cgi?id\u003d182684\n",
    "Please let me know if you still get the ClassCastException after bug 182684 is fixed.",
    "Please reopen if you still have the problem."
  ],
  "commentCreationDates": [
    "2007-04-09T11:05:20+02:00",
    "2007-04-09T18:10:13+02:00",
    "2007-04-10T00:17:33+02:00",
    "2007-04-10T13:30:41+02:00",
    "2007-04-10T15:28:16+02:00",
    "2007-04-11T09:23:56+02:00",
    "2007-04-11T18:47:53+02:00",
    "2007-04-16T14:35:17+02:00",
    "2007-04-16T19:12:27+02:00",
    "2007-04-17T07:51:12+02:00",
    "2007-04-17T16:03:34+02:00",
    "2007-05-02T15:49:33+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ClassCastException",
      "message": "org.eclipse.hyades.models.trace.impl.TRCClassImpl cannot be cast to org.eclipse.hyades.models.trace.TRCArrayClass",
      "elements": [
        {
          "method": "org.eclipse.hyades.loaders.trace.XMLobjAllocLoader.updateTheClass",
          "source": "XMLobjAllocLoader.java:314"
        },
        {
          "method": "org.eclipse.hyades.loaders.trace.XMLobjAllocLoader.processHF",
          "source": "XMLobjAllocLoader.java:244"
        },
        {
          "method": "org.eclipse.hyades.loaders.trace.TraceXMLFragmentLoader.processHF_EF",
          "source": "TraceXMLFragmentLoader.java:493"
        },
        {
          "method": "org.eclipse.hyades.loaders.trace.TraceXMLFragmentLoader.dispatchProcessMode",
          "source": "TraceXMLFragmentLoader.java:440"
        },
        {
          "method": "org.eclipse.hyades.loaders.trace.XMLobjAllocLoader.createTRCObject",
          "source": "XMLobjAllocLoader.java:297"
        },
        {
          "method": "org.eclipse.hyades.loaders.trace.XMLobjAllocLoader.addYourselfInContext",
          "source": "XMLobjAllocLoader.java:98"
        },
        {
          "method": "org.eclipse.hyades.loaders.util.XMLLoader.endElement",
          "source": "XMLLoader.java:315"
        },
        {
          "method": "org.eclipse.hyades.loaders.util.SAXFragmentHandler$RegularHandler.endElement",
          "source": "SAXFragmentHandler.java:175"
        },
        {
          "method": "org.apache.xerces.parsers.AbstractSAXParser.endElement",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.parsers.AbstractXMLDocumentParser.emptyElement",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.parsers.XML11Configuration.parse",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.parsers.XML11Configuration.parse",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.parsers.XMLParser.parse",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.parsers.AbstractSAXParser.parse",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.parse",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.jaxp.SAXParserImpl.parse",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.hyades.loaders.util.SAXFragmentHandler.parse",
          "source": "SAXFragmentHandler.java:128"
        },
        {
          "method": "org.eclipse.hyades.loaders.util.SAXFragmentHandler$1.run",
          "source": "SAXFragmentHandler.java:65"
        }
      ],
      "number": 0,
      "commentIndex": 2,
      "bugId": "181571",
      "date": "2007-04-10T00:17:33+02:00",
      "product": "TPTP Profiling",
      "component": "Platform.Model",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.ClassCastException",
      "message": "org.eclipse.hyades.models.trace.impl.TRCClassImpl cannot be cast to org.eclipse.hyades.models.trace.TRCArrayClass",
      "elements": [
        {
          "method": "org.eclipse.hyades.loaders.trace.XMLobjAllocLoader.updateTheClass",
          "source": "XMLobjAllocLoader.java:314"
        },
        {
          "method": "org.eclipse.hyades.loaders.trace.XMLobjAllocLoader.processHF",
          "source": "XMLobjAllocLoader.java:244"
        },
        {
          "method": "org.eclipse.hyades.loaders.trace.TraceXMLFragmentLoader.processHF_EF",
          "source": "TraceXMLFragmentLoader.java:493"
        },
        {
          "method": "org.eclipse.hyades.loaders.trace.TraceXMLFragmentLoader.dispatchProcessMode",
          "source": "TraceXMLFragmentLoader.java:440"
        },
        {
          "method": "org.eclipse.hyades.loaders.trace.XMLobjAllocLoader.createTRCObject",
          "source": "XMLobjAllocLoader.java:297"
        },
        {
          "method": "org.eclipse.hyades.loaders.trace.XMLobjAllocLoader.addYourselfInContext",
          "source": "XMLobjAllocLoader.java:98"
        },
        {
          "method": "org.eclipse.hyades.loaders.util.XMLLoader.endElement",
          "source": "XMLLoader.java:315"
        },
        {
          "method": "org.eclipse.hyades.loaders.util.SAXFragmentHandler$RegularHandler.endElement",
          "source": "SAXFragmentHandler.java:175"
        },
        {
          "method": "org.apache.xerces.parsers.AbstractSAXParser.endElement",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.parsers.AbstractXMLDocumentParser.emptyElement",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.parsers.XML11Configuration.parse",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.parsers.XML11Configuration.parse",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.parsers.XMLParser.parse",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.parsers.AbstractSAXParser.parse",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.parse",
          "source": "Unknown Source"
        },
        {
          "method": "org.apache.xerces.jaxp.SAXParserImpl.parse",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.hyades.loaders.util.SAXFragmentHandler.parse",
          "source": "SAXFragmentHandler.java:128"
        },
        {
          "method": "org.eclipse.hyades.loaders.util.SAXFragmentHandler$1.run",
          "source": "SAXFragmentHandler.java:65"
        }
      ],
      "number": 1,
      "commentIndex": 2,
      "bugId": "181571",
      "date": "2007-04-10T00:17:33+02:00",
      "product": "TPTP Profiling",
      "component": "Platform.Model",
      "severity": "normal"
    }
  ],
  "groupId": "181571",
  "bugId": "181571",
  "date": "2007-04-09T11:05:20+02:00",
  "product": "TPTP Profiling",
  "component": "Platform.Model",
  "severity": "normal"
}