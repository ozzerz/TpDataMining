{
  "comments": [
    "Using Callisto RC5 (WTP+TPTP+Platform)\n\nNOTE: This NullPointer only occurs when running TPTP Automated GUI Recorder (AGR) tests.\n\nWe have a test script that launches a performs the following steps:\nLaunch a New Cape Clear Project Wizard.  (The CC Project Wizard pages build on the wst facet wizard pages).\nCreates a Server Runtime\nCancels the wizard on the first page.\nLaunches the wizard a second time.\n\nOn the second launch the script fails with the following exception\n\njava.lang.NullPointerException\nat org.eclipse.jst.common.project.facet.JavaFacetInstallDataModelProvider.getDefaultProperty(JavaFacetInstallDataModelProvider.java:41)\nat org.eclipse.wst.common.frameworks.internal.datamodel.DataModelImpl.getProperty(DataModelImpl.java:130)\nat org.eclipse.wst.common.componentcore.datamodel.FacetProjectCreationDataModelProvider.propertySet(FacetProjectCreationDataModelProvider.java:236)\n\nThe relevant code in JavaFacetInstallDataModelProvider is\n\n39 Hashtable javaOptions \u003d JavaCore.getOptions();\n40 String jdtVersion \u003d (String)javaOptions.get(JavaCore.COMPILER_COMPLIANCE);\n41 if (jdtVersion.startsWith(\"1.3\")) { //$NON-NLS-1$\n\nThe jdtVersion being returned by the JavaCore is, for some reason null.  As mentioned above, this only happens when the tests are being run in a workbench that was launched via TPTP \"Test\" Launch Configuration.  Unfortunately that launch configuration cannot be used in debug mode so I cannot easily dig deeper.\n\nThe same use case works fine if run manually by a user. \n\nThere must be something specific about how TPTP is launching the test workbench that causes JavaCore to not correctly initalize the compilier compliance property, although strangly the NPE only manifests the second time the wizard is launched, not the first.",
    "Some more information from debugging the same use case using JST/WST wizards and server runtimes only (i.e. none of our code involved).  I have also managed to reproduce the error manually (i.e. not using TPTP) using the following steps:\n\n1) Launch/Debug a new WTP workbench with a clean workspace and clean configuration.\n2) Launch the New Project Wizard and choose Dynamic Web Project\n3) On the first page, click \"New\" to create a New Server Runtime.  It launches the server runtime wizard.\n4) Create an appropriate runtime (I\u0027m using Tomcat 5.5)\n5) Finish the New Runtime wizard and immediately cancel the New Project wizard.\n\n(To catch the NPE, set a breakpoint at \norg.eclipse.jst.common.project.facet.JavaFacetInstallDataModelProvider.getDefaultProperty(java.lang.String) line: 41)  Othwise it gets swallowed.\n\n6) Relaunch the New Project Wizard and choose Dynamic Web Project.  Click Next and the NPE will occur and the next page will not display.  Any subsequent to rerun the New Dynamic Web Project wizard will fail.  The NPE seems to be swallowed somewhere else (not logged) so there is no feedback to the user, hence the need for a breakpoint.  \n\nIt appears that the call to JavaCore.getOptions() from the above method is returning a Set containing just 1 property (\"org.eclipse.jdt.core.builder.resourceCopyExclusionFilter\") - that seems (very) wrong.\n\nThe property that it is being set (at DataModelImpl.internalSetProperty() in the stack trace below) is the FACET_RUNTIME property.  The first time the wizard is launched the call to DataModelImpl.internalSetProperty does nothing as the old and new values are both  null.  The second time around the (new) property value is a BridgedRunime so it proceeds. (This explains somewhat why the NPE only occurs the second time the wizard is launched.)\n\nDriver versions:\nS-3.2RC6-200605260010 (Platform)\nwtp-sdk-S-1.5RC4-200605310507\nJEM-SDK-1.2RC2.zip\nGEF-SDK-3.2RC4.zip\nemf-sdo-xsd-SDK-2.2.0RC6a.zip\n  \nStack Trace:\n\nThread [main] (Suspended (breakpoint at line 41 in org.eclipse.jst.common.project.facet.JavaFacetInstallDataModelProvider))\t\n\torg.eclipse.jst.common.project.facet.JavaFacetInstallDataModelProvider.getDefaultProperty(java.lang.String) line: 41\t\n\torg.eclipse.wst.common.frameworks.internal.datamodel.DataModelImpl.getProperty(java.lang.String) line: 130\t\n\torg.eclipse.jst.j2ee.internal.web.archive.operations.WebFacetProjectCreationDataModelProvider(org.eclipse.wst.common.componentcore.datamodel.FacetProjectCreationDataModelProvider).propertySet(java.lang.String, java.lang.Object) line: 236\t\n\torg.eclipse.jst.j2ee.internal.web.archive.operations.WebFacetProjectCreationDataModelProvider(org.eclipse.jst.j2ee.project.facet.J2EEFacetProjectCreationDataModelProvider).propertySet(java.lang.String, java.lang.Object) line: 57\t\n\torg.eclipse.jst.j2ee.internal.web.archive.operations.WebFacetProjectCreationDataModelProvider.propertySet(java.lang.String, java.lang.Object) line: 56\t\n\torg.eclipse.wst.common.frameworks.internal.datamodel.DataModelImpl.internalSetProperty(java.lang.String, java.lang.Object) line: 182\t\n\torg.eclipse.wst.common.frameworks.internal.datamodel.DataModelImpl.setProperty(java.lang.String, java.lang.Object) line: 172\t\n\torg.eclipse.jst.servlet.ui.project.facet.WebProjectFirstPage(org.eclipse.wst.web.ui.internal.wizards.DataModelFacetCreationWizardPage).restoreDefaultSettings() line: 173\t\n\torg.eclipse.jst.servlet.ui.project.facet.WebProjectFirstPage(org.eclipse.jst.j2ee.internal.wizard.J2EEComponentFacetCreationWizardPage).restoreDefaultSettings() line: 78\t\n\torg.eclipse.jst.servlet.ui.project.facet.WebProjectFirstPage(org.eclipse.wst.common.frameworks.internal.datamodel.ui.DataModelWizardPage).setDefaults() line: 170\t\n\torg.eclipse.jst.servlet.ui.project.facet.WebProjectFirstPage(org.eclipse.wst.common.frameworks.internal.datamodel.ui.DataModelWizardPage).createControl(org.eclipse.swt.widgets.Composite) line: 104\t\n\torg.eclipse.jst.servlet.ui.project.facet.WebProjectWizard(org.eclipse.jface.wizard.Wizard).createPageControls(org.eclipse.swt.widgets.Composite) line: 180\t\n\torg.eclipse.jst.servlet.ui.project.facet.WebProjectWizard(org.eclipse.wst.common.project.facet.ui.AddRemoveFacetsWizard).createPageControls(org.eclipse.swt.widgets.Composite) line: 236\t\n\torg.eclipse.jst.servlet.ui.project.facet.WebProjectWizard(org.eclipse.wst.web.ui.internal.wizards.NewProjectDataModelFacetWizard).createPageControls(org.eclipse.swt.widgets.Composite) line: 135\t\n\torg.eclipse.jface.wizard.WizardDialog.createPageControls() line: 614\t\n\torg.eclipse.jface.wizard.WizardDialog.setWizard(org.eclipse.jface.wizard.IWizard) line: 989\t\n\torg.eclipse.jface.wizard.WizardDialog.updateForPage(org.eclipse.jface.wizard.IWizardPage) line: 1041\t\n\torg.eclipse.jface.wizard.WizardDialog.access$2(org.eclipse.jface.wizard.WizardDialog, org.eclipse.jface.wizard.IWizardPage) line: 1038\t\n\torg.eclipse.jface.wizard.WizardDialog$4.run() line: 1028\t\n\torg.eclipse.swt.custom.BusyIndicator.showWhile(org.eclipse.swt.widgets.Display, java.lang.Runnable) line: 67\t\n\torg.eclipse.jface.wizard.WizardDialog.showPage(org.eclipse.jface.wizard.IWizardPage) line: 1026\t\n\torg.eclipse.jface.wizard.WizardDialog.nextPressed() line: 757\t\n\torg.eclipse.jface.wizard.WizardDialog.buttonPressed(int) line: 351\t\n\torg.eclipse.jface.dialogs.Dialog$3.widgetSelected(org.eclipse.swt.events.SelectionEvent) line: 660\t\n\torg.eclipse.swt.widgets.TypedListener.handleEvent(org.eclipse.swt.widgets.Event) line: 90\t\n\torg.eclipse.swt.widgets.EventTable.sendEvent(org.eclipse.swt.widgets.Event) line: 66\t\n\torg.eclipse.swt.widgets.Button(org.eclipse.swt.widgets.Widget).sendEvent(org.eclipse.swt.widgets.Event) line: 928\t\n\torg.eclipse.swt.widgets.Display.runDeferredEvents() line: 3348\t\n\torg.eclipse.swt.widgets.Display.readAndDispatch() line: 2968\t\n\torg.eclipse.jface.wizard.WizardDialog(org.eclipse.jface.window.Window).runEventLoop(org.eclipse.swt.widgets.Shell) line: 820\t\n\torg.eclipse.jface.wizard.WizardDialog(org.eclipse.jface.window.Window).open() line: 796\t\n\torg.eclipse.ui.actions.NewWizardAction.run() line: 181\t\n\torg.eclipse.ui.actions.NewWizardAction(org.eclipse.jface.action.Action).runWithEvent(org.eclipse.swt.widgets.Event) line: 499\t\n\torg.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(org.eclipse.swt.widgets.Event, boolean) line: 539\t\n\torg.eclipse.jface.action.ActionContributionItem.access$2(org.eclipse.jface.action.ActionContributionItem, org.eclipse.swt.widgets.Event, boolean) line: 488\t\n\torg.eclipse.jface.action.ActionContributionItem$5.handleEvent(org.eclipse.swt.widgets.Event) line: 400\t\n\torg.eclipse.swt.widgets.EventTable.sendEvent(org.eclipse.swt.widgets.Event) line: 66\t\n\torg.eclipse.swt.widgets.MenuItem(org.eclipse.swt.widgets.Widget).sendEvent(org.eclipse.swt.widgets.Event) line: 928\t\n\torg.eclipse.swt.widgets.Display.runDeferredEvents() line: 3348\t\n\torg.eclipse.swt.widgets.Display.readAndDispatch() line: 2968\t\n\torg.eclipse.ui.internal.Workbench.runEventLoop(org.eclipse.jface.window.Window$IExceptionHandler, org.eclipse.swt.widgets.Display) line: 1914\t\n\torg.eclipse.ui.internal.Workbench.runUI() line: 1878\t\n\torg.eclipse.ui.internal.Workbench.createAndRunWorkbench(org.eclipse.swt.widgets.Display, org.eclipse.ui.application.WorkbenchAdvisor) line: 419\t\n\torg.eclipse.ui.PlatformUI.createAndRunWorkbench(org.eclipse.swt.widgets.Display, org.eclipse.ui.application.WorkbenchAdvisor) line: 149\t\n\torg.eclipse.ui.internal.ide.IDEApplication.run(java.lang.Object) line: 95\t\n\torg.eclipse.core.internal.runtime.PlatformActivator$1.run(java.lang.Object) line: 78\t\n\torg.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(java.lang.Object) line: 92\t\n\torg.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(java.lang.Object) line: 68\t\n\torg.eclipse.core.runtime.adaptor.EclipseStarter.run(java.lang.Object) line: 400\t\n\torg.eclipse.core.runtime.adaptor.EclipseStarter.run(java.lang.String[], java.lang.Runnable) line: 177\t\n\tsun.reflect.NativeMethodAccessorImpl.invoke0(java.lang.reflect.Method, java.lang.Object, java.lang.Object[]) line: not available [native method]\t\n\tsun.reflect.NativeMethodAccessorImpl.invoke(java.lang.Object, java.lang.Object[]) line: not available\t\n\tsun.reflect.DelegatingMethodAccessorImpl.invoke(java.lang.Object, java.lang.Object[]) line: not available\t\n\tjava.lang.reflect.Method.invoke(java.lang.Object, java.lang.Object[]) line: not available\t\n\torg.eclipse.core.launcher.Main.invokeFramework(java.lang.String[], java.net.URL[]) line: 336\t\n\torg.eclipse.core.launcher.Main.basicRun(java.lang.String[]) line: 280\t\n\torg.eclipse.core.launcher.Main.run(java.lang.String[]) line: 977\t\n\torg.eclipse.core.launcher.Main.main(java.lang.String[]) line: 952\t\n\n\n",
    "It turns out this is happening because of a bug in TPTP 4.2 - a TPTP plugin is overwriting the set of JavaCore options so when the facet runtime goes looking for the JVM version number it is not defined, resulting in a NPE.\n\nSee https://bugs.eclipse.org/bugs/show_bug.cgi?id\u003d149596 for the bug I have logged against TPTP.  \n\nNote that this implies that the Callisto releases of TPTP and WTP have a pretty serious compatability issue - the user cannot use any WTP faceted projects if TPTP in installed...",
    "TPTP fixed the underlying cause of this..."
  ],
  "commentCreationDates": [
    "2006-07-04T11:41:57+02:00",
    "2006-07-04T13:50:19+02:00",
    "2006-07-04T18:36:23+02:00",
    "2006-09-07T09:39:03+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.jst.common.project.facet.JavaFacetInstallDataModelProvider.getDefaultProperty",
          "source": "JavaFacetInstallDataModelProvider.java:41"
        },
        {
          "method": "org.eclipse.wst.common.frameworks.internal.datamodel.DataModelImpl.getProperty",
          "source": "DataModelImpl.java:130"
        },
        {
          "method": "org.eclipse.wst.common.componentcore.datamodel.FacetProjectCreationDataModelProvider.propertySet",
          "source": "FacetProjectCreationDataModelProvider.java:236"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "149542",
      "date": "2006-07-04T11:41:57+02:00",
      "product": "Web Tools",
      "component": "jst.j2ee",
      "severity": "normal"
    }
  ],
  "groupId": "149542",
  "bugId": "149542",
  "date": "2006-07-04T11:41:57+02:00",
  "product": "Web Tools",
  "component": "jst.j2ee",
  "severity": "normal"
}