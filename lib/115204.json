{
  "comments": [
    "Sorry I don\u0027t have a small test case.  It looks like the NPE happens when the\nannotation refered to by a (compiled?) aspect no longer exists because it was\nrenamed.  The class being woven is the first one (alphabetically), and the\nmethod being woven does not have the annotation on it.\n\nLet me know if you need a test case.\n(And sorry for the late bugs - I\u0027m just now writing the article.)\n\n------------------------------------------------------------------\njava.lang.NullPointerException\nat\norg.aspectj.weaver.patterns.WildAnnotationTypePattern.matches(WildAnnotationTypePattern.java:61)\nat\norg.aspectj.weaver.patterns.SignaturePattern.matchesAnnotations(SignaturePattern.java:321)\nat\norg.aspectj.weaver.patterns.SignaturePattern.matchesExactly(SignaturePattern.java:169)\nat org.aspectj.weaver.patterns.SignaturePattern.matches(SignaturePattern.java:131)\nat\norg.aspectj.weaver.patterns.WithincodePointcut.matchInternal(WithincodePointcut.java:73)\nat org.aspectj.weaver.patterns.Pointcut.match(Pointcut.java:143)\nat org.aspectj.weaver.patterns.AndPointcut.matchInternal(AndPointcut.java:55)\nat org.aspectj.weaver.patterns.Pointcut.match(Pointcut.java:143)\nat org.aspectj.weaver.patterns.AndPointcut.matchInternal(AndPointcut.java:55)\nat org.aspectj.weaver.patterns.Pointcut.match(Pointcut.java:143)\nat org.aspectj.weaver.ShadowMunger.match(ShadowMunger.java:64)\nat org.aspectj.weaver.Advice.match(Advice.java:109)\nat org.aspectj.weaver.bcel.BcelAdvice.match(BcelAdvice.java:97)\nat org.aspectj.weaver.bcel.BcelClassWeaver.match(BcelClassWeaver.java:1749)\nat\norg.aspectj.weaver.bcel.BcelClassWeaver.matchInvokeInstruction(BcelClassWeaver.java:1736)\nat org.aspectj.weaver.bcel.BcelClassWeaver.match(BcelClassWeaver.java:1533)\nat org.aspectj.weaver.bcel.BcelClassWeaver.match(BcelClassWeaver.java:1359)\nat org.aspectj.weaver.bcel.BcelClassWeaver.weave(BcelClassWeaver.java:382)\nat org.aspectj.weaver.bcel.BcelClassWeaver.weave(BcelClassWeaver.java:98)\nat org.aspectj.weaver.bcel.BcelWeaver.weave(BcelWeaver.java:1478)\nat org.aspectj.weaver.bcel.BcelWeaver.weaveWithoutDump(BcelWeaver.java:1443)\nat org.aspectj.weaver.bcel.BcelWeaver.weaveAndNotify(BcelWeaver.java:1217)\nat org.aspectj.weaver.bcel.BcelWeaver.weave(BcelWeaver.java:1021)\nat\norg.aspectj.ajdt.internal.compiler.AjCompilerAdapter.weave(AjCompilerAdapter.java:300)\nat\norg.aspectj.ajdt.internal.compiler.AjCompilerAdapter.afterCompiling(AjCompilerAdapter.java:178)\nat\norg.aspectj.ajdt.internal.compiler.CompilerAdapter.ajc$afterReturning$org_aspectj_ajdt_internal_compiler_CompilerAdapter$2$f9cc9ca0(CompilerAdapter.aj:70)\nat org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile(Compiler.java:367)\nat\norg.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilation(AjBuildManager.java:759)\nat\norg.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild(AjBuildManager.java:225)\nat\norg.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild(AjBuildManager.java:151)\nat org.aspectj.ajde.internal.CompilerAdapter.compile(CompilerAdapter.java:122)\nat\norg.aspectj.ajde.internal.AspectJBuildManager$CompilerThread.run(AspectJBuildManager.java:191)\n\ntrouble in: \npublic class com.isberg.articles.aop7.bean.ABeanTest$APlus extends java.lang.Object:\n  TypeMungers: [(BcelTypeMunger ResolvedTypeMunger(Method, java.lang.String\ncom.isberg.articles.aop7.bean.ABeanTest$CPlus.propertyName(java.lang.String)))]\n     declares: [declare parents: com.isberg.articles.aop7.bean.ABeanTest$CPlus\nextends (com.isberg.articles.aop7.bean.ABean$IBean);]\n  private static Throwable ajc$initFailureCause\n  public static final com.isberg.articles.aop7.bean.ABeanTest$APlus\najc$perSingletonInstance\n  static void \u003cclinit\u003e():\n    staticinitialization(void\ncom.isberg.articles.aop7.bean.ABeanTest$APlus.\u003cclinit\u003e())\n    | catch java.lang.Throwable -\u003e E0\n    | |             INVOKESTATIC\ncom.isberg.articles.aop7.bean.ABeanTest$APlus.ajc$postClinit ()V   (line 125)\n    | catch java.lang.Throwable -\u003e E0\n    |               GOTO L0\n    |           E0: ASTORE_0\n    |               ALOAD_0\n    |               PUTSTATIC\ncom.isberg.articles.aop7.bean.ABeanTest$APlus.ajc$initFailureCause\nLjava/lang/Throwable;\n    |           L0: RETURN\n    staticinitialization(void\ncom.isberg.articles.aop7.bean.ABeanTest$APlus.\u003cclinit\u003e())\n  end static void \u003cclinit\u003e()\n\n  void \u003cinit\u003e():\n                    ALOAD_0     // com.isberg.articles.aop7.bean.ABeanTest$APlus\nthis   (line 125)\n                    INVOKESPECIAL java.lang.Object.\u003cinit\u003e ()V\n    constructor-execution(void\ncom.isberg.articles.aop7.bean.ABeanTest$APlus.\u003cinit\u003e())\n    |               RETURN\n    constructor-execution(void\ncom.isberg.articles.aop7.bean.ABeanTest$APlus.\u003cinit\u003e())\n  end void \u003cinit\u003e()\n\n  void ajc$declare_parents_1()   \norg.aspectj.weaver.MethodDeclarationLineNumber: 127:3678\n:\n                    RETURN   (line 127)\n  end void ajc$declare_parents_1()\n\n  public static String\najc$interMethod$com_isberg_articles_aop7_bean_ABeanTest$APlus$com_isberg_articles_aop7_bean_ABeanTest$CPlus$propertyName(com.isberg.articles.aop7.bean.ABeanTest$CPlus,\nString)    EffectiveSignatureAttribute(java.lang.String\ncom.isberg.articles.aop7.bean.ABeanTest$CPlus.propertyName(java.lang.String),\nmethod-execution)\n:\n    method-execution(java.lang.String\ncom.isberg.articles.aop7.bean.ABeanTest$CPlus.propertyName(java.lang.String))\n    |               ALOAD_0     // com.isberg.articles.aop7.bean.ABeanTest$CPlus\najc$this_   (line 132)\n    |               ALOAD_1     // java.lang.String methodName\n    |               INVOKESTATIC\ncom.isberg.articles.aop7.bean.ABean.ajc$interMethod$com_isberg_articles_aop7_bean_ABean$com_isberg_articles_aop7_bean_ABean$IBean$propertyName\n(Lcom/isberg/articles/aop7/bean/ABean$IBean;Ljava/lang/String;)Ljava/lang/String;\n    |               ASTORE_2\n    |               LDC \"something\"   (line 133)\n    |               ALOAD_2     // java.lang.String result\n    | method-call(boolean java.lang.String.equals(java.lang.Object))\n    | |             INVOKEVIRTUAL java.lang.String.equals (Ljava/lang/Object;)Z\n    | method-call(boolean java.lang.String.equals(java.lang.Object))\n    |               IFEQ L0\n    |               LDC \"a\"   (line 134)\n    |               ASTORE_2     // java.lang.String result\n    |           L0: ALOAD_2     // java.lang.String result   (line 136)\n    |               ARETURN\n    method-execution(java.lang.String\ncom.isberg.articles.aop7.bean.ABeanTest$CPlus.propertyName(java.lang.String))\n  end public static String\najc$interMethod$com_isberg_articles_aop7_bean_ABeanTest$APlus$com_isberg_articles_aop7_bean_ABeanTest$CPlus$propertyName(com.isberg.articles.aop7.bean.ABeanTest$CPlus,\nString)\n\n  public static String\najc$interMethodDispatch1$com_isberg_articles_aop7_bean_ABeanTest$APlus$com_isberg_articles_aop7_bean_ABeanTest$CPlus$propertyName(com.isberg.articles.aop7.bean.ABeanTest$CPlus,\nString)    EffectiveSignatureAttribute(java.lang.String\ncom.isberg.articles.aop7.bean.ABeanTest$CPlus.propertyName(java.lang.String),\nmethod-call)\n:\n                    ALOAD_0\n                    ALOAD_1\n                    INVOKEVIRTUAL\ncom.isberg.articles.aop7.bean.ABeanTest$CPlus.propertyName\n(Ljava/lang/String;)Ljava/lang/String;\n                    ARETURN\n  end public static String\najc$interMethodDispatch1$com_isberg_articles_aop7_bean_ABeanTest$APlus$com_isberg_articles_aop7_bean_ABeanTest$CPlus$propertyName(com.isberg.articles.aop7.bean.ABeanTest$CPlus,\nString)\n\n  public static com.isberg.articles.aop7.bean.ABeanTest$APlus aspectOf()   \norg.aspectj.weaver.AjAttribute$AjSynthetic@591171\n:\n                    GETSTATIC\ncom.isberg.articles.aop7.bean.ABeanTest$APlus.ajc$perSingletonInstance\nLcom/isberg/articles/aop7/bean/ABeanTest$APlus;\n                    IFNONNULL L0\n                    NEW org.aspectj.lang.NoAspectBoundException\n                    DUP\n                    LDC \"com_isberg_articles_aop7_bean_ABeanTest$APlus\"\n                    GETSTATIC\ncom.isberg.articles.aop7.bean.ABeanTest$APlus.ajc$initFailureCause\nLjava/lang/Throwable;\n                    INVOKESPECIAL org.aspectj.lang.NoAspectBoundException.\u003cinit\u003e\n(Ljava/lang/String;Ljava/lang/Throwable;)V\n                    ATHROW\n                L0: GETSTATIC\ncom.isberg.articles.aop7.bean.ABeanTest$APlus.ajc$perSingletonInstance\nLcom/isberg/articles/aop7/bean/ABeanTest$APlus;\n                    ARETURN\n  end public static com.isberg.articles.aop7.bean.ABeanTest$APlus aspectOf()\n\n  public static boolean hasAspect()   \norg.aspectj.weaver.AjAttribute$AjSynthetic@16e3eb3\n:\n                    GETSTATIC\ncom.isberg.articles.aop7.bean.ABeanTest$APlus.ajc$perSingletonInstance\nLcom/isberg/articles/aop7/bean/ABeanTest$APlus;\n                    IFNULL L0\n                    ICONST_1\n                    IRETURN\n                L0: ICONST_0\n                    IRETURN\n  end public static boolean hasAspect()\n\n  private static void ajc$postClinit()   \norg.aspectj.weaver.AjAttribute$AjSynthetic@d7cf62\n:\n                    NEW com.isberg.articles.aop7.bean.ABeanTest$APlus\n                    DUP\n                    INVOKESPECIAL\ncom.isberg.articles.aop7.bean.ABeanTest$APlus.\u003cinit\u003e ()V\n                    PUTSTATIC\ncom.isberg.articles.aop7.bean.ABeanTest$APlus.ajc$perSingletonInstance\nLcom/isberg/articles/aop7/bean/ABeanTest$APlus;\n                    RETURN\n  end private static void ajc$postClinit()\nend public class com.isberg.articles.aop7.bean.ABeanTest$APlus\n\nwhen matching pointcut ((withincode(@(Parallel) * *(..)) \u0026\u0026 call(void *(..))) \u0026\u0026\npercflow(com.isberg.articles.aop7.concurrent.ParallelMethodImpl on\nexecution(@(Parallel) * *(..))))\nwhen matching shadow method-call(boolean java.lang.String.equals(java.lang.Object))\nwhen weaving type com.isberg.articles.aop7.bean.ABeanTest$APlus\nwhen weaving aspects \nwhen weaving \nwhen batch building\nBuildConfig[c:\\home\\ws\\main-31\\.metadata\\.plugins\\org.eclipse.ajdt.core\\devworks-fall.generated.lst]\n#Files\u003d70",
    "for investigation prior to RC1",
    "fix checked in. waiting on build.",
    "fix available.  Wes, if you remember and still have the environment, can you try\nit out when AJDT gets updated (probably Monday?).",
    "I\u0027m unable to reproduce in AJDT 20051122132809.\n\nThere is the usual incremental issue that after code has been invalidated by something like rename, not all dependent code is wiped, so an illegal class seems to be constructed.  In this case, when running the class I get a VerifyError:\n----------------------------------\nException in thread \"main\" java.lang.VerifyError: (class: bugs/Bug115204, method: \u003cclinit\u003e signature: ()V) Stack size too large\n\tat bugs.Bug115204Class.main(Bug115204Class.java)\n----------------------------------\nI don\u0027t think it\u0027s related and I think it\u0027s already a bug.  \n\nBut just in case, here\u0027s the procedure and the code:\n\n- define all classes/aspects\n- rename the annotation class  from Annot to AnnotRenamed\n- run the main class\nRESULT: VerifyError above\n\nThe code:\n------------------------------------\npackage bugs;\n\npublic aspect Bug115204 {\n    before() : execution(@Annot void Bug115204Class.*(..)) {\n        System.out.println(\"before \" + thisJoinPoint);\n    }\n}\n------------------------------------\npackage bugs;\n\npublic class Bug115204Class {\n\n    @Annot()\n    public static void main(String[] args) {\n        System.out.println(\"Bug115204Class.main(String[])\");\n    }\n}\n\n------------------------------------\npackage bugs;\n\npublic @interface Annot {\n}\n\n------------------------------------ becomes\npackage bugs;\n\npublic @interface AnnotRenamed {\n}"
  ],
  "commentCreationDates": [
    "2005-11-05T11:03:26+01:00",
    "2005-11-10T16:16:20+01:00",
    "2005-11-18T10:33:47+01:00",
    "2005-11-18T12:08:00+01:00",
    "2005-11-23T03:55:05+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.aspectj.weaver.patterns.WildAnnotationTypePattern.matches",
          "source": "WildAnnotationTypePattern.java:61"
        },
        {
          "method": "org.aspectj.weaver.patterns.SignaturePattern.matchesAnnotations",
          "source": "SignaturePattern.java:321"
        },
        {
          "method": "org.aspectj.weaver.patterns.SignaturePattern.matchesExactly",
          "source": "SignaturePattern.java:169"
        },
        {
          "method": "org.aspectj.weaver.patterns.SignaturePattern.matches",
          "source": "SignaturePattern.java:131"
        },
        {
          "method": "org.aspectj.weaver.patterns.WithincodePointcut.matchInternal",
          "source": "WithincodePointcut.java:73"
        },
        {
          "method": "org.aspectj.weaver.patterns.Pointcut.match",
          "source": "Pointcut.java:143"
        },
        {
          "method": "org.aspectj.weaver.patterns.AndPointcut.matchInternal",
          "source": "AndPointcut.java:55"
        },
        {
          "method": "org.aspectj.weaver.patterns.Pointcut.match",
          "source": "Pointcut.java:143"
        },
        {
          "method": "org.aspectj.weaver.patterns.AndPointcut.matchInternal",
          "source": "AndPointcut.java:55"
        },
        {
          "method": "org.aspectj.weaver.patterns.Pointcut.match",
          "source": "Pointcut.java:143"
        },
        {
          "method": "org.aspectj.weaver.ShadowMunger.match",
          "source": "ShadowMunger.java:64"
        },
        {
          "method": "org.aspectj.weaver.Advice.match",
          "source": "Advice.java:109"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelAdvice.match",
          "source": "BcelAdvice.java:97"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelClassWeaver.match",
          "source": "BcelClassWeaver.java:1749"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelClassWeaver.matchInvokeInstruction",
          "source": "BcelClassWeaver.java:1736"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelClassWeaver.match",
          "source": "BcelClassWeaver.java:1533"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelClassWeaver.match",
          "source": "BcelClassWeaver.java:1359"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelClassWeaver.weave",
          "source": "BcelClassWeaver.java:382"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelClassWeaver.weave",
          "source": "BcelClassWeaver.java:98"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.weave",
          "source": "BcelWeaver.java:1478"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.weaveWithoutDump",
          "source": "BcelWeaver.java:1443"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.weaveAndNotify",
          "source": "BcelWeaver.java:1217"
        },
        {
          "method": "org.aspectj.weaver.bcel.BcelWeaver.weave",
          "source": "BcelWeaver.java:1021"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.weave",
          "source": "AjCompilerAdapter.java:300"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.afterCompiling",
          "source": "AjCompilerAdapter.java:178"
        },
        {
          "method": "org.aspectj.ajdt.internal.compiler.CompilerAdapter.ajc$afterReturning$org_aspectj_ajdt_internal_compiler_CompilerAdapter$2$f9cc9ca0",
          "source": "CompilerAdapter.aj:70"
        },
        {
          "method": "org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile",
          "source": "Compiler.java:367"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilation",
          "source": "AjBuildManager.java:759"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild",
          "source": "AjBuildManager.java:225"
        },
        {
          "method": "org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild",
          "source": "AjBuildManager.java:151"
        },
        {
          "method": "org.aspectj.ajde.internal.CompilerAdapter.compile",
          "source": "CompilerAdapter.java:122"
        },
        {
          "method": "org.aspectj.ajde.internal.AspectJBuildManager$CompilerThread.run",
          "source": "AspectJBuildManager.java:191"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "115204",
      "date": "2005-11-05T11:03:26+01:00",
      "product": "AspectJ",
      "component": "Compiler",
      "severity": "normal"
    },
    {
      "exceptionType": "java.lang.VerifyError",
      "message": "(class: bugs/Bug115204, method: \u003cclinit\u003e signature: ()V) Stack size too large",
      "elements": [
        {
          "method": "bugs.Bug115204Class.main",
          "source": "Bug115204Class.java"
        }
      ],
      "number": 1,
      "commentIndex": 4,
      "bugId": "115204",
      "date": "2005-11-23T03:55:05+01:00",
      "product": "AspectJ",
      "component": "Compiler",
      "severity": "normal"
    }
  ],
  "groupId": "115204",
  "bugId": "115204",
  "date": "2005-11-05T11:03:26+01:00",
  "product": "AspectJ",
  "component": "Compiler",
  "severity": "normal"
}