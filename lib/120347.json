{
  "comments": [
    "Java source completion crashed on me in Eclipse 3.2M3 running on Windows 200SP4. This is different from bug 118667. Matt Chapman reported there that my stacktrace deserved a bug entry of its own. Here it is.\n\nAfter this crash, java completion remains half broken until I restart Eclipse.\n\nHere is my stacktrace:\n\njava.lang.ClassCastException:\norg.eclipse.jdt.internal.compiler.ast.QualifiedNameReference\nat org.eclipse.jdt.internal.codeassist.CompletionEngine.findEnumConstant(CompletionEngine.java:1924)\nat org.eclipse.jdt.internal.codeassist.CompletionEngine.complete(CompletionEngine.java:741)\nat\norg.eclipse.jdt.internal.codeassist.CompletionEngine.complete(CompletionEngine.java:1667)\nat org.eclipse.jdt.internal.core.Openable.codeComplete(Openable.java:127)\nat\norg.eclipse.jdt.internal.core.CompilationUnit.codeComplete(CompilationUnit.java:290)\nat\norg.eclipse.jdt.internal.core.CompilationUnit.codeComplete(CompilationUnit.java:283)\nat\norg.eclipse.jdt.internal.ui.text.java.JavaCompletionProposalComputer.internalComputeCompletionProposals(JavaCompletionProposalComputer.java:211)\nat\norg.eclipse.jdt.internal.ui.text.java.JavaCompletionProposalComputer.computeCompletionProposals(JavaCompletionProposalComputer.java:191)\nat\norg.eclipse.jdt.internal.ui.text.java.CompletionProposalComputerDescriptor.computeCompletionProposals(CompletionProposalComputerDescriptor.java:278)\nat\norg.eclipse.jdt.internal.ui.text.java.CompletionProposalCategory.computeCompletionProposals(CompletionProposalCategory.java:248)\nat\norg.eclipse.jdt.internal.ui.text.java.ContentAssistProcessor.collectProposals(ContentAssistProcessor.java:158)\nat\norg.eclipse.jdt.internal.ui.text.java.ContentAssistProcessor.computeCompletionProposals(ContentAssistProcessor.java:143)\nat\norg.eclipse.jface.text.contentassist.ContentAssistant.computeCompletionProposals(ContentAssistant.java:1566)\nat\norg.eclipse.jface.text.contentassist.CompletionProposalPopup.computeProposals(CompletionProposalPopup.java:447)\nat\norg.eclipse.jface.text.contentassist.CompletionProposalPopup.access$15(CompletionProposalPopup.java:444)\nat\norg.eclipse.jface.text.contentassist.CompletionProposalPopup$2.run(CompletionProposalPopup.java:379)\nat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:69)\nat\norg.eclipse.jface.text.contentassist.CompletionProposalPopup.showProposals(CompletionProposalPopup.java:373)\nat\norg.eclipse.jface.text.contentassist.ContentAssistant.showPossibleCompletions(ContentAssistant.java:1414)\nat\norg.eclipse.jdt.internal.ui.javaeditor.CompilationUnitEditor$AdaptedSourceViewer.doOperation(CompilationUnitEditor.java:204)\nat\norg.eclipse.ui.texteditor.ContentAssistAction$1.run(ContentAssistAction.java:82)\nat org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:69)\nat\norg.eclipse.ui.texteditor.ContentAssistAction.run(ContentAssistAction.java:80)\nat org.eclipse.jface.action.Action.runWithEvent(Action.java:996)\nat org.eclipse.ui.commands.ActionHandler.execute(ActionHandler.java:182)\nat\norg.eclipse.ui.internal.handlers.LegacyHandlerWrapper.execute(LegacyHandlerWrapper.java:108)\nat org.eclipse.core.commands.Command.execute(Command.java:287)\nat\norg.eclipse.core.commands.ParameterizedCommand.execute(ParameterizedCommand.java:401)\nat\norg.eclipse.ui.internal.keys.WorkbenchKeyboard.executeCommand(WorkbenchKeyboard.java:459)\nat\norg.eclipse.ui.internal.keys.WorkbenchKeyboard.press(WorkbenchKeyboard.java:781)\nat\norg.eclipse.ui.internal.keys.WorkbenchKeyboard.processKeyEvent(WorkbenchKeyboard.java:828)\nat\norg.eclipse.ui.internal.keys.WorkbenchKeyboard.filterKeySequenceBindings(WorkbenchKeyboard.java:550)\nat\norg.eclipse.ui.internal.keys.WorkbenchKeyboard.access$3(WorkbenchKeyboard.java:493)\nat\norg.eclipse.ui.internal.keys.WorkbenchKeyboard$KeyDownFilter.handleEvent(WorkbenchKeyboard.java:117)\nat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\nat org.eclipse.swt.widgets.Display.filterEvent(Display.java:975)\nat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:895)\nat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:920)\nat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:905)\nat org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:933)\nat org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:929)\nat org.eclipse.swt.widgets.Widget.wmChar(Widget.java:1243)\nat org.eclipse.swt.widgets.Control.WM_CHAR(Control.java:3241)\nat org.eclipse.swt.widgets.Control.windowProc(Control.java:3142)\nat org.eclipse.swt.widgets.Display.windowProc(Display.java:3908)\nat org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)\nat org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:1703)\nat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2854)\nat org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1774)\nat org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1738)\nat org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:376)\nat org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:143)\nat org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:106)\nat\norg.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:226)\nat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:376)\nat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:165)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\nat java.lang.reflect.Method.invoke(Unknown Source)\nat org.eclipse.core.launcher.Main.invokeFramework(Main.java:338)\nat org.eclipse.core.launcher.Main.basicRun(Main.java:282)\nat org.eclipse.core.launcher.Main.run(Main.java:977)\nat org.eclipse.core.launcher.Main.main(Main.java:952)",
    "I can reproduce the bug in I20051212-0010 with\n\npublic class X {\n  void foo(E e) {\n    switch (e) {\n      case E.AAAA:\n      case AAA:\n        break;\n    }\n  }\n}\n\nenum E {\n  AAAA,\n  AAAB\n}\n\nDo you reproduce the bug with a similar test case ?",
    "(In reply to comment #1)\n\u003e \n\u003e Do you reproduce the bug with a similar test case ?\n\u003e \n\nI tried your test case and I could crash the completion subsystem too. I first defined the enum, then the class X. When trying to complete after typeing \"case A\" on the line \"case AAA:\", I got the crash. \n\nResult: a dialog with the following:\n\nContent Assist: Disabling the \"org.eclipse.jdt.ui.JavaNoTypeCompletionProposalComputer\" (org.eclipse.jdt.ui.JavaNoTypeCompletionProposalComputer) extension to the \"javaCompletionProposalComputer\" extension point. Reason: The extension has thrown a runtime exception.\n\nThis is also the header I get in the Error Log file before the stacktrace. Stack  trace the same as I reported already.",
    "We will improve the UI side: we should not disable the processor automatically but give users a hint how to disable it manually. They can then choose to do so themselves.",
    "(In reply to comment #3)\n\u003e We will improve the UI side: we should not disable the processor automatically\n\u003e but give users a hint how to disable it manually. They can then choose to do so\n\u003e themselves.\n\nDaniel, I don\u0027t understand the proposed improvement. Why would we want to disable the processors as a user? I want Java completion to work in all circumstances for a Java construct, whether it is Java 1.4 or Java 5. Could you elaborate?\n\nRingo\n",
    "Sure you want it to work 100% all times - no question. As you can see in this PR programming errors do happen ;-). Up to now the code assist UI side disables code assist processors that crash automatically or take up to much time to complete and only calls the remaining completion processors. That\u0027s why you have to restart to enable the Java completion processor again. In the future we will notify you about the \"bad\" processor and leave you the choice to disable it manually or continue - accepting that you might get the error dialog again later.",
    "This is indeed an improvement over the current situation. However, who will be looking for the root cause of the bad completion processor? David Audel posted a reproducible case, so this shouldn\u0027t be too hard to nail down, right?",
    "The root cause is this PR and is in JDT Core. I just added comment 3 FYI.",
    "Daniel, now I\u0027m really puzzled. How on earth will improving the UI side fix the ClassCastException I reported?\n\nIf I understand correctly, the improvement to the UI side will give a user the option to either keep the faulty completion processor running or disable it when it crashes. Still, even if I have the option to let it running, I will encounter the crash again if I type code that resembles the reproducible case, no?",
    "JDT Core \u003d\u003d non-UI code\nJDT UI \u003d\u003d UI code\n\nThis PR is in JDT Core and is about the CCE and has nothing to do with the improvements on the UI side that I posted as additional info in comment 3. Comment 3 only tells what JDT UI will do on the UI side to ease the pain if bugs like this happen.",
    "\n\n*** This bug has been marked as a duplicate of 127323 ***"
  ],
  "commentCreationDates": [
    "2005-12-12T09:37:16+01:00",
    "2005-12-12T15:03:45+01:00",
    "2005-12-12T15:12:37+01:00",
    "2005-12-12T15:32:41+01:00",
    "2005-12-13T07:10:00+01:00",
    "2005-12-13T07:20:13+01:00",
    "2005-12-13T07:27:59+01:00",
    "2005-12-13T07:55:35+01:00",
    "2005-12-13T08:17:26+01:00",
    "2005-12-13T08:24:24+01:00",
    "2006-02-28T14:39:33+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ClassCastException",
      "message": "org.eclipse.jdt.internal.compiler.ast.QualifiedNameReference",
      "elements": [
        {
          "method": "org.eclipse.jdt.internal.codeassist.CompletionEngine.findEnumConstant",
          "source": "CompletionEngine.java:1924"
        },
        {
          "method": "org.eclipse.jdt.internal.codeassist.CompletionEngine.complete",
          "source": "CompletionEngine.java:741"
        },
        {
          "method": "org.eclipse.jdt.internal.codeassist.CompletionEngine.complete",
          "source": "CompletionEngine.java:1667"
        },
        {
          "method": "org.eclipse.jdt.internal.core.Openable.codeComplete",
          "source": "Openable.java:127"
        },
        {
          "method": "org.eclipse.jdt.internal.core.CompilationUnit.codeComplete",
          "source": "CompilationUnit.java:290"
        },
        {
          "method": "org.eclipse.jdt.internal.core.CompilationUnit.codeComplete",
          "source": "CompilationUnit.java:283"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.text.java.JavaCompletionProposalComputer.internalComputeCompletionProposals",
          "source": "JavaCompletionProposalComputer.java:211"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.text.java.JavaCompletionProposalComputer.computeCompletionProposals",
          "source": "JavaCompletionProposalComputer.java:191"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.text.java.CompletionProposalComputerDescriptor.computeCompletionProposals",
          "source": "CompletionProposalComputerDescriptor.java:278"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.text.java.CompletionProposalCategory.computeCompletionProposals",
          "source": "CompletionProposalCategory.java:248"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.text.java.ContentAssistProcessor.collectProposals",
          "source": "ContentAssistProcessor.java:158"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.text.java.ContentAssistProcessor.computeCompletionProposals",
          "source": "ContentAssistProcessor.java:143"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.ContentAssistant.computeCompletionProposals",
          "source": "ContentAssistant.java:1566"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.CompletionProposalPopup.computeProposals",
          "source": "CompletionProposalPopup.java:447"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.CompletionProposalPopup.access$15",
          "source": "CompletionProposalPopup.java:444"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.CompletionProposalPopup$2.run",
          "source": "CompletionProposalPopup.java:379"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:69"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.CompletionProposalPopup.showProposals",
          "source": "CompletionProposalPopup.java:373"
        },
        {
          "method": "org.eclipse.jface.text.contentassist.ContentAssistant.showPossibleCompletions",
          "source": "ContentAssistant.java:1414"
        },
        {
          "method": "org.eclipse.jdt.internal.ui.javaeditor.CompilationUnitEditor$AdaptedSourceViewer.doOperation",
          "source": "CompilationUnitEditor.java:204"
        },
        {
          "method": "org.eclipse.ui.texteditor.ContentAssistAction$1.run",
          "source": "ContentAssistAction.java:82"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:69"
        },
        {
          "method": "org.eclipse.ui.texteditor.ContentAssistAction.run",
          "source": "ContentAssistAction.java:80"
        },
        {
          "method": "org.eclipse.jface.action.Action.runWithEvent",
          "source": "Action.java:996"
        },
        {
          "method": "org.eclipse.ui.commands.ActionHandler.execute",
          "source": "ActionHandler.java:182"
        },
        {
          "method": "org.eclipse.ui.internal.handlers.LegacyHandlerWrapper.execute",
          "source": "LegacyHandlerWrapper.java:108"
        },
        {
          "method": "org.eclipse.core.commands.Command.execute",
          "source": "Command.java:287"
        },
        {
          "method": "org.eclipse.core.commands.ParameterizedCommand.execute",
          "source": "ParameterizedCommand.java:401"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.executeCommand",
          "source": "WorkbenchKeyboard.java:459"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.press",
          "source": "WorkbenchKeyboard.java:781"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.processKeyEvent",
          "source": "WorkbenchKeyboard.java:828"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.filterKeySequenceBindings",
          "source": "WorkbenchKeyboard.java:550"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard.access$3",
          "source": "WorkbenchKeyboard.java:493"
        },
        {
          "method": "org.eclipse.ui.internal.keys.WorkbenchKeyboard$KeyDownFilter.handleEvent",
          "source": "WorkbenchKeyboard.java:117"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.filterEvent",
          "source": "Display.java:975"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:895"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:920"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:905"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendKeyEvent",
          "source": "Widget.java:933"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendKeyEvent",
          "source": "Widget.java:929"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.wmChar",
          "source": "Widget.java:1243"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.WM_CHAR",
          "source": "Control.java:3241"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3142"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:3908"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessage",
          "source": "OS.java:1703"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:2854"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1774"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:1738"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:376"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:143"
        },
        {
          "method": "org.eclipse.ui.internal.ide.IDEApplication.run",
          "source": "IDEApplication.java:106"
        },
        {
          "method": "org.eclipse.core.internal.runtime.PlatformActivator$1.run",
          "source": "PlatformActivator.java:226"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:376"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:165"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Unknown Source"
        },
        {
          "method": "org.eclipse.core.launcher.Main.invokeFramework",
          "source": "Main.java:338"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:282"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:977"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:952"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "120347",
      "duplicateId": "127323",
      "date": "2005-12-12T09:37:16+01:00",
      "product": "JDT",
      "component": "Core",
      "severity": "major"
    }
  ],
  "groupId": "127323",
  "bugId": "120347",
  "duplicateId": "127323",
  "date": "2005-12-12T09:37:16+01:00",
  "product": "JDT",
  "component": "Core",
  "severity": "major"
}