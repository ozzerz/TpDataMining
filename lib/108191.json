{
  "comments": [
    "If I try to install a plugin into the eclipse installatation directory while I don\u0027t have write permission in \nthis directory, Update gives me a popup dialog with message \n\"org.eclipse.update.internal.core.SiteFilePackedPluginContentConsumer\". This seems to be the \ngetMessage() of a ClassCastException, since the Error Log shows:\n\njava.lang.ClassCastException: org.eclipse.update.internal.core.SiteFilePackedPluginContentConsumer\nat org.eclipse.update.internal.core.SiteFileContentConsumer.abort(SiteFileContentConsumer.java:209)\nat org.eclipse.update.internal.core.FeatureExecutableContentConsumer.abort\n(FeatureExecutableContentConsumer.java:152)\nat org.eclipse.update.core.Feature.install(Feature.java:516)\nat org.eclipse.update.internal.core.SiteFile.install(SiteFile.java:74)\nat org.eclipse.update.internal.core.ConfiguredSite.install(ConfiguredSite.java:122)\nat org.eclipse.update.internal.core.ConfiguredSite.install(ConfiguredSite.java:86)\nat org.eclipse.update.internal.operations.InstallOperation.execute(InstallOperation.java:72)\nat org.eclipse.update.internal.operations.BatchInstallOperation.execute(BatchInstallOperation.java:84)\nat org.eclipse.update.internal.ui.wizards.InstallWizard2.install(InstallWizard2.java:373)\nat org.eclipse.update.internal.ui.wizards.InstallWizard2.access$1(InstallWizard2.java:370)\nat org.eclipse.update.internal.ui.wizards.InstallWizard2$2.run(InstallWizard2.java:465)\nat org.eclipse.jface.operation.ModalContext$ModalContextThread.run(ModalContext.java:113)\n\nTwo questions:\n- Should a ClassCastException occur or is this a bug?\n- If a user does not have write permission in the target directory, could Eclipse give a more meaningful \nmessage?",
    "I was not able to reproduce this behaviour on Windows or Linux (haven\u0027t got a \nMac). On Linux, the error message is about write permissions.\n\nHowever, it is clearly visible from the code what goes wrong, so I fixed at \nleast the ClassCastException.\n\nI attached a test case that exposes the bug and a patch with a fix. I was not\nsure in which package the test case should go, so I stuck with the common\npractice to put it into the same package where the tested class is. The test\nwill become unnecessary once we switch to Java 5, where problems like this are\nchecked by the compiler already. Depending on when that will be, we won\u0027t\nprobably need it in the test suite.",
    "Created an attachment (id\u003d29821)\nFixed type problems for internal data structure\n",
    "Created an attachment (id\u003d29822)\ntest case that provokes the reported ClassCastException\n",
    "*** Bug 122930 has been marked as a duplicate of this bug. ***",
    "Hi\n\nThis problem is caused when code tries to write to a installation directory to which the user does not have write permission. I am writing my own automatic update code and it seems that the the ConfiguredSite.isUpdatable() is not correctly detecting the directory to be read only. I tried the following:\n\n\u003cpsuedo\u003e\n\nConfiguredSite targetSite \u003d the installation site;\n\nSite tSite \u003d (Site) targetSite.getSite();\nif (tSite.isReadOnly()) {\n    logger.log(Level.INFO, \"The site is read only\");\n} else {\n    logger.log(Level.INFO, \"The site is NOT read only\");\n}\n\t\t\n\t\t\t\nif (targetSite.isUpdatable()) {\n    logger.log(Level.INFO, \"Site is updatable\");\n} else {\n    logger.log(Level.INFO, \"Site is NOT updatable\");\n}\n\n\u003c/pseudo\u003e\n\nwith the install site being read only (Windows) and I get back the following in the logs:\n\n\"The site is NOT read only\" and \"Site is updatable\".\n\nWhen the InstallationJob executes then it fails with the ClassCastException.\n\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\nAs a workaround: I am trying to find a way to get the Location of the installation or plugin directory and grab an IFile instace so that I can test if is is read only or not. Hopefully something like this will work until this problem is resolved.",
    "As a workaround:\n\nPlatform.getInstallLocation().isReadOnly()\n\ncorrectly detects the installationLocation as read only if the permissions on the directory are deny write in Windows.\n\na simple conditional to avoid the installation job works. This is mainly for people writing their own update managers but it might provide a way to fix this bug."
  ],
  "commentCreationDates": [
    "2005-08-27T13:00:12+02:00",
    "2005-11-12T10:27:36+01:00",
    "2005-11-12T10:29:19+01:00",
    "2005-11-12T10:31:29+01:00",
    "2006-02-17T14:04:10+01:00",
    "2006-12-27T20:11:23+01:00",
    "2006-12-27T21:05:23+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ClassCastException",
      "message": "org.eclipse.update.internal.core.SiteFilePackedPluginContentConsumer",
      "elements": [
        {
          "method": "org.eclipse.update.internal.core.SiteFileContentConsumer.abort",
          "source": "SiteFileContentConsumer.java:209"
        },
        {
          "method": "org.eclipse.update.internal.core.FeatureExecutableContentConsumer.abort",
          "source": "FeatureExecutableContentConsumer.java:152"
        },
        {
          "method": "org.eclipse.update.core.Feature.install",
          "source": "Feature.java:516"
        },
        {
          "method": "org.eclipse.update.internal.core.SiteFile.install",
          "source": "SiteFile.java:74"
        },
        {
          "method": "org.eclipse.update.internal.core.ConfiguredSite.install",
          "source": "ConfiguredSite.java:122"
        },
        {
          "method": "org.eclipse.update.internal.core.ConfiguredSite.install",
          "source": "ConfiguredSite.java:86"
        },
        {
          "method": "org.eclipse.update.internal.operations.InstallOperation.execute",
          "source": "InstallOperation.java:72"
        },
        {
          "method": "org.eclipse.update.internal.operations.BatchInstallOperation.execute",
          "source": "BatchInstallOperation.java:84"
        },
        {
          "method": "org.eclipse.update.internal.ui.wizards.InstallWizard2.install",
          "source": "InstallWizard2.java:373"
        },
        {
          "method": "org.eclipse.update.internal.ui.wizards.InstallWizard2.access$1",
          "source": "InstallWizard2.java:370"
        },
        {
          "method": "org.eclipse.update.internal.ui.wizards.InstallWizard2$2.run",
          "source": "InstallWizard2.java:465"
        },
        {
          "method": "org.eclipse.jface.operation.ModalContext$ModalContextThread.run",
          "source": "ModalContext.java:113"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "108191",
      "date": "2005-08-27T13:00:12+02:00",
      "product": "Platform",
      "component": "Update",
      "severity": "normal"
    }
  ],
  "groupId": "108191",
  "bugId": "108191",
  "date": "2005-08-27T13:00:12+02:00",
  "product": "Platform",
  "component": "Update",
  "severity": "normal"
}