{
  "comments": [
    "Build ID: I20070625-1500\n\nOk, I\u0027ve not been able to reproduce this bug always. Usually it just happens after having Eclipse open for quite some time (1-2 days), and as I use many plugins I don\u0027t know which plugin could be actually making this happen... I\u0027ve been able to see it in a debug session (some details at: http://pydev.blogspot.com/2007/09/debugging-eclipse.html) but couldn\u0027t get to the actual point of the bug (but got close to it).\n\nStill, I can explain the bug and a theoretical resolution...\n\nWhat I know is that the problem appears to be that in org.eclipse.ui.internal.Workbench the method busyClose(final boolean force) calls a shutdown() after the UI is disposed and clients may raise exceptions within that call (this had happened to me previously within a fixed bug in pydev at: https://bugs.eclipse.org/bugs/show_bug.cgi?id\u003d186890). \n\nWhen debugging I couldn\u0027t see what was the exact line within the shutdown() method that had thrown an exception, but it was before calling the stop() method in plugins... and as the shutdown() had an exception, the runEventLoop \u003d false; was never actually called and the process was kept alive.\n\nAlso, this exception wasn\u0027t printed to anywhere (I don\u0027t know why it doesn\u0027t appear in my .log, but I guess it may be related to which services were already finished or not).\n\nSo, this could be (probably is) a defective plugin I have installed, but I think that the platform should be able to shut down \u0027gracefully\u0027 even if a client throws some exception at that point... \n\nWhat\u0027s more annoying in this is that the UI closes but the plugins don\u0027t have their stop() called, so, my perspectives are set to something that happened a long time ago.",
    "Ok, I\u0027ve found the error in a plug-in... basically it happens when going into\n\nWorkbenchWindow.hardClose(): line 1580\n\n// Bring down all of the services.\nserviceLocator.dispose(); \u003c-- will throw exception\n\nThe stack trace is below (so, I\u0027ll stop using that plugin and it \u0027should\u0027 work -- if that was the only plugin with that error... so, it should be easier to fix it with that trace).\n\nDo you think it could be available for 3.3.1? (at least having a try..except where it\u0027s needed and logged correctly instead of stopping the shutdown process).\n\n\n---------------------------- Stack trace: -----------------------------\n\nProblems occurred when invoking code from plug-in: \"org.eclipse.ui.workbench\".\n\n\njava.lang.NullPointerException\n        at net.sf.lunar_eclipse.editing.AbstractAction.selectionChanged(AbstractAction.java:74)\n        at org.eclipse.ui.internal.handlers.ActionDelegateHandlerProxy.updateDelegate(ActionDelegateHandlerProxy.java:310)\n        at org.eclipse.ui.internal.handlers.ActionDelegateHandlerProxy.isEnabled(ActionDelegateHandlerProxy.java:467)\n        at org.eclipse.ui.internal.handlers.ActionDelegateHandlerProxy.isEnabled(ActionDelegateHandlerProxy.java:435)\n        at org.eclipse.core.commands.Command.isEnabled(Command.java:831)\n        at org.eclipse.core.commands.Command.setHandler(Command.java:938)\n        at org.eclipse.ui.internal.handlers.HandlerAuthority.updateCommand(HandlerAuthority.java:535)\n        at org.eclipse.ui.internal.handlers.HandlerAuthority.deactivateHandler(HandlerAuthority.java:256)\n        at org.eclipse.ui.internal.handlers.HandlerService.deactivateHandler(HandlerService.java:144)\n        at org.eclipse.ui.internal.handlers.HandlerService.deactivateHandlers(HandlerService.java:153)\n        at org.eclipse.ui.internal.handlers.SlaveHandlerService.dispose(SlaveHandlerService.java:219)\n        at org.eclipse.ui.internal.services.ServiceLocator.dispose(ServiceLocator.java:95)\n        at org.eclipse.ui.internal.WorkbenchWindow.hardClose(WorkbenchWindow.java:1580)\n        at org.eclipse.ui.internal.WorkbenchWindow.busyClose(WorkbenchWindow.java:699)\n        at org.eclipse.ui.internal.WorkbenchWindow.access$0(WorkbenchWindow.java:675)\n        at org.eclipse.ui.internal.WorkbenchWindow$2.run(WorkbenchWindow.java:790)\n        at org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:67)\n        at org.eclipse.ui.internal.WorkbenchWindow.close(WorkbenchWindow.java:788)\n        at org.eclipse.jface.window.WindowManager.close(WindowManager.java:109)\n        at org.eclipse.ui.internal.Workbench$15.run(Workbench.java:908)\n        at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37)\n        at org.eclipse.ui.internal.Workbench.busyClose(Workbench.java:905)\n        at org.eclipse.ui.internal.Workbench.access$15(Workbench.java:834)\n        at org.eclipse.ui.internal.Workbench$22.run(Workbench.java:1078)\n        at org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:67)\n        at org.eclipse.ui.internal.Workbench.close(Workbench.java:1076)\n        at org.eclipse.ui.internal.Workbench.close(Workbench.java:1048)\n        at org.eclipse.ui.internal.WorkbenchWindow.busyClose(WorkbenchWindow.java:696)\n        at org.eclipse.ui.internal.WorkbenchWindow.access$0(WorkbenchWindow.java:675)\n        at org.eclipse.ui.internal.WorkbenchWindow$2.run(WorkbenchWindow.java:790)\n        at org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:67)\n        at org.eclipse.ui.internal.WorkbenchWindow.close(WorkbenchWindow.java:788)\n        at org.eclipse.jface.window.Window.handleShellCloseEvent(Window.java:736)\n        at org.eclipse.jface.window.Window$3.shellClosed(Window.java:682)\n        at org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:91)\n        at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66)\n        at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:938)\n        at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:962)\n        at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:947)\n        at org.eclipse.swt.widgets.Decorations.closeWidget(Decorations.java:301)\n        at org.eclipse.swt.widgets.Decorations.WM_CLOSE(Decorations.java:1651)\n        at org.eclipse.swt.widgets.Control.windowProc(Control.java:3674)\n        at org.eclipse.swt.widgets.Canvas.windowProc(Canvas.java:291)\n        at org.eclipse.swt.widgets.Decorations.windowProc(Decorations.java:1584)\n        at org.eclipse.swt.widgets.Shell.windowProc(Shell.java:1753)\n        at org.eclipse.swt.widgets.Display.windowProc(Display.java:4351)\n        at org.eclipse.swt.internal.win32.OS.DefWindowProcW(Native Method)\n        at org.eclipse.swt.internal.win32.OS.DefWindowProc(OS.java:2259)\n        at org.eclipse.swt.widgets.Shell.callWindowProc(Shell.java:456)\n        at org.eclipse.swt.widgets.Control.windowProc(Control.java:3760)\n        at org.eclipse.swt.widgets.Canvas.windowProc(Canvas.java:291)\n        at org.eclipse.swt.widgets.Decorations.windowProc(Decorations.java:1584)\n        at org.eclipse.swt.widgets.Shell.windowProc(Shell.java:1753)\n        at org.eclipse.swt.widgets.Display.windowProc(Display.java:4351)\n        at org.eclipse.swt.internal.win32.OS.DefWindowProcW(Native Method)\n        at org.eclipse.swt.internal.win32.OS.DefWindowProc(OS.java:2259)\n        at org.eclipse.swt.widgets.Shell.callWindowProc(Shell.java:456)\n        at org.eclipse.swt.widgets.Control.windowProc(Control.java:3760)\n        at org.eclipse.swt.widgets.Canvas.windowProc(Canvas.java:291)\n        at org.eclipse.swt.widgets.Decorations.windowProc(Decorations.java:1584)\n        at org.eclipse.swt.widgets.Shell.windowProc(Shell.java:1753)\n        at org.eclipse.swt.widgets.Display.windowProc(Display.java:4351)\n        at org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)\n        at org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:2264)\n        at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3291)\n        at org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:2389)\n        at org.eclipse.ui.internal.Workbench.runUI(Workbench.java:2353)\n        at org.eclipse.ui.internal.Workbench.access$4(Workbench.java:2219)\n        at org.eclipse.ui.internal.Workbench$4.run(Workbench.java:466)\n        at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:289)\n        at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:461)\n        at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)\n        at org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:106)\n        at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:153)\n        at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:106)\n        at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:76)\n        at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:363)\n        at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:176)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:585)\n        at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:504)\n        at org.eclipse.equinox.launcher.Main.basicRun(Main.java:443)\n        at org.eclipse.equinox.launcher.Main.run(Main.java:1169)\n        at org.eclipse.equinox.launcher.Main.main(Main.java:1144)\n",
    "(In reply to comment #1)\n\u003e Do you think it could be available for 3.3.1? (at least having a try..except\n\u003e where it\u0027s needed and logged correctly instead of stopping the shutdown\n\u003e process).\n\nSorry but it is too late for 3.3.1."
  ],
  "commentCreationDates": [
    "2007-09-10T18:35:28+02:00",
    "2007-09-18T20:41:02+02:00",
    "2007-09-18T20:46:03+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "net.sf.lunar_eclipse.editing.AbstractAction.selectionChanged",
          "source": "AbstractAction.java:74"
        },
        {
          "method": "org.eclipse.ui.internal.handlers.ActionDelegateHandlerProxy.updateDelegate",
          "source": "ActionDelegateHandlerProxy.java:310"
        },
        {
          "method": "org.eclipse.ui.internal.handlers.ActionDelegateHandlerProxy.isEnabled",
          "source": "ActionDelegateHandlerProxy.java:467"
        },
        {
          "method": "org.eclipse.ui.internal.handlers.ActionDelegateHandlerProxy.isEnabled",
          "source": "ActionDelegateHandlerProxy.java:435"
        },
        {
          "method": "org.eclipse.core.commands.Command.isEnabled",
          "source": "Command.java:831"
        },
        {
          "method": "org.eclipse.core.commands.Command.setHandler",
          "source": "Command.java:938"
        },
        {
          "method": "org.eclipse.ui.internal.handlers.HandlerAuthority.updateCommand",
          "source": "HandlerAuthority.java:535"
        },
        {
          "method": "org.eclipse.ui.internal.handlers.HandlerAuthority.deactivateHandler",
          "source": "HandlerAuthority.java:256"
        },
        {
          "method": "org.eclipse.ui.internal.handlers.HandlerService.deactivateHandler",
          "source": "HandlerService.java:144"
        },
        {
          "method": "org.eclipse.ui.internal.handlers.HandlerService.deactivateHandlers",
          "source": "HandlerService.java:153"
        },
        {
          "method": "org.eclipse.ui.internal.handlers.SlaveHandlerService.dispose",
          "source": "SlaveHandlerService.java:219"
        },
        {
          "method": "org.eclipse.ui.internal.services.ServiceLocator.dispose",
          "source": "ServiceLocator.java:95"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchWindow.hardClose",
          "source": "WorkbenchWindow.java:1580"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchWindow.busyClose",
          "source": "WorkbenchWindow.java:699"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchWindow.access$0",
          "source": "WorkbenchWindow.java:675"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchWindow$2.run",
          "source": "WorkbenchWindow.java:790"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:67"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchWindow.close",
          "source": "WorkbenchWindow.java:788"
        },
        {
          "method": "org.eclipse.jface.window.WindowManager.close",
          "source": "WindowManager.java:109"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$15.run",
          "source": "Workbench.java:908"
        },
        {
          "method": "org.eclipse.core.runtime.SafeRunner.run",
          "source": "SafeRunner.java:37"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.busyClose",
          "source": "Workbench.java:905"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.access$15",
          "source": "Workbench.java:834"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$22.run",
          "source": "Workbench.java:1078"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:67"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.close",
          "source": "Workbench.java:1076"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.close",
          "source": "Workbench.java:1048"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchWindow.busyClose",
          "source": "WorkbenchWindow.java:696"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchWindow.access$0",
          "source": "WorkbenchWindow.java:675"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchWindow$2.run",
          "source": "WorkbenchWindow.java:790"
        },
        {
          "method": "org.eclipse.swt.custom.BusyIndicator.showWhile",
          "source": "BusyIndicator.java:67"
        },
        {
          "method": "org.eclipse.ui.internal.WorkbenchWindow.close",
          "source": "WorkbenchWindow.java:788"
        },
        {
          "method": "org.eclipse.jface.window.Window.handleShellCloseEvent",
          "source": "Window.java:736"
        },
        {
          "method": "org.eclipse.jface.window.Window$3.shellClosed",
          "source": "Window.java:682"
        },
        {
          "method": "org.eclipse.swt.widgets.TypedListener.handleEvent",
          "source": "TypedListener.java:91"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:66"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:938"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:962"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:947"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.closeWidget",
          "source": "Decorations.java:301"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.WM_CLOSE",
          "source": "Decorations.java:1651"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3674"
        },
        {
          "method": "org.eclipse.swt.widgets.Canvas.windowProc",
          "source": "Canvas.java:291"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.windowProc",
          "source": "Decorations.java:1584"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.windowProc",
          "source": "Shell.java:1753"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:4351"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DefWindowProcW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DefWindowProc",
          "source": "OS.java:2259"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.callWindowProc",
          "source": "Shell.java:456"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3760"
        },
        {
          "method": "org.eclipse.swt.widgets.Canvas.windowProc",
          "source": "Canvas.java:291"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.windowProc",
          "source": "Decorations.java:1584"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.windowProc",
          "source": "Shell.java:1753"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:4351"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DefWindowProcW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DefWindowProc",
          "source": "OS.java:2259"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.callWindowProc",
          "source": "Shell.java:456"
        },
        {
          "method": "org.eclipse.swt.widgets.Control.windowProc",
          "source": "Control.java:3760"
        },
        {
          "method": "org.eclipse.swt.widgets.Canvas.windowProc",
          "source": "Canvas.java:291"
        },
        {
          "method": "org.eclipse.swt.widgets.Decorations.windowProc",
          "source": "Decorations.java:1584"
        },
        {
          "method": "org.eclipse.swt.widgets.Shell.windowProc",
          "source": "Shell.java:1753"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.windowProc",
          "source": "Display.java:4351"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessageW",
          "source": "Native Method"
        },
        {
          "method": "org.eclipse.swt.internal.win32.OS.DispatchMessage",
          "source": "OS.java:2264"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:3291"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:2389"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runUI",
          "source": "Workbench.java:2353"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.access$4",
          "source": "Workbench.java:2219"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench$4.run",
          "source": "Workbench.java:466"
        },
        {
          "method": "org.eclipse.core.databinding.observable.Realm.runWithDefault",
          "source": "Realm.java:289"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.createAndRunWorkbench",
          "source": "Workbench.java:461"
        },
        {
          "method": "org.eclipse.ui.PlatformUI.createAndRunWorkbench",
          "source": "PlatformUI.java:149"
        },
        {
          "method": "org.eclipse.ui.internal.ide.application.IDEApplication.start",
          "source": "IDEApplication.java:106"
        },
        {
          "method": "org.eclipse.equinox.internal.app.EclipseAppHandle.run",
          "source": "EclipseAppHandle.java:153"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication",
          "source": "EclipseAppLauncher.java:106"
        },
        {
          "method": "org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start",
          "source": "EclipseAppLauncher.java:76"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:363"
        },
        {
          "method": "org.eclipse.core.runtime.adaptor.EclipseStarter.run",
          "source": "EclipseStarter.java:176"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:585"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.invokeFramework",
          "source": "Main.java:504"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.basicRun",
          "source": "Main.java:443"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.run",
          "source": "Main.java:1169"
        },
        {
          "method": "org.eclipse.equinox.launcher.Main.main",
          "source": "Main.java:1144"
        }
      ],
      "number": 0,
      "commentIndex": 1,
      "bugId": "202819",
      "date": "2007-09-18T20:41:02+02:00",
      "product": "Platform",
      "component": "UI",
      "severity": "major"
    }
  ],
  "groupId": "202819",
  "bugId": "202819",
  "date": "2007-09-10T18:35:28+02:00",
  "product": "Platform",
  "component": "UI",
  "severity": "major"
}