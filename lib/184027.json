{
  "comments": [
    "Working with the instruction pointer annotations for Bug 167426, a had this appear in the console of my host.\n\nException in thread \"Thread-17\" java.util.ConcurrentModificationException\n\tat java.util.HashMap$HashIterator.nextEntry(HashMap.java:793)\n\tat java.util.HashMap$KeyIterator.next(HashMap.java:827)\n\tat org.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator(AnnotationModel.java:553)\n\tat org.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator(AnnotationModel.java:531)\n\tat org.eclipse.jface.text.source.projection.ProjectionSummary.removeSummaries(ProjectionSummary.java:193)\n\tat org.eclipse.jface.text.source.projection.ProjectionSummary.internalUpdateSummaries(ProjectionSummary.java:166)\n\tat org.eclipse.jface.text.source.projection.ProjectionSummary.access$3(ProjectionSummary.java:148)\n\tat org.eclipse.jface.text.source.projection.ProjectionSummary$Summarizer.run(ProjectionSummary.java:70)\n\nI haven\u0027t been able to reproduce it.  I wonder if an annotation was added or removed while this projection summary job is being run.",
    "which build?\nwhich editor?",
    "I20070424-0930\n\nWe changed our instruction pointer annotation manager to remove annotations from the editors when they are closed or the input changes).  This code is not released to HEAD yet.  It appears that the API method is not synchronized correctly, as the removal can occur while another job (in this case the projection summary) is iterating through the annotations.\n\nIn AnnotationModel.removeAnnotation(Annotation, boolean), the firing of the event is synchronized, but the removal from the map is not.  Perhaps the whole method should be synchronized.\n\nI don\u0027t think this problem is dependent on the editor.  In addition, the problem probably existed before the changes for bug 167426.  However, we are cleaning up our annotations much more often with the new code, making it more likely that we will encounter the problem.",
    "To make that more clear, the API method I am referring to is IAnnotationModel.removeAnnotation()\n\nI have been able to reproduce a couple more times, but not consistently.  I am not sure when the projection summary job is run.",
    "Platform Text code is UI code. Only certified areas are allowed to be called in a non-UI thread which clients are typically not. Are you calling that code in a non-UI thread?",
    "See also: 69289.",
    "\n\n*** This bug has been marked as a duplicate of bug 69289 ***"
  ],
  "commentCreationDates": [
    "2007-04-25T16:52:11+02:00",
    "2007-04-25T16:54:32+02:00",
    "2007-04-25T17:16:06+02:00",
    "2007-04-25T17:18:49+02:00",
    "2007-04-25T17:22:15+02:00",
    "2007-04-25T17:24:08+02:00",
    "2007-04-25T17:31:36+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.util.ConcurrentModificationException",
      "elements": [
        {
          "method": "java.util.HashMap$HashIterator.nextEntry",
          "source": "HashMap.java:793"
        },
        {
          "method": "java.util.HashMap$KeyIterator.next",
          "source": "HashMap.java:827"
        },
        {
          "method": "org.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator",
          "source": "AnnotationModel.java:553"
        },
        {
          "method": "org.eclipse.jface.text.source.AnnotationModel.getAnnotationIterator",
          "source": "AnnotationModel.java:531"
        },
        {
          "method": "org.eclipse.jface.text.source.projection.ProjectionSummary.removeSummaries",
          "source": "ProjectionSummary.java:193"
        },
        {
          "method": "org.eclipse.jface.text.source.projection.ProjectionSummary.internalUpdateSummaries",
          "source": "ProjectionSummary.java:166"
        },
        {
          "method": "org.eclipse.jface.text.source.projection.ProjectionSummary.access$3",
          "source": "ProjectionSummary.java:148"
        },
        {
          "method": "org.eclipse.jface.text.source.projection.ProjectionSummary$Summarizer.run",
          "source": "ProjectionSummary.java:70"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "184027",
      "duplicateId": "69289",
      "date": "2007-04-25T16:52:11+02:00",
      "product": "Platform",
      "component": "Text",
      "severity": "normal"
    }
  ],
  "groupId": "69289",
  "bugId": "184027",
  "duplicateId": "69289",
  "date": "2007-04-25T16:52:11+02:00",
  "product": "Platform",
  "component": "Text",
  "severity": "normal"
}