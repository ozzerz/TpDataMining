{
  "comments": [
    "We have unit tests that utilise SDO (and hence EMF). Occasionally these unit tests fail with a ClassCastException thrown from the depths of EMF. Unfortunately all we get to see is the ClassCastException and the stack trace. For example:\n\nTestcase: testOpenContent2 took 0.044 sec\n        Caused an ERROR\nnull\njava.lang.ClassCastException\n        at org.eclipse.emf.ecore.util.FeatureMapUtil$EntryImpl.\u003cinit\u003e(FeatureMapUtil.java:142)\n        at org.eclipse.emf.ecore.util.FeatureMapUtil.createEntry(FeatureMapUtil.java:128)\n        at org.eclipse.emf.ecore.util.BasicFeatureMap.createEntry(BasicFeatureMap.java:65)\n        at org.eclipse.emf.ecore.util.BasicFeatureMap.add(BasicFeatureMap.java:1156)\n        at org.eclipse.emf.ecore.sdo.util.BasicESequence.add(BasicESequence.java:85)\n        at xsd.SimpleXSDTests.testOpenContent2(SimpleXSDTests.java:196)\n        at com.ibm.js.test.LoggingTestCase.runTest(LoggingTestCase.java:358)\n\nWe\u0027re unable to do much to investigate this (or, indeed, determine if the error is actually in our code or in EMF) due to the lack of any additional information about what exactly EMF is unhappy about.\n\nThe diagnostic information from EMF needs to be improved so that it is possible to debug problems without stepping\nthrough the code in Eclipse - in this case the error hasn\u0027t happened again, so it is not possible\nto determine the cause by rerunning in the debugger.\n\nxsd.SimpleXSDTests.testOpenContent2(SimpleXSDTests.java:196) is a call to \n   Sequence.add(Property, DataObject);\n(where Sequence, Property \u0026 DataObject are all in the commonj.sdo package)\n\n(Our expectation, based on the standard Java usage of ClassCastException, is to be told what the class the object actually has, and can deduce from the source code what class it needs to be - hence we would expect these pieces of information as a minimum).",
    "As part of the work for https://bugs.eclipse.org/bugs/show_bug.cgi?id\u003d121933 the exception was changed to provide the following details:\n\n        String valueClass \u003d value instanceof EObject ? ((EObject)value).eClass().getName() : value.getClass().getName();\n        throw \n          new ClassCastException\n            (\"The feature \u0027\" + eStructuralFeature.getName()  + \"\u0027s type \u0027\" + \n                eStructuralFeature.getEType().getName() + \"\u0027 does not permit a value of type \u0027\" + valueClass + \"\u0027\");\n\nSo I\u0027ll return this as a dup since it\u0027s already done.\n\nNote that the implementation of feature map entry has completely changed in 2.2 to greatly improve performance.  The class EStructuralFeatureImpl.AbstractFeatureMapEntry is used instead (and it has the same code as above).\n\n*** This bug has been marked as a duplicate of 121933 ***"
  ],
  "commentCreationDates": [
    "2006-06-02T13:31:08+02:00",
    "2006-06-02T15:11:52+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ClassCastException",
      "elements": [
        {
          "method": "org.eclipse.emf.ecore.util.FeatureMapUtil$EntryImpl.\u003cinit\u003e",
          "source": "FeatureMapUtil.java:142"
        },
        {
          "method": "org.eclipse.emf.ecore.util.FeatureMapUtil.createEntry",
          "source": "FeatureMapUtil.java:128"
        },
        {
          "method": "org.eclipse.emf.ecore.util.BasicFeatureMap.createEntry",
          "source": "BasicFeatureMap.java:65"
        },
        {
          "method": "org.eclipse.emf.ecore.util.BasicFeatureMap.add",
          "source": "BasicFeatureMap.java:1156"
        },
        {
          "method": "org.eclipse.emf.ecore.sdo.util.BasicESequence.add",
          "source": "BasicESequence.java:85"
        },
        {
          "method": "xsd.SimpleXSDTests.testOpenContent2",
          "source": "SimpleXSDTests.java:196"
        },
        {
          "method": "com.ibm.js.test.LoggingTestCase.runTest",
          "source": "LoggingTestCase.java:358"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "145040",
      "duplicateId": "121933",
      "date": "2006-06-02T13:31:08+02:00",
      "product": "EMF",
      "component": "Core",
      "severity": "enhancement"
    }
  ],
  "groupId": "121933",
  "bugId": "145040",
  "duplicateId": "121933",
  "date": "2006-06-02T13:31:08+02:00",
  "product": "EMF",
  "component": "Core",
  "severity": "enhancement"
}