{
  "comments": [
    "1. set the default JRE to J9\n2. launch the following program with the JDK 1.4.1\n\nimport java.util.HashMap;\npublic class TestEval {\n  public static void main(String[] args) {\n    HashMap hashmap\u003d new HashMap();\n    hashmap.put(new Object(), new Object());\n    System.out.println(\"test\");          // \u003c---- breakpoint here\n  }\n}\n\n3. when the breakpoint is hit, go in the variable view, expand hashmap-\u003etable\nand select the java.util.HashMap$Entry element.\n4. eval in the context of this element \u0027this.key\u0027\nA NullPointerException is thrown with the following stack trace in the log :\n\n\n!ENTRY org.eclipse.core.resources 1 4 May 23, 2002 09:44:17.463\n!MESSAGE Unhandled exception caught in event loop.\n!ENTRY org.eclipse.ui 4 0 May 23, 2002 09:44:17.466\n!MESSAGE java.lang.NullPointerException\n!STACK 0\njava.lang.NullPointerException\n        at\norg.eclipse.jdt.internal.debug.eval.ast.engine.SourceBasedSourceGenerator.buildCompilationUnit(SourceBasedSourceGenerator.java:387)\n        at\norg.eclipse.jdt.internal.debug.eval.ast.engine.SourceBasedSourceGenerator.endVisit(SourceBasedSourceGenerator.java:580)\n        at\norg.eclipse.jdt.core.dom.CompilationUnit.accept0(CompilationUnit.java:147)\n        at org.eclipse.jdt.core.dom.ASTNode.accept(ASTNode.java:1330)\n        at\norg.eclipse.jdt.internal.debug.eval.ast.engine.EvaluationSourceGenerator.createEvaluationSourceFromSource(EvaluationSourceGenerator.java:144)\n        at\norg.eclipse.jdt.internal.debug.eval.ast.engine.EvaluationSourceGenerator.getSource(EvaluationSourceGenerator.java:208)\n        at\norg.eclipse.jdt.internal.debug.eval.ast.engine.ASTEvaluationEngine.getCompiledExpression(ASTEvaluationEngine.java:233)\n        at\norg.eclipse.jdt.internal.debug.eval.ast.engine.ASTEvaluationEngine.evaluate(ASTEvaluationEngine.java:84)\n        at\norg.eclipse.jdt.internal.debug.ui.actions.EvaluateAction.run(EvaluateAction.java:235)\n        at\norg.eclipse.jdt.internal.debug.ui.actions.DisplayAction.run(DisplayAction.java:144)\n        at\norg.eclipse.jdt.internal.debug.ui.actions.EvaluateAction.run(EvaluateAction.java:502)\n        at org.eclipse.ui.internal.PluginAction.runWithEvent(PluginAction.java:210)\n        at\norg.eclipse.ui.internal.WWinPluginAction.runWithEvent(WWinPluginAction.java:171)\n        at\norg.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:407)\n        at\norg.eclipse.jface.action.ActionContributionItem.handleWidgetEvent(ActionContributionItem.java:361)\n        at\norg.eclipse.jface.action.ActionContributionItem.access$0(ActionContributionItem.java:352)\n        at\norg.eclipse.jface.action.ActionContributionItem$ActionListener.handleEvent(ActionContributionItem.java:47)\n        at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:75)\n        at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:815)\n        at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:1379)\n        at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:1223)\n        at org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1085)\n        at org.eclipse.ui.internal.Workbench.run(Workbench.java:1068)\n        at\norg.eclipse.core.internal.boot.InternalBootLoader.run(InternalBootLoader.java:739)\n        at org.eclipse.core.boot.BootLoader.run(BootLoader.java:462)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.eclipse.core.launcher.Main.basicRun(Main.java:200)\n        at org.eclipse.core.launcher.Main.run(Main.java:643)\n        at org.eclipse.core.launcher.Main.main(Main.java:476)\n\n\nThe evaluation engine ask to the VM some information  about the type in which\nthe evalution should be done, for guess where the source of the type is in the\ncompilation unit. The result of this guess is the number of a line which should\nbe a part of the type declaration.\nThe probleme in this case is the line number return is after the end of the file\n(or not in a type declaration), the evaluation engine cannot find the right type\nin the source and the offending variable is not correctly initialized.\n\nThis case should be managed.",
    "Fixed in EvaluationSourceGenerator and SourceBasedSourceGenerator.\n\nEvaluations are now more robust in the face of incorrect (mismatched) source. \nIf we fail to build good evaluation source from the given source, we try to \ngenerate source from the JDI information available. We fall back to the \nBinaryBasedSourceGenerator.",
    "Please verify.",
    "Logged bug# 18244 for code assist problem related to this bug. I still get an \nevaluation error:\n\nthis.key\n\tEvaluation failed. Reason(s):\nCannot find the field key for the object java.util.HashMap$Entry (id\u003d35)",
    "Re-opening - still works the same for me (J9 is build JRE, jdk1.4 is runtime \nJRE)",
    "I should have been more explicit. The fix here is for the NPE. The fact \nthat HashMap$Entry.key isn\u0027t resolved is a separate bug (it was assigned to \nme, but you closed it yesterday).\n\nThe problem there is that we\u0027re doing an evaluation in the context of an \nobject reference for an inner type and we\u0027re generating the source based on \nthe type\u0027s name, not it\u0027s signature. So in this case, the eval source looks \n(basically) like:\nEntry {\n  private Object key;\n  public ___eval() {\n    return this.key;\n  }\n}\n\nThe name of our generated class doesn\u0027t match the signature of the actual \ninner type.",
    "See my comments above. Please verify the NPE fix and reopen the \"cannot find \nfield\" bug if you\u0027d like us to take a look at it today.",
    "Verified. Will not re-open other bug for 2.0"
  ],
  "commentCreationDates": [
    "2002-05-23T17:13:00+02:00",
    "2002-05-29T22:27:32+02:00",
    "2002-05-29T22:28:32+02:00",
    "2002-05-29T23:07:37+02:00",
    "2002-05-30T02:22:57+02:00",
    "2002-05-30T14:30:20+02:00",
    "2002-05-30T14:32:06+02:00",
    "2002-05-30T20:22:53+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.NullPointerException",
      "elements": [
        {
          "method": "org.eclipse.jdt.internal.debug.eval.ast.engine.SourceBasedSourceGenerator.buildCompilationUnit",
          "source": "SourceBasedSourceGenerator.java:387"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.eval.ast.engine.SourceBasedSourceGenerator.endVisit",
          "source": "SourceBasedSourceGenerator.java:580"
        },
        {
          "method": "org.eclipse.jdt.core.dom.CompilationUnit.accept0",
          "source": "CompilationUnit.java:147"
        },
        {
          "method": "org.eclipse.jdt.core.dom.ASTNode.accept",
          "source": "ASTNode.java:1330"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.eval.ast.engine.EvaluationSourceGenerator.createEvaluationSourceFromSource",
          "source": "EvaluationSourceGenerator.java:144"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.eval.ast.engine.EvaluationSourceGenerator.getSource",
          "source": "EvaluationSourceGenerator.java:208"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.eval.ast.engine.ASTEvaluationEngine.getCompiledExpression",
          "source": "ASTEvaluationEngine.java:233"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.eval.ast.engine.ASTEvaluationEngine.evaluate",
          "source": "ASTEvaluationEngine.java:84"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.ui.actions.EvaluateAction.run",
          "source": "EvaluateAction.java:235"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.ui.actions.DisplayAction.run",
          "source": "DisplayAction.java:144"
        },
        {
          "method": "org.eclipse.jdt.internal.debug.ui.actions.EvaluateAction.run",
          "source": "EvaluateAction.java:502"
        },
        {
          "method": "org.eclipse.ui.internal.PluginAction.runWithEvent",
          "source": "PluginAction.java:210"
        },
        {
          "method": "org.eclipse.ui.internal.WWinPluginAction.runWithEvent",
          "source": "WWinPluginAction.java:171"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection",
          "source": "ActionContributionItem.java:407"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.handleWidgetEvent",
          "source": "ActionContributionItem.java:361"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem.access$0",
          "source": "ActionContributionItem.java:352"
        },
        {
          "method": "org.eclipse.jface.action.ActionContributionItem$ActionListener.handleEvent",
          "source": "ActionContributionItem.java:47"
        },
        {
          "method": "org.eclipse.swt.widgets.EventTable.sendEvent",
          "source": "EventTable.java:75"
        },
        {
          "method": "org.eclipse.swt.widgets.Widget.sendEvent",
          "source": "Widget.java:815"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.runDeferredEvents",
          "source": "Display.java:1379"
        },
        {
          "method": "org.eclipse.swt.widgets.Display.readAndDispatch",
          "source": "Display.java:1223"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.runEventLoop",
          "source": "Workbench.java:1085"
        },
        {
          "method": "org.eclipse.ui.internal.Workbench.run",
          "source": "Workbench.java:1068"
        },
        {
          "method": "org.eclipse.core.internal.boot.InternalBootLoader.run",
          "source": "InternalBootLoader.java:739"
        },
        {
          "method": "org.eclipse.core.boot.BootLoader.run",
          "source": "BootLoader.java:462"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke0",
          "source": "Native Method"
        },
        {
          "method": "sun.reflect.NativeMethodAccessorImpl.invoke",
          "source": "NativeMethodAccessorImpl.java:39"
        },
        {
          "method": "sun.reflect.DelegatingMethodAccessorImpl.invoke",
          "source": "DelegatingMethodAccessorImpl.java:25"
        },
        {
          "method": "java.lang.reflect.Method.invoke",
          "source": "Method.java:324"
        },
        {
          "method": "org.eclipse.core.launcher.Main.basicRun",
          "source": "Main.java:200"
        },
        {
          "method": "org.eclipse.core.launcher.Main.run",
          "source": "Main.java:643"
        },
        {
          "method": "org.eclipse.core.launcher.Main.main",
          "source": "Main.java:476"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "17348",
      "date": "2002-05-23T17:13:00+02:00",
      "product": "JDT",
      "component": "Debug",
      "severity": "normal"
    }
  ],
  "groupId": "17348",
  "bugId": "17348",
  "date": "2002-05-23T17:13:00+02:00",
  "product": "JDT",
  "component": "Debug",
  "severity": "normal"
}