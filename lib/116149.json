{
  "comments": [
    "wtp-sdk-I200511111814.zip\n\nmywebproj is ~800 file project.  If I publish, start server runtime in debugging\nmode.\n\nThen I edit a file from that web project, the save file operation takes too long\n(~7 seconds from a warmed up eclipse session), freezing the UI during this time.\n\nIf I stop the server runtime the problem goes away.\n\nAny slim chance of anything for M9 ?\n\n\nWith debuging enabled, I have :\n\norg.eclipse.wst.server.core RESOURCES 13/11/05 20:31.45.783 -\u003e-\nServerResourceChangeListener responding to resource change: 1 -\u003e-\norg.eclipse.wst.server.core FINEST    13/11/05 20:31.45.783 Loading project\npreferences: P/mywebproj\norg.eclipse.wst.server.core SEVERE    13/11/05 20:31.45.784 Could not load\npreferences:\n/home/dlm/workspace/.metadata/.plugins/org.eclipse.core.resources/.projects/mywebproj/org.eclipse.wst.server.core/.runtime\n(No such file or directory)\norg.eclipse.wst.server.core RESOURCES 13/11/05 20:31.45.784 Not a server\nproject: mywebproj\norg.eclipse.wst.server.core FINEST    13/11/05 20:31.45.784 \u003e\npublishHandleProjectChange P/mywebproj\norg.eclipse.wst.server.core FINEST    13/11/05 20:31.45.784 -\npublishHandleProjectChange\norg.eclipse.wst.server.core FINEST    13/11/05 20:31.45.785 \u003e\nhandleDeployableProjectChange() Tomcat v5.5 Server @ localhost\nModule[mywebproj,org.eclipse.jst.j2ee.server:mywebproj]\n\n// MASSIVE DELAY HERE, UI FREEZE\n\norg.eclipse.wst.server.core FINEST    13/11/05 20:31.52.742 \u003c\npublishHandleProjectChange\norg.eclipse.wst.server.core RESOURCES 13/11/05 20:31.52.742 -\u003c- Done\nServerResourceChangeListener responding to resource change -\u003c-\norg.eclipse.wst.server.core RESOURCES 13/11/05 20:31.53.101 -\u003e-\nServerResourceChangeListener responding to resource change: 1 -\u003e-\norg.eclipse.wst.server.core FINEST    13/11/05 20:31.53.102 Loading project\npreferences: P/mywebproj\norg.eclipse.wst.server.core SEVERE    13/11/05 20:31.53.102 Could not load\npreferences:\n/home/dlm/workspace/.metadata/.plugins/org.eclipse.core.resources/.projects/mywebproj/org.eclipse.wst.server.core/.runtime\n(No such file or directory)\norg.eclipse.wst.server.core RESOURCES 13/11/05 20:31.53.103 Not a server\nproject: mywebproj\norg.eclipse.wst.server.core FINEST    13/11/05 20:31.53.103 \u003e\npublishHandleProjectChange P/mywebproj\norg.eclipse.wst.server.core FINEST    13/11/05 20:31.53.103 -\npublishHandleProjectChange\norg.eclipse.wst.server.core FINEST    13/11/05 20:31.53.104 \u003e\nhandleDeployableProjectChange() Tomcat v5.5 Server @ localhost\nModule[mywebproj,org.eclipse.jst.j2ee.server:mywebproj]\norg.eclipse.wst.server.core FINEST    13/11/05 20:32.00.205 \u003c\npublishHandleProjectChange\norg.eclipse.wst.server.core RESOURCES 13/11/05 20:32.00.206 -\u003c- Done\nServerResourceChangeListener responding to resource change -\u003c-",
    "Sorry thats wrong.  I have to delete the web-app module from the server runtime\nto stop the delay.  Just having the server runtime with the web application\nmodule added is enough to cause the delay.\n",
    "Found the problem. I am using the members() method on the module to check\nwhether any of the resources have changed that need to be published to the\nserver. I then update the server publish status accordingly or kick off a\nbackground publish.\n\nAdding in a few more trace statements, I\u0027ve found that 99% of the time is being\nspent in a single call to the members() method of\norg.eclipse.jst.j2ee.internal.deployables.J2EEFlexProjDeployable. There are\nseveral improvements that can be made to this method now that the J2EE project\nstructure consists of just a couple source root directories instead of the\nunstructured projects that were possible before.\n\nThe bottom limit for this method is about 150ms (the amount of time it takes to\nget the root source folders directly), and we\u0027ll have to see whether that is\nperformant enough. I\u0027ll investigate to see if I can get it down in this range\ninstead of the many seconds it is taking now.",
    "Created an attachment (id\u003d30358)\nJ2EEFlexProjectDeployable patch\n\n",
    "The server tools framework needs to call the members() method on project module delegates when changes occur in a project, so that it can determine if the project is in sync on the server. In the future this should probably be done on a separate Job, but in either case the members() methods needs to perform reasonably well.\n\nWith a sample Web project with 1500 files, the members() method on J2EEFlexProjectDeployable is currently taking about 2-2.5s to return. Most of this appears to be taken up in complex code from when the J2EE supported much more complex structures. I rewrote the method from scratch (see patch), and it now takes 200-250ms, a 10x improvement. This solves the UI hang on resource changes, and also makes publishing work 10x-30x faster (members() isn\u0027t cached yet, so in some cases it is still called several times during publishing). It is also simpler and less code, so it should be easier to maintain in the future.\n\nSince jst.j2ee is not my component, I\u0027ve attached the patch to this bug. You don\u0027t have to use it if you see any issues with it or you can find similar performance improvements elsewhere :). Please let me know if you have any questions or you want me to check in the patch directly.",
    "I released to HEAD - we\u0027ll do some more testing tomorrow",
    "Will be in todays driver",
    "*** Bug 117533 has been marked as a duplicate of this bug. ***",
    "I\u0027ve just got to testing this... no UI freeze, publish operation on same project seems zippey enough for me but....\n\n\norg.eclipse.wst.server.core SEVERE    24/11/05 21:19.39.008 Task failed\norg.eclipse.core.runtime.CoreException[0]: java.util.zip.ZipException: duplicate entry: net/netbauds/catalina/mbean/mbeans-descriptor.xml\n        at java.util.zip.ZipOutputStream.putNextEntry(ZipOutputStream.java:163)\n        at org.eclipse.jst.server.core.PublishUtil.addZipEntries(PublishUtil.java:325)\n        at org.eclipse.jst.server.core.PublishUtil.addZipEntries(PublishUtil.java:317)\n        at org.eclipse.jst.server.core.PublishUtil.addZipEntries(PublishUtil.java:317)\n        at org.eclipse.jst.server.core.PublishUtil.addZipEntries(PublishUtil.java:317)\n        at org.eclipse.jst.server.core.PublishUtil.addZipEntries(PublishUtil.java:317)\n        at org.eclipse.jst.server.core.PublishUtil.createZipFile(PublishUtil.java:302)\n        at org.eclipse.jst.server.tomcat.core.internal.PublishOperation2.publishJar(PublishOperation2.java:90)\n        at org.eclipse.jst.server.tomcat.core.internal.PublishOperation2.execute(PublishOperation2.java:51)\n...SNIP....\n\n\nThis results in an exception error during publishing.\n\n\nThis duplicate entry problem smells like exactly the same problem reating to bug reports bug #115190 and recently bug #116253 but I\u0027ve not proof the root cause is related.\n\n\nI presume someone has already fileds a bug report for this new problem ?\n",
    "The new problem looks like bug 117956. Any chance that net/netbauds/catalina/mbean/mbeans-descriptor.xml is in a Java utility project?",
    "Yes the file is from inside a J2EE Utility JAR project.\n"
  ],
  "commentCreationDates": [
    "2005-11-13T20:40:09+01:00",
    "2005-11-13T20:52:31+01:00",
    "2005-11-14T02:08:12+01:00",
    "2005-11-22T03:42:21+01:00",
    "2005-11-22T03:59:16+01:00",
    "2005-11-22T05:58:52+01:00",
    "2005-11-22T16:06:38+01:00",
    "2005-11-22T18:24:39+01:00",
    "2005-11-24T21:31:25+01:00",
    "2005-11-24T21:42:03+01:00",
    "2005-11-24T22:40:40+01:00"
  ],
  "traces": [
    {
      "exceptionType": "java.util.zip.ZipException",
      "message": "duplicate entry: net/netbauds/catalina/mbean/mbeans-descriptor.xml",
      "elements": [
        {
          "method": "java.util.zip.ZipOutputStream.putNextEntry",
          "source": "ZipOutputStream.java:163"
        },
        {
          "method": "org.eclipse.jst.server.core.PublishUtil.addZipEntries",
          "source": "PublishUtil.java:325"
        },
        {
          "method": "org.eclipse.jst.server.core.PublishUtil.addZipEntries",
          "source": "PublishUtil.java:317"
        },
        {
          "method": "org.eclipse.jst.server.core.PublishUtil.addZipEntries",
          "source": "PublishUtil.java:317"
        },
        {
          "method": "org.eclipse.jst.server.core.PublishUtil.addZipEntries",
          "source": "PublishUtil.java:317"
        },
        {
          "method": "org.eclipse.jst.server.core.PublishUtil.addZipEntries",
          "source": "PublishUtil.java:317"
        },
        {
          "method": "org.eclipse.jst.server.core.PublishUtil.createZipFile",
          "source": "PublishUtil.java:302"
        },
        {
          "method": "org.eclipse.jst.server.tomcat.core.internal.PublishOperation2.publishJar",
          "source": "PublishOperation2.java:90"
        },
        {
          "method": "org.eclipse.jst.server.tomcat.core.internal.PublishOperation2.execute",
          "source": "PublishOperation2.java:51"
        }
      ],
      "number": 0,
      "commentIndex": 8,
      "bugId": "116149",
      "date": "2005-11-24T21:31:25+01:00",
      "product": "Web Tools",
      "component": "jst.j2ee",
      "severity": "major"
    }
  ],
  "groupId": "116149",
  "bugId": "116149",
  "date": "2005-11-13T20:40:09+01:00",
  "product": "Web Tools",
  "component": "jst.j2ee",
  "severity": "major"
}