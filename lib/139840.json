{
  "comments": [
    "Use example files from bug 98630#c6\n\nRun Validation on the files.  You get the following exception:\n!ENTRY org.eclipse.wst.validation 4 0 2006-05-02 16:57:59.542\n!MESSAGE \n!STACK 0\njava.lang.ClassCastException: org.eclipse.jst.jsp.css.core.internal.document.JSPedCSSModelImpl\n\tat org.eclipse.jst.jsp.core.internal.validation.JSPJavaValidator.validateFile(JSPJavaValidator.java:40)\n\tat org.eclipse.jst.jsp.core.internal.validation.JSPValidator.validate(JSPValidator.java:155)\n\tat org.eclipse.jst.jsp.core.internal.validation.JSPValidator.validateInJob(JSPValidator.java:351)\n\tat org.eclipse.wst.validation.internal.operations.ValidatorJob.run(ValidatorJob.java:70)\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:58)",
    "Created an attachment (id\u003d40127)\nfixForValidators.patch\n\nsuggested patch on jsp.core from Hoshiura-san",
    "I looked over the patch and noticed this check:\nif (!contentTypeJSP.getId().equals(desc.getContentType().getId()))\n  don\u0027t validate/search\n\nThat\u0027s a valid check because this means any jsp-related content type will no longer get validation/search for free.  While css-jsp may not want validation/search, another content type, like jsf, may want it.\n\nAn alternative fix/workaround may be for css-jsp to provide their own \"validator\"  This way way, their validator could run instead of ours.\n\nMeanwhile, I\u0027ll look into where our validator/search is assuming IDOMModel, and we should add some checks to not always assume that.",
    "Okay, I found 3 places where IStructuredModel was being directly typecasted to IDOMModel.\n\njsp.core\n-JSPSearchDocument\n-JSPJavaValidator\n\njsp.ui\n-JSPJavaSelectionProvider\n\nThe fix is in each of the cases, instead of directly typecasting, first do an instanceof check to see if model is really IDOMModel.\n\nThis seems to fix the ClassCastException problem.  (I was actually only able to get the one in JSPJavaValidator to surface)\n\nThe one downside of this if is that searching and validation will be enabled and ran on css jsp files.  But IDOMModel is required pretty early on in the validation/search process, so the validation/search is cancelled pretty quickly (and by cancelled, I just mean validate/search \"returns\")",
    "Created an attachment (id\u003d40323)\norg.eclipse.jst.jsp.core.patch\n\n",
    "Created an attachment (id\u003d40324)\norg.eclipse.jst.jsp.ui.patch\n\n",
    "(From update of attachment 40127)\nobsoleting in favor of Amy\u0027s  patch. \n\n",
    "I think this is a great fix, and will leave us in a better position as we move forward that we can evolve the definition of \"JSP Content\" in general. \n\nThanks Amy. \n\n",
    "fix released for this week\u0027s 1.5 rc2 build",
    "While releasing the fix for bug 98258, I found that the fixes for this bug did not make it into 1.5 RC2.  The person releasing the changes for bug 140093 overwrote the map file with their version and had retagged the plugin without grabbing the absolute latest changes.  I\u0027m changing the target to RC3 to reflect this.",
    "verified in wtp 1.5 rc5"
  ],
  "commentCreationDates": [
    "2006-05-02T22:59:56+02:00",
    "2006-05-02T23:04:49+02:00",
    "2006-05-03T00:25:02+02:00",
    "2006-05-04T06:31:22+02:00",
    "2006-05-04T06:33:12+02:00",
    "2006-05-04T06:33:23+02:00",
    "2006-05-04T06:41:11+02:00",
    "2006-05-04T06:42:04+02:00",
    "2006-05-04T07:16:48+02:00",
    "2006-05-10T05:11:55+02:00",
    "2006-06-20T00:04:13+02:00"
  ],
  "traces": [
    {
      "exceptionType": "java.lang.ClassCastException",
      "message": "org.eclipse.jst.jsp.css.core.internal.document.JSPedCSSModelImpl",
      "elements": [
        {
          "method": "org.eclipse.jst.jsp.core.internal.validation.JSPJavaValidator.validateFile",
          "source": "JSPJavaValidator.java:40"
        },
        {
          "method": "org.eclipse.jst.jsp.core.internal.validation.JSPValidator.validate",
          "source": "JSPValidator.java:155"
        },
        {
          "method": "org.eclipse.jst.jsp.core.internal.validation.JSPValidator.validateInJob",
          "source": "JSPValidator.java:351"
        },
        {
          "method": "org.eclipse.wst.validation.internal.operations.ValidatorJob.run",
          "source": "ValidatorJob.java:70"
        },
        {
          "method": "org.eclipse.core.internal.jobs.Worker.run",
          "source": "Worker.java:58"
        }
      ],
      "number": 0,
      "commentIndex": 0,
      "bugId": "139840",
      "date": "2006-05-02T22:59:56+02:00",
      "product": "Web Tools",
      "component": "jst.jsp",
      "severity": "normal"
    }
  ],
  "groupId": "139840",
  "bugId": "139840",
  "date": "2006-05-02T22:59:56+02:00",
  "product": "Web Tools",
  "component": "jst.jsp",
  "severity": "normal"
}